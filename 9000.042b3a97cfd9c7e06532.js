(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[9e3],{9e3:function(xe,Be,oe){oe(4656),function($){function v(s,a){return"number"==typeof s&&"number"==typeof a?s<=a:s["$<="](a)}function b(s,a){return"number"==typeof s&&"number"==typeof a?s+a:s["$+"](a)}function B(s,a){return"number"==typeof s&&"number"==typeof a?s>=a:s["$>="](a)}function L(s,a){return"number"==typeof s&&"number"==typeof a?s/a:s["$/"](a)}function k(s,a){return"number"==typeof s&&"number"==typeof a?s<a:s["$<"](a)}function H(s,a){return"number"==typeof s&&"number"==typeof a?s-a:s["$-"](a)}var a,de,Re,D,E,M,N,j,G,K,Y,q,J,Q,U,V,W,X,Z,O,ee,te,ie,ne,h,y,S,P,z=[],e=$.nil,x=$.$$,w=$.module,ce=$.klass,he=$.send2,I=$.range,f=$.truthy,A=$.send,ge=$.hash2;a=z,de=P=[w(z[0],"BCDice")].concat(a),Re=S=[w(P[0],"GameSystem")].concat(de),h=ce(S[0],x(S,"Base"),"Cthulhu7th_ChineseTraditional"),y=[h].concat(Re),h.$$prototype.bonus_dice_range=h.$$prototype.randomizer=e,$.const_set(y[0],"ID","Cthulhu7th:ChineseTraditional"),$.const_set(y[0],"NAME","\u514b\u8607\u9b6f\u795e\u8a71\u7b2c7\u7248"),$.const_set(y[0],"SORT_KEY","\u56fd\u969b\u5316:Chinese Traditional:\u514b\u8607\u9b6f\u795e\u8a71\u7b2c7\u7248"),$.const_set(y[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u3000CC(x)<=\uff08\u76ee\u6a19\u5024\uff09\n\u3000x\uff1a\u734e\u52f5\u9ab0/\u61f2\u7f70\u9ab0\uff1aBonus/Penalty Dice (2\uff5e\uff0d2)\u3002\u6c92\u6709\u7684\u8a71\u53ef\u4ee5\u7701\u7565\u3002\n\u3000\u81f4\u547d\u7684\u5931\u6557\uff1aFumble\uff0f\u5931\u6557\uff1aFailure\uff0f\u901a\u5e38\u6210\u529f\uff1aRegular success\uff0f\n\u3000\u56f0\u96e3\u6210\u529f\uff1aHard success\uff0f\u6975\u9650\u6210\u529f\uff1aExtreme success\uff0f\n\u3000\u6c7a\u5b9a\u6027\u7684\u6210\u529f\uff1aCritical success\u3000\u81ea\u52d5\u5224\u5b9a\u3002\n\u4f8b\uff09CC<=30\u3000CC(2)<=50\u3000CC(-1)<=75\n\n\u30fb\u7d44\u5408\u5224\u5b9a\u3000(CBR(x,y))\n\u3000\u9032\u884c\u76ee\u6a19\u5024 x \u548c y \u7684\u5224\u5b9a\u3002\n\u3000\u4f8b\uff09CBR(50,20)\n\n\u30fb\u9023\u5c04\uff08Full Auto\uff09\u5224\u5b9a\u3000FAR(w,x,y,z)\n\u3000w\uff1a\u5f48\u6578(1\uff5e100\uff09\u3001x\uff1a\u6280\u80fd\u5024\uff081\uff5e100\uff09\u3001y\uff1a\u6545\u969c\u7387\n\u3000z\uff1a\u734e\u52f5\u3001\u61f2\u7f70\u9ab0(-2\uff5e2)\u3002\u53ef\u7701\u7565\u3002\n\u3000\u53ea\u8a08\u7b97\u547d\u4e2d\u6578\u3001\u8cab\u7a7f\u6578\u53ca\u5269\u9918\u5f48\u85e5\uff0c\u4e0d\u8a08\u7b97\u50b7\u5bb3\u3002\n\u4f8b\uff09FAR(25,70,98)\u3000FAR(50,80,98,-1)\n\n\u30fb\u760b\u72c2\u8868\n\u30fb\u5be6\u6642\u578b\u3000Short\uff0f\u7e3d\u7d50\u578b\u3000Longer\n"),h.$register_prefix("CC","CBR","FAR"),$.def(h,"$initialize",D=function(n){var l=this;return D.$$p&&(D.$$p=null),he(l,$.find_super_dispatcher(l,"initialize",D,!1,!0),"initialize",[n],null),l.bonus_dice_range=I(-2,2,!1)},D.$$arity=1),$.def(h,"$eval_game_system_specific_command",E=function(n){var t,i=this;return/CC/i["$==="](t=n)?i.$getCheckResult(n):/CBR/i["$==="](t)?i.$getCombineRoll(n):/FAR/i["$==="](t)?i.$getFullAutoResult(n):e},E.$$arity=1),$.def(h,"$getCheckResult",M=function(n){var t,l,i=this,u=e,c=e,o=e,_=e,r=e;return f(/^CC([-\d]+)?<=(\d+)/i["$=~"](n)),t=x(y,"Regexp").$last_match(1).$to_i(),l=x(y,"Regexp").$last_match(2).$to_i(),f(v(l,0))?"\u932f\u8aa4\u3002\u76ee\u6a19\u503c\u9700\u70ba1\u4ee5\u4e0a\u3002":f(i.bonus_dice_range["$include?"](t))?(u=b(u="","(1D100<="+l+")"),u=b(u," \u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024["+t+"]"),c=i.$rollPercentD10(),o=i.$getTotalLists(t,c),_=i.$getTotal(o,t),r=i.$getCheckResultText(_,l),u=b(u," \uff1e "+o.$join(", ")+" \uff1e "+_+" \uff1e "+r)):"\u932f\u8aa4\u3002\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024\u70ba"+i.bonus_dice_range.$min()+"\uff5e"+i.bonus_dice_range.$max()+"\u3002"},M.$$arity=1),$.def(h,"$rollPercentD10",N=function(){var i=e;return(i=this.randomizer.$roll_once(10))["$=="](10)&&(i=0),i},N.$$arity=0),$.def(h,"$getTotalLists",j=function(n,i){var t,c,u=e;return u=[],c=b(1,n.$abs()),A(c,"times",[],((t=function(){var s,C=e;return(C=b((s=(null==t.$$s?this:t.$$s).$rollPercentD10(),"number"==typeof s?10*s:s["$*"](10)),i))["$=="](0)&&(C=100),u.$push(C)}).$$s=this,t.$$arity=0,t)),u},j.$$arity=2),$.def(h,"$getTotal",G=function(n,i){return f(B(i,0))?n.$min():n.$max()},G.$$arity=2),$.def(h,"$getCheckResultText",K=function(n,i,t){var u;if(null==t&&(t=!1),f(v(n,i)))return n["$=="](1)?"\u6c7a\u5b9a\u6027\u7684\u6210\u529f":f(v(n,L(i,5).$to_i()))?"\u6975\u9650\u7684\u6210\u529f":f(v(n,L(i,2).$to_i()))?"\u56f0\u96e3\u7684\u6210\u529f":"\u901a\u5e38\u6210\u529f";if(u="\u81f4\u547d\u7684\u5931\u6557",n["$=="](100))return u;if(f(B(n,96))){if(f(k(i,50)))return u;if(f(t))return u}return"\u5931\u6557"},K.$$arity=-3),$.def(h,"$getCombineRoll",Y=function(n){var i=this,t=e,l=e,u=e,c=e,o=e,_=e,r=e;return f(/CBR\((\d+),(\d+)\)/i["$=~"](n))?(t=x(y,"Regexp").$last_match(1).$to_i(),l=x(y,"Regexp").$last_match(2).$to_i(),u=i.randomizer.$roll_once(100),c=i.$getCheckResultText(u,t),o=i.$getCheckResultText(u,l),r=0,f((_=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f","\u56f0\u96e3\u7684\u6210\u529f","\u901a\u5e38\u6210\u529f"])["$include?"](c))&&(r=b(r,1)),f(_["$include?"](o))&&(r=b(r,1)),i.$debug("succesCount",r),"(1d100<="+t+","+l+") \uff1e "+u+"["+c+","+o+"] \uff1e "+(f(B(r,2))?"\u6210\u529f":r["$=="](1)?"\u90e8\u5206\u7684\u6210\u529f":"\u5931\u6557")):e},Y.$$arity=1),$.def(h,"$getFullAutoResult",q=function(n){var i=this,t=e,l=e,u=e,c=e,o=e,_=e,r=e;return f(/^FAR\((-?\d+)(,(-?\d+))(,(-?\d+))(,(-?\d+))?\)/i["$=~"](n))?(t=x(y,"Regexp").$last_match(1).$to_i(),l=x(y,"Regexp").$last_match(3).$to_i(),u=x(y,"Regexp").$last_match(5).$to_i(),c=(f(o=x(y,"Regexp").$last_match(7))?o:0).$to_i(),_="",f(function(s,a){return"number"==typeof s&&"number"==typeof a?s>a:s["$>"](a)}(t,r=100))&&(_=b(_,"\n\u5f48\u85e5\u592a\u591a\u3002\u8acb\u6539\u88dd\u586b"+r+"\u767c\u3002\n"),t=r),f(v(t,0))?"\u6b63\u78ba\u88dd\u586b\u6578\u3002":f(v(l,0))?"\u6b63\u78ba\u76ee\u6a19\u503c\u3002":(f(k(u,0))&&(_=b(_,"\n\u6b63\u78ba\u6545\u969c\u503c\u3002\u6392\u9664\u734e\u52f5\u8a18\u865f\u3002\n"),u=u.$abs()),f(i.bonus_dice_range["$include?"](c))?(_=b(_,"\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024["+c+"]"),_=b(_,i.$rollFullAuto(t,l,u,c))):"\n\u932f\u8aa4\u3002\u734e\u52f5\u3001\u61f2\u7f70\u9ab0\u5024\u70ba"+i.bonus_dice_range.$min()+"\uff5e"+i.bonus_dice_range.$max()+"\u3067\u3059\u3002")):e},q.$$arity=1),$.def(h,"$rollFullAuto",J=function(n,i,t,l){try{var u,o=e,_=e,r=e;return o="",_=0,r=ge(["hit_bullet","impale_bullet","bullet"],{hit_bullet:0,impale_bullet:0,bullet:n}),A(I(0,3,!1),"each",[],((u=function(T){var d,F,m=null==u.$$s?this:u.$$s,p=e,le=e,$e=e,re=e,se=e,ae=e,R=e;for(null==m.bonus_dice_range&&(m.bonus_dice_range=e),null==T&&(T=e),o=b(o,m.$getNextDifficltyMessage(T));f(B(l,m.bonus_dice_range.$min()));)_=b(_,1),F=m.$getHitResultInfos(l,i,T),p=null==(d=$.to_ary(F))[0]?e:d[0],le=null==d[1]?e:d[1],o=b(o,"\n"+_+"\u6b21: \uff1e "+(null==d[2]?e:d[2]).$join(", ")+" \uff1e "+p),f(B(le,t))&&(o=b(o,"\u5361\u5f48"),$.ret(m.$getHitResultText(o,r))),$e=m.$getHitType(T,p),F=m.$getBulletResults(r["$[]"]("bullet"),$e,i),re=null==(d=$.to_ary(F))[0]?e:d[0],se=null==d[1]?e:d[1],ae=null==d[2]?e:d[2],R=["hit_bullet",b(r["$[]"]("hit_bullet"),re)],A(r,"[]=",$.to_a(R)),H(R.length,1),R=["impale_bullet",b(r["$[]"]("impale_bullet"),se)],A(r,"[]=",$.to_a(R)),H(R.length,1),R=["bullet",H(r["$[]"]("bullet"),ae)],A(r,"[]=",$.to_a(R)),H(R.length,1),f(v(r["$[]"]("bullet"),0))&&$.ret(m.$getHitResultText(o,r)),l=H(l,1);return l=b(l,1)}).$$s=this,u.$$arity=1,u)),this.$getHitResultText(o,r)}catch(C){if(C===$.returner)return C.$v;throw C}},J.$$arity=4),$.def(h,"$getHitResultInfos",Q=function(n,i,t){var u,c,o,_,l=this;return u=l.$rollPercentD10(),c=l.$getTotalLists(n,u),o=l.$getTotal(c,n),_=l.$getFumbleable(t),[l.$getCheckResultText(o,i,_),o,c]},Q.$$arity=3),$.def(h,"$getHitResultText",U=function(n,i){return n+"\n\uff1e "+i["$[]"]("hit_bullet")+"\u767c\u5c04\u64ca\u547d\u4e2d\u3001"+i["$[]"]("impale_bullet")+"\u5c04\u64ca\u8cab\u7a7f\u3001\u5269\u9918\u5f48\u85e5"+i["$[]"]("bullet")+"\u767c"},U.$$arity=2),$.def(h,"$getHitType",V=function(n,i){var t,l,o=e;return l=this.$getSuccessListImpaleBulletList(n),o=null==(t=$.to_ary(l))[1]?e:t[1],f((null==t[0]?e:t[0])["$include?"](i))?"hit":f(o["$include?"](i))?"impale":""},V.$$arity=2),$.def(h,"$getBulletResults",W=function(n,i,t){var u,c,l=this,o=e,_=e,r=e,C=e,T=e,m=e;return u=l.$getSetOfBullet(t),c=l.$getHitBulletCountBase(t,u),o=L(u,2..$to_f()),_=0,r=0,C=0,f(l.$isLastBulletTurn(n,u)["$!"]())?("hit"["$==="](T=i)?r=c:"impale"["$==="](T)&&(r=o.$floor(),C=o.$ceil()),_=u):("hit"["$==="](T=i)?r=l.$getLastHitBulletCount(n):"impale"["$==="](T)&&(r=(m=L(n,2..$to_f())).$floor(),C=m.$ceil()),_=n),[r,C,_]},W.$$arity=3),$.def(h,"$getSuccessListImpaleBulletList",X=function(n){var u,t=e,l=e;return t=[],l=[],(0)["$==="](u=n)?(t=["\u56f0\u96e3\u7684\u6210\u529f","\u901a\u5e38\u6210\u529f"],l=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):1["$==="](u)?(t=["\u56f0\u96e3\u7684\u6210\u529f"],l=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):2["$==="](u)?(t=[],l=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f","\u6975\u9650\u7684\u6210\u529f"]):3["$==="](u)&&(t=["\u6c7a\u5b9a\u6027\u7684\u6210\u529f"],l=[]),[t,l]},X.$$arity=1),$.def(h,"$getNextDifficltyMessage",Z=function(n){var t;return 1["$==="](t=n)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u56f0\u96e3\u7684\u6210\u529f":2["$==="](t)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u6975\u9650\u7684\u6210\u529f":3["$==="](t)?"\n    \u8b8a\u66f4\u96e3\u5ea6\u70ba\u6c7a\u5b9a\u6027\u7684\u6210\u529f":""},Z.$$arity=1),$.def(h,"$getSetOfBullet",O=function(n){var l,t=e;return t=L(n,10).$to_i(),f(f(l=B(n,1))?k(n,10):l)&&(t=1),t},O.$$arity=1),$.def(h,"$getHitBulletCountBase",ee=function(n,i){var u,l=e;return l=L(i,2).$to_i(),f(f(u=B(n,1))?k(n,10):u)&&(l=1),l},ee.$$arity=2),$.def(h,"$isLastBulletTurn",te=function(n,i){return k(H(n,i),0)},te.$$arity=2),$.def(h,"$getLastHitBulletCount",ie=function(n){return n["$=="](1)?1:L(n,2..$to_f()).$floor()},ie.$$arity=1),$.def(h,"$getFumbleable",ne=function(n){return B(n,1)},ne.$$arity=1)}(Opal)}}]);