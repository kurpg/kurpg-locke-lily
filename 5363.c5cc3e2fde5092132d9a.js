(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[5363],{5363:function(Xe,Je,Qe){Qe(4656),Opal.modules["i18n/backend/fallbacks"]=function(e){function Y(p,s){return"number"==typeof p&&"number"==typeof s?p-s:p["$-"](s)}var s,a,L,T,K,H,O,w=[],r=e.nil,D=e.$$$,u=e.$$,$e=e.module,_=e.truthy,F=e.send,n=e.send2,t=e.hash2;return s=w,O=[H=$e(w[0],"I18n")].concat(s),e.class_variable_set(O[0],"@@fallbacks",r),a=e.get_singleton_class(H),K=[a].concat(O),e.def(a,"$fallbacks",L=function(){var G,i,f;return e.class_variable_set(K[1],"@@fallbacks",_(f=null==(G=K[1].$$cvars["@@fallbacks"])?r:G)?f:D(D(u(K,"I18n"),"Locale"),"Fallbacks").$new()),_(i=u(K,"Thread").$current()["$[]"]("i18n_fallbacks"))?i:null==(G=K[1].$$cvars["@@fallbacks"])?r:G},L.$$arity=0),e.def(a,"$fallbacks=",T=function(G){var I,i;return e.class_variable_set(K[1],"@@fallbacks",_(G["$is_a?"](u(K,"Array")))?D(D(u(K,"I18n"),"Locale"),"Fallbacks").$new(G):G),i=["i18n_fallbacks",null==(I=K[1].$$cvars["@@fallbacks"])?r:I],F(u(K,"Thread").$current(),"[]=",e.to_a(i)),i[Y(i.length,1)]},T.$$arity=1),void function(a,C){var L=[$e(a,"Backend")].concat(C);!function(T,X){var f,i,b,c,G=$e(T,"Fallbacks"),I=[G].concat(X);e.def(G,"$translate",f=function(P,m,l){try{var R,q=f.$$p,A=this,h=r,g=r,z=r,B=r,j=r,o=r;for(q&&(f.$$p=null),j=0,o=arguments.length,B=new Array(o);j<o;j++)B[j]=arguments[j];return null==l&&(l=u(I,"EMPTY_HASH")),!_(l.$fetch("fallback",!0))||_(l["$[]"]("fallback_in_progress"))?n(A,e.find_super_dispatcher(A,"translate",f,!1,!0),"translate",B,q):(_(l["$[]"]("default"))&&(h=A["$extract_non_symbol_default!"](l)),g=l.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),F(u(I,"I18n").$fallbacks()["$[]"](P),"each",[],((R=function(te){var ue,se=null==R.$$s?this:R.$$s;null==te&&(te=r);try{return F(se,"catch",["exception"],((ue=function(){var Re=null==ue.$$s?this:ue.$$s,ze=r;if(ze=n(Re,e.find_iter_super_dispatcher(Re,"translate",ue.$$def||R.$$def||f,!1,!1),"translate",[te,m,g],null),_(ze["$nil?"]()))return r;_(P.$to_s()["$!="](te.$to_s()))&&Re.$on_fallback(P,te,m,l),e.ret(ze)}).$$s=se,ue.$$arity=0,ue))}catch(Te){if(!e.rescue(Te,[D(u(I,"I18n"),"InvalidLocale")]))throw Te;try{return r}finally{e.pop_exception()}}}).$$s=A,R.$$arity=1,R)),_(_(z=l["$key?"]("default"))?l["$[]"]("default")["$nil?"]():z)?r:_(h)?n(A,e.find_super_dispatcher(A,"translate",f,!1,!0),"translate",[P,r,l.$merge(t(["default"],{default:h}))],null):A.$throw("exception",D(u(I,"I18n"),"MissingTranslation").$new(P,m,l)))}catch(E){if(E===e.returner)return E.$v;throw E}},f.$$arity=-3),e.def(G,"$extract_non_symbol_default!",i=function(P){var m,q,R=r,re=r;return R=[P["$[]"]("default")].$flatten(),q=F(R,"detect",[],((m=function(h){return null==h&&(h=r),h["$is_a?"](u(I,"Symbol"))["$!"]()}).$$s=this,m.$$arity=1,m)),_(q)&&(re=["default",R["$[]"](0,R.$index(q))],F(P,"[]=",e.to_a(re)),Y(re.length,1)),q},i.$$arity=1),e.def(G,"$exists?",b=function(P,m,l){try{var R,q=b.$$p,A=this,h=r,g=r,z=r;for(q&&(b.$$p=null),g=0,z=arguments.length,h=new Array(z);g<z;g++)h[g]=arguments[g];return null==l&&(l=u(I,"EMPTY_HASH")),_(l.$fetch("fallback",!0))?(F(u(I,"I18n").$fallbacks()["$[]"](P),"each",[],((R=function(j){var o=null==R.$$s?this:R.$$s;null==j&&(j=r);try{if(!_(n(o,e.find_iter_super_dispatcher(o,"exists?",R.$$def||b,!1,!1),"exists?",[j,m],null)))return r;e.ret(!0)}catch(E){if(!e.rescue(E,[D(u(I,"I18n"),"InvalidLocale")]))throw E;try{return r}finally{e.pop_exception()}}}).$$s=A,R.$$arity=1,R)),!1):n(A,e.find_super_dispatcher(A,"exists?",b,!1,!0),"exists?",h,q)}catch(B){if(B===e.returner)return B.$v;throw B}},b.$$arity=-3),G.$private(),e.def(G,"$on_fallback",c=function(P,m,l,R){return r},c.$$arity=4)}(L[0],L)}(O[0],O)},Opal.modules["bcdice/randomizer"]=function(e){function Y(a,C){return"number"==typeof a&&"number"==typeof C?a>C:a["$>"](C)}function J(a,C){return"number"==typeof a&&"number"==typeof C?a+C:a["$+"](C)}function w(a,C){return"number"==typeof a&&"number"==typeof C?a<=C:a["$<="](C)}function r(a,C){return"number"==typeof a&&"number"==typeof C?a-C:a["$-"](C)}function D(a,C){return"number"==typeof a&&"number"==typeof C?a*C:a["$*"](C)}var C,G,i,b,c,k,P,m,l,R,q,re,A,I,f,L,_=[],F=e.nil,n=e.$$$,t=e.$$,s=e.klass,H=e.truthy,O=e.send;return C=_,G=L=[(0,e.module)(_[0],"BCDice")].concat(C),I=s(L[0],null,"Randomizer"),f=[I].concat(G),I.$$prototype.rand_results=I.$$prototype.detailed_rand_results=F,e.const_set(f[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(f[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(f[0],"UPPER_LIMIT_RANDS",1e4),e.def(I,"$initialize",i=function(){return this.rand_results=[],this.detailed_rand_results=[]},i.$$arity=0),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),e.const_set(f[0],"DetailedRandResult",t(f,"Struct").$new("kind","sides","value")),e.def(I,"$roll_barabara",b=function(g,z){var B,o,j=this;return H(Y(J(j.rand_results.$size(),g),t(f,"UPPER_LIMIT_RANDS")))&&j.$raise(t(f,"TooManyRandsError")),H(H(o=w(g,0))?o:Y(g,t(f,"UPPER_LIMIT_DICE_TIMES")))?[]:O(t(f,"Array"),"new",[g],((B=function(){return(null==B.$$s?this:B.$$s).$roll_once(z)}).$$s=j,B.$$arity=0,B))},b.$$arity=2),e.def(I,"$roll_sum",c=function(g,z){return this.$roll_barabara(g,z).$sum()},c.$$arity=2),e.def(I,"$roll_once",k=function(g){var B,j=F;return H(H(B=w(g,0))?B:Y(g,t(f,"UPPER_LIMIT_DICE_SIDES")))?0:(j=this.$rand_inner(g),this.$push_to_detail("normal",g,j),j)},k.$$arity=1),e.def(I,"$roll_index",P=function(g){return r(this.$roll_once(g),1)},P.$$arity=1),e.def(I,"$roll_tens_d10",m=function(){var B,z=F;return(z=this.$rand_inner(10))["$=="](10)&&(z=0),B=D(z,10),this.$push_to_detail("tens_d10",10,B),B},m.$$arity=0),e.def(I,"$roll_d9",l=function(){var z;return z=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,z),z},l.$$arity=0),e.def(I,"$roll_d66",R=function(g){var z,o,j=F;return j=O(t(f,"Array"),"new",[2],((z=function(){return(null==z.$$s?this:z.$$s).$roll_once(6)}).$$s=this,z.$$arity=0,z)),o=g,n(t(f,"D66SortType"),"ASC")["$==="](o)?j["$sort!"]():n(t(f,"D66SortType"),"DESC")["$==="](o)&&j["$sort!"]()["$reverse!"](),J(D(j["$[]"](0),10),j["$[]"](1))},R.$$arity=1),I.$private(),e.def(I,"$rand_inner",q=function(g){var B,z=this;return H(function(a,C){return"number"==typeof a&&"number"==typeof C?a>=C:a["$>="](C)}(z.rand_results.$size(),t(f,"UPPER_LIMIT_RANDS")))&&z.$raise(t(f,"TooManyRandsError")),B=z.$random(g),z.rand_results["$<<"]([B,g]),B},q.$$arity=1),e.def(I,"$random",re=function(g){return J(t(f,"Kernel").$rand(g),1)},re.$$arity=1),e.def(I,"$push_to_detail",A=function(g,z,B){var o;return o=t(f,"DetailedRandResult").$new(g,z,B),this.detailed_rand_results.$push(o)},A.$$arity=3),void function(T,X,G){[s(T,X,"TooManyRandsError")].concat(G)}(L[0],t(L,"StandardError"),L)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var n,H,L,G,I,f,i,T,X,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.klass,_=e.truthy;return n=J,H=p=[u(J[0],"BCDice")].concat(n),L=a=[u(p[0],"DiceTable")].concat(H),T=$e(a[0],null,"RollResult"),X=[T].concat(L),T.$$prototype.table_name=T.$$prototype.value=T.$$prototype.body=w,e.def(T,"$initialize",G=function(c,k,P){var m=this;return m.table_name=c,m.value=k,m.body=P},G.$$arity=3),T.$attr_reader("table_name"),T.$attr_reader("value"),T.$attr_reader("body"),e.def(T,"$to_s",I=function(){var c=this;return c.table_name+"("+c.value+") \uff1e "+c.body},I.$$arity=0),e.def(T,"$last_body",f=function(){var c=this;return _(c.body["$is_a?"](D(X,"RollResult")))?c.body.$last_body():c.body},f.$$arity=0),void e.def(T,"$empty?",i=function(){return!1},i.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,O,T,I,f,X,G,C,s,w=[],r=e.nil,u=e.$$,$e=e.module,_=e.klass,F=e.truthy;return t=w,O=s=[$e(w[0],"BCDice")].concat(t),T=C=[$e(s[0],"DiceTable")].concat(O),X=_(C[0],null,"ChainTable"),G=[X].concat(T),X.$$prototype.times=X.$$prototype.sides=X.$$prototype.items=X.$$prototype.name=r,e.def(X,"$initialize",I=function(b,c,k){var P=this,m=r;return P.name=b,P.items=k.$freeze(),m=/(\d+)D(\d+)/i.$match(c),F(m)||P.$raise(u(G,"ArgumentError"),"Unexpected table type: "+c),P.times=m["$[]"](1).$to_i(),P.sides=m["$[]"](2).$to_i()},I.$$arity=3),void e.def(X,"$roll",f=function(b){var k,P,c=this,m=r;return P=function(n,t){return"number"==typeof n&&"number"==typeof t?n-t:n["$-"](t)}(k=b.$roll_sum(c.times,c.sides),c.times),m=c.items["$[]"](P),F(m["$respond_to?"]("roll"))&&(m=m.$roll(b)),u(G,"RollResult").$new(c.name,k,m)},f.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function w(p,s){return"number"==typeof p&&"number"==typeof s?p-s:p["$-"](s)}var s,C,G,i,b,c,I,f,L,O,D=[],u=e.nil,_=e.$$,F=e.module,n=e.klass,t=e.hash2;return s=D,C=O=[F(D[0],"BCDice")].concat(s),G=L=[F(O[0],"DiceTable")].concat(C),I=n(L[0],null,"D66GridTable"),f=[I].concat(G),I.$$prototype.name=I.$$prototype.items=u,e.defs(I,"$from_i18n",i=function(P,m){var R=u;return R=_(f,"I18n").$t(P,t(["locale","raise"],{locale:m,raise:!0})),this.$new(R["$[]"]("name"),R["$[]"]("items"))},i.$$arity=2),e.def(I,"$initialize",b=function(P,m){return this.name=P,this.items=m.$freeze()},b.$$arity=2),void e.def(I,"$roll",c=function(P){var l,R,q,re,A,p;return l=P.$roll_once(6),R=P.$roll_once(6),q=function(p,s){return"number"==typeof p&&"number"==typeof s?p+s:p["$+"](s)}("number"==typeof(p=l)?10*p:p["$*"](10),R),re=w(l,1),A=w(R,1),_(f,"RollResult").$new(this.name,q,this.items["$[]"](re)["$[]"](A))},c.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var n,H,L,G,I,T,X,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.klass,_=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),n=J,H=p=[u(J[0],"BCDice")].concat(n),L=a=[u(p[0],"DiceTable")].concat(H),T=$e(a[0],D(a,"D66GridTable"),"D66HalfGridTable"),X=[T].concat(L),e.defs(T,"$from_i18n",G=function(i,b){var k=w;return k=D(X,"I18n").$t(i,_(["locale","raise"],{locale:b,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))},G.$$arity=2),void e.def(T,"$initialize",I=function(i,b,c){return this.name=i,this.items=[b,b,b,c,c,c].$freeze()},I.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var n,H,L,G,I,T,X,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.klass,_=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),n=J,H=p=[u(J[0],"BCDice")].concat(n),L=a=[u(p[0],"DiceTable")].concat(H),T=$e(a[0],D(a,"D66GridTable"),"D66OneThirdTable"),X=[T].concat(L),e.defs(T,"$from_i18n",G=function(i,b){var k=w;return k=D(X,"I18n").$t(i,_(["locale","raise"],{locale:b,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))},G.$$arity=2),void e.def(T,"$initialize",I=function(i,b,c,k){return this.name=i,this.items=[b,b,c,c,k,k].$freeze()},I.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var s,C,G,i,b,c,k,I,f,L,O,r=[],D=e.nil,u=e.$$$,$e=e.$$,_=e.module,F=e.klass,n=e.hash2,t=e.truthy;return s=r,C=O=[_(r[0],"BCDice")].concat(s),G=L=[_(O[0],"DiceTable")].concat(C),I=F(L[0],null,"D66Table"),f=[I].concat(G),I.$$prototype.sort_type=I.$$prototype.items=I.$$prototype.name=D,e.defs(I,"$from_i18n",i=function(m,l){var re,q=D;return q=$e(f,"I18n").$t(m,n(["locale"],{locale:l})),re=$e(f,"D66SortType").$const_get(q["$[]"]("d66_sort_type")),this.$new(q["$[]"]("name"),re,q["$[]"]("items"))},i.$$arity=2),e.def(I,"$initialize",b=function(m,l,R){var q=this;return q.name=m,q.sort_type=l,q.items=R.$freeze()},b.$$arity=3),e.def(I,"$roll",c=function(m){var q,h,p,l=this,R=D,re=D,A=D;return R=m.$roll_barabara(2,6),q=l.sort_type,u($e(f,"D66SortType"),"ASC")["$==="](q)?R["$sort!"]():u($e(f,"D66SortType"),"DESC")["$==="](q)&&R["$sort!"]()["$reverse!"](),re=function(p,s){return"number"==typeof p&&"number"==typeof s?p+s:p["$+"](s)}("number"==typeof(p=R["$[]"](0))?10*p:p["$*"](10),R["$[]"](1)),A=t(h=l.items["$[]"](re))?h:l.items["$[]"](re.$to_s()),t(A["$respond_to?"]("roll"))&&(A=A.$roll(m)),$e(f,"RollResult").$new(l.name,re,A)},c.$$arity=1),void e.def(I,"$choice",k=function(m){return $e(f,"RollResult").$new(this.name,m,this.items["$[]"](m))},k.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function Y(H,O){return"number"==typeof H&&"number"==typeof O?H+O:H["$+"](O)}var O,f,c,i,L,X,C,D=[],u=e.nil,_=e.$$,F=e.module,n=e.klass,t=e.hash2,p=e.send,s=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),O=D,L=C=[F(D[0],"BCDice")].concat(O),f=X=[F(C[0],"DiceTable")].concat(L),[i=n(X[0],_(X,"D66Table"),"D66LeftRangeTable")].concat(f),void e.def(i,"$initialize",c=function(P,m,l){var R,h,A=this;return c.$$p&&(c.$$p=null),h=t([],{}),p(l,"each",[],((R=function(g){function z(B){return g.apply(this,arguments)}return z.toString=function(){return g.toString()},z}(function(g){var B,o,te,z=null==R.$$s?this:R.$$s;return null==g&&(g=u),B=e.to_ary(g),te=null==B[1]?u:B[1],p(null==B[0]?u:B[0],"each",[],((o=function(ue){var Re;return null==ue&&(ue=u),p(te,"each_with_index",[],((Re=function(Le,fe){var V,M,H;return null==Le&&(Le=u),null==fe&&(fe=u),V=Y("number"==typeof(H=ue)?10*H:H["$*"](10),Y(fe,1)),p(h,"[]=",e.to_a(M=[V,Le])),M[function(H,O){return"number"==typeof H?H-1:H["$-"](1)}(M.length)]}).$$s=null==o.$$s?this:o.$$s,Re.$$arity=2,Re))}).$$s=z,o.$$arity=1,o))})).$$s=A,R.$$arity=1,R)),s(A,e.find_super_dispatcher(A,"initialize",c,!1,!0),"initialize",[P,m,h],null)},c.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var s,C,G,i,b,I,f,L,O,D=[],u=e.nil,_=e.$$,F=e.module,n=e.klass,t=e.truthy;return s=D,C=O=[F(D[0],"BCDice")].concat(s),G=L=[F(O[0],"DiceTable")].concat(C),I=n(L[0],null,"D66ParityTable"),f=[I].concat(G),I.$$prototype.odd=I.$$prototype.even=I.$$prototype.name=u,e.def(I,"$initialize",i=function(k,P,m){var l=this;return l.name=k,l.odd=P.$freeze(),l.even=m.$freeze()},i.$$arity=3),void e.def(I,"$roll",b=function(k){var l,q,re,p,P=this,m=u;return m=k.$roll_once(6),l=k.$roll_once(6),q=(t(m["$odd?"]())?P.odd:P.even)["$[]"]("number"==typeof(p=l)?p-1:p["$-"](1)),re=function(p,s){return"number"==typeof p&&"number"==typeof s?p+s:p["$+"](s)}(function(p,s){return"number"==typeof p?10*p:p["$*"](10)}(m),l),_(f,"RollResult").$new(P.name,re,q)},b.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var p,a,X,f,i,G,I,K,H,r=[],D=e.nil,$e=e.$$,_=e.module,F=e.klass,n=e.send;return p=r,a=H=[_(r[0],"BCDice")].concat(p),X=K=[_(H[0],"DiceTable")].concat(a),G=F(K[0],null,"D66RangeTable"),I=[G].concat(X),G.$$prototype.items=G.$$prototype.name=D,e.def(G,"$initialize",f=function(c,k){return this.name=c,this.items=k.$freeze()},f.$$arity=2),void e.def(G,"$roll",i=function(c){var k,m,l,R,t,P=this,q=D;return m=c.$roll_once(6),l=c.$roll_once(6),R=function(t,p){return"number"==typeof t&&"number"==typeof p?t+p:t["$+"](p)}("number"==typeof(t=m)?10*t:t["$*"](10),l),q=n(P.items,"find",[],((k=function(A){return null==A&&(A=D),A["$[]"](0)["$include?"](R)}).$$s=P,k.$$arity=1,k)),$e(I,"RollResult").$new(P.name,R,q["$[]"](1))},i.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var H,K,I,b,c,k,P,m,l,R,q,re,f,i,T,a,D=[],u=e.nil,_=e.$$,F=e.module,n=e.klass,t=e.send,p=e.truthy;return H=D,K=a=[F(D[0],"BCDice")].concat(H),I=T=[F(a[0],"DiceTable")].concat(K),f=n(T[0],null,"RangeTable"),i=[f].concat(I),f.$$prototype.name=f.$$prototype.items=f.$$prototype.num_of_dice=f.$$prototype.num_of_sides=f.$$prototype.formatter=u,e.const_set(i[0],"RollResult",t(_(i,"Struct"),"new",["sum","values","content","formatted"],((b=function(){return(null==b.$$s?this:b.$$s).$alias_method("to_s","formatted")}).$$s=f,b.$$arity=0,b))),e.const_set(i[0],"Item",_(i,"Struct").$new("range","content")),e.const_set(i[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(i[0],"DEFAULT_FORMATTER",t(f,"lambda",[],($$2=function(A){function h(g,z){return A.apply(this,arguments)}return h.toString=function(){return A.toString()},h}(function(A,h){return null==$$2.$$s||$$2,null==A&&(A=u),null==h&&(h=u),A.$name()+"("+h.$sum()+") \uff1e "+h.$content()}),$$2.$$s=f,$$2.$$arity=2,$$2))),f.$attr_reader("name"),f.$attr_reader("num_of_dice"),f.$attr_reader("num_of_sides"),e.def(f,"$initialize",c=function(h,g,z){var E,B=c.$$p,j=B||u,o=this,te=u;return B&&(c.$$p=null),B&&(c.$$p=null),o.name=h.$freeze(),o.formatter=p(E=j)?E:_(i,"DEFAULT_FORMATTER"),te=_(i,"DICE_ROLL_METHOD_RE").$match(g),p(te)||o.$raise(_(i,"ArgumentError"),o.name+": invalid dice roll method: "+g),o.num_of_dice=te["$[]"](1).$to_i(),o.num_of_sides=te["$[]"](2).$to_i(),o.$store(z)},c.$$arity=3),e.def(f,"$fetch",k=function(h){var g,B,z=this;return B=t(z.items,"find",[],((g=function(o){return null==o&&(o=u),o.$range()["$include?"](h)}).$$s=z,g.$$arity=1,g)),p(B)||z.$raise(_(i,"RangeError"),z.name+": value is out of range: "+h),B},k.$$arity=1),e.def(f,"$roll",P=function(h){var B,j,o,s,g=this,z=u;return B=(z=h.$roll_barabara(g.num_of_dice,g.num_of_sides)).$sum(),j=_(i,"RollResult").$new(B,z,g.$fetch(B).$content()),o=[g.formatter["$[]"](g,j)],t(j,"formatted=",e.to_a(o)),"number"==typeof(s=o.length)||s["$-"](1),j},P.$$arity=1),f.$private(),e.def(f,"$store",m=function(h){var g,z,B,o,E,j=this;return o=t(h,"map",[],((g=function(se,ue){return null==se&&(se=u),null==ue&&(ue=u),[(null==g.$$s?this:g.$$s).$coerce_to_int_range(se),ue]}).$$s=j,g.$$arity=2,g)),E=t(o,"sort_by",[],((z=function(se,ue){return null==se&&(se=u),null==ue&&(ue=u),se.$min()}).$$s=j,z.$$arity=2,z)),j.$assert_min_sum_is_covered(E),j.$assert_max_sum_is_covered(E),j.$assert_no_gap_or_overlap_in_ranges(E),j.items=t(E,"map",[],(B=function(se,ue){return null==se&&(se=u),null==ue&&(ue=u),_(i,"Item").$new(se,ue.$freeze()).$freeze()},B.$$s=j,B.$$arity=2,B)).$freeze(),j},m.$$arity=1),e.def(f,"$coerce_to_int_range",l=function(h){var z,B=u;return z=h,_(i,"Integer")["$==="](z)?_(i,"Range").$new(h,h):_(i,"Range")["$==="](z)&&p(p(B=h.$begin()["$is_a?"](_(i,"Integer")))?h.$end()["$is_a?"](_(i,"Integer")):B)?h:this.$raise(_(i,"TypeError"),this.name+": "+h+" ("+h.$class()+") must be an Integer or a Range with Integers ")},l.$$arity=1),e.def(f,"$assert_min_sum_is_covered",R=function(h){var z,g=this,B=u;return z=g.num_of_dice,B=h.$first()["$[]"](0),p(B["$include?"](z))||g.$raise(_(i,"RangeError"),g.name+": min value ("+z+") is not covered: "+B),g},R.$$arity=1),e.def(f,"$assert_max_sum_is_covered",q=function(h){var z,g=this,B=u;return z=function(s,H){return"number"==typeof s&&"number"==typeof H?s*H:s["$*"](H)}(g.num_of_dice,g.num_of_sides),B=h.$last()["$[]"](0),p(B["$include?"](z))||g.$raise(_(i,"RangeError"),g.name+": max value ("+z+") is not covered: "+B),g},q.$$arity=1),void e.def(f,"$assert_no_gap_or_overlap_in_ranges",re=function(h){var g;return t(h,"each_cons",[2],((g=function(j,o){var ue,Te,s,E=null==g.$$s?this:g.$$s,te=u,se=u;return null==E.name&&(E.name=u),null==j&&(j=u),null==o&&(o=u),te=j["$[]"](0),se=o["$[]"](0),Te="number"==typeof(s=ue=te.$max())?s+1:s["$+"](1),p(se["$include?"](ue))&&E.$raise(_(i,"RangeError"),E.name+": Range overlap: "+te+" and "+se),p(se["$include?"](Te))?u:E.$raise(_(i,"RangeError"),E.name+": Range gap: "+te+" and "+se)}).$$s=this,g.$$arity=2,g)),this},re.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,O,T,i,k,P,m,b,c,G,C,s,w=[],r=e.nil,D=e.$$$,u=e.$$,$e=e.module,_=e.klass,F=e.send;return t=w,O=s=[$e(w[0],"BCDice")].concat(t),T=C=[$e(s[0],"DiceTable")].concat(O),i=G=[_(C[0],null,"SaiFicSkillTable")].concat(T),b=_(G[0],null,"Category"),c=[b].concat(i),b.$$prototype.name=r,e.def(b,"$initialize",k=function(R,q,re,A){var h,g=this;return g.name=R,g.skills=F(q.$map(),"with_index",[2],((h=function(z){function B(j,o){return z.apply(this,arguments)}return B.toString=function(){return z.toString()},B}(function(z,B){return null==z&&(z=r),null==B&&(B=r),D(u(c,"SaiFicSkillTable"),"Skill").$new(R,z,re,B,A)})).$$s=g,h.$$arity=2,h)),g.dice=re},k.$$arity=4),e.def(b,"$roll",P=function(R){return this.$skills()["$[]"]("number"==typeof(n=R.$roll_sum(2,6))?n-2:n["$-"](2));var n},P.$$arity=1),e.def(b,"$to_s",m=function(){return this.name},m.$$arity=0),void b.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var n,H,f,c,k,i,L,X,a,p,J=[],w=e.nil,u=e.module,$e=e.klass,_=e.hash2;return n=J,H=p=[u(J[0],"BCDice")].concat(n),L=a=[u(p[0],"DiceTable")].concat(H),f=X=[$e(a[0],null,"SaiFicSkillTable")].concat(L),[i=$e(X[0],null,"Skill")].concat(f),i.$$prototype.s_format=i.$$prototype.category_dice=i.$$prototype.row_dice=i.$$prototype.category_name=i.$$prototype.name=w,e.def(i,"$initialize",c=function(m,l,R,q,re){var A=this;return A.category_name=m,A.name=l,A.category_dice=R,A.row_dice=q,A.s_format=re},c.$$arity=5),e.def(i,"$to_s",k=function(){var m=this;return m.$format(m.s_format,_(["category_dice","row_dice","category_name","skill_name"],{category_dice:m.category_dice,row_dice:m.row_dice,category_name:m.category_name,skill_name:m.name}))},k.$$arity=0),void i.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var O,L,f,c,k,P,m,l,R,q,i,b,X,C,w=e.top,r=[],D=e.nil,u=e.$$$,$e=e.$$,_=e.module,F=e.klass,n=e.hash2,t=e.send,s=e.truthy;return w.$require("bcdice/dice_table/sai_fic_skill_table/category"),w.$require("bcdice/dice_table/sai_fic_skill_table/skill"),O=r,L=C=[_(r[0],"BCDice")].concat(O),f=X=[_(C[0],"DiceTable")].concat(L),i=F(X[0],null,"SaiFicSkillTable"),b=[i].concat(f),i.$$prototype.rtt=i.$$prototype.rtt_format=i.$$prototype.rct=i.$$prototype.rct_format=i.$$prototype.rttn=i.$$prototype.rttn_format=i.$$prototype.categories=D,e.defs(i,"$from_i18n",c=function(A,h,g){var z,B,j,o,ue,se=D;if(null==g)g=n([],{});else if(!g.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(z=g.$$smap.rtt)&&(z=D),null==(B=g.$$smap.rct)&&(B=D),null==(j=g.$$smap.rttn)&&(j=D),ue=(se=$e(b,"I18n").$t("RTT",n(["locale","raise","default"],{locale:h,raise:!1,default:n([],{})})).$merge($e(b,"I18n").$t(A,n(["locale","raise"],{locale:h,raise:!0}))))["$[]"]("items"),se=t(se,"select",[],((o=function(Te){function Re(ze,Le){return Te.apply(this,arguments)}return Re.toString=function(){return Te.toString()},Re}(function(Te,Re){return null==Te&&(Te=D),null==Re&&(Re=D),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Te)})).$$s=this,o.$$arity=2,o)),this.$new(ue,e.to_hash(se).$merge(n(["rtt","rct","rttn"],{rtt:z,rct:B,rttn:j})))},c.$$arity=-3),e.const_set(b[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(b[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(b[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(b[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(i,"$initialize",k=function(A,h){var g,z,B,j,o,E,te,se,ue=this;if(null==h)h=n([],{});else if(!h.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(g=h.$$smap.rtt)&&(g=D),null==(z=h.$$smap.rct)&&(z=D),null==(B=h.$$smap.rttn)&&(B=D),null==(j=h.$$smap.rtt_format)&&(j=$e(b,"DEFAULT_RTT")),null==(o=h.$$smap.rct_format)&&(o=$e(b,"DEFAULT_RCT")),null==(E=h.$$smap.rttn_format)&&(E=$e(b,"DEFAULT_RTTN")),null==(te=h.$$smap.s_format)&&(te=$e(b,"DEFAULT_S")),ue.categories=t(A.$map(),"with_index",[1],((se=function(Re,ze){var fe,V,M;return null==Re&&(Re=D),null==ze&&(ze=D),V=null==(fe=e.to_ary(Re))[0]?D:fe[0],M=null==fe[1]?D:fe[1],u($e(b,"SaiFicSkillTable"),"Category").$new(V,M,ze,te)}).$$s=ue,se.$$arity=2,se.$$has_top_level_mlhs_arg=!0,se)),ue.rtt=g,ue.rct=z,ue.rttn=B.$to_a(),ue.rtt_format=j,ue.rct_format=o,ue.rttn_format=E},k.$$arity=-2),e.const_set(b[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),i.$attr_reader("categories"),e.def(i,"$roll_command",P=function(A,h){var z,g=this,B=D,j=D,o=D;return s(["RTT",g.rtt]["$include?"](z=h))?g.$format_skill(g.rtt_format,g.$roll_skill(A)):s(["RCT",g.rct]["$include?"](z))?(B=g.$roll_category(A),g.$format(g.rct_format,n(["category_dice","category_name"],{category_dice:B.$dice(),category_name:B.$name()}))):s(s(j=o=$e(b,"RTTN").$index(z))?j:o=g.rttn.$index(z))?g.$format_skill(g.rttn_format,g.categories["$[]"](o).$roll(A)):D},P.$$arity=2),e.def(i,"$roll_category",m=function(A){return this.categories["$[]"]("number"==typeof(H=A.$roll_once(6))?H-1:H["$-"](1));var H},m.$$arity=1),e.def(i,"$roll_skill",l=function(A){return this.$roll_category(A).$roll(A)},l.$$arity=1),e.def(i,"$prefixes",R=function(){var A=this;return function(H,O){return"number"==typeof H&&"number"==typeof O?H+O:H["$+"](O)}(["RTT[1-6]?","RCT",A.rtt,A.rct],A.rttn).$compact()},R.$$arity=0),i.$private(),void e.def(i,"$format_skill",q=function(A,h){return this.$format(A,n(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:h.$category_dice(),row_dice:h.$row_dice(),category_name:h.$category_name(),skill_name:h.$name(),text:h.$to_s()}))},q.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var p,a,X,f,i,b,c,G,I,K,H,w=[],r=e.nil,u=e.$$,$e=e.module,_=e.klass,F=e.hash2,n=e.truthy;return p=w,a=H=[$e(w[0],"BCDice")].concat(p),X=K=[$e(H[0],"DiceTable")].concat(a),G=_(K[0],null,"Table"),I=[G].concat(X),G.$$prototype.times=G.$$prototype.sides=G.$$prototype.name=G.$$prototype.items=r,e.defs(G,"$from_i18n",f=function(P,m){var R=r;return R=u(I,"I18n").$t(P,F(["locale"],{locale:m})),this.$new(R["$[]"]("name"),R["$[]"]("type"),R["$[]"]("items"))},f.$$arity=2),e.def(G,"$initialize",i=function(P,m,l){var R=this,q=r;return R.name=P,R.items=l.$freeze(),q=/(\d+)D(\d+)/i.$match(m),n(q)||R.$raise(u(I,"ArgumentError"),"Unexpected table type: "+m),R.times=q["$[]"](1).$to_i(),R.sides=q["$[]"](2).$to_i()},i.$$arity=3),e.def(G,"$roll",b=function(P){var l,m=this;return l=P.$roll_sum(m.times,m.sides),m.$choice(l)},b.$$arity=1),void e.def(G,"$choice",c=function(P){var l,m=this;return l=function(t,p){return"number"==typeof t&&"number"==typeof p?t-p:t["$-"](p)}(P,m.times),u(I,"RollResult").$new(m.name,P,m.items["$[]"](l))},c.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var _,p,H,n,J=[],u=e.module;return _=J,p=n=[u(J[0],"BCDice")].concat(_),H=[u(n[0],"D66SortType")].concat(p),e.const_set(H[0],"NO_SORT","no_sort"),e.const_set(H[0],"ASC","asc"),e.const_set(H[0],"DESC","desc"),void function(t,p){var H=[u(t,"RoundType")].concat(p);e.const_set(H[0],"CEIL","ceil"),e.const_set(H[0],"FLOOR","floor"),e.const_set(H[0],"ROUND","round")}(n[0],n)},Opal.modules["bcdice/translate"]=function(e){var n,H,C,O,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.hash2;return n=J,H=p=[u(J[0],"BCDice")].concat(n),O=u(p[0],"Translate"),a=[O].concat(H),void e.def(O,"$translate",C=function(L,T){var X,G=this;if(null==G.locale&&(G.locale=w),null==T)T=$e([],{});else if(!T.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return X=e.kwrestargs(T,{}),D(a,"I18n").$translate(L,$e(["locale","raise"],{locale:G.locale,raise:!0}).$merge(e.to_hash(X)))},C.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function Y(n,t){return"number"==typeof n&&"number"==typeof t?n-t:n["$-"](t)}var t,b,P,m,l,R,q,a,L,T,X,G,I,f,i,C,K,s,w=[],r=e.nil,_=e.klass,F=e.send;return t=w,a=s=[(0,e.module)(w[0],"BCDice")].concat(t),K=[C=_(s[0],null,"Result")].concat(a),C.$$prototype.secret=C.$$prototype.success=C.$$prototype.failure=C.$$prototype.critical=C.$$prototype.fumble=r,[b=e.get_singleton_class(C)].concat(K),e.def(b,"$success",P=function(A){var h;return F(this.$new(),"tap",[],((h=function(z){function B(j){return z.apply(this,arguments)}return B.toString=function(){return z.toString()},B}(function(z){var j=r;return null==z&&(z=r),F(z,"text=",e.to_a(j=[A])),Y(j.length,1),F(z,"success=",e.to_a(j=[!0])),j[Y(j.length,1)]})).$$s=this,h.$$arity=1,h))},P.$$arity=1),e.def(b,"$failure",m=function(A){var h;return F(this.$new(),"tap",[],((h=function(B){var o=r;return null==B&&(B=r),F(B,"text=",e.to_a(o=[A])),Y(o.length,1),F(B,"failure=",e.to_a(o=[!0])),o[Y(o.length,1)]}).$$s=this,h.$$arity=1,h))},m.$$arity=1),e.def(b,"$critical",l=function(A){var h;return F(this.$new(),"tap",[],((h=function(B){var o=r;return null==B&&(B=r),F(B,"text=",e.to_a(o=[A])),Y(o.length,1),F(B,"critical=",e.to_a(o=[!0])),Y(o.length,1),F(B,"success=",e.to_a(o=[!0])),o[Y(o.length,1)]}).$$s=this,h.$$arity=1,h))},l.$$arity=1),e.def(b,"$fumble",R=function(A){var h;return F(this.$new(),"tap",[],((h=function(B){var o=r;return null==B&&(B=r),F(B,"text=",e.to_a(o=[A])),Y(o.length,1),F(B,"fumble=",e.to_a(o=[!0])),Y(o.length,1),F(B,"failure=",e.to_a(o=[!0])),o[Y(o.length,1)]}).$$s=this,h.$$arity=1,h))},R.$$arity=1),e.def(b,"$nothing",q=function(){return"nothing"},q.$$arity=0),e.def(C,"$initialize",L=function(c){var k=this;return null==c&&(c=r),k.text=c,k.rands=r,k.detailed_rands=r,k.secret=!1,k.success=!1,k.failure=!1,k.critical=!1,k.fumble=!1},L.$$arity=-1),C.$attr_accessor("text","rands","detailed_rands"),C.$attr_writer("secret","success","failure","critical","fumble"),e.def(C,"$secret?",T=function(){return this.secret},T.$$arity=0),e.def(C,"$success?",X=function(){return this.success},X.$$arity=0),e.def(C,"$failure?",G=function(){return this.failure},G.$$arity=0),e.def(C,"$critical?",I=function(){return this.critical},I.$$arity=0),e.def(C,"$fumble?",f=function(){return this.fumble},f.$$arity=0),void e.def(C,"$condition=",i=function(c){return this.success=c,this.failure=c["$!"]()},i.$$arity=1)},Opal.modules["racc/parser"]=function(e){function Y(L,T){return"number"==typeof L&&"number"==typeof T?L<T:L["$<"](T)}function J(L,T){return"number"==typeof L&&"number"==typeof T?L-T:L["$-"](T)}function w(L,T){return"number"==typeof L&&"number"==typeof T?L+T:L["$+"](T)}function r(L,T){return"number"==typeof L&&"number"==typeof T?L>=T:L["$>="](T)}function D(L,T){return"number"==typeof L&&"number"==typeof T?L>T:L["$>"](T)}function u(L,T){return"number"==typeof L&&"number"==typeof T?L<=T:L["$<="](T)}var I,f,i,T,G,n=[],t=e.nil,p=e.$$$,s=e.$$,H=e.module,O=e.klass,a=e.truthy,C=e.gvars,K=e.send;return T=n,I=(G=[H(n[0],"Racc")].concat(T))[0],f=s(G,"StandardError"),i=G,[O(I,f,"ParseError")].concat(i),a(p("::","ParseError","skip_raise")?"constant":t)||e.const_set(n[0],"ParseError",p(s(n,"Racc"),"ParseError")),function(L,T){var b,P,m,l,R,q,re,A,h,g,z,B,j,o,E,te,se,ue,Te,Re,ze,Le,fe,ae,V,c,k,G=[H(L,"Racc")].concat(T);a(s(G,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(G[0],"Racc_No_Extensions",!1),b=G,c=O(G[0],null,"Parser"),k=[c].concat(b),c.$$prototype.yydebug=c.$$prototype.racc_debug_out=c.$$prototype.racc_error_status=c.$$prototype.racc_t=c.$$prototype.racc_vstack=c.$$prototype.racc_val=c.$$prototype.racc_state=c.$$prototype.racc_tstack=t,e.const_set(k[0],"Racc_Runtime_Version","1.4.6"),e.const_set(k[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(k[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(k[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(k[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(k[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(k[0],"Racc_Runtime_Core_Version",s(k,"Racc_Runtime_Core_Version_R")),e.const_set(k[0],"Racc_Runtime_Core_Revision",s(k,"Racc_Runtime_Core_Revision_R")),e.const_set(k[0],"Racc_Runtime_Type","ruby"),e.defs(s(k,"Parser"),"$racc_runtime_type",P=function(){return s(k,"Racc_Runtime_Type")},P.$$arity=0),e.def(c,"$_racc_setup",m=function(){var x,S,$=this,v=t,d=t,y=t;return null==C.stderr&&(C.stderr=t),a(p($.$class(),"Racc_debug_parser"))||($.yydebug=!1),a(null!=(x=$.yydebug)&&x!==t?"instance-variable":t)||($.yydebug=!1),a($.yydebug)&&(a(null!=(S=$.racc_debug_out)&&S!==t?"instance-variable":t)||($.racc_debug_out=C.stderr),$.racc_debug_out=a(v=$.racc_debug_out)?v:C.stderr),d=p($.$class(),"Racc_arg"),a(Y(d.$size(),14))&&(K(d,"[]=",e.to_a(y=[13,!0])),J(y.length,1)),d},m.$$arity=0),e.def(c,"$_racc_init_sysvars",l=function(){var x=this;return x.racc_state=[0],x.racc_tstack=[],x.racc_vstack=[],x.racc_t=t,x.racc_val=t,x.racc_read_next=!0,x.racc_user_yyerror=!1,x.racc_error_status=0},l.$$arity=0),e.def(c,"$do_parse",R=function(){return this.$__send__(s(k,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},R.$$arity=0),e.def(c,"$next_token",q=function(){return this.$raise(s(k,"NotImplementedError"),this.$class()+"#next_token is not defined")},q.$$arity=0),e.def(c,"$_racc_do_parse_rb",re=function(x,S){var $,d,y=this,N=t,W=t,ee=t,oe=t,ie=t,ce=t,ve=t,be=t;return $=e.to_ary(x),N=null==$[0]?t:$[0],W=null==$[1]?t:$[1],ee=null==$[2]?t:$[2],oe=null==$[3]?t:$[3],ie=null==$[10]?t:$[10],y.$_racc_init_sysvars(),ce=ve=be=t,K(y,"catch",["racc_end_parse"],((d=function(){var Ae,Be,_e=null==d.$$s?this:d.$$s,Ce=t,He=t,Ie=t;for(null==_e.racc_state&&(_e.racc_state=t),null==_e.racc_read_next&&(_e.racc_read_next=t),null==_e.racc_t&&(_e.racc_t=t),null==_e.yydebug&&(_e.yydebug=t),null==_e.racc_val&&(_e.racc_val=t);a(!0);)for(a(be=oe["$[]"](_e.racc_state["$[]"](-1)))?(a(_e.racc_read_next)&&a(_e.racc_t["$!="](0))&&(Be=_e.$next_token(),Ae=e.to_ary(Be),ce=null==Ae[0]?t:Ae[0],_e.racc_val=null==Ae[1]?t:Ae[1],_e.racc_t=a(ce)?a(Ce=ie["$[]"](ce))?Ce:1:0,a(_e.yydebug)&&_e.$racc_read_token(_e.racc_t,ce,_e.racc_val),_e.racc_read_next=!1),be=w(be,_e.racc_t),a(a(He=a(Ie=r(be,0))?ve=N["$[]"](be):Ie)?W["$[]"](be)["$=="](_e.racc_state["$[]"](-1)):He)||(ve=ee["$[]"](_e.racc_state["$[]"](-1)))):ve=ee["$[]"](_e.racc_state["$[]"](-1));a(ve=_e.$_racc_evalact(ve,x)););}).$$s=y,d.$$arity=0,d))},re.$$arity=2),e.def(c,"$yyparse",A=function(x,S){return this.$__send__(s(k,"Racc_YY_Parse_Method"),x,S,this.$_racc_setup(),!0)},A.$$arity=2),e.def(c,"$_racc_yyparse_rb",h=function(x,S,$,v){var d,N,W=this,ee=t,oe=t,ne=t,ie=t,ve=t,be=t,he=t;return d=e.to_ary($),ee=null==d[0]?t:d[0],oe=null==d[1]?t:d[1],ne=null==d[2]?t:d[2],ie=null==d[3]?t:d[3],ve=null==d[10]?t:d[10],W.$_racc_init_sysvars(),be=t,he=t,K(W,"catch",["racc_end_parse"],((N=function(){var Ce,Se=null==N.$$s?this:N.$$s;for(null==Se.racc_state&&(Se.racc_state=t);!a(he=ie["$[]"](Se.racc_state["$[]"](-1)));)for(;a(be=Se.$_racc_evalact(ne["$[]"](Se.racc_state["$[]"](-1)),$)););return K(x,"__send__",[S],((Ce=function(Ie,we){var Fe,Ge,xe=null==Ce.$$s?this:Ce.$$s,qe=t,Ue=t,je=t,We=t,de=t,Z=t,ye=t;for(null==xe.racc_t&&(xe.racc_t=t),null==xe.racc_state&&(xe.racc_state=t),null==xe.racc_read_next&&(xe.racc_read_next=t),null==Ie&&(Ie=t),null==we&&(we=t),xe.racc_t=a(Ie)?a(qe=ve["$[]"](Ie))?qe:1:0,xe.racc_val=we,xe.racc_read_next=!1,he=w(he,xe.racc_t),a(a(Fe=a(Ge=r(he,0))?be=ee["$[]"](he):Ge)?oe["$[]"](he)["$=="](xe.racc_state["$[]"](-1)):Fe)||(be=ne["$[]"](xe.racc_state["$[]"](-1)));a(be=xe.$_racc_evalact(be,$)););for(;a(a(Ue=a(je=(he=ie["$[]"](xe.racc_state["$[]"](-1)))["$!"]())?je:xe.racc_read_next["$!"]())?Ue:xe.racc_t["$=="](0));)for(a(a(We=a(de=a(Z=a(ye=he)?he=w(he,xe.racc_t):ye)?r(he,0):Z)?be=ee["$[]"](he):de)?oe["$[]"](he)["$=="](xe.racc_state["$[]"](-1)):We)||(be=ne["$[]"](xe.racc_state["$[]"](-1)));a(be=xe.$_racc_evalact(be,$)););}).$$s=Se,Ce.$$arity=2,Ce))}).$$s=W,N.$$arity=0,N))},h.$$arity=4),e.def(c,"$_racc_evalact",g=function(x,S){var $,d,ne,ce,y=this,N=t,W=t,oe=t,ie=t,ve=t,be=t,he=t,_e=t,Se=t,Ae=t;if(N=null==($=e.to_ary(S))[0]?t:$[0],W=null==$[1]?t:$[1],oe=null==$[3]?t:$[3],ne=null==$[11]?t:$[11],ie=null==$[12]?t:$[12],a(a(ce=D(x,0))?Y(x,ne):ce))a(D(y.racc_error_status,0))&&(y.racc_t["$=="](1)||(y.racc_error_status=J(y.racc_error_status,1))),y.racc_vstack.$push(y.racc_val),y.racc_state.$push(x),y.racc_read_next=!0,a(y.yydebug)&&(y.racc_tstack.$push(y.racc_t),y.$racc_shift(y.racc_t,y.racc_tstack,y.racc_vstack));else if(a(a(ve=Y(x,0))?D(x,ie["$-@"]()):ve)){if(be=K(y,"catch",["racc_jump"],((d=function(){var Ce=null==d.$$s?this:d.$$s;return null==Ce.racc_state&&(Ce.racc_state=t),Ce.racc_state.$push(Ce.$_racc_do_reduce(S,x)),!1}).$$s=y,d.$$arity=0,d)),a(be)){if(1["$==="](he=be))return y.racc_user_yyerror=!0,ie["$-@"]();if(2["$==="](he))return ne;y.$raise("[Racc Bug] unknown jump code")}}else if(x["$=="](ne))a(y.yydebug)&&y.$racc_accept(),y.$throw("racc_end_parse",y.racc_vstack["$[]"](0));else{if(x["$=="](ie["$-@"]())){for((0)["$==="](he=y.racc_error_status)?a(S["$[]"](21))||y.$on_error(y.racc_t,y.racc_val,y.racc_vstack):3["$==="](he)&&(y.racc_t["$=="](0)&&y.$throw("racc_end_parse",t),y.racc_read_next=!0),y.racc_user_yyerror=!1,y.racc_error_status=3;a(!0)&&(!a(_e=oe["$[]"](y.racc_state["$[]"](-1)))||(_e=w(_e,1),!a(a(Se=a(Ae=r(_e,0))?x=N["$[]"](_e):Ae)?W["$[]"](_e)["$=="](y.racc_state["$[]"](-1)):Se)));)a(u(y.racc_state.$size(),1))&&y.$throw("racc_end_parse",t),y.racc_state.$pop(),y.racc_vstack.$pop(),a(y.yydebug)&&(y.racc_tstack.$pop(),y.$racc_e_pop(y.racc_state,y.racc_tstack,y.racc_vstack));return x}y.$raise("[Racc Bug] unknown action "+x.$inspect())}return a(y.yydebug)&&y.$racc_next_state(y.racc_state["$[]"](-1),y.racc_state),t},g.$$arity=2),e.def(c,"$_racc_do_reduce",z=function(x,S){var $,ne,ce,Ae,Be,Ce,xe,d=this,N=t,W=t,ee=t,oe=t,ie=t,ve=t,be=t,he=t,_e=t,Se=t,He=t,Ie=t,we=t,Ne=t,Me=t,qe=t;return N=null==($=e.to_ary(x))[4]?t:$[4],W=null==$[5]?t:$[5],ee=null==$[6]?t:$[6],oe=null==$[7]?t:$[7],ne=null==$[8]?t:$[8],ie=null==$[9]?t:$[9],ce=null==$[13]?t:$[13],ve=d.racc_state,be=d.racc_vstack,he=d.racc_tstack,_e=function(L,T){return"number"==typeof L?-3*L:L["$*"](-3)}(S),Se=ie["$[]"](_e),Ae=ie["$[]"](w(_e,1)),Be=ie["$[]"](w(_e,2)),Ce=[],a(d.yydebug)&&(He=he["$[]"](Se["$-@"](),Se)),Ie=be["$[]"](Se["$-@"](),Se),a(d.yydebug)&&(we=[Se["$-@"](),Se,Ce],K(he,"[]=",e.to_a(we)),J(we.length,1)),we=[Se["$-@"](),Se,Ce],K(be,"[]=",e.to_a(we)),J(we.length,1),we=[Se["$-@"](),Se,Ce],K(ve,"[]=",e.to_a(we)),J(we.length,1),a(ce)?be.$push(d.$__send__(Be,Ie,be,Ie["$[]"](0))):be.$push(d.$__send__(Be,Ie,be)),he.$push(Ae),a(d.yydebug)&&d.$racc_reduce(He,Ae,he,be),xe=J(Ae,ne),a(_e=oe["$[]"](xe))&&(_e=w(_e,ve["$[]"](-1)),a(a(Ne=a(Me=r(_e,0))?qe=N["$[]"](_e):Me)?W["$[]"](_e)["$=="](xe):Ne))?qe:ee["$[]"](xe)},z.$$arity=2),e.def(c,"$on_error",B=function(x,S,$){var d,v=this;return v.$raise(s(k,"ParseError"),v.$sprintf("\nparse error on value %s (%s)",S.$inspect(),a(d=v.$token_to_str(x))?d:"?"))},B.$$arity=3),e.def(c,"$yyerror",j=function(){return this.$throw("racc_jump",1)},j.$$arity=0),e.def(c,"$yyaccept",o=function(){return this.$throw("racc_jump",2)},o.$$arity=0),e.def(c,"$yyerrok",E=function(){return this.racc_error_status=0},E.$$arity=0),e.def(c,"$racc_read_token",te=function(x,S,$){var v=this;return v.racc_debug_out.$print("read    "),v.racc_debug_out.$print(S.$inspect(),"(",v.$racc_token2str(x),") "),v.racc_debug_out.$puts($.$inspect()),v.racc_debug_out.$puts()},te.$$arity=3),e.def(c,"$racc_shift",se=function(x,S,$){var v=this;return v.racc_debug_out.$puts("shift   "+v.$racc_token2str(x)),v.$racc_print_stacks(S,$),v.racc_debug_out.$puts()},se.$$arity=3),e.def(c,"$racc_reduce",ue=function(x,S,$,v){var d,y=this,N=t;return(N=y.racc_debug_out).$print("reduce "),a(x["$empty?"]())?N.$print(" <none>"):K(x,"each",[],((d=function(ee){return null==ee&&(ee=t),N.$print(" ",(null==d.$$s?this:d.$$s).$racc_token2str(ee))}).$$s=y,d.$$arity=1,d)),N.$puts(" --\x3e "+y.$racc_token2str(S)),y.$racc_print_stacks($,v),y.racc_debug_out.$puts()},ue.$$arity=4),e.def(c,"$racc_accept",Te=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},Te.$$arity=0),e.def(c,"$racc_e_pop",Re=function(x,S,$){var v=this;return v.racc_debug_out.$puts("error recovering mode: pop token"),v.$racc_print_states(x),v.$racc_print_stacks(S,$),v.racc_debug_out.$puts()},Re.$$arity=3),e.def(c,"$racc_next_state",ze=function(x,S){var $=this;return $.racc_debug_out.$puts("goto    "+x),$.$racc_print_states(S),$.racc_debug_out.$puts()},ze.$$arity=2),e.def(c,"$racc_print_stacks",Le=function(x,S){var $,d=t;return(d=this.racc_debug_out).$print("        ["),K(x,"each_index",[],(($=function(N){return null==N&&(N=t),d.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(x["$[]"](N))," ",S["$[]"](N).$inspect(),")")}).$$s=this,$.$$arity=1,$)),d.$puts(" ]")},Le.$$arity=2),e.def(c,"$racc_print_states",fe=function(x){var S,v=t;return(v=this.racc_debug_out).$print("        ["),K(x,"each",[],((S=function(y){return null==y&&(y=t),v.$print(" ",y)}).$$s=this,S.$$arity=1,S)),v.$puts(" ]")},fe.$$arity=1),e.def(c,"$racc_token2str",ae=function(x){var $;return a($=p(this.$class(),"Racc_token_to_s_table")["$[]"](x))?$:this.$raise("[Racc Bug] can't convert token "+x+" to string")},ae.$$arity=1),e.def(c,"$token_to_str",V=function(x){return p(this.$class(),"Racc_token_to_s_table")["$[]"](x)},V.$$arity=1)}(n[0],n)},Opal.modules["bcdice/arithmetic/node"]=function(e){function Y(n,t){return"number"==typeof n&&"number"==typeof t?n/t:n["$/"](t)}var t,O,L,G,I,f,c,k,P,m,l,R,i,b,X,C,s,w=[],r=e.nil,D=e.$$$,u=e.$$,$e=e.module,_=e.klass,F=e.send2;return t=w,O=s=[$e(w[0],"BCDice")].concat(t),L=C=[$e(s[0],"Arithmetic")].concat(O),function(G,I,f){var c,k,P,m,l,i=_(G,null,"BinaryOp");[i].concat(f),i.$$prototype.lhs=i.$$prototype.rhs=i.$$prototype.op=r,e.def(i,"$initialize",c=function(q,re,A){var h=this;return h.lhs=q,h.op=re,h.rhs=A},c.$$arity=3),e.def(i,"$eval",k=function(q){var h,A=r;return A=this.lhs.$eval(q),h=this.rhs.$eval(q),A.$send(this.op,h)},k.$$arity=1),e.def(i,"$output",P=function(){var q=this;return""+q.lhs.$output()+q.op+q.rhs.$output()},P.$$arity=0),e.def(i,"$s_exp",m=function(){var q=this;return"("+q.$op_for_s_exp()+" "+q.lhs.$s_exp()+" "+q.rhs.$s_exp()+")"},m.$$arity=0),e.def(i,"$op_for_s_exp",l=function(){return this.op},l.$$arity=0)}((X=[$e(C[0],"Node")].concat(L))[0],0,X),G=X[0],I=u(X,"BinaryOp"),f=X,i=_(G,I,"DivideBase"),b=[i].concat(f),i.$$prototype.lhs=i.$$prototype.rhs=i.$$prototype.op=r,e.def(i,"$initialize",c=function(re,A){return c.$$p&&(c.$$p=null),F(this,e.find_super_dispatcher(this,"initialize",c,!1,!0),"initialize",[re,"/",A],null)},c.$$arity=2),e.def(i,"$eval",k=function(re){var h,A=this,g=r;return h=A.lhs.$eval(re),(g=A.rhs.$eval(re))["$=="](0)&&A.$raise(u(b,"ZeroDivisionError")),A.$divide_and_round(h,g,re)},k.$$arity=1),e.def(i,"$output",P=function(){var re=P.$$p,h=this,g=r,z=r,B=r;for(re&&(P.$$p=null),z=0,B=arguments.length,g=new Array(B);z<B;z++)g[z]=arguments[z];return""+F(h,e.find_super_dispatcher(h,"output",P,!1,!0),"output",g,re)+h.$rounding_method()},P.$$arity=0),i.$private(),e.def(i,"$rounding_method",m=function(){return D(this.$class(),"ROUNDING_METHOD")},m.$$arity=0),e.def(i,"$op_for_s_exp",l=function(){return""+this.op+this.$rounding_method()},l.$$arity=0),e.def(i,"$divide_and_round",R=function(re,A,h){return this.$raise(u(b,"NotImplementedError"))},R.$$arity=3),function(G,I,f){var c,i=_(G,I,"DivideWithGameSystemDefault"),b=[i].concat(f);e.const_set(b[0],"ROUNDING_METHOD",""),i.$private(),e.def(i,"$divide_and_round",c=function(P,m,l){var q;return q=l,D(u(b,"RoundType"),"CEIL")["$==="](q)?Y(P.$to_f(),m).$ceil():D(u(b,"RoundType"),"ROUND")["$==="](q)?Y(P.$to_f(),m).$round():Y(P,m).$to_i()},c.$$arity=3)}(X[0],u(X,"DivideBase"),X),function(G,I,f){var c,i=_(G,I,"DivideWithCeil"),b=[i].concat(f);e.const_set(b[0],"ROUNDING_METHOD","C"),i.$private(),e.def(i,"$divide_and_round",c=function(P,m,l){return Y(P.$to_f(),m).$ceil()},c.$$arity=3)}(X[0],u(X,"DivideBase"),X),function(G,I,f){var c,i=_(G,I,"DivideWithRound"),b=[i].concat(f);e.const_set(b[0],"ROUNDING_METHOD","R"),i.$private(),e.def(i,"$divide_and_round",c=function(P,m,l){return Y(P.$to_f(),m).$round()},c.$$arity=3)}(X[0],u(X,"DivideBase"),X),function(G,I,f){var c,i=_(G,I,"DivideWithFloor"),b=[i].concat(f);e.const_set(b[0],"ROUNDING_METHOD","F"),i.$private(),e.def(i,"$divide_and_round",c=function(P,m,l){return Y(P,m).$to_i()},c.$$arity=3)}(X[0],u(X,"DivideBase"),X),function(G,I,f){var c,k,P,m,i=_(G,null,"Negative");[i].concat(f),i.$$prototype.body=r,e.def(i,"$initialize",c=function(R){return this.body=R},c.$$arity=1),e.def(i,"$eval",k=function(R){return this.body.$eval(R)["$-@"]()},k.$$arity=1),e.def(i,"$output",P=function(){return"-"+this.body.$output()},P.$$arity=0),e.def(i,"$s_exp",m=function(){return"(- "+this.body.$s_exp()+")"},m.$$arity=0)}(X[0],0,X),function(G,I,f){var c,k,P,m,i=_(G,null,"Parenthesis");[i].concat(f),i.$$prototype.expr=r,e.def(i,"$initialize",c=function(R){return this.expr=R},c.$$arity=1),e.def(i,"$eval",k=function(R){return this.expr.$eval(R)},k.$$arity=1),e.def(i,"$output",P=function(){return"("+this.expr.$output()+")"},P.$$arity=0),e.def(i,"$s_exp",m=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},m.$$arity=0)}(X[0],0,X),void function(G,I,f){var c,k,P,i=_(G,null,"Number");[i].concat(f),i.$$prototype.value=r,e.def(i,"$initialize",c=function(l){return this.value=l},c.$$arity=1),e.def(i,"$eval",k=function(l){return this.value},k.$$arity=1),e.def(i,"$output",P=function(){return this.value.$to_s()},P.$$arity=0),e.alias(i,"s_exp","output")}(X[0],0,X)},Opal.modules.strscan=function(e){var p,O,a,C,K,L,T,X,G,I,f,i,b,c,k,P,m,l,R,q,re,A,h,g,z,B,s,H,w=[],r=e.nil,u=e.$$,_=e.truthy,F=e.send;return p=w,s=(0,e.klass)(w[0],null,"StringScanner"),H=[s].concat(p),s.$$prototype.pos=s.$$prototype.string=s.$$prototype.working=s.$$prototype.matched=s.$$prototype.prev_pos=s.$$prototype.match=r,s.$attr_reader("pos"),s.$attr_reader("matched"),e.def(s,"$initialize",O=function(o){var E=this;return E.string=o,E.pos=0,E.matched=r,E.working=o,E.match=[]},O.$$arity=1),s.$attr_reader("string"),e.def(s,"$beginning_of_line?",a=function(){var o=this;return 0===o.pos||"\n"===o.string.charAt(o.pos-1)},a.$$arity=0),e.alias(s,"bol?","beginning_of_line?"),e.def(s,"$scan",C=function(o){var E=this,te=(o=E.$anchor(o)).exec(E.working);return null==te?E.matched=r:"object"==typeof te?(E.prev_pos=E.pos,E.pos+=te[0].length,E.working=E.working.substring(te[0].length),E.matched=te[0],E.match=te,te[0]):"string"==typeof te?(E.pos+=te.length,E.working=E.working.substring(te.length),te):r},C.$$arity=1),e.def(s,"$scan_until",K=function(o){var E=this;o=E.$anchor(o);for(var ue,te=E.pos,se=E.working;;){if(ue=o.exec(se),te+=1,se=se.substr(1),null!=ue)return E.matched=E.string.substr(E.pos,te-E.pos-1+ue[0].length),E.match=ue,E.prev_pos=te-1,E.pos=te,E.working=se.substr(ue[0].length),E.matched;if(0===se.length)return E.match=[],E.matched=r}},K.$$arity=1),e.def(s,"$[]",L=function(o){var te;if(_(this.match["$empty?"]()))return r;te=o,u(H,"Symbol")["$==="](te)?o=o.$to_s():u(H,"String")["$==="](te)||(o=u(H,"Opal")["$coerce_to!"](o,u(H,"Integer"),"to_int"));var se=this.match;return o<0&&(o+=se.length),o<0||o>=se.length||null==se[o]?r:se[o]},L.$$arity=1),e.def(s,"$check",T=function(o){var E=this,te=(o=E.$anchor(o)).exec(E.working);return E.matched=null==te?r:te[0]},T.$$arity=1),e.def(s,"$check_until",X=function(o){var E=this,te=E.prev_pos,se=E.pos,ue=E.$scan_until(o);return ue!==r&&(E.matched=ue.substr(-1),E.working=E.string.substr(se)),E.prev_pos=te,E.pos=se,ue},X.$$arity=1),e.def(s,"$peek",G=function(o){return this.working.substring(0,o)},G.$$arity=1),e.def(s,"$eos?",I=function(){return 0===this.working.length},I.$$arity=0),e.def(s,"$exist?",f=function(o){var te=o.exec(this.working);return null==te?r:0==te.index?0:te.index+1},f.$$arity=1),e.def(s,"$skip",i=function(o){var E=this,te=(o=E.$anchor(o)).exec(E.working);if(null==te)return E.match=[],E.matched=r;var se=te[0],ue=se.length;return E.matched=se,E.match=te,E.prev_pos=E.pos,E.pos+=ue,E.working=E.working.substring(ue),ue},i.$$arity=1),e.def(s,"$skip_until",b=function(o){var te=this.$scan_until(o);return te===r?r:(this.matched=te.substr(-1),te.length)},b.$$arity=1),e.def(s,"$get_byte",c=function(){var o=this,E=r;return o.pos<o.string.length?(o.prev_pos=o.pos,o.pos+=1,E=o.matched=o.working.substring(0,1),o.working=o.working.substring(1)):o.matched=r,E},c.$$arity=0),e.alias(s,"getch","get_byte"),e.def(s,"$match?",k=function(o){var E=this,te=(o=E.$anchor(o)).exec(E.working);return null==te?r:(E.prev_pos=E.pos,te[0].length)},k.$$arity=1),e.def(s,"$pos=",P=function(o){var E=this;return o<0&&(o+=E.string.$length()),E.pos=o,E.working=E.string.slice(o)},P.$$arity=1),e.def(s,"$matched_size",m=function(){return this.matched===r?r:this.matched.length},m.$$arity=0),e.def(s,"$post_match",l=function(){var o=this;return o.matched===r?r:o.string.substr(o.pos)},l.$$arity=0),e.def(s,"$pre_match",R=function(){var o=this;return o.matched===r?r:o.string.substr(0,o.prev_pos)},R.$$arity=0),e.def(s,"$reset",q=function(){var o=this;return o.working=o.string,o.matched=r,o.pos=0},q.$$arity=0),e.def(s,"$rest",re=function(){return this.working},re.$$arity=0),e.def(s,"$rest?",A=function(){return 0!==this.working.length},A.$$arity=0),e.def(s,"$rest_size",h=function(){return this.$rest().$size()},h.$$arity=0),e.def(s,"$terminate",g=function(){var E,n,o=this;return o.match=r,E=[o.string.$length()],F(o,"pos=",e.to_a(E)),E[(n=E.length,"number"==typeof n?n-1:n["$-"](1))]},g.$$arity=0),e.def(s,"$unscan",z=function(){var o=this;return o.pos=o.prev_pos,o.prev_pos=r,o.match=r,o},z.$$arity=0),s.$private(),e.def(s,"$anchor",B=function(o){var te=o.toString().match(/\/([^\/]+)$/);return te=te?te[1]:void 0,new RegExp("^(?:"+o.source+")",te)},B.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var p,O,a,s,_,n,J=[],w=e.nil,u=e.module;return _=J,p=n=[u(J[0],"BCDice")].concat(_),[s=u(n[0],"Normalize")].concat(p),s.$module_function(),e.def(s,"$comparison_operator",O=function(K){var T;return/<=|=</["$==="](T=K)?"<=":/>=|=>/["$==="](T)?">=":/<>|!=|=!/["$==="](T)?"!=":/</["$==="](T)?"<":/>/["$==="](T)?">":/=/["$==="](T)?"==":w},O.$$arity=1),void e.def(s,"$target_number",a=function(K){return K["$=="]("?")?K:K.$to_i()},a.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var p,a,X,f,i,b,G,I,K,H,Y=e.top,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.klass,_=e.hash2,F=e.truthy,n=e.send;return Y.$require("strscan"),Y.$require("bcdice/normalize"),p=J,a=H=[u(J[0],"BCDice")].concat(p),X=K=[u(H[0],"Command")].concat(a),G=$e(K[0],null,"Lexer"),I=[G].concat(X),G.$$prototype.scanner=G.$$prototype.notations=w,e.const_set(I[0],"SYMBOLS",_(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(G,"$initialize",f=function(k,P){var m,l,R,re,q=this;return k=F(re=(l=(m=k)===w||null==m?w:n(m,"split",[" ",2]))===w||null==l?w:n(l,"first",[]))?re:"",q.scanner=D(I,"StringScanner").$new(k),q.notations=n(P,"map",[],((R=function(A){function h(g){return A.apply(this,arguments)}return h.toString=function(){return A.toString()},h}(function(A){return null==A&&(A=w),F(A["$is_a?"](D(I,"String")))?D(I,"Regexp").$new(A):A})).$$s=q,R.$$arity=1,R))},f.$$arity=2),e.def(G,"$next_token",i=function(){try{var k,P=this,m=w,l=w,q=w,re=w;return F(P.scanner["$eos?"]())?[!1,"$"]:(n(P.notations,"each",[],((k=function(h){var z,g=null==k.$$s?this:k.$$s;if(null==g.scanner&&(g.scanner=w),null==h&&(h=w),z=g.scanner.$scan(h),!F(z))return w;e.ret(["NOTATION",z])}).$$s=P,k.$$arity=1,k)),F(m=P.scanner.$scan(/\d+/))?["NUMBER",m.$to_i()]:F(l=P.scanner.$scan(/[<>!=]+/))?(l=D(I,"Normalize").$comparison_operator(l),[F(l)?"CMP_OP":"ILLEGAL",l]):(q=P.scanner.$getch().$upcase(),[F(re=D(I,"SYMBOLS")["$[]"](q))?re:q.$to_sym(),q]))}catch(A){if(A===e.returner)return A.$v;throw A}},i.$$arity=0),void e.def(G,"$source",b=function(){return this.scanner.$string()},b.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var n,H,L,G,I,f,T,X,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.klass,_=e.truthy;return n=J,H=p=[u(J[0],"BCDice")].concat(n),L=a=[u(p[0],"Command")].concat(H),T=$e(a[0],null,"Parsed"),X=[T].concat(L),T.$$prototype.question_target=T.$$prototype.critical=T.$$prototype.fumble=T.$$prototype.dollar=T.$$prototype.modify_number=T.$$prototype.target_number=T.$$prototype.prefix_number=T.$$prototype.command=T.$$prototype.suffix_number=T.$$prototype.cmp_op=w,T.$attr_accessor("command"),T.$attr_accessor("prefix_number"),T.$attr_accessor("suffix_number"),T.$attr_accessor("critical"),T.$attr_accessor("fumble"),T.$attr_accessor("dollar"),T.$attr_accessor("modify_number"),T.$attr_accessor("cmp_op"),T.$attr_accessor("target_number"),T.$attr_writer("question_target"),e.def(T,"$initialize",G=function(){var b=this;return b.prefix_number=w,b.suffix_number=w,b.critical=w,b.fumble=w,b.dollar=w,b.cmp_op=w,b.target_number=w,b.question_target=!1},G.$$arity=0),e.def(T,"$question_target?",I=function(){return this.question_target},I.$$arity=0),void e.def(T,"$to_s",f=function(b){var q,c=this,k=w,P=w,m=w,l=w,R=w;return null==b&&(b="after_command"),k=_(c.critical)?"@"+c.critical:w,P=_(c.fumble)?"#"+c.fumble:w,m=_(c.dollar)?"$"+c.dollar:w,l=D(X,"Format").$modifier(c.modify_number),R=_(c.question_target)?"?":c.target_number,"after_command"["$==="](q=b)?[c.prefix_number,c.command,c.suffix_number,k,P,m,l,c.cmp_op,R].$join():"after_modify_number"["$==="](q)?[c.prefix_number,c.command,c.suffix_number,l,k,P,m,c.cmp_op,R].$join():"after_target_number"["$==="](q)?[c.prefix_number,c.command,c.suffix_number,l,c.cmp_op,R,k,P,m].$join():w},f.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function Y(H,O){return"number"==typeof H&&"number"==typeof O?H-O:H["$-"](O)}var O,L,G,I,f,c,k,P,m,l,R,q,re,A,h,g,z,B,j,o,E,te,se,ue,Te,Re,ze,Le,fe,ae,V,M,x,S,$,v,d,y,N,W,ee,oe,ne,ie,ce,ve,be,he,_e,Se,Ae,Be,Ce,He,Ie,we,xe,Ne,Me,qe,Ue,i,b,X,C,J=e.top,w=[],r=e.nil,D=e.$$$,u=e.$$,$e=e.klass,_=e.module,F=e.hash2,n=e.send2,t=e.send,p=e.hash,s=e.truthy;return J.$require("racc/parser.rb"),J.$require("bcdice/arithmetic/node"),J.$require("bcdice/command/lexer"),J.$require("bcdice/command/parsed"),function(H,O,a){[$e(H,O,"Parser")].concat(a)}(D(u(w,"BCDice"),"Command"),D(u(w,"Racc"),"Parser"),w),O=w,L=C=[_(w[0],"BCDice")].concat(O),G=(X=[_(C[0],"Command")].concat(L))[0],I=D(u(X,"Racc"),"Parser"),f=X,i=$e(G,I,"Parser"),b=[i].concat(f),i.$$prototype.notations=i.$$prototype.lexer=i.$$prototype.modifier=i.$$prototype.prefix_number=i.$$prototype.suffix_number=i.$$prototype.need_suffix_number=i.$$prototype.need_prefix_number=i.$$prototype.critical=i.$$prototype.fumble=i.$$prototype.dollar=i.$$prototype.allowed_cmp_op=i.$$prototype.question_target=r,e.def(i,"$initialize",c=function(Z,ye){var Q,U,le,De,ke=c.$$p,ge=this;if(ke&&(c.$$p=null),Q=e.slice.call(arguments,0,arguments.length),null==(U=e.extract_kwargs(Q)))U=F([],{});else if(!U.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(le=Q,!e.hasOwnProperty.call(U.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return De=U.$$smap.round_type,n(ge,e.find_super_dispatcher(ge,"initialize",c,!1,!0),"initialize",[],null),ge.notations=le,ge.round_type=De,ge.prefix_number=!1,ge.suffix_number=!1,ge.need_prefix_number=!1,ge.need_suffix_number=!1,ge.modifier=!0,ge.critical=!1,ge.fumble=!1,ge.dollar=!1,ge.allowed_cmp_op=[r,">=",">","<=","<","==","!="],ge.question_target=!1},c.$$arity=-2),e.def(i,"$disable_modifier",k=function(){return this.modifier=!1,this},k.$$arity=0),e.def(i,"$enable_prefix_number",P=function(){return this.prefix_number=!0,this},P.$$arity=0),e.def(i,"$enable_suffix_number",m=function(){return this.suffix_number=!0,this},m.$$arity=0),e.def(i,"$has_prefix_number",l=function(){var Z=this;return Z.prefix_number=!0,Z.need_prefix_number=!0,Z},l.$$arity=0),e.def(i,"$has_suffix_number",R=function(){var Z=this;return Z.suffix_number=!0,Z.need_suffix_number=!0,Z},R.$$arity=0),e.def(i,"$enable_critical",q=function(){return this.critical=!0,this},q.$$arity=0),e.def(i,"$enable_fumble",re=function(){return this.fumble=!0,this},re.$$arity=0),e.def(i,"$enable_dollar",A=function(){return this.dollar=!0,this},A.$$arity=0),e.def(i,"$restrict_cmp_op_to",h=function(Z){var ye,U=this;return ye=e.slice.call(arguments,0,arguments.length),U.allowed_cmp_op=ye,U},h.$$arity=-1),e.def(i,"$enable_question_target",g=function(){return this.question_target=!0,this},g.$$arity=0),e.def(i,"$parse",z=function(Z){try{return this.lexer=u(b,"Lexer").$new(Z,this.notations),this.$do_parse()}catch(Q){if(!e.rescue(Q,[u(b,"ParseError"),u(b,"ZeroDivisionError")]))throw Q;try{return r}finally{e.pop_exception()}}},z.$$arity=1),i.$private(),e.def(i,"$parsed",B=function(Z,ye,Q,U){var le;return t(u(b,"Parsed").$new(),"tap",[],((le=function(pe){var Pe,Ee,Ye,Ke,Ve,Ze,ge=null==le.$$s?this:le.$$s,me=r;return null==ge.round_type&&(ge.round_type=r),null==pe&&(pe=r),me=[Z["$[]"]("command")],t(pe,"command=",e.to_a(me)),Y(me.length,1),me=[(Pe=Z["$[]"]("prefix"),Pe===r||null==Pe?r:t(Pe,"eval",[ge.round_type]))],t(pe,"prefix_number=",e.to_a(me)),Y(me.length,1),me=[(Ee=Z["$[]"]("suffix"),Ee===r||null==Ee?r:t(Ee,"eval",[ge.round_type]))],t(pe,"suffix_number=",e.to_a(me)),Y(me.length,1),me=[(Ye=ye["$[]"]("critical"),Ye===r||null==Ye?r:t(Ye,"eval",[ge.round_type]))],t(pe,"critical=",e.to_a(me)),Y(me.length,1),me=[(Ke=ye["$[]"]("fumble"),Ke===r||null==Ke?r:t(Ke,"eval",[ge.round_type]))],t(pe,"fumble=",e.to_a(me)),Y(me.length,1),me=[(Ve=ye["$[]"]("dollar"),Ve===r||null==Ve?r:t(Ve,"eval",[ge.round_type]))],t(pe,"dollar=",e.to_a(me)),Y(me.length,1),me=[Q.$eval(ge.round_type)],t(pe,"modify_number=",e.to_a(me)),Y(me.length,1),me=[U["$[]"]("cmp_op")],t(pe,"cmp_op=",e.to_a(me)),Y(me.length,1),U["$[]"]("target")["$=="]("?")?(t(pe,"question_target=",e.to_a(me=[!0])),Y(me.length,1),t(pe,"target_number=",e.to_a(me=[0])),me[Y(me.length,1)]):(t(pe,"question_target=",e.to_a(me=[!1])),Y(me.length,1),me=[(Ze=U["$[]"]("target"),Ze===r||null==Ze?r:t(Ze,"eval",[ge.round_type]))],t(pe,"target_number=",e.to_a(me)),me[Y(me.length,1)])}).$$s=this,le.$$arity=1,le))},B.$$arity=4),e.def(i,"$next_token",j=function(){return this.lexer.$next_token()},j.$$arity=0),Be=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],Ce=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],He=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],Ie=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],we=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],xe=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],Ne=[r,6,13,3,9,-1,27,-15,-10,-1,-38],Me=[r,r,r,r,r,r,19,16,15,r,r],qe=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],Ue=p(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(b[0],"Racc_arg",[Be,Ce,Ie,He,we,xe,Me,Ne,19,qe,Ue,58,35,!0]),e.const_set(b[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(b[0],"Racc_debug_parser",!1),e.def(i,"$_reduce_1",o=function(Z,ye,Q){var U;return s(this.modifier)||this.$raise(u(b,"ParseError")),U=e.to_ary(Z),this.$parsed(null==U[0]?r:U[0],null==U[1]?r:U[1],null==U[2]?r:U[2],null==U[3]?r:U[3])},o.$$arity=3),e.def(i,"$_reduce_2",E=function(Z,ye,Q){var U;return s(this.modifier)||this.$raise(u(b,"ParseError")),U=e.to_ary(Z),this.$parsed(null==U[0]?r:U[0],null==U[2]?r:U[2],null==U[1]?r:U[1],null==U[3]?r:U[3])},E.$$arity=3),e.def(i,"$_reduce_3",te=function(Z,ye,Q){var U,ge;return ge=null==(U=e.to_ary(Z))[2]?r:U[2],this.$parsed(null==U[0]?r:U[0],null==U[1]?r:U[1],D(D(u(b,"Arithmetic"),"Node"),"Number").$new(0),ge)},te.$$arity=3),e.def(i,"$_reduce_4",se=function(Z,ye,Q){var le,U=this;return s(s(le=U.prefix_number)?U.suffix_number:le)||U.$raise(u(b,"ParseError")),F(["command","prefix","suffix"],{command:Z["$[]"](1),prefix:Z["$[]"](0),suffix:Z["$[]"](2)})},se.$$arity=3),e.def(i,"$_reduce_5",ue=function(Z,ye,Q){var U=this;return s(U.prefix_number)||U.$raise(u(b,"ParseError")),s(U.need_suffix_number)&&U.$raise(u(b,"ParseError")),F(["command","prefix"],{command:Z["$[]"](1),prefix:Z["$[]"](0)})},ue.$$arity=3),e.def(i,"$_reduce_6",Te=function(Z,ye,Q){var U=this;return s(U.suffix_number)||U.$raise(u(b,"ParseError")),s(U.need_prefix_number)&&U.$raise(u(b,"ParseError")),F(["command","suffix"],{command:Z["$[]"](0),suffix:Z["$[]"](1)})},Te.$$arity=3),e.def(i,"$_reduce_7",Re=function(Z,ye,Q){var le,U=this;return s(s(le=U.need_prefix_number)?le:U.need_suffix_number)&&U.$raise(u(b,"ParseError")),F(["command"],{command:Z["$[]"](0)})},Re.$$arity=3),e.def(i,"$_reduce_8",ze=function(Z,ye,Q){return F([],{})},ze.$$arity=3),e.def(i,"$_reduce_9",Le=function(Z,ye,Q){var U,ge,Ee,Pe,ke=r;return ke=null==(U=e.to_ary(Z))[0]?r:U[0],ge=null==U[2]?r:U[2],s(s(Pe=this.critical)?ke["$[]"]("critical")["$nil?"]():Pe)||this.$raise(u(b,"ParseError")),t(ke,"[]=",e.to_a(Ee=["critical",ge])),Y(Ee.length,1),ke},Le.$$arity=3),e.def(i,"$_reduce_10",fe=function(Z,ye,Q){var U,ge,Ee,Pe,ke=r;return ke=null==(U=e.to_ary(Z))[0]?r:U[0],ge=null==U[2]?r:U[2],s(s(Pe=this.fumble)?ke["$[]"]("fumble")["$nil?"]():Pe)||this.$raise(u(b,"ParseError")),t(ke,"[]=",e.to_a(Ee=["fumble",ge])),Y(Ee.length,1),ke},fe.$$arity=3),e.def(i,"$_reduce_11",ae=function(Z,ye,Q){var U,ge,Ee,Pe,ke=r;return ke=null==(U=e.to_ary(Z))[0]?r:U[0],ge=null==U[2]?r:U[2],s(s(Pe=this.dollar)?ke["$[]"]("dollar")["$nil?"]():Pe)||this.$raise(u(b,"ParseError")),t(ke,"[]=",e.to_a(Ee=["dollar",ge])),Y(Ee.length,1),ke},ae.$$arity=3),e.def(i,"$_reduce_12",V=function(Z,ye,Q){return Z["$[]"](1)},V.$$arity=3),e.def(i,"$_reduce_13",M=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"Negative").$new(Z["$[]"](1))},M.$$arity=3),e.def(i,"$_reduce_14",x=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"BinaryOp").$new(Z["$[]"](0),"+",Z["$[]"](2))},x.$$arity=3),e.def(i,"$_reduce_15",S=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"BinaryOp").$new(Z["$[]"](0),"-",Z["$[]"](2))},S.$$arity=3),e.def(i,"$_reduce_16",$=function(Z,ye,Q){return s(this.allowed_cmp_op["$include?"](r))||this.$raise(u(b,"ParseError")),F([],{})},$.$$arity=3),e.def(i,"$_reduce_17",v=function(Z,ye,Q){var U,ke,pe;return pe=null==(U=e.to_ary(Z))[1]?r:U[1],s(this.allowed_cmp_op["$include?"](ke=null==U[0]?r:U[0]))||this.$raise(u(b,"ParseError")),F(["cmp_op","target"],{cmp_op:ke,target:pe})},v.$$arity=3),e.def(i,"$_reduce_18",d=function(Z,ye,Q){var le,U=this;return le=Z["$[]"](0),s(U.question_target)||U.$raise(u(b,"ParseError")),s(U.allowed_cmp_op["$include?"](le))||U.$raise(u(b,"ParseError")),F(["cmp_op","target"],{cmp_op:le,target:"?"})},d.$$arity=3),e.def(i,"$_reduce_19",y=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"BinaryOp").$new(Z["$[]"](0),"+",Z["$[]"](2))},y.$$arity=3),e.def(i,"$_reduce_20",N=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"BinaryOp").$new(Z["$[]"](0),"-",Z["$[]"](2))},N.$$arity=3),e.def(i,"$_reduce_22",W=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"BinaryOp").$new(Z["$[]"](0),"*",Z["$[]"](2))},W.$$arity=3),e.def(i,"$_reduce_23",ee=function(Z,ye,Q){return Z["$[]"](3).$new(Z["$[]"](0),Z["$[]"](2))},ee.$$arity=3),e.def(i,"$_reduce_25",oe=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},oe.$$arity=3),e.def(i,"$_reduce_26",ne=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"DivideWithCeil")},ne.$$arity=3),e.def(i,"$_reduce_27",ie=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"DivideWithCeil")},ie.$$arity=3),e.def(i,"$_reduce_28",ce=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"DivideWithRound")},ce.$$arity=3),e.def(i,"$_reduce_29",ve=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"DivideWithFloor")},ve.$$arity=3),e.def(i,"$_reduce_30",be=function(Z,ye,Q){return Z["$[]"](1)},be.$$arity=3),e.def(i,"$_reduce_31",he=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"Negative").$new(Z["$[]"](1))},he.$$arity=3),e.def(i,"$_reduce_33",_e=function(Z,ye,Q){return Z["$[]"](1)},_e.$$arity=3),e.def(i,"$_reduce_34",Se=function(Z,ye,Q){return D(D(u(b,"Arithmetic"),"Node"),"Number").$new(Z["$[]"](0))},Se.$$arity=3),void e.def(i,"$_reduce_none",Ae=function(Z,ye,Q){return Z["$[]"](0)},Ae.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var n,H,K,X,G,I,f,i,b,L,T,a,p,J=[],w=e.nil,D=e.$$,u=e.module,$e=e.send,_=e.truthy;return n=J,H=p=[u(J[0],"BCDice")].concat(n),K=a=[u(p[0],"Deprecated")].concat(H),L=u(a[0],"Checker"),T=[L].concat(K),L.$private(),e.def(L,"$check_result_legacy",X=function(k,P,m,l){var A,z,R=this,q=w,re=w,h=w,g=w,B=w;return q=$e(P,"map",[],"sides".$to_proc()),A=(re=$e(P,"map",[],"value".$to_proc())).$sum(),h=[100]["$==="](g=q)?R.$check_1D100(k,A,m,l):[20]["$==="](g)?R.$check_1D20(k,A,m,l):[6,6]["$==="](g)?R.$check_2D6(k,A,re,m,l):w,_(_(z=h["$nil?"]())?z:h["$empty?"]())&&(g=q.$uniq(),h=[10]["$==="](g)?R.$check_nD10(k,A,re,m,l):[6]["$==="](g)?R.$check_nD6(k,A,re,m,l):w,_(_(B=h["$nil?"]())?B:h["$empty?"]()))?w:D(T,"Result").$new(h.$delete_prefix(" \uff1e "))},X.$$arity=4),e.def(L,"$check_1D100",G=function(k,P,m,l){return w},G.$$arity=4),e.def(L,"$check_1D20",I=function(k,P,m,l){return w},I.$$arity=4),e.def(L,"$check_nD10",f=function(k,P,m,l,R){return w},f.$$arity=5),e.def(L,"$check_2D6",i=function(k,P,m,l,R){return w},i.$$arity=5),void e.def(L,"$check_nD6",b=function(k,P,m,l,R){return w},b.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function Y(C,K){return"number"==typeof C&&"number"==typeof K?C+K:C["$+"](K)}function J(C,K){return"number"==typeof C&&"number"==typeof K?C-K:C["$-"](K)}var K,I,b,c,k,P,m,l,R,q,re,A,h,g,z,B,j,o,E,te,se,ue,Te,Re,ze,Le,fe,ae,V,M,x,S,d,y,N,W,ee,v,f,i,T,u=e.top,$e=[],_=e.nil,F=e.$$$,n=e.$$,t=e.module,p=e.klass,s=e.truthy,H=e.send,O=e.range,a=_;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),K=$e,I=T=[t($e[0],"BCDice")].concat(K),f=p(T[0],null,"Base"),i=[f].concat(I),f.$$prototype.sort_add_dice=f.$$prototype.sort_barabara_dice=f.$$prototype.enabled_d9=f.$$prototype.raw_input=f.$$prototype.randomizer=f.$$prototype.enabled_upcase_input=f.$$prototype.debug=_,S=e.get_singleton_class(f),v=[S].concat(i),S.$attr_reader("prefixes"),e.def(S,"$register_prefix",d=function(ne){var ce,ve=this,be=_;return null==ve.prefixes&&(ve.prefixes=_),ce=e.slice.call(arguments,0,arguments.length),ve.prefixes=s(be=ve.prefixes)?be:[],ve.prefixes.$concat(ce.$flatten())},d.$$arity=-1),e.def(S,"$register_prefix_from_super_class",y=function(){return this.$register_prefix(this.$superclass().$prefixes())},y.$$arity=0),e.def(S,"$prefixes_pattern",N=function(){var ie,ne=this,ce=_;return null==ne.prefixes_pattern&&(ne.prefixes_pattern=_),null==ne.prefixes&&(ne.prefixes=_),ne.prefixes_pattern=s(ie=ne.prefixes_pattern)?ie:_,s(ne.prefixes_pattern)?ne.prefixes_pattern:(ne.prefixes=s(ce=ne.prefixes)?ce:[],ne.prefixes.$freeze(),ne.prefixes_pattern=(s(ne.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",ne.prefixes.$join("|"),")"],"i")).$freeze())},N.$$arity=0),e.def(S,"$command_pattern",W=function(){var ne,ce,ie=this,ve=_,be=_;return null==ie.command_pattern&&(ie.command_pattern=_),null==ie.prefixes&&(ie.prefixes=_),ie.command_pattern=s(ce=ie.command_pattern)?ce:_,s(ie.command_pattern)?ie.command_pattern:(ie.prefixes=s(ve=ie.prefixes)?ve:[],ie.prefixes.$freeze(),be=Y(H(F(n(v,"CommonCommand"),"COMMANDS"),"map",[],((ne=function(_e){return null==_e&&(_e=_),F(_e,"PREFIX_PATTERN").$source()}).$$s=ie,ne.$$arity=1,ne)),ie.prefixes),ie.command_pattern=e.regexp(["^S?(",be.$join("|"),")"],"i").$freeze())},W.$$arity=0),e.def(S,"$eval",ee=function(ne){return this.$new(ne).$eval()},ee.$$arity=1),f.$include(n(i,"Translate")),f.$include(F(n(i,"Deprecated"),"Checker")),e.def(f,"$initialize",b=function($){var v=this;return v.raw_input=$,v.sort_add_dice=!1,v.sort_barabara_dice=!1,v.d66_sort_type=F(n(i,"D66SortType"),"NO_SORT"),v.enabled_d9=!1,v.round_type=F(n(i,"RoundType"),"FLOOR"),v.sides_implicit_d=6,v.upper_dice_reroll_threshold=_,v.reroll_dice_reroll_threshold=_,v.default_cmp_op=_,v.default_target_number=_,v.enabled_upcase_input=!0,v.locale="ja_jp",v.randomizer=F(n(i,"BCDice"),"Randomizer").$new(),v.debug=!1},b.$$arity=1),f.$attr_accessor("randomizer"),f.$attr_reader("d66_sort_type"),f.$attr_reader("round_type"),f.$attr_reader("sides_implicit_d"),f.$attr_reader("upper_dice_reroll_threshold"),f.$attr_reader("reroll_dice_reroll_threshold"),f.$attr_reader("default_cmp_op"),f.$attr_reader("default_target_number"),e.def(f,"$sort_add_dice?",c=function(){return this.sort_add_dice},c.$$arity=0),e.def(f,"$sort_barabara_dice?",k=function(){return this.sort_barabara_dice},k.$$arity=0),e.def(f,"$enabled_d9?",P=function(){return this.enabled_d9},P.$$arity=0),e.def(f,"$enable_debug",m=function(){return this.debug=!0},m.$$arity=0),e.def(f,"$eval",l=function(){var v,d,y,$=this,N=_;return v=F(n(i,"BCDice"),"Preprocessor").$process($.raw_input,$),d=s(y=$.$dice_command(v))?y:$.$eval_common_command($.raw_input),s(d)?(N=[$.randomizer.$rand_results()],H(d,"rands=",e.to_a(N)),J(N.length,1),N=[$.randomizer.$detailed_rand_results()],H(d,"detailed_rands=",e.to_a(N)),J(N.length,1),d):_},l.$$arity=0),e.def(f,"$change_text",R=function($){return $},R.$$arity=1),e.def(f,"$check_result",q=function($,v,d,y){var N=this,W=_,ee=_,oe=_,ne=_,ie=_;return W=N.$check_result_legacy($,v,d,y),s(W)?W:(ee=H(v,"map",[],"sides".$to_proc()),ne=(oe=H(v,"map",[],"value".$to_proc())).$sum(),(W=[100]["$==="](ie=ee)?N.$result_1d100($,ne,d,y):[20]["$==="](ie)?N.$result_1d20($,ne,d,y):[6,6]["$==="](ie)?N.$result_2d6($,ne,oe,d,y):_)["$=="](n(i,"Result").$nothing())?_:s(W)?W:(ie=ee.$uniq(),(W=[10]["$==="](ie)?N.$result_nd10($,ne,oe,d,y):[6]["$==="](ie)?N.$result_nd6($,ne,oe,d,y):_)["$=="](n(i,"Result").$nothing())?_:s(W)?W:N.$result_ndx($,d,y)))},q.$$arity=4),e.def(f,"$grich_text",re=function($,v,d){return _},re.$$arity=3),f.$private(),e.def(f,"$eval_common_command",A=function($){try{var v;return $=this.$change_text($),H(F(n(i,"CommonCommand"),"COMMANDS"),"each",[],((v=function(N){var ee,W=null==v.$$s?this:v.$$s;if(null==W.randomizer&&(W.randomizer=_),null==N&&(N=_),ee=N.$eval($,W,W.randomizer),!s(ee))return _;e.ret(ee)}).$$s=this,v.$$arity=1,v)),_}catch(y){if(y===e.returner)return y.$v;throw y}},A.$$arity=1),e.def(f,"$dice_command",h=function($){var v,d=this,y=_,N=_,W=_,ee=_,oe=_,ne=_,ie=_;return s(d.enabled_upcase_input)&&($=$.$upcase()),y=d.$class().$prefixes_pattern().$match($),s(y)?(N=y["$[]"](1)["$nil?"]()["$!"](),s(N)&&($=$["$[]"](O(1,-1,!1))),W=d.$eval_game_system_specific_command($),s(W["$is_a?"](n(i,"Result")))?(ee=[s(oe=W["$secret?"]())?oe:N],H(W,"secret=",e.to_a(ee)),J(ee.length,1),W):s(s(ne=s(ie=W["$nil?"]())?ie:W["$empty?"]())?ne:W["$=="]("1"))?_:H(n(i,"Result").$new(),"tap",[],((v=function(ve){return null==ve&&(ve=_),ee=[W.$to_s()],H(ve,"text=",e.to_a(ee)),J(ee.length,1),H(ve,"secret=",e.to_a(ee=[N])),ee[J(ee.length,1)]}).$$s=d,v.$$arity=1,v))):_},h.$$arity=1),e.def(f,"$eval_game_system_specific_command",g=function($){return _},g.$$arity=1),e.def(f,"$result_ndx",z=function($,v,d){return s(d["$is_a?"](n(i,"String")))?_:s($.$send(v,d))?n(i,"Result").$success(this.$translate("success")):n(i,"Result").$failure(this.$translate("failure"))},z.$$arity=3),e.def(f,"$result_1d100",B=function($,v,d,y){return _},B.$$arity=4),e.def(f,"$result_1d20",j=function($,v,d,y){return _},j.$$arity=4),e.def(f,"$result_nd10",o=function($,v,d,y,N){return _},o.$$arity=5),e.def(f,"$result_2d6",E=function($,v,d,y,N){return _},E.$$arity=5),e.def(f,"$result_nd6",te=function($,v,d,y,N){return _},te.$$arity=5),e.def(f,"$get_table_by_2d6",se=function($){return this.$get_table_by_nD6($,2)},se.$$arity=1),e.def(f,"$get_table_by_1d6",ue=function($){return this.$get_table_by_nD6($,1)},ue.$$arity=1),e.def(f,"$get_table_by_nD6",Te=function($,v){return this.$get_table_by_nDx($,v,6)},Te.$$arity=2),e.def(f,"$get_table_by_nDx",Re=function($,v,d){var N,W=_;return N=this.randomizer.$roll_sum(v,d),W=this.$get_table_value($["$[]"](J(N,v))),s(W["$nil?"]())?["1",0]:[W,N]},Re.$$arity=3),e.def(f,"$get_table_by_1d3",ze=function($){var y,N,C,v=this,W=_;return v.$debug("get_table_by_1d3"),y=v.randomizer.$roll_sum(1,6),v.$debug("num",y),N=(C=J(y,1),"number"==typeof C?C/2:C["$/"](2)).$to_i(),v.$debug("index",N),W=$["$[]"](N),s(W["$nil?"]())?["1",0]:[W,y]},ze.$$arity=1),e.def(f,"$get_table_by_d66_swap",Le=function($){var d;return d=this.randomizer.$roll_d66(F(n(i,"D66SortType"),"ASC")),[this.$get_table_by_number(d,$),d]},Le.$$arity=1),e.def(f,"$get_table_by_d66",fe=function($){var d,y,N,ee,C,W=_;return d=this.randomizer.$roll_once(6),y=this.randomizer.$roll_once(6),N=Y("number"==typeof(C=J(d,1))?6*C:C["$*"](6),J(y,1)),W=$["$[]"](N),ee=""+d+y,s(W["$nil?"]())?["1",ee]:[W,ee]},fe.$$arity=1),e.def(f,"$get_table_by_number",ae=function($,v,d){try{var y;return null==d&&(d="1"),H(v,"each",[],((y=function(ee){var ne,oe=null==y.$$s?this:y.$$s;if(null==ee&&(ee=_),ne=ee["$[]"](0),!s(function(C,K){return"number"==typeof C&&"number"==typeof K?C>=K:C["$>="](K)}(ne,$)))return _;e.ret(oe.$get_table_value(ee["$[]"](1)))}).$$s=this,y.$$arity=1,y)),this.$get_table_value(d)}catch(W){if(W===e.returner)return W.$v;throw W}},ae.$$arity=-3),e.def(f,"$get_table_value",V=function($){return s($["$is_a?"](n(i,"Proc")))?$.$call():$},V.$$arity=1),e.def(f,"$roll_tables",M=function($,v){var y=_;return y=v["$[]"]($),s(y)?y.$roll(this.randomizer).$to_s():_},M.$$arity=2),e.def(f,"$debug",x=function($,v){var y,N,W=this,ee=_,oe=_;return y=e.slice.call(arguments,1,arguments.length),s(W.debug)?(ee=s($["$is_a?"](n(i,"String")))?$:$.$inspect(),s(y["$empty?"]())?W.$warn(ee):(oe=H(y,"map",[],((N=function(ie){return null==ie&&(ie=_),s(ie["$is_a?"](n(i,"String")))?'"'+ie+'"':ie.$inspect()}).$$s=W,N.$$arity=1,N)),W.$warn(ee+": "+oe.$join(", ")))):_},x.$$arity=-2),F(F(n($e,"I18n"),"Backend"),"Simple").$include(F(F(n($e,"I18n"),"Backend"),"Fallbacks")),n($e,"I18n").$load_path()["$<<"](n($e,"Dir")["$[]"](n($e,"File").$join(u.$__dir__(),"../../i18n/**/*.yml"))),a=["ja_jp"],H(n($e,"I18n"),"default_locale=",e.to_a(a)),J(a.length,1),a=[["ja_jp"]],H(n($e,"I18n").$fallbacks(),"defaults=",e.to_a(a)),a[J(a.length,1)]},Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var n,H,C,T,L,O,a,p,J=[],w=e.nil,r=e.$$$,D=e.$$,u=e.module,$e=e.hash2,_=e.truthy;return n=J,H=p=[u(J[0],"BCDice")].concat(n),a=[O=u(p[0],"ArithmeticEvaluator")].concat(H),C=e.get_singleton_class(O),L=[C].concat(a),void e.def(C,"$eval",T=function(G,I){var f,b=w;if(null==I)I=$e([],{});else if(!I.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(f=I.$$smap.round_type)&&(f=r(D(L,"RoundType"),"FLOOR")),_(G)&&_(b=D(L,"Arithmetic").$eval(G,f))?b:0},T.$$arity=-2)},function(e){function Y(L,T){return"number"==typeof L&&"number"==typeof T?L+T:L["$+"](T)}function J(L,T){return"number"==typeof L&&"number"==typeof T?L-T:L["$-"](T)}function w(L,T){return"number"==typeof L&&"number"==typeof T?L>=T:L["$>="](T)}function D(L,T){return"number"==typeof L&&"number"==typeof T?L*T:L["$*"](T)}function u(L,T){return"number"==typeof L&&"number"==typeof T?L<=T:L["$<="](T)}function $e(L,T){return"number"==typeof L&&"number"==typeof T?L<T:L["$<"](T)}var T,f,c,k,P,R,q,re,A,h,g,z,B,j,o,E,te,se,ue,Te,Re,ze,Le,V,S,$,v,d,y,ee,W,M,x,m,l,b,G,_=e.top,F=[],n=e.nil,t=e.$$$,p=e.$$,s=e.module,H=e.klass,O=e.send2,a=e.truthy,C=e.hash2,K=e.send;_.$require("bcdice/base"),_.$require("bcdice/arithmetic_evaluator"),T=F,f=G=[s(F[0],"BCDice")].concat(T),c=(b=[s(G[0],"GameSystem")].concat(f))[0],k=p(b,"Base"),P=b,m=H(c,k,"LogHorizon"),l=[m].concat(P),m.$$prototype.randomizer=m.$$prototype.locale=n,e.const_set(l[0],"ID","LogHorizon"),e.const_set(l[0],"NAME","\u30ed\u30b0\u30fb\u30db\u30e9\u30a4\u30ba\u30f3TRPG"),e.const_set(l[0],"SORT_KEY","\u308d\u304f\u307b\u3089\u3044\u3059\u3093TRPG"),e.const_set(l[0],"HELP_MESSAGE","\u25a0 \u5224\u5b9a (xLH\xb1y>=z)\n\u3000xD6\u306e\u5224\u5b9a\u3002\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000x\uff1ax\u306b\u632f\u308b\u30c0\u30a4\u30b9\u6570\u3092\u5165\u529b\u3002\n\u3000\xb1y\uff1ay\u306b\u4fee\u6b63\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000>=z\uff1az\u306b\u76ee\u6a19\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 3LH\u30002LH>=8\u30003LH+1>=10\n\n\u25a0 \u6d88\u8017\u8868 (tCTx\xb1y$z)\n\u3000PCT \u4f53\u529b\uff0fECT \u6c17\u529b\uff0fGCT \u7269\u54c1\uff0fCCT \u91d1\u92ad\n\u3000x:CR\u3092\u6307\u5b9a\u3002\n\u3000\xb1y:\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u8868\u306e\u7279\u5b9a\u306e\u5024\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 PCT1\u3000ECT2+1\u3000GCT3-1\u3000CCT3$5\n\n\u25a0 \u6d88\u8017\u8868\u30ed\u30fc\u30eb (CTx\xb1y)\n\u3000\u6d88\u8017\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u7701\u7565\u53ef\u80fd\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u8ca1\u5b9d\u8868 (tTRSx\xb1y$)\n\u3000LHZB1\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRS \u91d1\u92ad\uff0fMTRS \u9b54\u6cd5\u7d20\u6750\uff0fITRS \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0f\u203bHTRS \u30d2\u30ed\u30a4\u30f3\uff0fGTRS \u30b4\u30d6\u30ea\u30f3\u8ca1\u5b9d\u8868\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\u300a\u30b4\u30fc\u30eb\u30c9\u30d5\u30a3\u30f3\u30ac\u30fc\u300b\u4f7f\u7528\u6642\u306a\u3069\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u8ca1\u5b9d\u8868\u306e\u30c0\u30a4\u30b9\u76ee\u30927\u56fa\u5b9a\uff081\u56de\u5206\u306e\u30d7\u30e9\u30a4\u30ba\u7528\uff09\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 CTRS1\u3000MTRS2+1\u3000ITRS3-1\u3000ITRS+27\u3000CTRS3$\n\n\u25a0 \u8ca1\u5b9d\u8868\uff08\u62e1\u5f35\u30eb\u30fc\u30eb\u30d6\u30c3\u30af\uff09 (tTRSEx\xb1y$)\n\u3000LHZB2\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRSE \u91d1\u92ad\uff0fMTRSE \u9b54\u6cd5\u7d20\u6750\uff0fITRSE \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0fOTRSE \u305d\u306e\u307b\u304b\n\u3000\u8a18\u6cd5\u306f\u8ca1\u5b9d\u8868\u3068\u540c\u69d8\n\n\u25a0 \u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb (TRSx\xb1y)\n\u3000\u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306fCR 0\u3068\u3057\u3066\u6271\u3046\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u30a4\u30fc\u30b9\u30bf\u30eb\u63a2\u7d22\u8868 (ESTLx\xb1y$z)\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u7279\u5b9aCR\u306e\u8868\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 ESTL1\u3000ESTL+15\u3000ESTL2+1$5\u3000ESTL2-1$5\n\n\u25a0 \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u30c9\u30de\u30b8\u30c3\u30af\u30a2\u30a4\u30c6\u30e0\u52b9\u679c\u8868 (MGRx)\n\u3000x\u306fMG\u3092\u6307\u5b9a\u3002(LHZB1\u7528)\n\n\u25a0 \u697d\u5668\u7a2e\u5225\u8868\u2020 (MIIx)\n\u3000x\u306f\u697d\u5668\u306e\u7a2e\u985e(1\uff5e6\u3092\u6307\u5b9a)\u3001\u7701\u7565\u53ef\u80fd\n\u30001 \u6253\u697d\u5668\uff11\uff0f2 \u9375\u76e4\u697d\u5668\uff0f3 \u5f26\u697d\u5668\uff11\uff0f4 \u5f26\u697d\u5668\uff12\uff0f5 \u7ba1\u697d\u5668\uff11\uff0f6 \u7ba1\u697d\u5668\uff12\n\n\u25a0 \u7279\u6b8a\u6d88\u8017\u8868\u2606 (tSCTx\xb1y$z)\n\u3000\u6d88\u8017\u8868\u3068\u540c\u69d8\u3001\u305f\u3060\u3057CR\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000ESCT \u30ed\u30c7\u7814\u306f\u7206\u767a\u3060\uff01\uff0fCSCT \u30a2\u30eb\u30f4\u306e\u546a\u3044\u3058\u3083\uff01\n\n\u25a0 \u30ed\u30c7\u7814\u306e\u65b0\u767a\u660e\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (IATt)\n\u3000IATA \u7279\u5fb4A(\u30e1\u30ea\u30c3\u30c8)\uff0fIATB \u7279\u5fb4B(\u30c7\u30e1\u30ea\u30c3\u30c8)\uff0fIATL \u898b\u305f\u76ee\uff0fIATT \u7a2e\u985e\n\u3000t\u3092\u7701\u7565\u3059\u308b\u3068\u5168\u3066\u8868\u793a\u3002t\u306bA/B/L/T\u3092\u4efb\u610f\u306e\u9806\u3067\u9023\u7d50\u53ef\u80fd\n\u3000\u4f8b\uff09IAT\u3000IATALT  IATABBLT  IATABL\n\n\u25a0 \u8868\n\u3000\u30fb\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u30bf\u30b0\u8868 (PTAG)\n\u3000\u30fb\u4ea4\u53cb\u8868 (KOYU)\n\u3000\u30fb\u653b\u6483\u547d\u4e2d\u7b87\u6240\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (HLOC)\n\u3000\u30fbPC\u540d\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (PCNM)\n\u3000\u30fb\u30a2\u30ad\u30d0\u306e\u8857\u3067\u906d\u9047\u3059\u308b\u30c8\u30e9\u30d6\u30eb\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (TIAS)\n\u3000\u30fb\u5ec3\u68c4\u5150\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (ABDC)\n\n\u2020\u5370\u306f\u2606\u5370\u306f\u300c\u30a4\u30f3\u30c8\u30a5\u30fb\u30b6\u30fb\u30bb\u30eb\u30c7\u30b7\u30a2 \u3055\u3089\u306a\u308b\u30d3\u30eb\u30c9\u306e\u7fbd\u3070\u305f\u304d\uff08\uff11\uff09\u300d\u3088\u308a\u3001\n\u2606\u5370\u306f\u30bb\u30eb\u30c7\u30b7\u30a2\u30fb\u30ac\u30bc\u30c3\u30c8\u300c\u3067\u304d\u308b\u304b\u306a66\u300dVol.1\u3088\u308a\u3001\n\u203b\u5370\u306f\u300c\u5b9f\u9332\u30fb\u4e03\u9762\u4f53\u5de5\u623f\u30b9\u30bf\u30c3\u30d5\u5ea7\u8ac7\u4f1a(\u590f\u306e\u9663)\u300d\u3088\u308a\u3002\u5229\u7528\u6cd5\u306a\u3069\u306f\u305d\u3061\u3089\u53c2\u7167\u3002\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n"),m.$register_prefix("\\d+LH","\\w+CT","CT","\\w+TRS","TRS","IAT","TIAS","ABDC","MII","ESTL"),e.def(m,"$initialize",R=function(ae){var x=this;return R.$$p&&(R.$$p=null),O(x,e.find_super_dispatcher(x,"initialize",R,!1,!0),"initialize",[ae],null),x.d66_sort_type=t(p(l,"D66SortType"),"NO_SORT")},R.$$arity=1),e.def(m,"$eval_game_system_specific_command",q=function(ae){var M,x,S,$,v,d,y,N,W,ee,oe,V=this;return a(M=a(x=a(S=a($=a(v=a(d=a(y=a(N=a(W=a(ee=a(oe=V.$getCheckRollDiceCommandResult(ae))?oe:V.$roll_consumption(ae))?ee:V.$roll_consumption_table(ae))?W:V.$roll_treasure(ae))?N:V.$roll_treasure_table(ae))?y:V.$roll_treasure_table_b2(ae))?d:V.$getInventionAttributeTextDiceCommandResult(ae))?v:V.$getTroubleInAkibaStreetDiceCommandResult(ae))?$:V.$getAbandonedChildDiceCommandResult(ae))?S:V.$getMusicalInstrumentTypeDiceCommandResult(ae))?x:V.$roll_eastal_exploration_table(ae))?M:V.$roll_tables(ae,t(V.$class(),"TABLES"))},q.$$arity=1),m.$private(),e.def(m,"$getCheckRollDiceCommandResult",re=function(ae){var V=this,x=n,S=n,$=n,v=n,d=n,y=n,W=n;return x=t(p(l,"Command"),"Parser").$new(/\d+LH/,C(["round_type"],{round_type:V.$round_type()})).$restrict_cmp_op_to(n,">=").$parse(ae),a(x)?(S=x.$command().$to_i(),d=Y(v=($=V.randomizer.$roll_barabara(S,6)).$sum(),x.$modify_number()),y=V.$result_text(S,$,d,x),W=[["("+x+")",v+"["+$.$join(",")+"]"+p(l,"Format").$modifier(x.$modify_number()),d,y.$text()].$compact().$join(" \uff1e ")],K(y,"text=",e.to_a(W)),J(W.length,1),y):n},re.$$arity=1),e.def(m,"$result_text",A=function(ae,V,M,x){var S=this;return a(w(V.$count(6),2))?p(l,"Result").$critical(S.$translate("LogHorizon.LH.critical")):a(w(V.$count(1),ae))?p(l,"Result").$fumble(S.$translate("LogHorizon.LH.fumble")):a(x.$cmp_op()["$nil?"]())?p(l,"Result").$new():a(w(M,x.$target_number()))?p(l,"Result").$success(S.$translate("success")):p(l,"Result").$failure(S.$translate("failure"))},A.$$arity=4),e.def(m,"$getValue",h=function(ae,V){var x;return a(a(x=ae["$nil?"]())?x:ae["$empty?"]())?V:p(l,"ArithmeticEvaluator").$eval(ae)},h.$$arity=2),e.def(m,"$roll_consumption",g=function(ae){var M=n,x=n,S=n,$=n,v=n;return M=/^CT\d*([+\-\d]+)?$/.$match(ae),a(M)?(x=p(l,"ArithmeticEvaluator").$eval(M["$[]"](1)),S=p(l,"Format").$modifier(x),$=this.randomizer.$roll_once(6),a(S["$empty?"]())||(v=Y($.$to_s(),S)),["(1D6"+S+")",v,Y($,x)].$compact().$join(" \uff1e ")):n},g.$$arity=1),e.def(m,"$roll_consumption_table",z=function(ae){var M=n,x=n,S=n,$=n;return M=/(P|E|G|C|ES|CS)CT(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(ae),a(M)?(x=this.$construct_consumption_table(M["$[]"](1)),S=M["$[]"](2).$to_i(),$=p(l,"ArithmeticEvaluator").$eval(M["$[]"](3)),a(M["$[]"](4))&&x.$fix_dice_value(M["$[]"](4).$to_i()),x.$roll(S,$,this.randomizer)):n},z.$$arity=1),e.def(m,"$construct_consumption_table",B=function(ae){var x,V=this,M=n;return M="P"["$==="](x=ae)?V.$translate("LogHorizon.CT.PCT"):"E"["$==="](x)?V.$translate("LogHorizon.CT.ECT"):"G"["$==="](x)?V.$translate("LogHorizon.CT.GCT"):"C"["$==="](x)?V.$translate("LogHorizon.CT.CCT"):"ES"["$==="](x)?V.$translate("LogHorizon.CT.ESCT"):"CS"["$==="](x)?V.$translate("LogHorizon.CT.CSCT"):n,p(l,"ConsumptionTable").$new(M["$[]"]("name"),M["$[]"]("items"))},B.$$arity=1),function(fe,ae,V){var S,$,v,M=H(fe,null,"ConsumptionTable");[M].concat(V),M.$$prototype.tables=M.$$prototype.dice_value=M.$$prototype.name=n,e.def(M,"$initialize",S=function(y,N){var W=this;return W.name=y,W.tables=N,W.dice_value=n},S.$$arity=2),e.def(M,"$fix_dice_value",$=function(y){return this.dice_value=y},$.$$arity=1),e.def(M,"$roll",v=function(y,N,W){var oe,ve,ie,L,ee=this,ne=n,ce=n;return oe=(L=J(y,1),"number"==typeof L?L/5:L["$/"](5)).$clamp(0,J(ee.tables.$size(),1)),ne=ee.tables["$[]"](oe),ee.dice_value=a(ie=ee.dice_value)?ie:W.$roll_once(6),ce=Y(ee.dice_value,N),ve=ne["$[]"](ce.$clamp(0,7)),ee.name+"("+ce+"["+ee.dice_value+"]) \uff1e "+ve},v.$$arity=3)}(l[0],0,l),e.def(m,"$roll_treasure",j=function(ae){var M=n,x=n,S=n,$=n,v=n,d=n;return M=/^TRS(\d+)?([+\-\d]+)?$/.$match(ae),a(M)?(x=M["$[]"](1).$to_i(),S=p(l,"ArithmeticEvaluator").$eval(M["$[]"](2)),d=Y(Y(v=($=this.randomizer.$roll_barabara(2,6)).$sum(),D(x,5)),S),"(2D6+"+x+"*5"+p(l,"Format").$modifier(S)+") \uff1e "+v+"["+$.$join(",")+"]"+p(l,"Format").$modifier(Y(D(x,5),S))+" \uff1e "+d):n},j.$$arity=1),e.def(m,"$roll_treasure_table",o=function(ae){var V=this,M=n,x=n,S=n,$=n,v=n,d=n;return M=/^([CMIHG]TRS)(\d+)?([+\-\d]+)?(\$)?$/.$match(ae),a(M)?(x=M["$[]"](1),S=V.$construct_treasure_table(x),$=M["$[]"](2).$to_i(),v=p(l,"ArithmeticEvaluator").$eval(M["$[]"](3)),a(a(d=$["$=="](0))?v["$=="](0):d)?V.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:ae})):(a(M["$[]"](4))&&S.$fix_dice_value(7),S.$roll($,v,V.randomizer))):n},o.$$arity=1),e.def(m,"$construct_treasure_table",E=function(ae){return ae["$=="]("HTRS")?p(l,"HeroineTreasureTable").$from_i18n("LogHorizon.TRS.HTRS",this.locale):p(l,"TreasureTable").$from_i18n("LogHorizon.TRS."+ae,this.locale)},E.$$arity=1),e.def(m,"$roll_treasure_table_b2",te=function(ae){var V=this,M=n,x=n,S=n,$=n,v=n,d=n;return M=/^([CMIO]TRSE)(\d+)?([+\-\d]+)?(\$)?$/.$match(ae),a(M)?(x=M["$[]"](1),S=p(l,"ExpansionTreasureTable").$from_i18n("LogHorizon.TRSE."+x,V.locale),$=M["$[]"](2).$to_i(),v=p(l,"ArithmeticEvaluator").$eval(M["$[]"](3)),a(a(d=$["$=="](0))?v["$=="](0):d)?V.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:ae})):(a(M["$[]"](4))&&S.$fix_dice_value(7),S.$roll($,v,V.randomizer))):n},te.$$arity=1),V=l,x=[M=H(l[0],null,"TreasureTable")].concat(V),M.$$prototype.dice_list=M.$$prototype.name=M.$$prototype.items=n,M.$include(p(x,"Translate")),y=e.get_singleton_class(M),W=[y].concat(x),e.def(y,"$from_i18n",ee=function(ne,ie){var ve=n;return ve=p(W,"I18n").$translate(ne,C(["raise","locale"],{raise:!0,locale:ie})),this.$new(ve["$[]"]("name"),ve["$[]"]("items"),ie)},ee.$$arity=2),e.def(M,"$initialize",S=function(N,W,ee){return this.name=N,this.items=W,this.locale=ee,this.dice_list=n},S.$$arity=3),e.def(M,"$fix_dice_value",$=function(N){return this.dice_list=[N]},$.$$arity=1),e.def(M,"$roll",v=function(N,W,ee){var oe,ie,ne=this,ce=n,ve=n,be=n,he=n,_e=n;return a(a(ie=N["$=="](0))?W["$=="](0):ie)?n:(ce=a(a(ve=N["$=="](0))?W["$!="](0):ve)?W:(ne.dice_list=a(be=ne.dice_list)?be:ee.$roll_barabara(2,6),Y(Y(ne.dice_list.$sum(),D(5,N)),W)),he=ne.$pick_item(ce),a(ne.dice_list)&&(_e="["+((oe=ne.dice_list)===n||null==oe?n:K(oe,"join",[","]))+"]"),ne.name+"("+ce+_e+") \uff1e "+he)},v.$$arity=3),M.$private(),e.def(M,"$pick_item",d=function(N){var W=this;return a(u(N,6))?W.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):a(u(N,62))?W.items["$[]"](N.$to_s()):a(u(N,72))?W.items["$[]"](J(N,10).$to_s())+"&80G":a(u(N,82))?W.items["$[]"](J(N,20).$to_s())+"&160G":a(u(N,87))?W.items["$[]"](J(N,30).$to_s())+"&260G":W.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:88}))},d.$$arity=1),function(fe,ae,V){var S,M=H(fe,ae,"HeroineTreasureTable");[M].concat(V),M.$$prototype.items=n,e.def(M,"$pick_item",S=function(v){var d=this;return a(u(v,6))?d.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):a(u(v,53))?d.items["$[]"](v.$to_s()):d.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:54}))},S.$$arity=1)}(l[0],p(l,"TreasureTable"),l),function(fe,ae,V){var S,M=H(fe,ae,"ExpansionTreasureTable");[M].concat(V),M.$$prototype.items=n,e.def(M,"$pick_item",S=function(v){var d=this;return a(u(v,6))?d.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):a(u(v,162))?d.items["$[]"](v.$to_s()):a(u(v,172))?d.items["$[]"](J(v,10).$to_s())+"&200G":a(u(v,182))?d.items["$[]"](J(v,20).$to_s())+"&400G":a(u(v,187))?d.items["$[]"](J(v,30).$to_s())+"&600G":d.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:188}))},S.$$arity=1)}(l[0],p(l,"TreasureTable"),l),e.def(m,"$getInventionAttributeTextDiceCommandResult",se=function(ae){var V,x=n,S=n,$=n,v=n,d=n,y=n;return a(ae["$=~"](/IAT([ABMDLT]*)/))?(x=this.$translate("LogHorizon.IAT.name"),S=a(a($=p(l,"Regexp").$last_match(1))?p(l,"Regexp").$last_match(1)["$!="](""):$)?p(l,"Regexp").$last_match(1):"MDLT",v=S.$length()["$=="](1),d=[],y=[],K(S.$split(/(?:)/),"each",[],((V=function(W){var ie,ee=null==V.$$s?this:V.$$s,oe=n,ne=n,ce=n;return null==ee.randomizer&&(ee.randomizer=n),null==W&&(W=n),oe=ee.randomizer.$roll_once(6),y["$<<"](oe.$to_s()),ce=(ne="A"["$==="](ie=W)||"M"["$==="](ie)?ee.$translate("LogHorizon.IAT.A"):"B"["$==="](ie)||"D"["$==="](ie)?ee.$translate("LogHorizon.IAT.B"):"L"["$==="](ie)?ee.$translate("LogHorizon.IAT.L"):"T"["$==="](ie)?ee.$translate("LogHorizon.IAT.T"):n)["$[]"]("items")["$[]"](J(oe,1)),a(v)&&(ce=ne["$[]"]("name")+"\uff1a"+ce),d.$push(ce)}).$$s=this,V.$$arity=1,V)),x+"(["+y.$join(",")+"]) \uff1e "+d.$join(" ")):n},se.$$arity=1),e.def(m,"$getTroubleInAkibaStreetDiceCommandResult",ue=function(ae){return ae["$=="]("TIAS")?this.$roll_random_table("LogHorizon.TIAS"):n},ue.$$arity=1),e.def(m,"$getAbandonedChildDiceCommandResult",Te=function(ae){return ae["$=="]("ABDC")?this.$roll_random_table("LogHorizon.ABDC"):n},Te.$$arity=1),e.def(m,"$roll_random_table",Re=function(ae){var V,M=this,x=n,S=n,$=n,v=n;return x=M.$translate(ae),S=x["$[]"]("tables"),$=M.randomizer.$roll_barabara(S.$size(),6),v=K($.$map(),"with_index",[],((V=function(y,N){return null==y&&(y=n),null==N&&(N=n),S["$[]"](N)["$[]"](J(y,1))}).$$s=M,V.$$arity=2,V)),x["$[]"]("name")+"(["+$.$join(",")+"]) \uff1e "+v.$join(" ")},Re.$$arity=1),e.def(m,"$getMusicalInstrumentTypeDiceCommandResult",ze=function(ae){var V=this,M=n,x=n,S=n,$=n,v=n,d=n,y=n,N=n;return!a(ae["$=~"](/MII(\d?)/))||(M=(a(x=p(l,"Regexp").$last_match(1))?p(l,"Regexp").$last_match(1)["$!="](""):x)["$!"](),S=a(M)?V.randomizer.$roll_once(6):p(l,"Regexp").$last_match(1).$to_i(),a(a($=$e(S,1))?$:$e(6,S)))?n:(v=V.$translate("LogHorizon.MII.name"),d=V.$translate("LogHorizon.MII.type_list")["$[]"](J(S,1)),y=V.randomizer.$roll_once(6),N=V.$translate("LogHorizon.MII.items")["$[]"](J(S,1))["$[]"](J(y,1)),Y(Y(v.$to_s(),a(M)?"("+S+")":"")," \uff1e "+d+"("+y+") \uff1e "+N))},ze.$$arity=1),e.def(m,"$roll_eastal_exploration_table",Le=function(ae){var V,M=this,x=n,S=n,$=n,v=n,d=n,y=n,N=n,W=n,ee=n,oe=n,ie=n;return x=/ESTL(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(ae),!a(x)||a(a(S=a($=x["$[]"](1)["$nil?"]())?x["$[]"](2)["$nil?"]():$)?x["$[]"](3)["$nil?"]():S)?n:(v=x["$[]"](1).$to_i(),d=p(l,"ArithmeticEvaluator").$eval(x["$[]"](2)),y=(V=x["$[]"](3))===n||null==V?n:K(V,"to_i",[]),N=a(y)?[y]:v["$=="](0)?[]:M.randomizer.$roll_barabara(2,6),a(N["$empty?"]())||(W="["+N.$join(",")+"]"),ee=Y(Y(N.$sum(),D(v,5)),d).$clamp(7,162),oe=M.$translate("LogHorizon.ESTL.name"),ie=M.$translate("LogHorizon.ESTL.items")["$[]"](ee.$to_s()).$chomp(),oe+"("+ee+W+")\n"+ie)},Le.$$arity=1),function(fe,ae){var M,V=[fe].concat(ae);fe.$private(),e.def(fe,"$translate_tables",M=function(S){return C(["PTAG","KOYU","MGR1","MGR2","MGR3","HLOC","PCNM"],{PTAG:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PTAG",S),KOYU:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.KOYU",S),MGR1:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR1",S),MGR2:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR2",S),MGR3:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR3",S),HLOC:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.HLOC",S),PCNM:t(p(V,"DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PCNM",S)})},M.$$arity=1)}(e.get_singleton_class(m),l),e.const_set(l[0],"TABLES",m.$translate_tables("ja_jp")),m.$register_prefix(p(l,"TABLES").$keys())}(Opal)}}]);