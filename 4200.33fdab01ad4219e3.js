(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4200],{4200:(de,ve,fe)=>{fe(9993),Opal.modules["bcdice/dice_table/table"]=function(n){var j,f,c,i,l,v,B,Q,C,L=[],a=n.nil,s=n.module,e=n.klass,T=n.hash2,R=n.defs,K=n.truthy,$=n.def,P=n.rb_minus;return j=L,f=C=[s(L[0],"BCDice")].concat(j),c=Q=[s(C[0],"DiceTable")].concat(f),l=[i=e(Q[0],null,"Table")].concat(c),v=n.$r(l),(B=i.$$prototype).times=B.sides=B.name=B.items=a,R(i,"$from_i18n",function(k,D){var m=a;return m=v("I18n").$t(k,T(["locale"],{locale:D})),this.$new(m["$[]"]("name"),m["$[]"]("type"),m["$[]"]("items"))},2),$(i,"$initialize",function(k,D,y){var m=this,o=a;return m.name=k,m.items=y.$freeze(),o=/(\d+)D(\d+)/i.$match(D),K(o)||m.$raise(v("ArgumentError"),"Unexpected table type: "+D),m.times=o["$[]"](1).$to_i(),m.sides=o["$[]"](2).$to_i()},3),$(i,"$roll",function(k){var y,D=this;return y=k.$roll_sum(D.times,D.sides),D.$choice(y)},1),$(i,"$choice",function(k){var y,D=this;return y=P(k,D.times),v("RollResult").$new(D.name,k,D.items["$[]"](y))},1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(n){var G,N,i,l,v,B,M,F,I,L=[],a=n.nil,s=n.module,e=n.klass,T=n.hash2,R=n.defs,K=n.def,$=n.rb_plus,P=n.rb_times,Y=n.rb_minus;return G=L,N=I=[s(L[0],"BCDice")].concat(G),i=F=[s(I[0],"DiceTable")].concat(N),v=[l=e(F[0],null,"D66GridTable")].concat(i),B=n.$r(v),(M=l.$$prototype).name=M.items=a,R(l,"$from_i18n",function(D,y){var o=a;return o=B("I18n").$t(D,T(["locale","raise"],{locale:y,raise:!0})),this.$new(o["$[]"]("name"),o["$[]"]("items"))},2),K(l,"$initialize",function(D,y){return this.name=D,this.items=y.$freeze()},2),K(l,"$roll",function(D){var m,o,g,x,p;return m=D.$roll_once(6),o=D.$roll_once(6),g=$(P(m,10),o),x=Y(m,1),p=Y(o,1),B("RollResult").$new(this.name,g,this.items["$[]"](x)["$[]"](p))},1)},Opal.modules["bcdice/arithmetic/node"]=function(n){var N,c,B,o,g,k,D,l,F,L=[],a=n.nil,s=n.$$$,e=n.module,T=n.klass,R=n.def,K=n.send2,$=n.find_super,P=n.eqeq,Y=n.const_set,j=n.eqeqeq,G=n.rb_divide,C=n.truthy,I=n.alias;return N=L,c=F=[e(L[0],"BCDice")].concat(N),B=l=[e(F[0],"Arithmetic")].concat(c),k=[e(l[0],"Node")].concat(B),D=n.$r(k),(g=(o=T(k[0],null,"BinaryOp")).$$prototype).lhs=g.rhs=g.op=a,R(o,"$initialize",function(p,A,d){var b=this;return b.lhs=p,b.op=A,b.rhs=d},3),R(o,"$eval",function(p){var b,A=this,d=a;return d=A.lhs.$eval(p),b=A.rhs.$eval(p),d.$send(A.op,b)},1),R(o,"$output",function(){var p=this;return""+p.lhs.$output()+p.op+p.rhs.$output()},0),R(o,"$s_exp",function(){var p=this;return"("+p.$op_for_s_exp()+" "+p.lhs.$s_exp()+" "+p.rhs.$s_exp()+")"},0),R(o,"$op_for_s_exp",function(){return this.op},0),function(y,m,o){var g=T(y,m,"DivideBase"),x=[g].concat(o),p=n.$r(x),A=g.$$prototype;A.lhs=A.rhs=A.op=a,R(g,"$initialize",function d(b,E){return delete d.$$p,K(this,$(this,"initialize",d,!1,!0),"initialize",[b,"/",E],null)},2),R(g,"$eval",function(b){var V,q,E=this;return V=E.lhs.$eval(b),q=E.rhs.$eval(b),P(q,0)&&E.$raise(p("ZeroDivisionError")),E.$divide_and_round(V,q,b)},1),R(g,"$output",function d(){var b=d.$$p||a,E=this;return delete d.$$p,""+K(E,$(E,"output",d,!1,!0),"output",[],b)+E.$rounding_method()},0),g.$private(),R(g,"$rounding_method",function(){return s(this.$class(),"ROUNDING_METHOD")},0),R(g,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()},0),R(g,"$divide_and_round",function(b,E,V){return this.$raise(p("NotImplementedError"))},3)}(k[0],D("BinaryOp"),k),function(y,m,o){var g=T(y,m,"DivideWithGameSystemDefault"),x=[g].concat(o),p=n.$r(x);Y(x[0],"ROUNDING_METHOD",""),g.$private(),R(g,"$divide_and_round",function(d,b,E){var V,q=a;return j(s(p("RoundType"),"CEIL"),V=E)?G(d.$to_f(),b).$ceil():j(s(p("RoundType"),"ROUND"),V)?(q=G(d.$to_f(),b),C(q["$negative?"]())?q.$abs().$round()["$-@"]():q.$round()):G(d,b).$floor()},3)}(k[0],D("DivideBase"),k),function(y,m,o){var g=T(y,m,"DivideWithCeil"),x=[g].concat(o);Y(x[0],"ROUNDING_METHOD","C"),g.$private(),R(g,"$divide_and_round",function(A,d,b){return G(A.$to_f(),d).$ceil()},3)}(k[0],D("DivideBase"),k),function(y,m,o){var g=T(y,m,"DivideWithRound"),x=[g].concat(o);Y(x[0],"ROUNDING_METHOD","R"),g.$private(),R(g,"$divide_and_round",function(A,d,b){var E=a;return E=G(A.$to_f(),d),C(E["$negative?"]())?E.$abs().$round()["$-@"]():E.$round()},3)}(k[0],D("DivideBase"),k),function(y,m,o){var g=T(y,m,"DivideWithFloor"),x=[g].concat(o);Y(x[0],"ROUNDING_METHOD","F"),g.$private(),R(g,"$divide_and_round",function(A,d,b){return G(A,d).$floor()},3)}(k[0],D("DivideBase"),k),function(y,m){var o=T(y,null,"Negative");o.$$prototype.body=a,R(o,"$initialize",function(p){return this.body=p},1),R(o,"$eval",function(p){return this.body.$eval(p)["$-@"]()},1),R(o,"$output",function(){return"-"+this.body.$output()},0),R(o,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"},0)}(k[0]),function(y,m){var o=T(y,null,"Parenthesis");o.$$prototype.expr=a,R(o,"$initialize",function(p){return this.expr=p},1),R(o,"$eval",function(p){return this.expr.$eval(p)},1),R(o,"$output",function(){return"("+this.expr.$output()+")"},0),R(o,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"},0)}(k[0]),function(y,m){var o=T(y,null,"Number");return o.$$prototype.value=a,R(o,"$initialize",function(p){return this.value=p},1),R(o,"$eval",function(p){return this.value},1),R(o,"$output",function(){return this.value.$to_s()},0),I(o,"s_exp","output")}(k[0])},Opal.modules["racc/parser"]=function(n){var D,m,o,a=[],s=n.$r(a),e=n.nil,T=n.$$$,R=n.module,K=n.klass,$=n.truthy,P=n.const_set,Y=n.defs,j=n.gvars,G=n.rb_lt,C=n.send,I=n.to_a,f=n.rb_minus,N=n.def,Q=n.to_ary,F=n.neqeq,w=n.rb_plus,c=n.eqeq,i=n.rb_ge,l=n.rb_gt,v=n.eqeqeq,B=n.rb_le,M=n.rb_times;return D=a,m=[R(a[0],"Racc")].concat(D),o=n.$r(m),K(m[0],o("StandardError"),"ParseError"),$(T("::","ParseError","skip_raise")?"constant":e)||P(a[0],"ParseError",T(s("Racc"),"ParseError")),function(k,D){var A,d,b,E,V,o=[R(k,"Racc")].concat(D),g=n.$r(o);return $(g("Racc_No_Extensions","skip_raise")?"constant":e)||P(o[0],"Racc_No_Extensions",!1),A=o,b=[d=K(o[0],null,"Parser")].concat(A),E=n.$r(b),(V=d.$$prototype).yydebug=V.racc_debug_out=V.racc_error_status=V.racc_t=V.racc_vstack=V.racc_val=V.racc_state=V.racc_tstack=e,P(b[0],"Racc_Runtime_Version","1.4.6"),P(b[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),P(b[0],"Racc_Runtime_Core_Version_R","1.4.6"),P(b[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),P(b[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),P(b[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),P(b[0],"Racc_Runtime_Core_Version",E("Racc_Runtime_Core_Version_R")),P(b[0],"Racc_Runtime_Core_Revision",E("Racc_Runtime_Core_Revision_R")),P(b[0],"Racc_Runtime_Type","ruby"),Y(E("Parser"),"$racc_runtime_type",function(){return E("Racc_Runtime_Type")},0),N(d,"$_racc_setup",function(){var u,h,r=this,_=e,t=e,S=e;return null==j.stderr&&(j.stderr=e),$(T(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),$(null!=(u=r.yydebug)&&u!==e?"instance-variable":e)||(r.yydebug=!1),$(r.yydebug)&&($(null!=(h=r.racc_debug_out)&&h!==e?"instance-variable":e)||(r.racc_debug_out=j.stderr),r.racc_debug_out=$(_=r.racc_debug_out)?_:j.stderr),t=T(r.$class(),"Racc_arg"),$(G(t.$size(),14))&&(C(t,"[]=",I(S=[13,!0])),f(S.length,1)),t},0),N(d,"$_racc_init_sysvars",function(){var u=this;return u.racc_state=[0],u.racc_tstack=[],u.racc_vstack=[],u.racc_t=e,u.racc_val=e,u.racc_read_next=!0,u.racc_user_yyerror=!1,u.racc_error_status=0},0),N(d,"$do_parse",function(){return this.$__send__(E("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},0),N(d,"$next_token",function(){return this.$raise(E("NotImplementedError"),this.$class()+"#next_token is not defined")},0),N(d,"$_racc_do_parse_rb",function(u,h){var r,t=this,S=e,O=e,U=e,ne=e,ce=e,J=e,ee=e,H=e;return r=Q(u),S=null==r[0]?e:r[0],O=null==r[1]?e:r[1],U=null==r[2]?e:r[2],ne=null==r[3]?e:r[3],ce=null==r[10]?e:r[10],t.$_racc_init_sysvars(),J=ee=H=e,C(t,"catch",["racc_end_parse"],function W(){var re,te,z=null==W.$$s?this:W.$$s,se=e;for(null==z.racc_state&&(z.racc_state=e),null==z.racc_read_next&&(z.racc_read_next=e),null==z.racc_t&&(z.racc_t=e),null==z.yydebug&&(z.yydebug=e),null==z.racc_val&&(z.racc_val=e);$(!0);)for($(H=ne["$[]"](z.racc_state["$[]"](-1)))?($(z.racc_read_next)&&F(z.racc_t,0)&&(te=z.$next_token(),re=Q(te),J=null==re[0]?e:re[0],z.racc_val=null==re[1]?e:re[1],z.racc_t=$(J)?$(se=ce["$[]"](J))?se:1:0,$(z.yydebug)&&z.$racc_read_token(z.racc_t,J,z.racc_val),z.racc_read_next=!1),H=w(H,z.racc_t),$(i(H,0))&&$(ee=S["$[]"](H))&&c(O["$[]"](H),z.racc_state["$[]"](-1))||(ee=U["$[]"](z.racc_state["$[]"](-1)))):ee=U["$[]"](z.racc_state["$[]"](-1));$(ee=z.$_racc_evalact(ee,u)););},{$$arity:0,$$s:t})},2),N(d,"$yyparse",function(u,h){return this.$__send__(E("Racc_YY_Parse_Method"),u,h,this.$_racc_setup(),!0)},2),N(d,"$_racc_yyparse_rb",function(u,h,r,_){var t,O=this,U=e,ne=e,X=e,ce=e,ee=e,H=e,W=e;return t=Q(r),U=null==t[0]?e:t[0],ne=null==t[1]?e:t[1],X=null==t[2]?e:t[2],ce=null==t[3]?e:t[3],ee=null==t[10]?e:t[10],O.$_racc_init_sysvars(),H=e,W=e,C(O,"catch",["racc_end_parse"],function ie(){var z=null==ie.$$s?this:ie.$$s;for(null==z.racc_state&&(z.racc_state=e);!$(W=ce["$[]"](z.racc_state["$[]"](-1)));)for(;$(H=z.$_racc_evalact(X["$[]"](z.racc_state["$[]"](-1)),r)););return C(u,"__send__",[h],function se(ae,_e){var Z=null==se.$$s?this:se.$$s,ue=e,le=e;for(null==Z.racc_t&&(Z.racc_t=e),null==Z.racc_state&&(Z.racc_state=e),null==Z.racc_read_next&&(Z.racc_read_next=e),null==ae&&(ae=e),null==_e&&(_e=e),Z.racc_t=$(ae)?$(ue=ee["$[]"](ae))?ue:1:0,Z.racc_val=_e,Z.racc_read_next=!1,W=w(W,Z.racc_t),$(i(W,0))&&$(H=U["$[]"](W))&&c(ne["$[]"](W),Z.racc_state["$[]"](-1))||(H=X["$[]"](Z.racc_state["$[]"](-1)));$(H=Z.$_racc_evalact(H,r)););for(;$($(ue=$(le=(W=ce["$[]"](Z.racc_state["$[]"](-1)))["$!"]())?le:Z.racc_read_next["$!"]())?ue:Z.racc_t["$=="](0));)for($(W)&&$(W=w(W,Z.racc_t))&&$(i(W,0))&&$(H=U["$[]"](W))&&c(ne["$[]"](W),Z.racc_state["$[]"](-1))||(H=X["$[]"](Z.racc_state["$[]"](-1)));$(H=Z.$_racc_evalact(H,r)););},{$$arity:2,$$s:z})},{$$arity:0,$$s:O})},4),N(d,"$_racc_evalact",function(u,h){var r,X,t=this,S=e,O=e,ne=e,ce=e,J=e,ee=e,H=e;if(S=null==(r=Q(h))[0]?e:r[0],O=null==r[1]?e:r[1],ne=null==r[3]?e:r[3],X=null==r[11]?e:r[11],ce=null==r[12]?e:r[12],$(l(u,0))&&$(G(u,X)))$(l(t.racc_error_status,0))&&(c(t.racc_t,1)||(t.racc_error_status=f(t.racc_error_status,1))),t.racc_vstack.$push(t.racc_val),t.racc_state.$push(u),t.racc_read_next=!0,$(t.yydebug)&&(t.racc_tstack.$push(t.racc_t),t.$racc_shift(t.racc_t,t.racc_tstack,t.racc_vstack));else if($(G(u,0))&&$(l(u,ce["$-@"]()))){if(J=C(t,"catch",["racc_jump"],function W(){var ie=null==W.$$s?this:W.$$s;return null==ie.racc_state&&(ie.racc_state=e),ie.racc_state.$push(ie.$_racc_do_reduce(h,u)),!1},{$$arity:0,$$s:t}),$(J)){if(v(1,ee=J))return t.racc_user_yyerror=!0,ce["$-@"]();if(v(2,ee))return X;t.$raise("[Racc Bug] unknown jump code")}}else if(c(u,X))$(t.yydebug)&&t.$racc_accept(),t.$throw("racc_end_parse",t.racc_vstack["$[]"](0));else{if(c(u,ce["$-@"]())){for(v(0,ee=t.racc_error_status)?$(h["$[]"](21))||t.$on_error(t.racc_t,t.racc_val,t.racc_vstack):v(3,ee)&&(c(t.racc_t,0)&&t.$throw("racc_end_parse",e),t.racc_read_next=!0),t.racc_user_yyerror=!1,t.racc_error_status=3;$(!0)&&!($(H=ne["$[]"](t.racc_state["$[]"](-1)))&&(H=w(H,1),$(i(H,0))&&$(u=S["$[]"](H))&&c(O["$[]"](H),t.racc_state["$[]"](-1))));)$(B(t.racc_state.$size(),1))&&t.$throw("racc_end_parse",e),t.racc_state.$pop(),t.racc_vstack.$pop(),$(t.yydebug)&&(t.racc_tstack.$pop(),t.$racc_e_pop(t.racc_state,t.racc_tstack,t.racc_vstack));return u}t.$raise("[Racc Bug] unknown action "+u.$inspect())}return $(t.yydebug)&&t.$racc_next_state(t.racc_state["$[]"](-1),t.racc_state),e},2),N(d,"$_racc_do_reduce",function(u,h){var r,ce,ee,z,se,ae,Z,t=this,O=e,U=e,ne=e,X=e,J=e,H=e,W=e,ie=e,re=e,te=e,_e=e,oe=e,$e=e,ue=e;return O=null==(r=Q(u))[4]?e:r[4],U=null==r[5]?e:r[5],ne=null==r[6]?e:r[6],X=null==r[7]?e:r[7],ce=null==r[8]?e:r[8],J=null==r[9]?e:r[9],ee=null==r[13]?e:r[13],H=t.racc_state,W=t.racc_vstack,ie=t.racc_tstack,re=M(h,-3),te=J["$[]"](re),z=J["$[]"](w(re,1)),se=J["$[]"](w(re,2)),ae=[],$(t.yydebug)&&(_e=ie["$[]"](te["$-@"](),te)),oe=W["$[]"](te["$-@"](),te),$(t.yydebug)&&($e=[te["$-@"](),te,ae],C(ie,"[]=",I($e)),f($e.length,1)),$e=[te["$-@"](),te,ae],C(W,"[]=",I($e)),f($e.length,1),$e=[te["$-@"](),te,ae],C(H,"[]=",I($e)),f($e.length,1),$(ee)?W.$push(t.$__send__(se,oe,W,oe["$[]"](0))):W.$push(t.$__send__(se,oe,W)),ie.$push(z),$(t.yydebug)&&t.$racc_reduce(_e,z,ie,W),Z=f(z,ce),$(re=X["$[]"](Z))&&(re=w(re,H["$[]"](-1)),$(i(re,0))&&$(ue=O["$[]"](re))&&c(U["$[]"](re),Z))?ue:ne["$[]"](Z)},2),N(d,"$on_error",function(u,h,r){var t,_=this;return _.$raise(E("ParseError"),_.$sprintf("\nparse error on value %s (%s)",h.$inspect(),$(t=_.$token_to_str(u))?t:"?"))},3),N(d,"$yyerror",function(){return this.$throw("racc_jump",1)},0),N(d,"$yyaccept",function(){return this.$throw("racc_jump",2)},0),N(d,"$yyerrok",function(){return this.racc_error_status=0},0),N(d,"$racc_read_token",function(u,h,r){var _=this;return _.racc_debug_out.$print("read    "),_.racc_debug_out.$print(h.$inspect(),"(",_.$racc_token2str(u),") "),_.racc_debug_out.$puts(r.$inspect()),_.racc_debug_out.$puts()},3),N(d,"$racc_shift",function(u,h,r){var _=this;return _.racc_debug_out.$puts("shift   "+_.$racc_token2str(u)),_.$racc_print_stacks(h,r),_.racc_debug_out.$puts()},3),N(d,"$racc_reduce",function(u,h,r,_){var t=this,S=e;return(S=t.racc_debug_out).$print("reduce "),$(u["$empty?"]())?S.$print(" <none>"):C(u,"each",[],function O(U){return null==U&&(U=e),S.$print(" ",(null==O.$$s?this:O.$$s).$racc_token2str(U))},{$$arity:1,$$s:t}),S.$puts(" --\x3e "+t.$racc_token2str(h)),t.$racc_print_stacks(r,_),t.racc_debug_out.$puts()},4),N(d,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},0),N(d,"$racc_e_pop",function(u,h,r){var _=this;return _.racc_debug_out.$puts("error recovering mode: pop token"),_.$racc_print_states(u),_.$racc_print_stacks(h,r),_.racc_debug_out.$puts()},3),N(d,"$racc_next_state",function(u,h){var r=this;return r.racc_debug_out.$puts("goto    "+u),r.$racc_print_states(h),r.racc_debug_out.$puts()},2),N(d,"$racc_print_stacks",function(u,h){var _=e;return(_=this.racc_debug_out).$print("        ["),C(u,"each_index",[],function t(S){return null==S&&(S=e),_.$print(" (",(null==t.$$s?this:t.$$s).$racc_token2str(u["$[]"](S))," ",h["$[]"](S).$inspect(),")")},{$$arity:1,$$s:this}),_.$puts(" ]")},2),N(d,"$racc_print_states",function(u){var r=e;return(r=this.racc_debug_out).$print("        ["),C(u,"each",[],function(t){return null==t&&(t=e),r.$print(" ",t)},1),r.$puts(" ]")},1),N(d,"$racc_token2str",function(u){var r;return $(r=T(this.$class(),"Racc_token_to_s_table")["$[]"](u))?r:this.$raise("[Racc Bug] can't convert token "+u+" to string")},1),N(d,"$token_to_str",function(u){return T(this.$class(),"Racc_token_to_s_table")["$[]"](u)},1)}(a[0],a)},Opal.modules.strscan=function(n){var I,f,N,Q,F,L=[],a=n.nil,e=n.def,T=n.truthy,R=n.eqeqeq,K=n.Opal,$=n.send,P=n.to_a,Y=n.rb_minus,j=n.alias;return I=L,N=[f=(0,n.klass)(L[0],null,"StringScanner")].concat(I),Q=n.$r(N),(F=f.$$prototype).pos=F.string=F.working=F.matched=F.prev_pos=F.match=a,f.$attr_reader("pos","matched"),e(f,"$initialize",function(c){var i=this;return i.string=c,i.pos=0,i.matched=a,i.working=c,i.match=[]},1),f.$attr_reader("string"),e(f,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)},0),e(f,"$scan",function(c){var i=this,l=(c=i.$anchor(c)).exec(i.working);return null==l?i.matched=a:"object"==typeof l?(i.prev_pos=i.pos,i.pos+=l[0].length,i.working=i.working.substring(l[0].length),i.matched=l[0],i.match=l,l[0]):"string"==typeof l?(i.pos+=l.length,i.working=i.working.substring(l.length),l):a},1),e(f,"$scan_until",function(c){var i=this;c=i.$anchor(c);for(var B,l=i.pos,v=i.working;;){if(B=c.exec(v),l+=1,v=v.substr(1),null!=B)return i.matched=i.string.substr(i.pos,l-i.pos-1+B[0].length),i.match=B,i.prev_pos=l-1,i.pos=l,i.working=v.substr(B[0].length),i.matched;if(0===v.length)return i.match=[],i.matched=a}},1),e(f,"$[]",function(c){var l;if(T(this.match["$empty?"]()))return a;R(Q("Symbol"),l=c)?c=c.$to_s():R(Q("String"),l)||(c=K["$coerce_to!"](c,Q("Integer"),"to_int"));var v=this.match;return c<0&&(c+=v.length),c<0||c>=v.length||null==v[c]?a:v[c]},1),e(f,"$check",function(c){var i=this,l=(c=i.$anchor(c)).exec(i.working);return i.matched=null==l?a:l[0]},1),e(f,"$check_until",function(c){var i=this,l=i.prev_pos,v=i.pos,B=i.$scan_until(c);return B!==a&&(i.matched=B.substr(-1),i.working=i.string.substr(v)),i.prev_pos=l,i.pos=v,B},1),e(f,"$peek",function(c){return this.working.substring(0,c)},1),e(f,"$eos?",function(){return 0===this.working.length},0),e(f,"$exist?",function(c){var l=c.exec(this.working);return null==l?a:0==l.index?0:l.index+1},1),e(f,"$skip",function(c){var i=this,l=(c=i.$anchor(c)).exec(i.working);if(null==l)return i.match=[],i.matched=a;var v=l[0],B=v.length;return i.matched=v,i.match=l,i.prev_pos=i.pos,i.pos+=B,i.working=i.working.substring(B),B},1),e(f,"$skip_until",function(c){var l=this.$scan_until(c);return l===a?a:(this.matched=l.substr(-1),l.length)},1),e(f,"$get_byte",function(){var c=this,i=a;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,i=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=a,i},0),e(f,"$match?",function(c){var i=this,l=(c=i.$anchor(c)).exec(i.working);return null==l?a:(i.prev_pos=i.pos,l[0].length)},1),e(f,"$pos=",function(c){var i=this;return c<0&&(c+=i.string.$length()),i.pos=c,i.working=i.string.slice(c)},1),e(f,"$matched_size",function(){return this.matched===a?a:this.matched.length},0),e(f,"$post_match",function(){var c=this;return c.matched===a?a:c.string.substr(c.pos)},0),e(f,"$pre_match",function(){var c=this;return c.matched===a?a:c.string.substr(0,c.prev_pos)},0),e(f,"$reset",function(){var c=this;return c.working=c.string,c.matched=a,c.pos=0},0),e(f,"$rest",function(){return this.working},0),e(f,"$rest?",function(){return 0!==this.working.length},0),e(f,"$rest_size",function(){return this.$rest().$size()},0),e(f,"$terminate",function(){var i,c=this;return c.match=a,i=[c.string.$length()],$(c,"pos=",P(i)),i[Y(i.length,1)]},0),e(f,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=a,c.match=a,c},0),j(f,"bol?","beginning_of_line?"),j(f,"getch","get_byte"),f.$private(),e(f,"$anchor",function(c){var i=c.toString().match(/\/([^\/]+)$/);return i=i?i[1]:void 0,new RegExp("^(?:"+c.source+")",i)},1)},Opal.modules["bcdice/normalize"]=function(n){var $,G,Y,L=[],a=n.nil,s=n.module,e=n.eqeqeq,T=n.def,R=n.eqeq;return $=L,Y=[s(L[0],"BCDice")].concat($),(G=s(Y[0],"Normalize")).$module_function(),T(G,"$comparison_operator",function(I){var f;return e(/<=|=</,f=I)?"<=":e(/>=|=>/,f)?">=":e(/<>|!=|=!/,f)?"!=":e(/</,f)?"<":e(/>/,f)?">":e(/=/,f)?"==":a},1),T(G,"$target_number",function(I){return R(I,"?")?I:I.$to_i()},1)},Opal.modules["bcdice/common_command/lexer"]=function(n){var j,f,c,i,l,v,Q,C,L=n.top,a=[],s=n.nil,e=n.module,T=n.klass,R=n.const_set,K=n.hash2,$=n.truthy,P=n.def;return L.$require("strscan"),L.$require("bcdice/normalize"),j=a,f=C=[e(a[0],"BCDice")].concat(j),c=Q=[e(C[0],"CommonCommand")].concat(f),l=[i=T(Q[0],null,"Lexer")].concat(c),v=n.$r(l),i.$$prototype.scanner=s,R(l[0],"SYMBOLS",K(["+","-","*","/","(",")","[","]","?","@"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","?":"QUESTION","@":"AT"}).$freeze()),P(i,"$initialize",function(k){var y;return k=$(y=k.$split(" ",2).$first())?y:"",this.scanner=v("StringScanner").$new(k)},1),P(i,"$next_token",function(){var k=this,D=s,y=s,m=s,g=s;return $(k.scanner["$eos?"]())?[!1,"$"]:$(D=k.scanner.$scan(/\d+/))?["NUMBER",D.$to_i()]:$(y=k.scanner.$scan(/[<>!=]+/))?["CMP_OP",v("Normalize").$comparison_operator(y)]:(m=k.scanner.$getch().$upcase(),[$(g=v("SYMBOLS")["$[]"](m))?g:m.$to_sym(),m])},0),P(i,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/arithmetic/parser"]=function(n){var G,N,l,k,D,y,m,o,g,x,p,A,E,v,B,M,F,w,I,L=n.top,a=[],s=n.nil,e=n.$$$,T=n.module,R=n.klass,K=n.defs,$=n.def,P=n.hash,Y=n.const_set;return L.$require("racc/parser.rb"),L.$require("bcdice/common_command/lexer"),L.$require("bcdice/arithmetic/node"),G=a,N=I=[T(a[0],"BCDice")].concat(G),F=[T(I[0],"Arithmetic")].concat(N),w=n.$r(F),l=F,B=[v=R(F[0],e(w("Racc"),"Parser"),"Parser")].concat(l),M=n.$r(B),v.$$prototype.lexer=s,K(v,"$parse",function(r){return this.$new().$parse(r)},1),$(v,"$parse",function(r){try{return this.lexer=e(e(M("BCDice"),"CommonCommand"),"Lexer").$new(r),this.$do_parse()}catch(t){if(!n.rescue(t,[M("ParseError")]))throw t;try{return s}finally{n.pop_exception()}}},1),v.$private(),$(v,"$next_token",function(){return this.lexer.$next_token()},0),k=[8,17,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,12,13,4,5,4,5,7,8,7,8,s,s,4,5,4,5,7,9,7,s,s,10,11,s,10,11,22,26,24,25,27],D=[0,9,4,2,2,0,0,4,4,0,5,4,7,18,18,5,5,7,7,5,10,7,11,19,19,10,10,11,11,10,12,11,13,s,s,12,12,13,13,12,1,13,s,s,16,16,s,1,1,16,21,21,21,21],y=[-2,40,-6,s,0,8,s,10,s,1,18,20,28,30,s,s,37,s,4,14,s,47,s,s,s,s,s,s],m=[-17,-17,-3,-6,-17,-17,-14,-17,-16,-17,-17,-17,-17,-17,-12,-13,-17,28,-1,-2,-4,-7,-15,-5,-8,-9,-10,-11],o=[14,15,23,1,18,19,s,s,20,21,16],g=[3,3,4,1,2,2,s,s,3,3,1],x=[s,3,-6,-4,-19,s],p=[s,s,2,3,s,6],A=[0,0,"racc_error",3,14,"_reduce_1",3,14,"_reduce_2",1,14,"_reduce_none",3,15,"_reduce_4",4,15,"_reduce_5",1,15,"_reduce_none",0,17,"_reduce_7",1,17,"_reduce_8",1,17,"_reduce_9",1,17,"_reduce_10",1,17,"_reduce_11",2,16,"_reduce_12",2,16,"_reduce_13",1,16,"_reduce_none",3,18,"_reduce_15",1,18,"_reduce_16"],E=P(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12),Y(B[0],"Racc_arg",[k,D,m,y,o,g,p,x,13,A,E,28,17,!0]),Y(B[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","$start","add","mul","unary","round_type","term"]),Y(B[0],"Racc_debug_parser",!1),$(v,"$_reduce_1",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"BinaryOp").$new(r["$[]"](0),"+",r["$[]"](2))},3),$(v,"$_reduce_2",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"BinaryOp").$new(r["$[]"](0),"-",r["$[]"](2))},3),$(v,"$_reduce_4",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"BinaryOp").$new(r["$[]"](0),"*",r["$[]"](2))},3),$(v,"$_reduce_5",function(r,_,t){return r["$[]"](3).$new(r["$[]"](0),r["$[]"](2))},3),$(v,"$_reduce_7",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"DivideWithGameSystemDefault")},3),$(v,"$_reduce_8",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"DivideWithCeil")},3),$(v,"$_reduce_9",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"DivideWithCeil")},3),$(v,"$_reduce_10",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"DivideWithRound")},3),$(v,"$_reduce_11",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"DivideWithFloor")},3),$(v,"$_reduce_12",function(r,_,t){return r["$[]"](1)},3),$(v,"$_reduce_13",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"Negative").$new(r["$[]"](1))},3),$(v,"$_reduce_15",function(r,_,t){return r["$[]"](1)},3),$(v,"$_reduce_16",function(r,_,t){return e(e(M("Arithmetic"),"Node"),"Number").$new(r["$[]"](0))},3),$(v,"$_reduce_none",function(r,_,t){return r["$[]"](0)},3)},Opal.modules["bcdice/arithmetic"]=function(n){var $,G,f,Q,F,C,I,Y,L=n.top,a=[],s=n.nil,e=n.module,T=n.send,R=n.def;return L.$require("bcdice/arithmetic/node"),L.$require("bcdice/arithmetic/parser"),$=a,G=Y=[e(a[0],"BCDice")].concat($),I=[C=e(Y[0],"Arithmetic")].concat(G),Q=[f=n.get_singleton_class(C)].concat(I),F=n.$r(Q),R(f,"$eval",function(c,i){var l;try{return(l=F("Parser").$parse(c))===s||null==l?s:T(l,"eval",[i])}catch(B){if(!n.rescue(B,[F("ZeroDivisionError")]))throw B;try{return s}finally{n.pop_exception()}}},2)},Opal.queue(function(n){var w,v,m,o,g,x,M,k,i,L=n.top,a=[],s=n.nil,e=n.$$$,T=n.module,R=n.klass,K=n.const_set,$=n.send2,P=n.find_super,Y=n.def,j=n.truthy,G=n.send,C=n.rb_le,I=n.rb_ge,f=n.rb_plus,N=n.rb_lt,Q=n.hash2;return L.$require("bcdice/dice_table/table"),L.$require("bcdice/dice_table/d66_grid_table"),L.$require("bcdice/arithmetic"),w=a,v=i=[T(a[0],"BCDice")].concat(w),M=[T(i[0],"GameSystem")].concat(v),k=n.$r(M),m=M,g=[o=R(M[0],k("Base"),"AngelGear")].concat(m),x=n.$r(g),o.$$prototype.randomizer=s,K(g[0],"ID","AngelGear"),K(g[0],"NAME","\u30a8\u30f3\u30bc\u30eb\u30ae\u30a2 \u5929\u4f7f\u5927\u6226TRPG The 2nd Editon"),K(g[0],"SORT_KEY","\u3048\u3093\u305b\u308b\u304d\u30422"),K(g[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u3000nAG[s][\xb1a]\n[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\nn:\u5224\u5b9a\u5024\ns:\u6280\u80fd\u5024\na:\u4fee\u6b63\n\uff08\u4f8b\uff09\n12AG 10AG3\xb120\n\n\u30fb\u611f\u60c5\u8868\u3000ET\n"),Y(o,"$initialize",function A(d){var E=this;return delete A.$$p,$(E,P(E,"initialize",A,!1,!0),"initialize",[d],null),E.sort_barabara_dice=!0},1),Y(o,"$eval_game_system_specific_command",function(d){var b,V=s;return j(V=/^(\d+)AG(\d+)?(([+\-]\d+)*)$/.$match(d))?this.$resolute_action(V["$[]"](1).$to_i(),(b=V["$[]"](2))===s||null==b?s:G(b,"to_i",[]),V["$[]"](3),d):this.$roll_tables(d,x("TABLES"))},1),Y(o,"$resolute_action",function(d,b,E,V){var h,S,u=s,r=s,_=s,t=s;return h=(u=this.randomizer.$roll_barabara(d,6).$sort()).$join(","),r=0,_=0,j(b)&&(_=G(u,"count",[],function(U){return null==U&&(U=s),C(U,b)},1),j(E["$empty?"]())||(r=x("Arithmetic").$eval(E,e(x("RoundType"),"FLOOR")))),j(I(f(_,r),100))&&(t="(\u798f\u97f3\u767a\u751f)"),S="("+V+") \uff1e "+_+"["+h+"]"+this.$format("%+d",r)+" \uff1e \u6210\u529f\u6570: "+f(_,r)+t,j(I(f(_,r),100))?x("Result").$critical(S):N(0,f(_,r))?x("Result").$success(S):x("Result").$failure(S)},4),K(g[0],"TABLES",Q(["ET"],{ET:e(x("DiceTable"),"D66GridTable").$new("\u611f\u60c5\u8868",[["\u597d\u5947\u5fc3\uff08\u597d\u5947\u5fc3\uff09","\u61a7\u308c\uff08\u3042\u3053\u304c\u308c\uff09","\u5c0a\u656c\uff08\u305d\u3093\u3051\u3044\uff09","\u4ef2\u9593\u610f\u8b58\uff08\u306a\u304b\u307e\u3044\u3057\u304d\uff09","\u6bcd\u6027\u611b\uff08\u307c\u305b\u3044\u3042\u3044\uff09","\u611f\u5fc3\uff08\u304b\u3093\u3057\u3093\uff09"],["\u7d14\u611b\uff08\u3058\u3085\u3093\u3042\u3044\uff09","\u53cb\u60c5\uff08\u3086\u3046\u3058\u3087\u3046\uff09","\u540c\u60c5\uff08\u3069\u3046\u3058\u3087\u3046\uff09","\u7236\u6027\u611b\uff08\u3075\u305b\u3044\u3042\u3044\uff09","\u5e78\u798f\u611f\uff08\u3053\u3046\u3075\u304f\u304b\u3093\uff09","\u4fe1\u983c\uff08\u3057\u3093\u3089\u3044\uff09"],["\u7af6\u4e89\u5fc3\uff08\u304d\u3087\u3046\u305d\u3046\u3057\u3093\uff09","\u89aa\u8fd1\u611f\uff08\u3057\u3093\u304d\u3093\u304b\u3093\uff09","\u307e\u3054\u3053\u308d","\u597d\u610f\uff08\u3053\u3046\u3044\uff09","\u6709\u70ba\uff08\u3086\u3046\u3044\uff09","\u5d07\u62dd\uff08\u3059\u3046\u306f\u3044\uff09"],["\u5927\u5acc\u3044\uff08\u3060\u3044\u304d\u3089\u3044\uff09","\u59ac\u307f\uff08\u306d\u305f\u307f\uff09","\u4fae\u8511\uff08\u3076\u3079\u3064\uff09","\u8150\u308c\u7e01\uff08\u304f\u3055\u308c\u3048\u3093\uff09","\u6050\u6016\uff08\u304d\u3087\u3046\u3075\uff09","\u52a3\u7b49\u611f\uff08\u308c\u3063\u3068\u3046\u304b\u3093\uff09"],["\u504f\u611b\uff08\u3078\u3093\u3042\u3044\uff09","\u5bc2\u3057\u3055\uff08\u3055\u3073\u3057\u3055\uff09","\u6190\u61ab\uff08\u308c\u3093\u3073\u3093\uff09","\u95d8\u4e89\u5fc3\uff08\u3068\u3046\u305d\u3046\u3057\u3093\uff09","\u98df\u50b7\uff08\u3057\u3087\u304f\u3057\u3087\u3046\uff09","\u5618\u3064\u304d\uff08\u3046\u305d\u3064\u304d\uff09"],["\u7518\u3048\uff08\u3042\u307e\u3048\uff09","\u82db\u7acb\u3061\uff08\u3044\u3089\u3060\u3061\uff09","\u4e0b\u5fc3\uff08\u3057\u305f\u3054\u3053\u308d\uff09","\u618e\u60aa\uff08\u305e\u3046\u304a\uff09","\u7591\u60d1\uff08\u304e\u308f\u304f\uff09","\u652f\u914d\uff08\u3057\u306f\u3044\uff09"]])}).$freeze()),o.$register_prefix("\\d+AG",x("TABLES").$keys())})}}]);