(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6698],{6698:(de,me,fe)=>{fe(9993),Opal.modules["i18n/backend/fallbacks"]=function(r){var U,l,N,B,z,f,M=[],t=r.nil,d=r.$$$,e=r.module,p=r.class_variable_set,E=r.truthy,A=r.class_variable_get,c=r.def,C=r.send,Y=r.to_a,S=r.rb_minus,I=r.send2,F=r.find_super,H=r.hash2,L=r.find_block_super,j=r.neqeq;return U=M,f=[z=e(M[0],"I18n")].concat(U),p(f[0],"@@fallbacks",t),l=r.get_singleton_class(z),N=[l].concat(f),B=r.$r(N),c(l,"$fallbacks",function(){var x=t;return p(N[1],"@@fallbacks",E(null!=N[1].$$cvars["@@fallbacks"]?"class variable":t)&&E(x=A(N[1],"@@fallbacks",!1))?x:d(d(B("I18n"),"Locale"),"Fallbacks").$new()),E(x=B("Thread").$current()["$[]"]("i18n_fallbacks"))?x:A(N[1],"@@fallbacks",!1)},0),c(l,"$fallbacks=",function(v){var x;return p(N[1],"@@fallbacks",E(v["$is_a?"](B("Array")))?d(d(B("I18n"),"Locale"),"Fallbacks").$new(v):v),x=["i18n_fallbacks",A(N[1],"@@fallbacks",!1)],C(B("Thread").$current(),"[]=",Y(x)),x[S(x.length,1)]},1),function(l,q){var v,x,y,m,B=[e(l,"Backend")].concat(q);return v=B,y=[x=e(B[0],"Fallbacks")].concat(v),m=r.$r(y),c(x,"$translate",function _(s,a,$){try{var n=_.$$p||t,i=this,u=t,g=t;return delete _.$$p,null==$&&($=m("EMPTY_HASH")),E($.$fetch("fallback",!0))?E($["$[]"]("fallback_in_progress"))?I(i,F(i,"translate",_,!1,!0),"translate",[s,a,$],n):(E($["$[]"]("default"))&&(u=i["$extract_non_symbol_default!"]($)),g=$.$merge(H(["fallback_in_progress"],{fallback_in_progress:!0})),C(m("I18n").$fallbacks()["$[]"](s),"each",[],function h(k){var P=null==h.$$s?this:h.$$s;null==k&&(k=t);try{return C(P,"catch",["exception"],function G(){var o=null==G.$$s?this:G.$$s,Z=t;if(Z=I(o,L(o,"translate",G.$$def||h.$$def||_,!1,!1),"translate",[k,a,g],null),E(Z["$nil?"]()))return t;j(s.$to_s(),k.$to_s())&&o.$on_fallback(s,k,a,$),r.ret(Z)},{$$arity:0,$$s:P})}catch(G){if(!r.rescue(G,[d(m("I18n"),"InvalidLocale")]))throw G;try{return t}finally{r.pop_exception()}}},{$$arity:1,$$s:i}),E($["$key?"]("default"))&&E($["$[]"]("default")["$nil?"]())?t:E(u)?I(i,F(i,"translate",_,!1,!0),"translate",[s,t,$.$merge(H(["default"],{default:u}))],null):i.$throw("exception",d(m("I18n"),"MissingTranslation").$new(s,a,$))):I(i,F(i,"translate",_,!1,!0),"translate",[s,a,$],n)}catch(h){if(h===r.returner)return h.$v;throw h}},-3),c(x,"$extract_non_symbol_default!",function(s){var $,a=t,n=t;return a=[s["$[]"]("default")].$flatten(),$=C(a,"detect",[],function(u){return null==u&&(u=t),u["$is_a?"](m("Symbol"))["$!"]()},1),E($)&&(n=["default",a["$[]"](0,a.$index($))],C(s,"[]=",Y(n)),S(n.length,1)),$},1),c(x,"$exists?",function _(s,a,$){try{var n=_.$$p||t,i=this;return delete _.$$p,null==$&&($=m("EMPTY_HASH")),E($.$fetch("fallback",!0))?(C(m("I18n").$fallbacks()["$[]"](s),"each",[],function u(g){var h=null==u.$$s?this:u.$$s;null==g&&(g=t);try{if(!E(I(h,L(h,"exists?",u.$$def||_,!1,!1),"exists?",[g,a],null)))return t;r.ret(!0)}catch(k){if(!r.rescue(k,[d(m("I18n"),"InvalidLocale")]))throw k;try{return t}finally{r.pop_exception()}}},{$$arity:1,$$s:i}),!1):I(i,F(i,"exists?",_,!1,!0),"exists?",[s,a,$],n)}catch(u){if(u===r.returner)return u.$v;throw u}},-3),x.$private(),c(x,"$on_fallback",function(s,a,$,n){return t},4)}(f[0],f)},Opal.modules["bcdice/randomizer"]=function(r){var z,b,v,x,y,m,l,q,M=[],t=r.nil,d=r.$$$,p=r.klass,E=r.const_set,A=r.def,c=r.truthy,C=r.rb_gt,Y=r.rb_plus,S=r.rb_le,I=r.send,F=r.rb_minus,H=r.eqeq,L=r.rb_times,j=r.eqeqeq,V=r.rb_ge;return z=M,l=[(0,r.module)(M[0],"BCDice")].concat(z),q=r.$r(l),b=l,x=[v=p(l[0],null,"Randomizer")].concat(b),y=r.$r(x),(m=v.$$prototype).rand_results=m.detailed_rand_results=t,E(x[0],"UPPER_LIMIT_DICE_TIMES",200),E(x[0],"UPPER_LIMIT_DICE_SIDES",1e4),E(x[0],"UPPER_LIMIT_RANDS",1e4),A(v,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]},0),v.$attr_reader("rand_results"),v.$attr_reader("detailed_rand_results"),E(x[0],"DetailedRandResult",y("Struct").$new("kind","sides","value")),A(v,"$roll_barabara",function(s,a){var $=this;return c(C(Y($.rand_results.$size(),s),y("UPPER_LIMIT_RANDS")))&&$.$raise(y("TooManyRandsError")),c(S(s,0))||c(C(s,y("UPPER_LIMIT_DICE_TIMES")))?[]:I(y("Array"),"new",[s],function n(){return(null==n.$$s?this:n.$$s).$roll_once(a)},{$$arity:0,$$s:$})},2),A(v,"$roll_sum",function(s,a){return this.$roll_barabara(s,a).$sum()},2),A(v,"$roll_once",function(s){var $=t;return c(S(s,0))||c(C(s,y("UPPER_LIMIT_DICE_SIDES")))?0:($=this.$rand_inner(s),this.$push_to_detail("normal",s,$),$)},1),A(v,"$roll_index",function(s){return F(this.$roll_once(s),1)},1),A(v,"$roll_tens_d10",function(){var $,a=t;return a=this.$rand_inner(10),H(a,10)&&(a=0),$=L(a,10),this.$push_to_detail("tens_d10",10,$),$},0),A(v,"$roll_d9",function(){var a;return a=F(this.$rand_inner(10),1),this.$push_to_detail("d9",10,a),a},0),A(v,"$roll_d66",function(s){var n,$=t;return $=I(y("Array"),"new",[2],function i(){return(null==i.$$s?this:i.$$s).$roll_once(6)},{$$arity:0,$$s:this}),j(d(y("D66SortType"),"ASC"),n=s)?$["$sort!"]():j(d(y("D66SortType"),"DESC"),n)&&$["$sort!"]()["$reverse!"](),Y(L($["$[]"](0),10),$["$[]"](1))},1),v.$private(),A(v,"$rand_inner",function(s){var $,a=this;return c(V(a.rand_results.$size(),y("UPPER_LIMIT_RANDS")))&&a.$raise(y("TooManyRandsError")),$=a.$random(s),a.rand_results["$<<"]([$,s]),$},1),A(v,"$random",function(s){return Y(y("Kernel").$rand(s),1)},1),A(v,"$push_to_detail",function(s,a,$){var i;return i=y("DetailedRandResult").$new(s,a,$),this.detailed_rand_results.$push(i)},3),p(l[0],q("StandardError"),"TooManyRandsError"),t},Opal.modules["bcdice/dice_table/roll_result"]=function(r){var c,I,V,U,z,f,l,H,Y,M=[],t=r.nil,d=r.module,e=r.klass,p=r.def,E=r.truthy;return c=M,I=Y=[d(M[0],"BCDice")].concat(c),V=H=[d(Y[0],"DiceTable")].concat(I),z=[U=e(H[0],null,"RollResult")].concat(V),f=r.$r(z),(l=U.$$prototype).table_name=l.value=l.body=t,p(U,"$initialize",function(N,B,b){var v=this;return v.table_name=N,v.value=B,v.body=b},3),U.$attr_reader("table_name"),U.$attr_reader("value"),U.$attr_reader("body"),p(U,"$to_s",function(){var N=this;return N.table_name+"("+N.value+") \uff1e "+N.body},0),p(U,"$last_body",function(){var N=this;return E(N.body["$is_a?"](f("RollResult")))?N.body.$last_body():N.body},0),p(U,"$empty?",function(){return!1},0)},Opal.modules["bcdice/dice_table/chain_table"]=function(r){var C,F,U,z,f,l,q,L,S,M=[],t=r.nil,d=r.module,e=r.klass,p=r.truthy,E=r.def,A=r.rb_minus;return C=M,F=S=[d(M[0],"BCDice")].concat(C),U=L=[d(S[0],"DiceTable")].concat(F),f=[z=e(L[0],null,"ChainTable")].concat(U),l=r.$r(f),(q=z.$$prototype).times=q.sides=q.items=q.name=t,E(z,"$initialize",function(B,b,v){var x=this,y=t;return x.name=B,x.items=v.$freeze(),y=/(\d+)D(\d+)/i.$match(b),p(y)||x.$raise(l("ArgumentError"),"Unexpected table type: "+b),x.times=y["$[]"](1).$to_i(),x.sides=y["$[]"](2).$to_i()},3),E(z,"$roll",function(B){var v,x,b=this,y=t;return v=B.$roll_sum(b.times,b.sides),x=A(v,b.times),y=b.items["$[]"](x),p(y["$respond_to?"]("roll"))&&(y=y.$roll(B)),l("RollResult").$new(b.name,v,y)},1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(r){var I,j,l,q,N,B,b,U,H,M=[],t=r.nil,d=r.module,e=r.klass,p=r.hash2,E=r.defs,A=r.def,c=r.rb_plus,C=r.rb_times,Y=r.rb_minus;return I=M,j=H=[d(M[0],"BCDice")].concat(I),l=U=[d(H[0],"DiceTable")].concat(j),N=[q=e(U[0],null,"D66GridTable")].concat(l),B=r.$r(N),(b=q.$$prototype).name=b.items=t,E(q,"$from_i18n",function(x,y){var _=t;return _=B("I18n").$t(x,p(["locale","raise"],{locale:y,raise:!0})),this.$new(_["$[]"]("name"),_["$[]"]("items"))},2),A(q,"$initialize",function(x,y){return this.name=x,this.items=y.$freeze()},2),A(q,"$roll",function(x){var m,_,s,a,$;return m=x.$roll_once(6),_=x.$roll_once(6),s=c(C(m,10),_),a=Y(m,1),$=Y(_,1),B("RollResult").$new(this.name,s,this.items["$[]"](a)["$[]"]($))},1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(r){var Y,H,f,l,q,N,j,V,I,t=[],d=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.defs,c=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),Y=t,H=I=[e(t[0],"BCDice")].concat(Y),j=[e(I[0],"DiceTable")].concat(H),V=r.$r(j),f=j,q=[l=p(j[0],V("D66GridTable"),"D66HalfGridTable")].concat(f),N=r.$r(q),A(l,"$from_i18n",function(b,v){var y=d;return y=N("I18n").$t(b,E(["locale","raise"],{locale:v,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2_3"),y["$[]"]("items_4_5_6"))},2),c(l,"$initialize",function(b,v,x){return this.name=b,this.items=[v,v,v,x,x,x].$freeze()},3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(r){var Y,H,f,l,q,N,j,V,I,t=[],d=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.defs,c=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),Y=t,H=I=[e(t[0],"BCDice")].concat(Y),j=[e(I[0],"DiceTable")].concat(H),V=r.$r(j),f=j,q=[l=p(j[0],V("D66GridTable"),"D66OneThirdTable")].concat(f),N=r.$r(q),A(l,"$from_i18n",function(b,v){var y=d;return y=N("I18n").$t(b,E(["locale","raise"],{locale:v,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2"),y["$[]"]("items_3_4"),y["$[]"]("items_5_6"))},2),c(l,"$initialize",function(b,v,x,y){return this.name=b,this.items=[v,v,x,x,y,y].$freeze()},4)},Opal.modules["bcdice/dice_table/d66_table"]=function(r){var H,U,N,B,b,v,x,f,j,M=[],t=r.nil,d=r.$$$,e=r.module,p=r.klass,E=r.hash2,A=r.defs,c=r.def,C=r.eqeqeq,Y=r.rb_plus,S=r.rb_times,I=r.truthy;return H=M,U=j=[e(M[0],"BCDice")].concat(H),N=f=[e(j[0],"DiceTable")].concat(U),b=[B=p(f[0],null,"D66Table")].concat(N),v=r.$r(b),(x=B.$$prototype).sort_type=x.items=x.name=t,A(B,"$from_i18n",function(m,_){var $,a=t;return a=v("I18n").$t(m,E(["locale"],{locale:_})),$=v("D66SortType").$const_get(a["$[]"]("d66_sort_type")),this.$new(a["$[]"]("name"),$,a["$[]"]("items"))},2),c(B,"$initialize",function(m,_,s){var a=this;return a.name=m,a.sort_type=_,a.items=s.$freeze()},3),c(B,"$roll",function(m){var _=this,s=t,a=t,$=t,n=t;return s=m.$roll_barabara(2,6),C(d(v("D66SortType"),"ASC"),a=_.sort_type)?s["$sort!"]():C(d(v("D66SortType"),"DESC"),a)&&s["$sort!"]()["$reverse!"](),$=Y(S(s["$[]"](0),10),s["$[]"](1)),n=I(a=_.items["$[]"]($))?a:_.items["$[]"]($.$to_s()),I(n["$respond_to?"]("roll"))&&(n=n.$roll(m)),v("RollResult").$new(_.name,$,n)},1),c(B,"$choice",function(m){return v("RollResult").$new(this.name,m,this.items["$[]"](m))},1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(r){var V,l,N,B,z,t=[],d=r.nil,e=r.module,p=r.klass,E=r.hash2,A=r.send,c=r.to_ary,C=r.rb_plus,Y=r.rb_times,S=r.to_a,I=r.rb_minus,F=r.send2,H=r.find_super,L=r.def;return r.top.$require("bcdice/dice_table/d66_table"),V=t,l=z=[e(t[0],"BCDice")].concat(V),N=[e(z[0],"DiceTable")].concat(l),B=r.$r(N),L(p(N[0],B("D66Table"),"D66LeftRangeTable"),"$initialize",function y(m,_,s){var n;return delete y.$$p,n=E([],{}),A(s,"each",[],function(u){var g,P;return null==u&&(u=d),g=c(u),P=null==g[1]?d:g[1],A(null==g[0]?d:g[0],"each",[],function(o){return null==o&&(o=d),A(P,"each_with_index",[],function(R,O){var $e,ne;return null==R&&(R=d),null==O&&(O=d),$e=C(Y(o,10),C(O,1)),A(n,"[]=",S(ne=[$e,R])),ne[I(ne.length,1)]},2)},1)},1),F(this,H(this,"initialize",y,!1,!0),"initialize",[m,_,n],null)},3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(r){var F,V,q,N,B,b,v,z,L,M=[],t=r.nil,d=r.module,e=r.klass,p=r.hash2,E=r.defs,A=r.def,c=r.truthy,C=r.rb_minus,Y=r.rb_plus,S=r.rb_times;return F=M,V=L=[d(M[0],"BCDice")].concat(F),q=z=[d(L[0],"DiceTable")].concat(V),B=[N=e(z[0],null,"D66ParityTable")].concat(q),b=r.$r(B),(v=N.$$prototype).odd=v.even=v.name=t,E(N,"$from_i18n",function(y,m){var s=t;return s=b("I18n").$t(y,p(["locale","raise"],{locale:m,raise:!0})),this.$new(s["$[]"]("name"),s["$[]"]("odd"),s["$[]"]("even"))},2),A(N,"$initialize",function(y,m,_){var s=this;return s.name=y,s.odd=m.$freeze(),s.even=_.$freeze()},3),A(N,"$roll",function(y){var s,$,n,m=this,_=t;return _=y.$roll_once(6),s=y.$roll_once(6),$=(c(_["$odd?"]())?m.odd:m.even)["$[]"](C(s,1)),n=Y(S(_,10),s),b("RollResult").$new(m.name,n,$)},1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(r){var Y,H,z,f,l,q,N,j,I,M=[],t=r.nil,d=r.module,e=r.klass,p=r.def,E=r.rb_plus,A=r.rb_times,c=r.send;return Y=M,H=I=[d(M[0],"BCDice")].concat(Y),z=j=[d(I[0],"DiceTable")].concat(H),l=[f=e(j[0],null,"D66RangeTable")].concat(z),q=r.$r(l),(N=f.$$prototype).items=N.name=t,p(f,"$initialize",function(b,v){return this.name=b,this.items=v.$freeze()},2),p(f,"$roll",function(b){var x,y,m,_=t;return x=b.$roll_once(6),y=b.$roll_once(6),m=E(A(x,10),y),_=c(this.items,"find",[],function(a){return null==a&&(a=t),a["$[]"](0)["$include?"](m)},1),q("RollResult").$new(this.name,m,_["$[]"](1))},1)},Opal.modules["bcdice/dice_table/range_table"]=function(r){var L,z,B,b,v,x,y,l,V,M=[],t=r.nil,d=r.module,e=r.klass,p=r.const_set,E=r.send,A=r.truthy,c=r.def,C=r.to_a,Y=r.rb_minus,S=r.eqeqeq,I=r.rb_times,F=r.rb_plus;return L=M,z=V=[d(M[0],"BCDice")].concat(L),B=l=[d(V[0],"DiceTable")].concat(z),v=[b=e(l[0],null,"RangeTable")].concat(B),x=r.$r(v),(y=b.$$prototype).name=y.items=y.num_of_dice=y.num_of_sides=y.formatter=t,p(v[0],"RollResult",E(x("Struct"),"new",["sum","values","content","formatted"],function m(){return(null==m.$$s?this:m.$$s).$alias_method("to_s","formatted")},{$$arity:0,$$s:b})),p(v[0],"Item",x("Struct").$new("range","content")),p(v[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),p(v[0],"DEFAULT_FORMATTER",E(b,"lambda",[],function(_,s){return null==_&&(_=t),null==s&&(s=t),_.$name()+"("+s.$sum()+") \uff1e "+s.$content()},2)),b.$attr_reader("name"),b.$attr_reader("num_of_dice"),b.$attr_reader("num_of_sides"),c(b,"$initialize",function m(_,s,a){var i,$=m.$$p||t,n=this,u=t;return delete m.$$p,n.name=_.$freeze(),n.formatter=A(i=$)?i:x("DEFAULT_FORMATTER"),u=x("DICE_ROLL_METHOD_RE").$match(s),A(u)||n.$raise(x("ArgumentError"),n.name+": invalid dice roll method: "+s),n.num_of_dice=u["$[]"](1).$to_i(),n.num_of_sides=u["$[]"](2).$to_i(),n.$store(a)},3),c(b,"$fetch",function(_){var a,s=this;return a=E(s.items,"find",[],function(n){return null==n&&(n=t),n.$range()["$include?"](_)},1),A(a)||s.$raise(x("RangeError"),s.name+": value is out of range: "+_),a},1),c(b,"$roll",function(_){var $,n,i,s=this,a=t;return $=(a=_.$roll_barabara(s.num_of_dice,s.num_of_sides)).$sum(),n=x("RollResult").$new($,a,s.$fetch($).$content()),i=[s.formatter["$[]"](s,n)],E(n,"formatted=",C(i)),Y(i.length,1),n},1),b.$private(),c(b,"$store",function(_){var a,$,s=this;return a=E(_,"map",[],function n(i,u){return null==i&&(i=t),null==u&&(u=t),[(null==n.$$s?this:n.$$s).$coerce_to_int_range(i),u]},{$$arity:2,$$s:s}),$=E(a,"sort_by",[],function(i,u){return null==i&&(i=t),null==u&&(u=t),i.$min()},2),s.$assert_min_sum_is_covered($),s.$assert_max_sum_is_covered($),s.$assert_no_gap_or_overlap_in_ranges($),s.items=E($,"map",[],function(i,u){return null==i&&(i=t),null==u&&(u=t),x("Item").$new(i,u.$freeze()).$freeze()},2).$freeze(),s},1),c(b,"$coerce_to_int_range",function(_){var a;return S(x("Integer"),a=_)?x("Range").$new(_,_):S(x("Range"),a)&&A(_.$begin()["$is_a?"](x("Integer")))&&A(_.$end()["$is_a?"](x("Integer")))?_:this.$raise(x("TypeError"),this.name+": "+_+" ("+_.$class()+") must be an Integer or a Range with Integers ")},1),c(b,"$assert_min_sum_is_covered",function(_){var a,s=this,$=t;return a=s.num_of_dice,$=_.$first()["$[]"](0),A($["$include?"](a))||s.$raise(x("RangeError"),s.name+": min value ("+a+") is not covered: "+$),s},1),c(b,"$assert_max_sum_is_covered",function(_){var a,s=this,$=t;return a=I(s.num_of_dice,s.num_of_sides),$=_.$last()["$[]"](0),A($["$include?"](a))||s.$raise(x("RangeError"),s.name+": max value ("+a+") is not covered: "+$),s},1),c(b,"$assert_no_gap_or_overlap_in_ranges",function(_){return E(_,"each_cons",[2],function a($,n){var h,k,i=null==a.$$s?this:a.$$s,u=t,g=t;return null==i.name&&(i.name=t),null==$&&($=t),null==n&&(n=t),u=$["$[]"](0),g=n["$[]"](0),h=u.$max(),k=F(h,1),A(g["$include?"](h))&&i.$raise(x("RangeError"),i.name+": Range overlap: "+u+" and "+g),A(g["$include?"](k))?t:i.$raise(x("RangeError"),i.name+": Range gap: "+u+" and "+g)},{$$arity:2,$$s:this}),this},1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(r){var Y,H,z,B,b,v,x,l,j,I,M=[],t=r.nil,d=r.$$$,e=r.module,p=r.klass,E=r.send,A=r.def,c=r.rb_minus;return Y=M,H=I=[e(M[0],"BCDice")].concat(Y),z=j=[e(I[0],"DiceTable")].concat(H),B=l=[p(j[0],null,"SaiFicSkillTable")].concat(z),v=[b=p(l[0],null,"Category")].concat(B),x=r.$r(v),b.$$prototype.name=t,A(b,"$initialize",function(_,s,a,$){var n=this;return n.name=_,n.skills=E(s.$map(),"with_index",[2],function(u,g){return null==u&&(u=t),null==g&&(g=t),d(x("SaiFicSkillTable"),"Skill").$new(_,u,a,g,$)},2),n.dice=a},4),A(b,"$roll",function(_){return this.$skills()["$[]"](c(_.$roll_sum(2,6),2))},1),A(b,"$to_s",function(){return this.name},0),b.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(r){var c,I,V,q,N,z,H,Y,M=[],t=r.nil,d=r.module,e=r.klass,p=r.def,E=r.hash2;return c=M,I=Y=[d(M[0],"BCDice")].concat(c),V=H=[d(Y[0],"DiceTable")].concat(I),z=[e(H[0],null,"SaiFicSkillTable")].concat(V),(N=(q=e(z[0],null,"Skill")).$$prototype).s_format=N.category_dice=N.row_dice=N.category_name=N.name=t,p(q,"$initialize",function(b,v,x,y,m){var _=this;return _.category_name=b,_.name=v,_.category_dice=x,_.row_dice=y,_.s_format=m},5),p(q,"$to_s",function(){var b=this;return b.$format(b.s_format,E(["category_dice","row_dice","category_name","skill_name"],{category_dice:b.category_dice,row_dice:b.row_dice,category_name:b.category_name,skill_name:b.name}))},0),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(r){var U,q,x,y,m,_,s,B,f,M=r.top,t=[],d=r.nil,e=r.$$$,p=r.module,E=r.klass,A=r.hash2,c=r.send,Y=r.defs,S=r.const_set,I=r.to_ary,F=r.def,H=r.truthy,L=r.rb_minus,j=r.rb_plus;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),U=t,q=f=[p(t[0],"BCDice")].concat(U),x=B=[p(f[0],"DiceTable")].concat(q),m=[y=E(B[0],null,"SaiFicSkillTable")].concat(x),_=r.$r(m),(s=y.$$prototype).rtt=s.rtt_format=s.rct=s.rct_format=s.rttn=s.rttn_format=s.categories=d,Y(y,"$from_i18n",function($,n,i){var u,g,h,o,G=d;if(null==i)i=A([],{});else if(!i.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(u=i.$$smap.rtt)&&(u=d),null==(g=i.$$smap.rct)&&(g=d),null==(h=i.$$smap.rttn)&&(h=d),o=(G=_("I18n").$t("RTT",A(["locale","raise","default"],{locale:n,raise:!1,default:A([],{})})).$merge(_("I18n").$t($,A(["locale","raise"],{locale:n,raise:!0}))))["$[]"]("items"),G=c(G,"select",[],function(R,O){return null==R&&(R=d),null==O&&(O=d),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](R)},2),this.$new(o,r.to_hash(G).$merge(A(["rtt","rct","rttn"],{rtt:u,rct:g,rttn:h})))},-3),S(m[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),S(m[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),S(m[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),S(m[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),F(y,"$initialize",function($,n){var i,u,g,h,k,P,G,o=this;if(null==n)n=A([],{});else if(!n.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(i=n.$$smap.rtt)&&(i=d),null==(u=n.$$smap.rct)&&(u=d),null==(g=n.$$smap.rttn)&&(g=d),null==(h=n.$$smap.rtt_format)&&(h=_("DEFAULT_RTT")),null==(k=n.$$smap.rct_format)&&(k=_("DEFAULT_RCT")),null==(P=n.$$smap.rttn_format)&&(P=_("DEFAULT_RTTN")),null==(G=n.$$smap.s_format)&&(G=_("DEFAULT_S")),o.categories=c($.$map(),"with_index",[1],function(R,O){var $e,ce,te;return null==R&&(R=d),null==O&&(O=d),ce=null==($e=I(R))[0]?d:$e[0],te=null==$e[1]?d:$e[1],e(_("SaiFicSkillTable"),"Category").$new(ce,te,O,G)},{$$arity:2,$$has_top_level_mlhs_arg:!0}),o.rtt=i,o.rct=u,o.rttn=g.$to_a(),o.rtt_format=h,o.rct_format=k,o.rttn_format=P},-2),S(m[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),F(y,"$roll_command",function($,n){var u,i=this,g=d,h=d;return H(["RTT",i.rtt]["$include?"](u=n))?i.$format_skill(i.rtt_format,i.$roll_skill($)):H(["RCT",i.rct]["$include?"](u))?(g=i.$roll_category($),i.$format(i.rct_format,A(["category_dice","category_name"],{category_dice:g.$dice(),category_name:g.$name()}))):H(h=_("RTTN").$index(u))||H(h=i.rttn.$index(u))?i.$format_skill(i.rttn_format,i.categories["$[]"](h).$roll($)):d},2),F(y,"$roll_category",function($){return this.categories["$[]"](L($.$roll_once(6),1))},1),F(y,"$roll_skill",function($){return this.$roll_category($).$roll($)},1),F(y,"$prefixes",function(){var $=this;return j(["RTT[1-6]?","RCT",$.rtt,$.rct],$.rttn).$compact()},0),y.$private(),F(y,"$format_skill",function($,n){return this.$format($,A(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:n.$category_dice(),row_dice:n.$row_dice(),category_name:n.$category_name(),skill_name:n.$name(),text:n.$to_s()}))},2)},Opal.modules["bcdice/dice_table/table"]=function(r){var S,L,f,l,q,N,B,V,F,M=[],t=r.nil,d=r.module,e=r.klass,p=r.hash2,E=r.defs,A=r.truthy,c=r.def,C=r.rb_minus;return S=M,L=F=[d(M[0],"BCDice")].concat(S),f=V=[d(F[0],"DiceTable")].concat(L),q=[l=e(V[0],null,"Table")].concat(f),N=r.$r(q),(B=l.$$prototype).times=B.sides=B.name=B.items=t,E(l,"$from_i18n",function(v,x){var m=t;return m=N("I18n").$t(v,p(["locale"],{locale:x})),this.$new(m["$[]"]("name"),m["$[]"]("type"),m["$[]"]("items"))},2),c(l,"$initialize",function(v,x,y){var m=this,_=t;return m.name=v,m.items=y.$freeze(),_=/(\d+)D(\d+)/i.$match(x),A(_)||m.$raise(N("ArgumentError"),"Unexpected table type: "+x),m.times=_["$[]"](1).$to_i(),m.sides=_["$[]"](2).$to_i()},3),c(l,"$roll",function(v){var y,x=this;return y=v.$roll_sum(x.times,x.sides),x.$choice(y)},1),c(l,"$choice",function(v){var y,x=this;return y=C(v,x.times),N("RollResult").$new(x.name,v,x.items["$[]"](y))},1)},Opal.modules["bcdice/dice_table"]=function(r){var M=r.top;return M.$require("bcdice/dice_table/roll_result"),M.$require("bcdice/dice_table/chain_table"),M.$require("bcdice/dice_table/d66_grid_table"),M.$require("bcdice/dice_table/d66_half_grid_table"),M.$require("bcdice/dice_table/d66_one_third_table"),M.$require("bcdice/dice_table/d66_left_range_table"),M.$require("bcdice/dice_table/d66_parity_table"),M.$require("bcdice/dice_table/d66_range_table"),M.$require("bcdice/dice_table/d66_table"),M.$require("bcdice/dice_table/range_table"),M.$require("bcdice/dice_table/sai_fic_skill_table"),M.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(r){var E,Y,I,c,M=[],d=r.module,e=r.const_set;return E=M,Y=c=[d(M[0],"BCDice")].concat(E),I=[d(c[0],"D66SortType")].concat(Y),e(I[0],"NO_SORT","no_sort"),e(I[0],"ASC","asc"),e(I[0],"DESC","desc"),function(C,Y){var I=[d(C,"RoundType")].concat(Y);return e(I[0],"CEIL","ceil"),e(I[0],"FLOOR","floor"),e(I[0],"ROUND","round")}(c[0],c)},Opal.modules["bcdice/translate"]=function(r){var c,I,F,H,L,Y,M=[],t=r.nil,d=r.module,e=r.hash2,E=r.def;return c=M,I=Y=[d(M[0],"BCDice")].concat(c),H=[F=d(Y[0],"Translate")].concat(I),L=r.$r(H),E(F,"$translate",function(V,U){var z,f=this;if(null==f.locale&&(f.locale=t),null==U)U=e([],{});else if(!U.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return z=r.kwrestargs(U,{}),L("I18n").$translate(V,e(["locale","raise"],{locale:f.locale,raise:!0}).$merge(r.to_hash(z)))},-2)},Opal.modules["bcdice/result"]=function(r){var Y,L,z,j,U,I,M=[],t=r.nil,e=r.klass,p=r.send,E=r.to_a,A=r.rb_minus,c=r.def;return Y=M,L=I=[(0,r.module)(M[0],"BCDice")].concat(Y),[j=e(I[0],null,"Result")].concat(L),(U=j.$$prototype).secret=U.success=U.failure=U.critical=U.fumble=t,c(z=r.get_singleton_class(j),"$success",function(q){return p(this.$new(),"tap",[],function(b){var v=t;return null==b&&(b=t),p(b,"text=",E(v=[q])),A(v.length,1),p(b,"success=",E(v=[!0])),v[A(v.length,1)]},1)},1),c(z,"$failure",function(q){return p(this.$new(),"tap",[],function(b){var v=t;return null==b&&(b=t),p(b,"text=",E(v=[q])),A(v.length,1),p(b,"failure=",E(v=[!0])),v[A(v.length,1)]},1)},1),c(z,"$critical",function(q){return p(this.$new(),"tap",[],function(b){var v=t;return null==b&&(b=t),p(b,"text=",E(v=[q])),A(v.length,1),p(b,"critical=",E(v=[!0])),A(v.length,1),p(b,"success=",E(v=[!0])),v[A(v.length,1)]},1)},1),c(z,"$fumble",function(q){return p(this.$new(),"tap",[],function(b){var v=t;return null==b&&(b=t),p(b,"text=",E(v=[q])),A(v.length,1),p(b,"fumble=",E(v=[!0])),A(v.length,1),p(b,"failure=",E(v=[!0])),v[A(v.length,1)]},1)},1),c(z,"$nothing",function(){return"nothing"},0),c(j,"$initialize",function(f){var l=this;return null==f&&(f=t),l.text=f,l.rands=t,l.detailed_rands=t,l.secret=!1,l.success=!1,l.failure=!1,l.critical=!1,l.fumble=!1},-1),j.$attr_accessor("text","rands","detailed_rands"),j.$attr_writer("secret","success","failure","critical","fumble"),c(j,"$secret?",function(){return this.secret},0),c(j,"$success?",function(){return this.success},0),c(j,"$failure?",function(){return this.failure},0),c(j,"$critical?",function(){return this.critical},0),c(j,"$fumble?",function(){return this.fumble},0),c(j,"$condition=",function(f){return this.success=f,this.failure=f["$!"]()},1)},Opal.modules["racc/parser"]=function(r){var x,m,_,t=[],d=r.$r(t),e=r.nil,p=r.$$$,E=r.module,A=r.klass,c=r.truthy,C=r.const_set,Y=r.defs,S=r.gvars,I=r.rb_lt,F=r.send,H=r.to_a,L=r.rb_minus,j=r.def,V=r.to_ary,U=r.neqeq,z=r.rb_plus,f=r.eqeq,l=r.rb_ge,q=r.rb_gt,N=r.eqeqeq,B=r.rb_le,b=r.rb_times;return x=t,m=[E(t[0],"Racc")].concat(x),_=r.$r(m),A(m[0],_("StandardError"),"ParseError"),c(p("::","ParseError","skip_raise")?"constant":e)||C(t[0],"ParseError",p(d("Racc"),"ParseError")),function(v,x){var n,i,u,g,h,_=[E(v,"Racc")].concat(x),s=r.$r(_);return c(s("Racc_No_Extensions","skip_raise")?"constant":e)||C(_[0],"Racc_No_Extensions",!1),n=_,u=[i=A(_[0],null,"Parser")].concat(n),g=r.$r(u),(h=i.$$prototype).yydebug=h.racc_debug_out=h.racc_error_status=h.racc_t=h.racc_vstack=h.racc_val=h.racc_state=h.racc_tstack=e,C(u[0],"Racc_Runtime_Version","1.4.6"),C(u[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),C(u[0],"Racc_Runtime_Core_Version_R","1.4.6"),C(u[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),C(u[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),C(u[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),C(u[0],"Racc_Runtime_Core_Version",g("Racc_Runtime_Core_Version_R")),C(u[0],"Racc_Runtime_Core_Revision",g("Racc_Runtime_Core_Revision_R")),C(u[0],"Racc_Runtime_Type","ruby"),Y(g("Parser"),"$racc_runtime_type",function(){return g("Racc_Runtime_Type")},0),j(i,"$_racc_setup",function(){var P,G,o=this,Z=e,R=e,O=e;return null==S.stderr&&(S.stderr=e),c(p(o.$class(),"Racc_debug_parser"))||(o.yydebug=!1),c(null!=(P=o.yydebug)&&P!==e?"instance-variable":e)||(o.yydebug=!1),c(o.yydebug)&&(c(null!=(G=o.racc_debug_out)&&G!==e?"instance-variable":e)||(o.racc_debug_out=S.stderr),o.racc_debug_out=c(Z=o.racc_debug_out)?Z:S.stderr),R=p(o.$class(),"Racc_arg"),c(I(R.$size(),14))&&(F(R,"[]=",H(O=[13,!0])),L(O.length,1)),R},0),j(i,"$_racc_init_sysvars",function(){var P=this;return P.racc_state=[0],P.racc_tstack=[],P.racc_vstack=[],P.racc_t=e,P.racc_val=e,P.racc_read_next=!0,P.racc_user_yyerror=!1,P.racc_error_status=0},0),j(i,"$do_parse",function(){return this.$__send__(g("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},0),j(i,"$next_token",function(){return this.$raise(g("NotImplementedError"),this.$class()+"#next_token is not defined")},0),j(i,"$_racc_do_parse_rb",function(P,G){var o,R=this,O=e,$e=e,ne=e,ce=e,K=e,w=e,Q=e,D=e;return o=V(P),O=null==o[0]?e:o[0],$e=null==o[1]?e:o[1],ne=null==o[2]?e:o[2],ce=null==o[3]?e:o[3],K=null==o[10]?e:o[10],R.$_racc_init_sysvars(),w=Q=D=e,F(R,"catch",["racc_end_parse"],function T(){var re,X,W=null==T.$$s?this:T.$$s,ae=e;for(null==W.racc_state&&(W.racc_state=e),null==W.racc_read_next&&(W.racc_read_next=e),null==W.racc_t&&(W.racc_t=e),null==W.yydebug&&(W.yydebug=e),null==W.racc_val&&(W.racc_val=e);c(!0);)for(c(D=ce["$[]"](W.racc_state["$[]"](-1)))?(c(W.racc_read_next)&&U(W.racc_t,0)&&(X=W.$next_token(),re=V(X),w=null==re[0]?e:re[0],W.racc_val=null==re[1]?e:re[1],W.racc_t=c(w)?c(ae=K["$[]"](w))?ae:1:0,c(W.yydebug)&&W.$racc_read_token(W.racc_t,w,W.racc_val),W.racc_read_next=!1),D=z(D,W.racc_t),c(l(D,0))&&c(Q=O["$[]"](D))&&f($e["$[]"](D),W.racc_state["$[]"](-1))||(Q=ne["$[]"](W.racc_state["$[]"](-1)))):Q=ne["$[]"](W.racc_state["$[]"](-1));c(Q=W.$_racc_evalact(Q,P)););},{$$arity:0,$$s:R})},2),j(i,"$yyparse",function(P,G){return this.$__send__(g("Racc_YY_Parse_Method"),P,G,this.$_racc_setup(),!0)},2),j(i,"$_racc_yyparse_rb",function(P,G,o,Z){var R,ne=e,ce=e,te=e,K=e,Q=e,D=e,T=e;return R=V(o),ne=null==R[0]?e:R[0],ce=null==R[1]?e:R[1],te=null==R[2]?e:R[2],K=null==R[3]?e:R[3],Q=null==R[10]?e:R[10],this.$_racc_init_sysvars(),D=e,T=e,F(this,"catch",["racc_end_parse"],function ee(){var W=null==ee.$$s?this:ee.$$s;for(null==W.racc_state&&(W.racc_state=e);!c(T=K["$[]"](W.racc_state["$[]"](-1)));)for(;c(D=W.$_racc_evalact(te["$[]"](W.racc_state["$[]"](-1)),o)););return F(P,"__send__",[G],function ae(se,_e){var ie=null==ae.$$s?this:ae.$$s,J=e,oe=e;for(null==ie.racc_t&&(ie.racc_t=e),null==ie.racc_state&&(ie.racc_state=e),null==ie.racc_read_next&&(ie.racc_read_next=e),null==se&&(se=e),null==_e&&(_e=e),ie.racc_t=c(se)?c(J=Q["$[]"](se))?J:1:0,ie.racc_val=_e,ie.racc_read_next=!1,T=z(T,ie.racc_t),c(l(T,0))&&c(D=ne["$[]"](T))&&f(ce["$[]"](T),ie.racc_state["$[]"](-1))||(D=te["$[]"](ie.racc_state["$[]"](-1)));c(D=ie.$_racc_evalact(D,o)););for(;c(c(J=c(oe=(T=K["$[]"](ie.racc_state["$[]"](-1)))["$!"]())?oe:ie.racc_read_next["$!"]())?J:ie.racc_t["$=="](0));)for(c(T)&&c(T=z(T,ie.racc_t))&&c(l(T,0))&&c(D=ne["$[]"](T))&&f(ce["$[]"](T),ie.racc_state["$[]"](-1))||(D=te["$[]"](ie.racc_state["$[]"](-1)));c(D=ie.$_racc_evalact(D,o)););},{$$arity:2,$$s:W})},{$$arity:0,$$s:this})},4),j(i,"$_racc_evalact",function(P,G){var o,te,R=this,O=e,$e=e,ce=e,K=e,w=e,Q=e,D=e;if(O=null==(o=V(G))[0]?e:o[0],$e=null==o[1]?e:o[1],ce=null==o[3]?e:o[3],te=null==o[11]?e:o[11],K=null==o[12]?e:o[12],c(q(P,0))&&c(I(P,te)))c(q(R.racc_error_status,0))&&(f(R.racc_t,1)||(R.racc_error_status=L(R.racc_error_status,1))),R.racc_vstack.$push(R.racc_val),R.racc_state.$push(P),R.racc_read_next=!0,c(R.yydebug)&&(R.racc_tstack.$push(R.racc_t),R.$racc_shift(R.racc_t,R.racc_tstack,R.racc_vstack));else if(c(I(P,0))&&c(q(P,K["$-@"]()))){if(w=F(R,"catch",["racc_jump"],function T(){var ee=null==T.$$s?this:T.$$s;return null==ee.racc_state&&(ee.racc_state=e),ee.racc_state.$push(ee.$_racc_do_reduce(G,P)),!1},{$$arity:0,$$s:R}),c(w)){if(N(1,Q=w))return R.racc_user_yyerror=!0,K["$-@"]();if(N(2,Q))return te;R.$raise("[Racc Bug] unknown jump code")}}else if(f(P,te))c(R.yydebug)&&R.$racc_accept(),R.$throw("racc_end_parse",R.racc_vstack["$[]"](0));else{if(f(P,K["$-@"]())){for(N(0,Q=R.racc_error_status)?c(G["$[]"](21))||R.$on_error(R.racc_t,R.racc_val,R.racc_vstack):N(3,Q)&&(f(R.racc_t,0)&&R.$throw("racc_end_parse",e),R.racc_read_next=!0),R.racc_user_yyerror=!1,R.racc_error_status=3;c(!0)&&!(c(D=ce["$[]"](R.racc_state["$[]"](-1)))&&(D=z(D,1),c(l(D,0))&&c(P=O["$[]"](D))&&f($e["$[]"](D),R.racc_state["$[]"](-1))));)c(B(R.racc_state.$size(),1))&&R.$throw("racc_end_parse",e),R.racc_state.$pop(),R.racc_vstack.$pop(),c(R.yydebug)&&(R.racc_tstack.$pop(),R.$racc_e_pop(R.racc_state,R.racc_tstack,R.racc_vstack));return P}R.$raise("[Racc Bug] unknown action "+P.$inspect())}return c(R.yydebug)&&R.$racc_next_state(R.racc_state["$[]"](-1),R.racc_state),e},2),j(i,"$_racc_do_reduce",function(P,G){var o,K,Q,W,ae,se,ie,R=this,$e=e,ne=e,ce=e,te=e,w=e,D=e,T=e,ee=e,re=e,X=e,_e=e,le=e,ue=e,J=e;return $e=null==(o=V(P))[4]?e:o[4],ne=null==o[5]?e:o[5],ce=null==o[6]?e:o[6],te=null==o[7]?e:o[7],K=null==o[8]?e:o[8],w=null==o[9]?e:o[9],Q=null==o[13]?e:o[13],D=R.racc_state,T=R.racc_vstack,ee=R.racc_tstack,re=b(G,-3),X=w["$[]"](re),W=w["$[]"](z(re,1)),ae=w["$[]"](z(re,2)),se=[],c(R.yydebug)&&(_e=ee["$[]"](X["$-@"](),X)),le=T["$[]"](X["$-@"](),X),c(R.yydebug)&&(ue=[X["$-@"](),X,se],F(ee,"[]=",H(ue)),L(ue.length,1)),ue=[X["$-@"](),X,se],F(T,"[]=",H(ue)),L(ue.length,1),ue=[X["$-@"](),X,se],F(D,"[]=",H(ue)),L(ue.length,1),c(Q)?T.$push(R.$__send__(ae,le,T,le["$[]"](0))):T.$push(R.$__send__(ae,le,T)),ee.$push(W),c(R.yydebug)&&R.$racc_reduce(_e,W,ee,T),ie=L(W,K),c(re=te["$[]"](ie))&&(re=z(re,D["$[]"](-1)),c(l(re,0))&&c(J=$e["$[]"](re))&&f(ne["$[]"](re),ie))?J:ce["$[]"](ie)},2),j(i,"$on_error",function(P,G,o){var R,Z=this;return Z.$raise(g("ParseError"),Z.$sprintf("\nparse error on value %s (%s)",G.$inspect(),c(R=Z.$token_to_str(P))?R:"?"))},3),j(i,"$yyerror",function(){return this.$throw("racc_jump",1)},0),j(i,"$yyaccept",function(){return this.$throw("racc_jump",2)},0),j(i,"$yyerrok",function(){return this.racc_error_status=0},0),j(i,"$racc_read_token",function(P,G,o){var Z=this;return Z.racc_debug_out.$print("read    "),Z.racc_debug_out.$print(G.$inspect(),"(",Z.$racc_token2str(P),") "),Z.racc_debug_out.$puts(o.$inspect()),Z.racc_debug_out.$puts()},3),j(i,"$racc_shift",function(P,G,o){var Z=this;return Z.racc_debug_out.$puts("shift   "+Z.$racc_token2str(P)),Z.$racc_print_stacks(G,o),Z.racc_debug_out.$puts()},3),j(i,"$racc_reduce",function(P,G,o,Z){var R=this,O=e;return(O=R.racc_debug_out).$print("reduce "),c(P["$empty?"]())?O.$print(" <none>"):F(P,"each",[],function $e(ne){return null==ne&&(ne=e),O.$print(" ",(null==$e.$$s?this:$e.$$s).$racc_token2str(ne))},{$$arity:1,$$s:R}),O.$puts(" --\x3e "+R.$racc_token2str(G)),R.$racc_print_stacks(o,Z),R.racc_debug_out.$puts()},4),j(i,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},0),j(i,"$racc_e_pop",function(P,G,o){var Z=this;return Z.racc_debug_out.$puts("error recovering mode: pop token"),Z.$racc_print_states(P),Z.$racc_print_stacks(G,o),Z.racc_debug_out.$puts()},3),j(i,"$racc_next_state",function(P,G){var o=this;return o.racc_debug_out.$puts("goto    "+P),o.$racc_print_states(G),o.racc_debug_out.$puts()},2),j(i,"$racc_print_stacks",function(P,G){var Z=e;return(Z=this.racc_debug_out).$print("        ["),F(P,"each_index",[],function R(O){return null==O&&(O=e),Z.$print(" (",(null==R.$$s?this:R.$$s).$racc_token2str(P["$[]"](O))," ",G["$[]"](O).$inspect(),")")},{$$arity:1,$$s:this}),Z.$puts(" ]")},2),j(i,"$racc_print_states",function(P){var o=e;return(o=this.racc_debug_out).$print("        ["),F(P,"each",[],function(R){return null==R&&(R=e),o.$print(" ",R)},1),o.$puts(" ]")},1),j(i,"$racc_token2str",function(P){var o;return c(o=p(this.$class(),"Racc_token_to_s_table")["$[]"](P))?o:this.$raise("[Racc Bug] can't convert token "+P+" to string")},1),j(i,"$token_to_str",function(P){return p(this.$class(),"Racc_token_to_s_table")["$[]"](P)},1)}(t[0],t)},Opal.modules["bcdice/arithmetic/node"]=function(r){var j,f,B,_,s,v,x,q,U,M=[],t=r.nil,d=r.$$$,e=r.module,p=r.klass,E=r.def,A=r.send2,c=r.find_super,C=r.eqeq,Y=r.const_set,S=r.eqeqeq,I=r.rb_divide,F=r.truthy,H=r.alias;return j=M,f=U=[e(M[0],"BCDice")].concat(j),B=q=[e(U[0],"Arithmetic")].concat(f),v=[e(q[0],"Node")].concat(B),x=r.$r(v),(s=(_=p(v[0],null,"BinaryOp")).$$prototype).lhs=s.rhs=s.op=t,E(_,"$initialize",function($,n,i){var u=this;return u.lhs=$,u.op=n,u.rhs=i},3),E(_,"$eval",function($){var u,n=this,i=t;return i=n.lhs.$eval($),u=n.rhs.$eval($),i.$send(n.op,u)},1),E(_,"$output",function(){var $=this;return""+$.lhs.$output()+$.op+$.rhs.$output()},0),E(_,"$s_exp",function(){var $=this;return"("+$.$op_for_s_exp()+" "+$.lhs.$s_exp()+" "+$.rhs.$s_exp()+")"},0),E(_,"$op_for_s_exp",function(){return this.op},0),function(y,m,_){var s=p(y,m,"DivideBase"),a=[s].concat(_),$=r.$r(a),n=s.$$prototype;n.lhs=n.rhs=n.op=t,E(s,"$initialize",function i(u,g){return delete i.$$p,A(this,c(this,"initialize",i,!1,!0),"initialize",[u,"/",g],null)},2),E(s,"$eval",function(u){var h,k,g=this;return h=g.lhs.$eval(u),k=g.rhs.$eval(u),C(k,0)&&g.$raise($("ZeroDivisionError")),g.$divide_and_round(h,k,u)},1),E(s,"$output",function i(){var u=i.$$p||t,g=this;return delete i.$$p,""+A(g,c(g,"output",i,!1,!0),"output",[],u)+g.$rounding_method()},0),s.$private(),E(s,"$rounding_method",function(){return d(this.$class(),"ROUNDING_METHOD")},0),E(s,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()},0),E(s,"$divide_and_round",function(u,g,h){return this.$raise($("NotImplementedError"))},3)}(v[0],x("BinaryOp"),v),function(y,m,_){var s=p(y,m,"DivideWithGameSystemDefault"),a=[s].concat(_),$=r.$r(a);Y(a[0],"ROUNDING_METHOD",""),s.$private(),E(s,"$divide_and_round",function(i,u,g){var h,k=t;return S(d($("RoundType"),"CEIL"),h=g)?I(i.$to_f(),u).$ceil():S(d($("RoundType"),"ROUND"),h)?(k=I(i.$to_f(),u),F(k["$negative?"]())?k.$abs().$round()["$-@"]():k.$round()):I(i,u).$floor()},3)}(v[0],x("DivideBase"),v),function(y,m,_){var s=p(y,m,"DivideWithCeil"),a=[s].concat(_);Y(a[0],"ROUNDING_METHOD","C"),s.$private(),E(s,"$divide_and_round",function(n,i,u){return I(n.$to_f(),i).$ceil()},3)}(v[0],x("DivideBase"),v),function(y,m,_){var s=p(y,m,"DivideWithRound"),a=[s].concat(_);Y(a[0],"ROUNDING_METHOD","R"),s.$private(),E(s,"$divide_and_round",function(n,i,u){var g=t;return g=I(n.$to_f(),i),F(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()},3)}(v[0],x("DivideBase"),v),function(y,m,_){var s=p(y,m,"DivideWithFloor"),a=[s].concat(_);Y(a[0],"ROUNDING_METHOD","F"),s.$private(),E(s,"$divide_and_round",function(n,i,u){return I(n,i).$floor()},3)}(v[0],x("DivideBase"),v),function(y,m){var _=p(y,null,"Negative");_.$$prototype.body=t,E(_,"$initialize",function($){return this.body=$},1),E(_,"$eval",function($){return this.body.$eval($)["$-@"]()},1),E(_,"$output",function(){return"-"+this.body.$output()},0),E(_,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"},0)}(v[0]),function(y,m){var _=p(y,null,"Parenthesis");_.$$prototype.expr=t,E(_,"$initialize",function($){return this.expr=$},1),E(_,"$eval",function($){return this.expr.$eval($)},1),E(_,"$output",function(){return"("+this.expr.$output()+")"},0),E(_,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"},0)}(v[0]),function(y,m){var _=p(y,null,"Number");return _.$$prototype.value=t,E(_,"$initialize",function($){return this.value=$},1),E(_,"$eval",function($){return this.value},1),E(_,"$output",function(){return this.value.$to_s()},0),H(_,"s_exp","output")}(v[0])},Opal.modules.strscan=function(r){var H,L,j,V,U,M=[],t=r.nil,e=r.def,p=r.truthy,E=r.eqeqeq,A=r.Opal,c=r.send,C=r.to_a,Y=r.rb_minus,S=r.alias;return H=M,j=[L=(0,r.klass)(M[0],null,"StringScanner")].concat(H),V=r.$r(j),(U=L.$$prototype).pos=U.string=U.working=U.matched=U.prev_pos=U.match=t,L.$attr_reader("pos","matched"),e(L,"$initialize",function(f){var l=this;return l.string=f,l.pos=0,l.matched=t,l.working=f,l.match=[]},1),L.$attr_reader("string"),e(L,"$beginning_of_line?",function(){var f=this;return 0===f.pos||"\n"===f.string.charAt(f.pos-1)},0),e(L,"$scan",function(f){var l=this,q=(f=l.$anchor(f)).exec(l.working);return null==q?l.matched=t:"object"==typeof q?(l.prev_pos=l.pos,l.pos+=q[0].length,l.working=l.working.substring(q[0].length),l.matched=q[0],l.match=q,q[0]):"string"==typeof q?(l.pos+=q.length,l.working=l.working.substring(q.length),q):t},1),e(L,"$scan_until",function(f){var l=this;f=l.$anchor(f);for(var B,q=l.pos,N=l.working;;){if(B=f.exec(N),q+=1,N=N.substr(1),null!=B)return l.matched=l.string.substr(l.pos,q-l.pos-1+B[0].length),l.match=B,l.prev_pos=q-1,l.pos=q,l.working=N.substr(B[0].length),l.matched;if(0===N.length)return l.match=[],l.matched=t}},1),e(L,"$[]",function(f){var q;if(p(this.match["$empty?"]()))return t;E(V("Symbol"),q=f)?f=f.$to_s():E(V("String"),q)||(f=A["$coerce_to!"](f,V("Integer"),"to_int"));var N=this.match;return f<0&&(f+=N.length),f<0||f>=N.length||null==N[f]?t:N[f]},1),e(L,"$check",function(f){var l=this,q=(f=l.$anchor(f)).exec(l.working);return l.matched=null==q?t:q[0]},1),e(L,"$check_until",function(f){var l=this,q=l.prev_pos,N=l.pos,B=l.$scan_until(f);return B!==t&&(l.matched=B.substr(-1),l.working=l.string.substr(N)),l.prev_pos=q,l.pos=N,B},1),e(L,"$peek",function(f){return this.working.substring(0,f)},1),e(L,"$eos?",function(){return 0===this.working.length},0),e(L,"$exist?",function(f){var q=f.exec(this.working);return null==q?t:0==q.index?0:q.index+1},1),e(L,"$skip",function(f){var l=this,q=(f=l.$anchor(f)).exec(l.working);if(null==q)return l.match=[],l.matched=t;var N=q[0],B=N.length;return l.matched=N,l.match=q,l.prev_pos=l.pos,l.pos+=B,l.working=l.working.substring(B),B},1),e(L,"$skip_until",function(f){var q=this.$scan_until(f);return q===t?t:(this.matched=q.substr(-1),q.length)},1),e(L,"$get_byte",function(){var f=this,l=t;return f.pos<f.string.length?(f.prev_pos=f.pos,f.pos+=1,l=f.matched=f.working.substring(0,1),f.working=f.working.substring(1)):f.matched=t,l},0),e(L,"$match?",function(f){var l=this,q=(f=l.$anchor(f)).exec(l.working);return null==q?t:(l.prev_pos=l.pos,q[0].length)},1),e(L,"$pos=",function(f){var l=this;return f<0&&(f+=l.string.$length()),l.pos=f,l.working=l.string.slice(f)},1),e(L,"$matched_size",function(){return this.matched===t?t:this.matched.length},0),e(L,"$post_match",function(){var f=this;return f.matched===t?t:f.string.substr(f.pos)},0),e(L,"$pre_match",function(){var f=this;return f.matched===t?t:f.string.substr(0,f.prev_pos)},0),e(L,"$reset",function(){var f=this;return f.working=f.string,f.matched=t,f.pos=0},0),e(L,"$rest",function(){return this.working},0),e(L,"$rest?",function(){return 0!==this.working.length},0),e(L,"$rest_size",function(){return this.$rest().$size()},0),e(L,"$terminate",function(){var l,f=this;return f.match=t,l=[f.string.$length()],c(f,"pos=",C(l)),l[Y(l.length,1)]},0),e(L,"$unscan",function(){var f=this;return f.pos=f.prev_pos,f.prev_pos=t,f.match=t,f},0),S(L,"bol?","beginning_of_line?"),S(L,"getch","get_byte"),L.$private(),e(L,"$anchor",function(f){var l=f.toString().match(/\/([^\/]+)$/);return l=l?l[1]:void 0,new RegExp("^(?:"+f.source+")",l)},1)},Opal.modules["bcdice/normalize"]=function(r){var c,I,Y,M=[],t=r.nil,d=r.module,e=r.eqeqeq,p=r.def,E=r.eqeq;return c=M,Y=[d(M[0],"BCDice")].concat(c),(I=d(Y[0],"Normalize")).$module_function(),p(I,"$comparison_operator",function(H){var L;return e(/<=|=</,L=H)?"<=":e(/>=|=>/,L)?">=":e(/<>|!=|=!/,L)?"!=":e(/</,L)?"<":e(/>/,L)?">":e(/=/,L)?"==":t},1),p(I,"$target_number",function(H){return E(H,"?")?H:H.$to_i()},1)},Opal.modules["bcdice/command/lexer"]=function(r){var I,j,l,q,N,B,b,U,H,M=r.top,t=[],d=r.nil,e=r.module,p=r.klass,E=r.const_set,A=r.hash2,c=r.truthy,C=r.send,Y=r.def;return M.$require("strscan"),M.$require("bcdice/normalize"),I=t,j=H=[e(t[0],"BCDice")].concat(I),l=U=[e(H[0],"Command")].concat(j),N=[q=p(U[0],null,"Lexer")].concat(l),B=r.$r(N),(b=q.$$prototype).scanner=b.notations=d,E(N[0],"SYMBOLS",A(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),Y(q,"$initialize",function(x,y){var m,_,a;return x=c(a=(_=(m=x)===d||null==m?d:C(m,"split",[" ",2]))===d||null==_?d:C(_,"first",[]))?a:"",this.scanner=B("StringScanner").$new(x),this.notations=C(y,"map",[],function(n){return null==n&&(n=d),c(n["$is_a?"](B("String")))?B("Regexp").$new(n):n},1)},2),Y(q,"$next_token",function(){try{var x=this,y=d,m=d,s=d,a=d;return c(x.scanner["$eos?"]())?[!1,"$"]:(C(x.notations,"each",[],function $(n){var u,i=null==$.$$s?this:$.$$s;if(null==i.scanner&&(i.scanner=d),null==n&&(n=d),u=i.scanner.$scan(n),!c(u))return d;r.ret(["NOTATION",u])},{$$arity:1,$$s:x}),c(y=x.scanner.$scan(/\d+/))?["NUMBER",y.$to_i()]:c(m=x.scanner.$scan(/[<>!=]+/))?(m=B("Normalize").$comparison_operator(m),[c(m)?"CMP_OP":"ILLEGAL",m]):(s=x.scanner.$getch().$upcase(),[c(a=B("SYMBOLS")["$[]"](s))?a:s.$to_sym(),s]))}catch($){if($===r.returner)return $.$v;throw $}},0),Y(q,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/command/parsed"]=function(r){var C,F,U,z,f,l,q,L,S,M=[],t=r.nil,d=r.module,e=r.klass,p=r.def,E=r.truthy,A=r.eqeqeq;return C=M,F=S=[d(M[0],"BCDice")].concat(C),U=L=[d(S[0],"Command")].concat(F),f=[z=e(L[0],null,"Parsed")].concat(U),l=r.$r(f),(q=z.$$prototype).question_target=q.critical=q.fumble=q.dollar=q.modify_number=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=t,z.$attr_accessor("command"),z.$attr_accessor("prefix_number"),z.$attr_accessor("suffix_number"),z.$attr_accessor("critical"),z.$attr_accessor("fumble"),z.$attr_accessor("dollar"),z.$attr_accessor("modify_number"),z.$attr_accessor("cmp_op"),z.$attr_accessor("target_number"),z.$attr_writer("question_target"),p(z,"$initialize",function(){var B=this;return B.prefix_number=t,B.suffix_number=t,B.critical=t,B.fumble=t,B.dollar=t,B.cmp_op=t,B.target_number=t,B.question_target=!1},0),p(z,"$question_target?",function(){return this.question_target},0),p(z,"$to_s",function(B){var s,b=this,v=t,x=t,y=t,m=t,_=t;return null==B&&(B="after_command"),v=E(b.critical)?"@"+b.critical:t,x=E(b.fumble)?"#"+b.fumble:t,y=E(b.dollar)?"$"+b.dollar:t,m=l("Format").$modifier(b.modify_number),_=E(b.question_target)?"?":b.target_number,A("after_command",s=B)?[b.prefix_number,b.command,b.suffix_number,v,x,y,m,b.cmp_op,_].$join():A("after_modify_number",s)?[b.prefix_number,b.command,b.suffix_number,m,v,x,y,b.cmp_op,_].$join():A("after_target_number",s)?[b.prefix_number,b.command,b.suffix_number,m,b.cmp_op,_,v,x,y].$join():t},-1)},Opal.modules["bcdice/command/parser"]=function(r){var l,b,s,i,u,g,h,k,P,G,o,Z,$e,a,$,n,te,x,y,N,M=r.top,t=[],d=r.$r(t),e=r.nil,p=r.$$$,E=r.klass,A=r.module,c=r.hash2,C=r.send2,Y=r.find_super,S=r.def,I=r.send,F=r.to_a,H=r.rb_minus,L=r.eqeq,j=r.hash,V=r.const_set,U=r.truthy,z=r.to_ary;return M.$require("racc/parser.rb"),M.$require("bcdice/arithmetic/node"),M.$require("bcdice/command/lexer"),M.$require("bcdice/command/parsed"),E(p(d("BCDice"),"Command"),p(d("Racc"),"Parser"),"Parser"),l=t,b=N=[A(t[0],"BCDice")].concat(l),x=[A(N[0],"Command")].concat(b),y=r.$r(x),s=x,$=[a=E(x[0],p(y("Racc"),"Parser"),"Parser")].concat(s),n=r.$r($),(te=a.$$prototype).notations=te.lexer=te.modifier=te.suffix_number=te.prefix_number=te.need_suffix_number=te.need_prefix_number=te.critical=te.fumble=te.dollar=te.allowed_cmp_op=te.question_target=e,S(a,"$initialize",function K(w,Q){var D,T,ee,re,W=this;if(delete K.$$p,D=r.slice.call(arguments),null==(T=r.extract_kwargs(D)))T=c([],{});else if(!T.$$is_hash)throw r.ArgumentError.$new("expected kwargs");if(ee=D,!r.hasOwnProperty.call(T.$$smap,"round_type"))throw r.ArgumentError.$new("missing keyword: round_type");return re=T.$$smap.round_type,C(W,Y(W,"initialize",K,!1,!0),"initialize",[],null),W.notations=ee,W.round_type=re,W.prefix_number=!1,W.suffix_number=!1,W.need_prefix_number=!1,W.need_suffix_number=!1,W.modifier=!0,W.critical=!1,W.fumble=!1,W.dollar=!1,W.allowed_cmp_op=[e,">=",">","<=","<","==","!="],W.question_target=!1},-2),S(a,"$disable_modifier",function(){return this.modifier=!1,this},0),S(a,"$enable_prefix_number",function(){return this.prefix_number=!0,this},0),S(a,"$enable_suffix_number",function(){return this.suffix_number=!0,this},0),S(a,"$has_prefix_number",function(){var w=this;return w.prefix_number=!0,w.need_prefix_number=!0,w},0),S(a,"$has_suffix_number",function(){var w=this;return w.suffix_number=!0,w.need_suffix_number=!0,w},0),S(a,"$enable_critical",function(){return this.critical=!0,this},0),S(a,"$enable_fumble",function(){return this.fumble=!0,this},0),S(a,"$enable_dollar",function(){return this.dollar=!0,this},0),S(a,"$restrict_cmp_op_to",function(w){var Q,T=this;return Q=r.slice.call(arguments),T.allowed_cmp_op=Q,T},-1),S(a,"$enable_question_target",function(){return this.question_target=!0,this},0),S(a,"$parse",function(w){var Q=this;try{return Q.lexer=n("Lexer").$new(w,Q.notations),Q.$do_parse()}catch(D){if(!r.rescue(D,[n("ParseError"),n("ZeroDivisionError")]))throw D;try{return e}finally{r.pop_exception()}}},1),a.$private(),S(a,"$parsed",function(w,Q,D,T){return I(n("Parsed").$new(),"tap",[],function re(X){var W,ae,se,_e,le,ue,ie=null==re.$$s?this:re.$$s,J=e;return null==ie.round_type&&(ie.round_type=e),null==X&&(X=e),J=[w["$[]"]("command")],I(X,"command=",F(J)),H(J.length,1),J=[(W=w["$[]"]("prefix"),W===e||null==W?e:I(W,"eval",[ie.round_type]))],I(X,"prefix_number=",F(J)),H(J.length,1),J=[(ae=w["$[]"]("suffix"),ae===e||null==ae?e:I(ae,"eval",[ie.round_type]))],I(X,"suffix_number=",F(J)),H(J.length,1),J=[(se=Q["$[]"]("critical"),se===e||null==se?e:I(se,"eval",[ie.round_type]))],I(X,"critical=",F(J)),H(J.length,1),J=[(_e=Q["$[]"]("fumble"),_e===e||null==_e?e:I(_e,"eval",[ie.round_type]))],I(X,"fumble=",F(J)),H(J.length,1),J=[(le=Q["$[]"]("dollar"),le===e||null==le?e:I(le,"eval",[ie.round_type]))],I(X,"dollar=",F(J)),H(J.length,1),J=[D.$eval(ie.round_type)],I(X,"modify_number=",F(J)),H(J.length,1),J=[T["$[]"]("cmp_op")],I(X,"cmp_op=",F(J)),H(J.length,1),L(T["$[]"]("target"),"?")?(I(X,"question_target=",F(J=[!0])),H(J.length,1),I(X,"target_number=",F(J=[0])),J[H(J.length,1)]):(I(X,"question_target=",F(J=[!1])),H(J.length,1),J=[(ue=T["$[]"]("target"),ue===e||null==ue?e:I(ue,"eval",[ie.round_type]))],I(X,"target_number=",F(J)),J[H(J.length,1)])},{$$arity:1,$$s:this})},4),S(a,"$next_token",function(){return this.lexer.$next_token()},0),i=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,33,34,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,e,e,17,18,6,e,5,e,e,17,18,e,e,5,23,24,25,26,56,54,55,57],u=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,e,17,15,15,18,18,23,e,18,30,30,23,23,24,e,23,31,31,24,24,25,e,24,44,44,25,25,28,e,25,47,47,28,28,29,e,28,48,48,29,29,33,e,29,49,49,33,33,34,e,33,50,50,34,34,36,e,34,e,e,36,36,37,e,36,e,e,37,37,e,e,37,27,27,27,27,52,52,52,52],g=[-2,4,16,-3,-1,11,e,33,13,35,23,30,1,e,28,40,e,37,44,e,e,-2,e,51,58,65,0,106,72,79,47,54,e,86,93,e,100,107,e,e,e,e,e,e,63,e,e,68,75,82,89,e,120,e,e,e,e,e],h=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],k=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,e,e,21,47,48,40,51,52,49,50,44,46,3,e,e,e,13,e,e,e,e,e,e,e,32],P=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,e,e,4,8,8,5,7,7,8,8,9,5,6,e,e,e,6,e,e,e,e,e,e,e,6],G=[e,6,13,3,9,-1,27,-15,-10,-1,-38],o=[e,e,e,e,e,e,19,16,15,e,e],Z=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],$e=j(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),V($[0],"Racc_arg",[i,u,h,g,k,P,o,G,19,Z,$e,58,35,!0]),V($[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),V($[0],"Racc_debug_parser",!1),S(a,"$_reduce_1",function(w,Q,D){var T;return U(this.modifier)||this.$raise(n("ParseError")),T=z(w),this.$parsed(null==T[0]?e:T[0],null==T[1]?e:T[1],null==T[2]?e:T[2],null==T[3]?e:T[3])},3),S(a,"$_reduce_2",function(w,Q,D){var T;return U(this.modifier)||this.$raise(n("ParseError")),T=z(w),this.$parsed(null==T[0]?e:T[0],null==T[2]?e:T[2],null==T[1]?e:T[1],null==T[3]?e:T[3])},3),S(a,"$_reduce_3",function(w,Q,D){var T,ae;return ae=null==(T=z(w))[2]?e:T[2],this.$parsed(null==T[0]?e:T[0],null==T[1]?e:T[1],p(p(n("Arithmetic"),"Node"),"Number").$new(0),ae)},3),S(a,"$_reduce_4",function(w,Q,D){var T=this;return U(T.prefix_number)&&U(T.suffix_number)||T.$raise(n("ParseError")),c(["command","prefix","suffix"],{command:w["$[]"](1),prefix:w["$[]"](0),suffix:w["$[]"](2)})},3),S(a,"$_reduce_5",function(w,Q,D){var T=this;return U(T.prefix_number)||T.$raise(n("ParseError")),U(T.need_suffix_number)&&T.$raise(n("ParseError")),c(["command","prefix"],{command:w["$[]"](1),prefix:w["$[]"](0)})},3),S(a,"$_reduce_6",function(w,Q,D){var T=this;return U(T.suffix_number)||T.$raise(n("ParseError")),U(T.need_prefix_number)&&T.$raise(n("ParseError")),c(["command","suffix"],{command:w["$[]"](0),suffix:w["$[]"](1)})},3),S(a,"$_reduce_7",function(w,Q,D){var T=this;return(U(T.need_prefix_number)||U(T.need_suffix_number))&&T.$raise(n("ParseError")),c(["command"],{command:w["$[]"](0)})},3),S(a,"$_reduce_8",function(w,Q,D){return c([],{})},3),S(a,"$_reduce_9",function(w,Q,D){var T,ae,se,X=e;return X=null==(T=z(w))[0]?e:T[0],ae=null==T[2]?e:T[2],U(this.critical)&&U(X["$[]"]("critical")["$nil?"]())||this.$raise(n("ParseError")),I(X,"[]=",F(se=["critical",ae])),H(se.length,1),X},3),S(a,"$_reduce_10",function(w,Q,D){var T,ae,se,X=e;return X=null==(T=z(w))[0]?e:T[0],ae=null==T[2]?e:T[2],U(this.fumble)&&U(X["$[]"]("fumble")["$nil?"]())||this.$raise(n("ParseError")),I(X,"[]=",F(se=["fumble",ae])),H(se.length,1),X},3),S(a,"$_reduce_11",function(w,Q,D){var T,ae,se,X=e;return X=null==(T=z(w))[0]?e:T[0],ae=null==T[2]?e:T[2],U(this.dollar)&&U(X["$[]"]("dollar")["$nil?"]())||this.$raise(n("ParseError")),I(X,"[]=",F(se=["dollar",ae])),H(se.length,1),X},3),S(a,"$_reduce_12",function(w,Q,D){return w["$[]"](1)},3),S(a,"$_reduce_13",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"Negative").$new(w["$[]"](1))},3),S(a,"$_reduce_14",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(w["$[]"](0),"+",w["$[]"](2))},3),S(a,"$_reduce_15",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(w["$[]"](0),"-",w["$[]"](2))},3),S(a,"$_reduce_16",function(w,Q,D){return U(this.allowed_cmp_op["$include?"](e))||this.$raise(n("ParseError")),c([],{})},3),S(a,"$_reduce_17",function(w,Q,D){var T,X,W;return W=null==(T=z(w))[1]?e:T[1],U(this.allowed_cmp_op["$include?"](X=null==T[0]?e:T[0]))||this.$raise(n("ParseError")),c(["cmp_op","target"],{cmp_op:X,target:W})},3),S(a,"$_reduce_18",function(w,Q,D){var ee,T=this;return ee=w["$[]"](0),U(T.question_target)||T.$raise(n("ParseError")),U(T.allowed_cmp_op["$include?"](ee))||T.$raise(n("ParseError")),c(["cmp_op","target"],{cmp_op:ee,target:"?"})},3),S(a,"$_reduce_19",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(w["$[]"](0),"+",w["$[]"](2))},3),S(a,"$_reduce_20",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(w["$[]"](0),"-",w["$[]"](2))},3),S(a,"$_reduce_22",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"BinaryOp").$new(w["$[]"](0),"*",w["$[]"](2))},3),S(a,"$_reduce_23",function(w,Q,D){return w["$[]"](3).$new(w["$[]"](0),w["$[]"](2))},3),S(a,"$_reduce_25",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault")},3),S(a,"$_reduce_26",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"DivideWithCeil")},3),S(a,"$_reduce_27",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"DivideWithCeil")},3),S(a,"$_reduce_28",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"DivideWithRound")},3),S(a,"$_reduce_29",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"DivideWithFloor")},3),S(a,"$_reduce_30",function(w,Q,D){return w["$[]"](1)},3),S(a,"$_reduce_31",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"Negative").$new(w["$[]"](1))},3),S(a,"$_reduce_33",function(w,Q,D){return w["$[]"](1)},3),S(a,"$_reduce_34",function(w,Q,D){return p(p(n("Arithmetic"),"Node"),"Number").$new(w["$[]"](0))},3),S(a,"$_reduce_none",function(w,Q,D){return w["$[]"](0)},3)},Opal.modules["bcdice/deprecated/checker"]=function(r){var C,F,V,U,z,f,L,S,M=[],t=r.nil,d=r.module,e=r.send,p=r.eqeqeq,E=r.truthy,A=r.def;return C=M,F=S=[d(M[0],"BCDice")].concat(C),V=L=[d(S[0],"Deprecated")].concat(F),z=[U=d(L[0],"Checker")].concat(V),f=r.$r(z),U.$private(),A(U,"$check_result_legacy",function(q,N,B,b){var m,v=this,x=t,y=t,_=t,s=t;return x=e(N,"map",[],"sides".$to_proc()),m=(y=e(N,"map",[],"value".$to_proc())).$sum(),_=p([100],s=x)?v.$check_1D100(q,m,B,b):p([20],s)?v.$check_1D20(q,m,B,b):p([6,6],s)?v.$check_2D6(q,m,y,B,b):t,(E(_["$nil?"]())||E(_["$empty?"]()))&&(_=p([10],s=x.$uniq())?v.$check_nD10(q,m,y,B,b):p([6],s)?v.$check_nD6(q,m,y,B,b):t,E(_["$nil?"]())||E(_["$empty?"]()))?t:f("Result").$new(_.$delete_prefix(" \uff1e "))},4),A(U,"$check_1D100",function(q,N,B,b){return t},4),A(U,"$check_1D20",function(q,N,B,b){return t},4),A(U,"$check_nD10",function(q,N,B,b,v){return t},5),A(U,"$check_2D6",function(q,N,B,b,v){return t},5),A(U,"$check_nD6",function(q,N,B,b,v){return t},5)},Opal.modules["bcdice/base"]=function(r){var N,y,$,i,u,m,_,s,a,b,M=r.top,t=[],d=r.$r(t),e=r.nil,p=r.$$$,E=r.module,A=r.klass,c=r.truthy,C=r.def,Y=r.regexp,S=r.rb_plus,I=r.send,F=r.to_a,H=r.rb_minus,L=r.eqeqeq,j=r.eqeq,V=r.range,U=r.rb_divide,z=r.rb_times,f=r.rb_ge,l=e;return M.$require("i18n"),M.$require("i18n/backend/fallbacks"),M.$require("bcdice/randomizer"),M.$require("bcdice/dice_table"),M.$require("bcdice/enum"),M.$require("bcdice/translate"),M.$require("bcdice/result"),M.$require("bcdice/command/parser"),M.$require("bcdice/deprecated/checker"),N=t,y=b=[E(t[0],"BCDice")].concat(N),_=[m=A(b[0],null,"Base")].concat(y),s=r.$r(_),(a=m.$$prototype).sort_add_dice=a.sort_barabara_dice=a.enabled_d9=a.raw_input=a.randomizer=a.enabled_upcase_input=a.debug=e,i=[$=r.get_singleton_class(m)].concat(_),u=r.$r(i),$.$attr_reader("prefixes"),C($,"$register_prefix",function(h){var P,G=this,o=e;return null==G.prefixes&&(G.prefixes=e),P=r.slice.call(arguments),G.prefixes=c(o=G.prefixes)?o:[],G.prefixes.$concat(P.$flatten())},-1),C($,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())},0),C($,"$prefixes_pattern",function(){var h=this,k=e;return null==h.prefixes_pattern&&(h.prefixes_pattern=e),null==h.prefixes&&(h.prefixes=e),h.prefixes_pattern=c(k=h.prefixes_pattern)?k:e,c(h.prefixes_pattern)?h.prefixes_pattern:(h.prefixes=c(k=h.prefixes)?k:[],h.prefixes.$freeze(),h.prefixes_pattern=(c(h.prefixes["$empty?"]())?/(?!)/:Y(["^(S)?(",h.prefixes.$join("|"),")"],"i")).$freeze())},0),C($,"$command_pattern",function(){var h=this,k=e,P=e;return null==h.command_pattern&&(h.command_pattern=e),null==h.prefixes&&(h.prefixes=e),h.command_pattern=c(k=h.command_pattern)?k:e,c(h.command_pattern)?h.command_pattern:(h.prefixes=c(k=h.prefixes)?k:[],h.prefixes.$freeze(),P=S(I(p(u("CommonCommand"),"COMMANDS"),"map",[],function(o){return null==o&&(o=e),p(o,"PREFIX_PATTERN").$source()},1),h.prefixes),h.command_pattern=Y(["^S?(",P.$join("|"),")"],"i").$freeze())},0),C($,"$eval",function(h){return this.$new(h).$eval()},1),m.$include(s("Translate")),m.$include(p(s("Deprecated"),"Checker")),C(m,"$initialize",function(n){var i=this;return i.raw_input=n,i.sort_add_dice=!1,i.sort_barabara_dice=!1,i.d66_sort_type=p(s("D66SortType"),"NO_SORT"),i.enabled_d9=!1,i.round_type=p(s("RoundType"),"FLOOR"),i.sides_implicit_d=6,i.upper_dice_reroll_threshold=e,i.reroll_dice_reroll_threshold=e,i.default_cmp_op=e,i.default_target_number=e,i.enabled_upcase_input=!0,i.locale="ja_jp",i.randomizer=p(s("BCDice"),"Randomizer").$new(),i.debug=!1},1),m.$attr_accessor("randomizer"),m.$attr_reader("d66_sort_type"),m.$attr_reader("round_type"),m.$attr_reader("sides_implicit_d"),m.$attr_reader("upper_dice_reroll_threshold"),m.$attr_reader("reroll_dice_reroll_threshold"),m.$attr_reader("default_cmp_op"),m.$attr_reader("default_target_number"),C(m,"$sort_add_dice?",function(){return this.sort_add_dice},0),C(m,"$sort_barabara_dice?",function(){return this.sort_barabara_dice},0),C(m,"$enabled_d9?",function(){return this.enabled_d9},0),C(m,"$enable_debug",function(){return this.debug=!0},0),C(m,"$eval",function(){var i,u,g,n=this,h=e;return i=p(s("BCDice"),"Preprocessor").$process(n.raw_input,n),u=c(g=n.$dice_command(i))?g:n.$eval_common_command(n.raw_input),c(u)?(h=[n.randomizer.$rand_results()],I(u,"rands=",F(h)),H(h.length,1),h=[n.randomizer.$detailed_rand_results()],I(u,"detailed_rands=",F(h)),H(h.length,1),u):e},0),C(m,"$change_text",function(n){return n},1),C(m,"$check_result",function(n,i,u,g){var h=this,k=e,P=e,G=e,o=e,Z=e;return k=h.$check_result_legacy(n,i,u,g),c(k)?k:(P=I(i,"map",[],"sides".$to_proc()),o=(G=I(i,"map",[],"value".$to_proc())).$sum(),k=L([100],Z=P)?h.$result_1d100(n,o,u,g):L([20],Z)?h.$result_1d20(n,o,u,g):L([6,6],Z)?h.$result_2d6(n,o,G,u,g):e,j(k,s("Result").$nothing())?e:c(k)?k:(k=L([10],Z=P.$uniq())?h.$result_nd10(n,o,G,u,g):L([6],Z)?h.$result_nd6(n,o,G,u,g):e,j(k,s("Result").$nothing())?e:c(k)?k:h.$result_ndx(n,u,g)))},4),C(m,"$grich_text",function(n,i,u){return e},3),m.$private(),C(m,"$eval_common_command",function(n){try{return n=this.$change_text(n),I(p(s("CommonCommand"),"COMMANDS"),"each",[],function u(g){var k,h=null==u.$$s?this:u.$$s;if(null==h.randomizer&&(h.randomizer=e),null==g&&(g=e),k=g.$eval(n,h,h.randomizer),!c(k))return e;r.ret(k)},{$$arity:1,$$s:this}),e}catch(u){if(u===r.returner)return u.$v;throw u}},1),C(m,"$dice_command",function(n){var i=this,u=e,g=e,h=e,k=e,P=e;return c(i.enabled_upcase_input)&&(n=n.$upcase()),u=i.$class().$prefixes_pattern().$match(n),c(u)?(g=u["$[]"](1)["$nil?"]()["$!"](),c(g)&&(n=n["$[]"](V(1,-1,!1))),h=i.$eval_game_system_specific_command(n),c(h["$is_a?"](s("Result")))?(k=[c(P=h["$secret?"]())?P:g],I(h,"secret=",F(k)),H(k.length,1),h):c(h["$nil?"]())||c(h["$empty?"]())||j(h,"1")?e:I(s("Result").$new(),"tap",[],function(o){return null==o&&(o=e),k=[h.$to_s()],I(o,"text=",F(k)),H(k.length,1),I(o,"secret=",F(k=[g])),k[H(k.length,1)]},1)):e},1),C(m,"$eval_game_system_specific_command",function(n){return e},1),C(m,"$result_ndx",function(n,i,u){return c(u["$is_a?"](s("String")))?e:c(n.$send(i,u))?s("Result").$success(this.$translate("success")):s("Result").$failure(this.$translate("failure"))},3),C(m,"$result_1d100",function(n,i,u,g){return e},4),C(m,"$result_1d20",function(n,i,u,g){return e},4),C(m,"$result_nd10",function(n,i,u,g,h){return e},5),C(m,"$result_2d6",function(n,i,u,g,h){return e},5),C(m,"$result_nd6",function(n,i,u,g,h){return e},5),C(m,"$get_table_by_2d6",function(n){return this.$get_table_by_nD6(n,2)},1),C(m,"$get_table_by_1d6",function(n){return this.$get_table_by_nD6(n,1)},1),C(m,"$get_table_by_nD6",function(n,i){return this.$get_table_by_nDx(n,i,6)},2),C(m,"$get_table_by_nDx",function(n,i,u){var h,k=e;return h=this.randomizer.$roll_sum(i,u),k=this.$get_table_value(n["$[]"](H(h,i))),c(k["$nil?"]())?["1",0]:[k,h]},3),C(m,"$get_table_by_1d3",function(n){var g,h,i=this,k=e;return i.$debug("get_table_by_1d3"),g=i.randomizer.$roll_sum(1,6),i.$debug("num",g),h=U(H(g,1),2).$to_i(),i.$debug("index",h),k=n["$[]"](h),c(k["$nil?"]())?["1",0]:[k,g]},1),C(m,"$get_table_by_d66_swap",function(n){var u;return u=this.randomizer.$roll_d66(p(s("D66SortType"),"ASC")),[this.$get_table_by_number(u,n),u]},1),C(m,"$get_table_by_d66",function(n){var u,g,h,P,k=e;return u=this.randomizer.$roll_once(6),g=this.randomizer.$roll_once(6),h=S(z(H(u,1),6),H(g,1)),k=n["$[]"](h),P=""+u+g,c(k["$nil?"]())?["1",P]:[k,P]},1),C(m,"$get_table_by_number",function(n,i,u){try{return null==u&&(u="1"),I(i,"each",[],function h(k){var G,P=null==h.$$s?this:h.$$s;if(null==k&&(k=e),G=k["$[]"](0),!c(f(G,n)))return e;r.ret(P.$get_table_value(k["$[]"](1)))},{$$arity:1,$$s:this}),this.$get_table_value(u)}catch(h){if(h===r.returner)return h.$v;throw h}},-3),C(m,"$get_table_value",function(n){return c(n["$is_a?"](s("Proc")))?n.$call():n},1),C(m,"$roll_tables",function(n,i){var g=e;return g=i["$[]"](n),c(g)?g.$roll(this.randomizer).$to_s():e},2),C(m,"$debug",function(n,i){var g,h=this,k=e,P=e;return g=r.slice.call(arguments,1),c(h.debug)?(k=c(n["$is_a?"](s("String")))?n:n.$inspect(),c(g["$empty?"]())?h.$warn(k):(P=I(g,"map",[],function(o){return null==o&&(o=e),c(o["$is_a?"](s("String")))?'"'+o+'"':o.$inspect()},1),h.$warn(k+": "+P.$join(", ")))):e},-2),p(p(d("I18n"),"Backend"),"Simple").$include(p(p(d("I18n"),"Backend"),"Fallbacks")),d("I18n").$load_path()["$<<"](d("Dir")["$[]"](d("File").$join("bcdice","../../i18n/**/*.yml"))),l=["ja_jp"],I(d("I18n"),"default_locale=",F(l)),H(l.length,1),l=[["ja_jp"]],I(d("I18n").$fallbacks(),"defaults=",F(l)),l[H(l.length,1)]},Opal.queue(function(r){var z,N,m,_,s,a,b,v,l,t=[],d=r.nil,e=r.module,p=r.klass,E=r.const_set,A=r.truthy,c=r.def,C=r.to_ary,Y=r.rb_plus,S=r.rb_minus,I=r.rb_gt,F=r.send,H=r.to_a,L=r.eqeq,j=r.rb_lt,V=r.rb_ge;return r.top.$require("bcdice/base"),z=t,N=l=[e(t[0],"BCDice")].concat(z),b=[e(l[0],"GameSystem")].concat(N),v=r.$r(b),m=b,s=[_=p(b[0],v("Base"),"ZettaiReido")].concat(m),a=r.$r(s),_.$$prototype.randomizer=d,E(s[0],"ID","ZettaiReido"),E(s[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),E(s[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),E(s[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),_.$register_prefix("\\d+\\-2DR"),c(_,"$eval_game_system_specific_command",function(i){var g=d,h=d,k=d;return A(i["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(g=a("Regexp").$last_match(1).$to_i(),h=a("Regexp").$last_match(2),k=a("Regexp").$last_match(4),this.$roll2DR(g,h,k)):d},1),c(_,"$roll2DR",function(i,u,g){var h,k,G,o,Z,R,O,Q,P=this,ne=d,ce=d,te=d,K=d,w=d;return k=P.$roll2DarkDice(),G=null==(h=C(k))[0]?d:h[0],o=null==h[1]?d:h[1],Z=null==h[2]?d:h[2],k=P.$getModInfo(u),R=null==(h=C(k))[0]?d:h[0],u=null==h[1]?d:h[1],k=P.$getDiffInfo(g),O=null==(h=C(k))[0]?d:h[0],ne="("+i+"-2DR"+u+(null==h[1]?d:h[1])+")",ce=i+"-"+G+"["+o+"]"+u,te=Y(S(i,G),R),K=P.$getResult(G,te,O),A(I(Z,0))&&(w=Z+"DP"),Q=[[ne,ce,te.$to_i(),K.$text(),w].$compact().$join(" \uff1e ")],F(K,"text=",H(Q)),S(Q.length,1),K},3),c(_,"$roll2DarkDice",function(){var i,u,h,k,P,G,o,g=this,R=d;return h=g.randomizer.$roll_once(6),k=g.randomizer.$roll_once(6),u=g.$changeDiceToDarkDice(h),P=null==(i=C(u))[0]?d:i[0],G=null==i[1]?d:i[1],u=g.$changeDiceToDarkDice(k),o=null==(i=C(u))[0]?d:i[0],R=Y(G,null==i[1]?d:i[1]),L(R,2)&&(R=4),[Y(P,o),P+","+o,R]},0),c(_,"$changeDiceToDarkDice",function(i){var u=d,g=d;return u=0,g=i,L(i,6)&&(g=0,u=1),[g,u]},1),c(_,"$getModInfo",function(i){var u=d,g=d;return u=a("ArithmeticEvaluator").$eval(i),g="",A(j(u,0))?g=u.$to_s():A(I(u,0))&&(g=Y("+",u.$to_s())),[u,g]},1),c(_,"$getDiffInfo",function(i){var u=d;return u="",A(i["$nil?"]())||(u=">="+(i=i.$to_i()).$to_i()),[i,u]},1),c(_,"$getResult",function(i,u,g){var h=d;return L(i,0)?a("Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):L(i,10)?a("Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(A(g["$nil?"]())&&(g=0),h=S(u,g),A(V(h,0))?a("Result").$success(h+" \u6210\u529f"):a("Result").$failure("\u5931\u6557"))},3)})}}]);