(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[2781],{2781:function(ae,se,le){le(4656),Opal.modules["bcdice/dice_table/table"]=function(n){var S,H,W,w,z,P,j,B,Y,T,m,M=[],G=n.nil,D=n.$$,x=n.module,i=n.klass,a=n.hash2,l=n.truthy;return S=M,H=m=[x(M[0],"BCDice")].concat(S),W=T=[x(m[0],"DiceTable")].concat(H),B=i(T[0],null,"Table"),Y=[B].concat(W),B.$$prototype.times=B.$$prototype.sides=B.$$prototype.name=B.$$prototype.items=G,n.defs(B,"$from_i18n",w=function(o,s){var b=G;return b=D(Y,"I18n").$t(o,a(["locale"],{locale:s})),this.$new(b["$[]"]("name"),b["$[]"]("type"),b["$[]"]("items"))},w.$$arity=2),n.def(B,"$initialize",z=function(o,s,_){var b=this,L=G;return b.name=o,b.items=_.$freeze(),L=/(\d+)D(\d+)/i.$match(s),l(L)||b.$raise(D(Y,"ArgumentError"),"Unexpected table type: "+s),b.times=L["$[]"](1).$to_i(),b.sides=L["$[]"](2).$to_i()},z.$$arity=3),n.def(B,"$roll",P=function(o){var _,s=this;return _=o.$roll_sum(s.times,s.sides),s.$choice(_)},P.$$arity=1),void n.def(B,"$choice",j=function(o){var _,s=this;return _=function(R,S){return"number"==typeof R&&"number"==typeof S?R-S:R["$-"](S)}(o,s.times),D(Y,"RollResult").$new(s.name,o,s.items["$[]"](_))},j.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(n){function M(S,y){return"number"==typeof S&&"number"==typeof y?S-y:S["$-"](y)}var y,I,B,z,P,j,Y,w,f,d,N=[],D=n.nil,i=n.$$,a=n.module,l=n.klass,R=n.hash2;return y=N,I=d=[a(N[0],"BCDice")].concat(y),B=f=[a(d[0],"DiceTable")].concat(I),Y=l(f[0],null,"D66GridTable"),w=[Y].concat(B),Y.$$prototype.name=Y.$$prototype.items=D,n.defs(Y,"$from_i18n",z=function(o,s){var b=D;return b=i(w,"I18n").$t(o,R(["locale","raise"],{locale:s,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items"))},z.$$arity=2),n.def(Y,"$initialize",P=function(o,s){return this.name=o,this.items=s.$freeze()},P.$$arity=2),void n.def(Y,"$roll",j=function(o){var _,b,L,J,Q,S;return _=o.$roll_once(6),b=o.$roll_once(6),L=function(S,y){return"number"==typeof S&&"number"==typeof y?S+y:S["$+"](y)}("number"==typeof(S=_)?10*S:S["$*"](10),b),J=M(_,1),Q=M(b,1),i(w,"RollResult").$new(this.name,L,this.items["$[]"](J)["$[]"](Q))},j.$$arity=1)},function(n){function E(T,f){return"number"==typeof T&&"number"==typeof f?T+f:T["$+"](f)}function G(T,f){return"number"==typeof T&&"number"==typeof f?T-f:T["$-"](f)}var f,Y,C,_,b,L,J,Q,te,ne,ie,$e,A,u,e,o,s,z,W,D=n.top,x=[],i=n.nil,a=n.$$$,l=n.$$,R=n.module,S=n.klass,y=n.send2,m=n.truthy,d=n.send,H=n.hash2,I=n.range;D.$require("bcdice/dice_table/table"),D.$require("bcdice/dice_table/d66_grid_table"),f=x,Y=W=[R(x[0],"BCDice")].concat(f),C=z=[R(W[0],"GameSystem")].concat(Y),o=S(z[0],l(z,"Base"),"StellarKnights"),s=[o].concat(C),o.$$prototype.randomizer=i,n.const_set(s[0],"ID","StellarKnights"),n.const_set(s[0],"NAME","\u9280\u5263\u306e\u30b9\u30c6\u30e9\u30ca\u30a4\u30c4"),n.const_set(s[0],"SORT_KEY","\u304d\u3093\u3051\u3093\u306e\u3059\u3066\u3089\u306a\u3044\u3064"),n.const_set(s[0],"HELP_MESSAGE","\u30fb\u30a2\u30bf\u30c3\u30af\u5224\u5b9a\u3000nSK[d][,k>l,...]\n[]\u5185\u306f\u7701\u7565\u53ef\u80fd\u3002\nn: \u30c0\u30a4\u30b9\u6570\u3001d: \u30a2\u30bf\u30c3\u30af\u5224\u5b9a\u306b\u304a\u3051\u308b\u5bfe\u8c61\u306e\u9632\u5fa1\u529b\u3001k, l: \u30c0\u30a4\u30b9\u306e\u51fa\u76ee\u304ck\u306a\u3089\u3070l\u306b\u5909\u66f4\uff08\u30a2\u30de\u30e9\u30f3\u30b5\u30b9\u306e\u30b9\u30ad\u30eb\u300c\u59cb\u307e\u308a\u306e\u90e8\u5c4b\u300d\u7528\uff09\nd\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u3092\u632f\u3063\u305f\u7d50\u679c\u306e\u307f\u8868\u793a\u3002\uff08nSK\u306fnB6\u3068\u540c\u3058\uff09\n\n4SK: \u30c0\u30a4\u30b9\u30924\u500b\u632f\u3063\u3066\u3001\u305d\u306e\u7d50\u679c\u3092\u8868\u793a\n4+2SK: \u30c0\u30a4\u30b9\u30924+2 (=6) \u500b\u632f\u3063\u3066\u3001\u305d\u306e\u7d50\u679c\u3092\u8868\u793a\n5/2SK: \u30c0\u30a4\u30b9\u30925\u500b\u306e\u534a\u5206 (=2) \u500b\u632f\u3063\u3066\u3001\u305d\u306e\u7d50\u679c\u3092\u8868\u793a\n(5+3)/2SK: \u30c0\u30a4\u30b9\u3092(5+3)\u500b\u306e\u534a\u5206 (=4) \u500b\u632f\u3063\u3066\u3001\u305d\u306e\u7d50\u679c\u3092\u8868\u793a\n5SK3: \u3010\u30a2\u30bf\u30c3\u30af\u5224\u5b9a\uff1a5\u30c0\u30a4\u30b9\u3011\u3001\u5bfe\u8c61\u306e\u9632\u5fa1\u529b\u30923\u3068\u3057\u3066\u6210\u529f\u6570\u3092\u8868\u793a\n3SK,1>6: \u30c0\u30a4\u30b9\u30923\u500b\u632f\u308a\u3001\u51fa\u76ee\u304c1\u306e\u30c0\u30a4\u30b9\u3092\u5168\u30666\u306b\u5909\u66f4\u3057\u3001\u305d\u306e\u7d50\u679c\u3092\u8868\u793a\n6SK4,1>6,2>6: \u3010\u30a2\u30bf\u30c3\u30af\u5224\u5b9a\uff1a6\u30c0\u30a4\u30b9\u3011\u3001\u51fa\u76ee\u304c1\u30682\u306e\u30c0\u30a4\u30b9\u3092\u5168\u30666\u306b\u5909\u66f4\u3001\u5bfe\u8c61\u306e\u9632\u5fa1\u529b\u30924\u3068\u3057\u3066\u6210\u529f\u6570\u3092\u8868\u793a\n\n\u30fb\u57fa\u672c\nTT\uff1a\u304a\u984c\u8868\nSTA    \uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868A\uff1a\u6642\u9593 (Situation Table A)\nSTB    \uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868B\uff1a\u5834\u6240 (ST B)\nSTB2[n]\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868B \u305d\u306e2\uff1a\u5b66\u5712\u7de8 (ST B 2)\n\u3000n: 1(\u30a2\u30fc\u30bb\u30eb\u30c8\u30ec\u30a4), 2(\u30a4\u30c7\u30a2\u30b0\u30ed\u30ea\u30a2), 3(\u30b7\u30c8\u30e9), 4(\u30d5\u30a3\u30ed\u30bd\u30d5\u30a3\u30a2), 5(\u8056\u30a2\u30fc\u30b8\u30a7\u30c6\u30a3\u30a2), 6(SoA)\nSTC    \uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868C\uff1a\u8a71\u984c (ST C)\nALLS   \uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868\u5168\u3066\u3092\u4e00\u62ec\u3067\uff08\u5b66\u5712\u7de8\u9664\u304f\uff09\nGAT\uff1a\u6240\u5c5e\u7d44\u7e54\u6c7a\u5b9a (Gakuen Table)\nHOT\uff1a\u5e0c\u671b\u8868 (Hope Table)\nDET\uff1a\u7d76\u671b\u8868 (Despair Table)\nWIT\uff1a\u9858\u3044\u4e8b\u8868 (Wish Table)\nYST\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868 (Your Story Table)\nYSTA\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u7570\u4e16\u754c (YST Another World)\nPET\uff1a\u6027\u683c\u8868 (Personality Table)\n    \u6027\u683c\u8868\u30922\u56de\u632f\u308a\u3001\u6027\u683c\u3092\u6c7a\u5b9a\u3059\u308b\n\n\u30fb\u9727\u3068\u685c\u306e\u30de\u30eb\u30b8\u30ca\u30ea\u30a2\nYSTM\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u30de\u30eb\u30b8\u30ca\u30ea\u30a2\u4e16\u754c (YST Marginalia)\nSTM\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868\uff1a\u30de\u30eb\u30b8\u30ca\u30ea\u30a2\u4e16\u754c (ST Marginalia)\nYSTL\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u624b\u7d19\u4e16\u754c (YST Letter)\nYSTR\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u30ea\u30b3\u30ec\u30af\u30c8\u30fb\u30c9\u30fc\u30eb (YST Recollect-doll)\nSTBR\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868B\uff1a\u5834\u6240\uff08\u30ea\u30b3\u30ec\u30af\u30c8\u30fb\u30c9\u30fc\u30eb\uff09 (ST B Recollect-doll)\nSTCR\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868C\uff1a\u30ea\u30b3\u30ec\u30af\u30c8 (ST C Recollect)\nSTBS\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868B\uff1a\u30b7\u30c8\u30e9\u30bb\u30c3\u30c6\u30a3\u30f3\u30b0 (ST B Sut Tu Real)\nSTE\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868\uff1a\u30a8\u30af\u30ea\u30d7\u30b9\u5c02\u7528 (ST Eclipse)\n\n\u30fb\u7d2b\u5f3e\u306e\u30aa\u30eb\u30c8\u30ea\u30f4\u30fc\u30c8\nFT\uff1a\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u8868 (Fragment Table)\n    \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u8868\u3092\uff15\u56de\u632f\u308b\nFTx\uff1a\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u8868\u3092x\u56de\u632f\u308b\nYSTB\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u30d6\u30ea\u30f3\u30ac\u30fc (YST Bringer)\nYSTF\uff1a\u3042\u306a\u305f\u306e\u7269\u8a9e\u8868\uff1a\u30d5\u30a9\u30fc\u30b8 (YST Forge)\nSTAL\uff1a\u30b7\u30c1\u30e5\u30a8\u30fc\u30b7\u30e7\u30f3\u8868\uff1a\u30aa\u30eb\u30c8\u30ea\u30f4\u30fc\u30c8 (ST Alt-Levoot)\n"),n.def(o,"$initialize",_=function($){var r=this;return _.$$p&&(_.$$p=null),y(r,n.find_super_dispatcher(r,"initialize",_,!1,!0),"initialize",[$],null),r.sort_barabara_dice=!0,r.d66_sort_type=a(l(s,"D66SortType"),"NO_SORT")},_.$$arity=1),n.def(o,"$eval_game_system_specific_command",b=function($){var e=this,u=i,r=i,t=i,g=i,c=i,h=i;return $=$.$upcase(),m(u=a(e.$class(),"TABLES")["$[]"]($))?u.$roll(e.randomizer):m(r=/([()+\/\d]+)SK(\d)?((,\d>\d)+)?/.$match($))?(t=l(s,"Arithmetic").$eval(r["$[]"](1),a(l(s,"RoundType"),"FLOOR")),m(t["$nil?"]())?i:e.$resolute_action(t,m(g=r["$[]"](2))?r["$[]"](2).$to_i():g,r["$[]"](3))):$["$=="]("STB2")?e.$roll_all_situation_b2_tables():$["$=="]("ALLS")?e.$roll_all_situation_tables():$["$=="]("PET")?e.$roll_personality_table():m(r=/FT(\d+)?/.$match($))?(c=(m(h=r["$[]"](1))?h:5).$to_i(),e.$roll_fragment_table(c)):i},b.$$arity=1),o.$private(),n.def(o,"$resolute_action",L=function($,e,u){var r,t,g,F,T,c=this,h=i,k=i,v=i,q=i,Z=i,O=i;return F=(h=c.randomizer.$roll_barabara($,6).$sort()).$join(","),k="("+c.$remake_command($,e,u)+") \uff1e "+F,m(h["$empty?"]())?E(k,c.$translate("StellarKnights.SK.no_dice_error")):(v=c.$parse_dice_change_rules(u),d(v,"each",[],((r=function(p){var K;return null==p&&(p=i),d(h,"map!",[],((K=function(X){return null==X&&(X=i),X["$=="](p["$[]"]("from"))?p["$[]"]("to"):X}).$$s=null==r.$$s?this:r.$$s,K.$$arity=1,K))}).$$s=c,r.$$arity=1,r)),m(v["$empty?"]())||(h["$sort!"](),k=E(k," \uff1e ["+h.$join(",")+"]")),m(e["$nil?"]())?(q=!1,Z=!1):(O=d(h,"count",[],((t=function(p){return null==p&&(p=i),function(T,f){return"number"==typeof T&&"number"==typeof f?T>=f:T["$>="](f)}(p,e)}).$$s=c,t.$$arity=1,t)),k=E(k,E(" \uff1e ",c.$translate("StellarKnights.SK.success_num",H(["success_num"],{success_num:O})))),q="number"==typeof(T=O)?T>0:T["$>"](0),Z=q["$!"]()),d(l(s,"Result").$new(k),"tap",[],((g=function(p){var K=i;return null==p&&(p=i),d(p,"success=",n.to_a(K=[q])),G(K.length,1),d(p,"failure=",n.to_a(K=[Z])),K[G(K.length,1)]}).$$s=c,g.$$arity=1,g)))},L.$$arity=3),n.def(o,"$remake_command",J=function($,e,u){var t=i;return t=$+"SK",m(e["$nil?"]())||(t=E(t,e.$to_s())),m(u["$nil?"]())||(t=E(t,u)),t},J.$$arity=3),n.def(o,"$parse_dice_change_rules",Q=function($){var e;return m($["$nil?"]())?[]:($=$["$[]"](I(1,-1,!1)),d($.$split(","),"map",[],((e=function(t){var c=i;return null==t&&(t=i),c=d(t.$split(">"),"map",[],"to_i".$to_proc()),H(["from","to"],{from:c["$[]"](0),to:c["$[]"](1)})}).$$s=this,e.$$arity=1,e)))},Q.$$arity=1),n.def(o,"$roll_all_situation_b2_tables",te=function(){var $;return d(I(1,6,!1),"map",[],($=function(r){var t=null==$.$$s?this:$.$$s;return null==t.randomizer&&(t.randomizer=i),null==r&&(r=i),a(t.$class(),"TABLES")["$[]"]("STB2"+r).$roll(t.randomizer)},$.$$s=this,$.$$arity=1,$)).$join("\n")},te.$$arity=0),n.def(o,"$roll_all_situation_tables",ne=function(){var $;return d(["STA","STB","STC"],"map",[],($=function(r){var t=null==$.$$s?this:$.$$s;return null==t.randomizer&&(t.randomizer=i),null==r&&(r=i),a(t.$class(),"TABLES")["$[]"](r).$roll(t.randomizer)},$.$$s=this,$.$$arity=1,$)).$join("\n")},ne.$$arity=0),n.def(o,"$roll_personality_table",ie=function(){var $,e,r,t,g,c,u=this;return e=u.$get_table_by_d66(u.$translate("StellarKnights.PET.items")),r=null==($=n.to_ary(e))[0]?i:$[0],t=null==$[1]?i:$[1],e=u.$get_table_by_d66(u.$translate("StellarKnights.PET.items")),g=null==($=n.to_ary(e))[0]?i:$[0],c=null==$[1]?i:$[1],u.$translate("StellarKnights.PET.name")+"("+t+","+c+") \uff1e "+u.$translate("StellarKnights.PET.result",H(["value1","value2"],{value1:r,value2:g}))},ie.$$arity=0),n.def(o,"$roll_fragment_table",$e=function($){var e,u,r,T,t=this,g=i,c=i,h=i;return m("number"==typeof(T=$)?T<=0:T["$<="](0))?i:(g=d(l(s,"Array"),"new",[$],((e=function(){var v=null==e.$$s?this:e.$$s;return v.$get_table_by_d66(v.$translate("StellarKnights.FT.items"))}).$$s=t,e.$$arity=0,e)),c=d(g,"map",[],((u=function(v){return null==v&&(v=i),v["$[]"](0)}).$$s=t,u.$$arity=1,u)),h=d(g,"map",[],((r=function(v){return null==v&&(v=i),v["$[]"](1)}).$$s=t,r.$$arity=1,r)),t.$translate("StellarKnights.FT.name")+"("+h.$join(",")+") \uff1e "+c.$join(t.$translate("StellarKnights.FT.sep")))},$e.$$arity=1),A=n.get_singleton_class(o),e=[A].concat(s),A.$private(),n.def(A,"$translate_tables",u=function(t){return H(["TT","STA","STB","STB21","STB22","STB23","STB24","STB25","STB26","STC","GAT","HOT","DET","WIT","YST","YSTA","YSTM","STM","YSTL","YSTR","STBR","STCR","STBS","STE","YSTB","YSTF","STAL"],{TT:a(l(e,"DiceTable"),"D66GridTable").$from_i18n("StellarKnights.tables.TT",t),STA:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STA",t),STB:a(l(e,"DiceTable"),"D66OneThirdTable").$from_i18n("StellarKnights.tables.STB",t),STB21:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB21",t),STB22:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB22",t),STB23:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB23",t),STB24:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB24",t),STB25:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB25",t),STB26:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.STB26",t),STC:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STC",t),GAT:a(l(e,"DiceTable"),"Table").$from_i18n("StellarKnights.tables.GAT",t),HOT:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.HOT",t),DET:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.DET",t),WIT:a(l(e,"DiceTable"),"D66OneThirdTable").$from_i18n("StellarKnights.tables.WIT",t),YST:a(l(e,"DiceTable"),"D66OneThirdTable").$from_i18n("StellarKnights.tables.YST",t),YSTA:a(l(e,"DiceTable"),"D66OneThirdTable").$from_i18n("StellarKnights.tables.YSTA",t),YSTM:a(l(e,"DiceTable"),"D66OneThirdTable").$from_i18n("StellarKnights.tables.YSTM",t),STM:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STM",t),YSTL:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.YSTL",t),YSTR:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.YSTR",t),STBR:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STBR",t),STCR:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STCR",t),STBS:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STBS",t),STE:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STE",t),YSTB:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.YSTB",t),YSTF:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.YSTF",t),STAL:a(l(e,"DiceTable"),"D66HalfGridTable").$from_i18n("StellarKnights.tables.STAL",t)})},u.$$arity=1),n.const_set(s[0],"TABLES",o.$translate_tables("ja_jp")),o.$register_prefix("[()+\\/\\d]+SK","STB2","ALLS","PET","FT",l(s,"TABLES").$keys())}(Opal)}}]);