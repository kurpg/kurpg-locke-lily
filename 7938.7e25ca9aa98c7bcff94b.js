(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[7938],{7938:function(oe,ce,re){re(4656),Opal.modules["bcdice/format"]=function(n){var y,B,k,o,v,m,F,E=[],g=n.nil,q=n.$$,R=n.module,j=n.truthy;return y=E,B=F=[R(E[0],"BCDice")].concat(y),v=R(F[0],"Format"),m=[v].concat(B),v.$module_function(),n.def(v,"$comparison_operator",k=function(b){var C;return"=="["$==="](C=b)?"=":"!="["$==="](C)?"<>":q(m,"Symbol")["$==="](C)?b.$to_s():g},k.$$arity=1),void n.def(v,"$modifier",o=function(b){return j(b["$nil?"]())?g:b["$=="](0)?"":j("number"==typeof(r=b)?r>0:r["$>"](0))?"+"+b:b.$to_s();var r},o.$$arity=1)},function(n){function D(o,c){return"number"==typeof o&&"number"==typeof c?o-c:o["$-"](c)}function h(o,c){return"number"==typeof o&&"number"==typeof c?o+c:o["$+"](c)}function E(o,c){return"number"==typeof o&&"number"==typeof c?o>=c:o["$>="](c)}function g(o,c){return"number"==typeof o&&"number"==typeof c?o<c:o["$<"](c)}var c,te,ue,L,I,K,N,T,Y,J,Q,U,V,W,X,Z,O,ee,a,_,A,S,j=[],r=n.nil,y=n.$$$,l=n.$$,F=n.module,P=n.klass,B=n.send2,v=n.hash2,m=n.truthy,k=n.send;n.top.$require("bcdice/format"),c=j,te=S=[F(j[0],"BCDice")].concat(c),ue=A=[F(S[0],"GameSystem")].concat(te),a=P(A[0],l(A,"Base"),"OracleEngine"),_=[a].concat(ue),a.$$prototype.cmd=a.$$prototype.max_shift=a.$$prototype.times=a.$$prototype.randomizer=a.$$prototype.break=a.$$prototype.critical=a.$$prototype.fumble=r,n.const_set(_[0],"ID","OracleEngine"),n.const_set(_[0],"NAME","\u30aa\u30e9\u30af\u30eb\u30a8\u30f3\u30b8\u30f3"),n.const_set(_[0],"SORT_KEY","\u304a\u3089\u304f\u308b\u3048\u3093\u3057\u3093"),n.const_set(_[0],"HELP_MESSAGE","  \u30fb\u30af\u30e9\u30c3\u30c1\u30ed\u30fc\u30eb \uff08xCL+y>=z)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u30011\u500b\u4ee5\u4e0a\u76ee\u6a19\u30b7\u30d5\u30c8z\u306b\u5230\u9054\u3057\u305f\u304b\u5224\u5b9a\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u5168\u3066\u306e\u30c0\u30a4\u30b9\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u6210\u529f\u3057\u305f\u6642\u306f\u76ee\u6a19\u30b7\u30d5\u30c8\u3092\u3001\u5931\u6557\u3057\u305f\u6642\u306f\u30c0\u30a4\u30b9\u306e\u6700\u5927\u5024-1\u30b7\u30d5\u30c8\u3092\u8fd4\u3057\u307e\u3059\n  z\u304c\u6307\u5b9a\u3055\u308c\u306a\u3044\u3068\u304d\u306f\u3001\u30c0\u30a4\u30b9\u3092x\u500b\u3092\u632f\u308a\u3001\u305d\u308c\u306b\u4fee\u6b63y\u3057\u305f\u3082\u306e\u3092\u8fd4\u3057\u307e\u3059\u3002\n  \u901a\u5e38\u3001\u6700\u4f4e\u30b7\u30d5\u30c8\u306f1\u3001\u6700\u5927\u30b7\u30d5\u30c8\u306f6\u3067\u3059\u3002\u76ee\u6a19\u30b7\u30d5\u30c8\u3082\u305d\u308d\u3048\u3089\u308c\u307e\u3059\u3002\n  \u307e\u305f\u3001CL\u306e\u5f8c\u306b7\u3092\u5165\u308c\u3001(xCL7+y>=z)\u3068\u5165\u529b\u3059\u308b\u3068\u6700\u5927\u30b7\u30d5\u30c8\u304c7\u306b\u306a\u308a\u307e\u3059\u3002\n \u30fb\u5224\u5b9a (xR6+y@c#f$b>=z)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u3001\u5927\u304d\u3044\u3082\u306e2\u3064\u3060\u3051\u3092\u898b\u3066\u9054\u6210\u5024\u3092\u7b97\u51fa\u3057\u3001\u6210\u5426\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u9054\u6210\u5024\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af\u3068\u3057\u3066b\u3092\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3068\u3057\u3066c\u3092\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u3068\u3057\u3066f\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n  \u305d\u308c\u305e\u308c\u6307\u5b9a\u3055\u308c\u306a\u3044\u6642\u30010,12,2\u306b\u306a\u308a\u307e\u3059\u3002\n  \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u4e0a\u9650\u306f\u306a\u3057\u3001\u4e0b\u9650\u306f2\u3002\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u4e0a\u9650\u306f12\u3001\u4e0b\u9650\u306f0\u3002\n  z\u304c\u6307\u5b9a\u3055\u308c\u306a\u3044\u3068\u304d\u3001\u9054\u6210\u5024\u306e\u7b97\u51fa\u306e\u307f\u884c\u3044\u307e\u3059\u3002\n \u30fb\u30c0\u30e1\u30fc\u30b8\u30ed\u30fc\u30eb\u306e\u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af (xD6+y$b)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u3001\u5408\u8a08\u5024\u3092\u51fa\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u5408\u8a08\u5024\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af\u3068\u3057\u3066b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u5408\u8a08\u5024\u306f0\u672a\u6e80\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n"),a.$register_prefix("\\d+CL","\\d+R6","\\d+D6.*\\$[\\+\\-]?\\d+"),n.def(a,"$initialize",L=function(t){var u=this;return L.$$p&&(L.$$p=null),B(u,n.find_super_dispatcher(u,"initialize",L,!1,!0),"initialize",[t],null),u.sort_add_dice=!0,u.sort_barabara_dice=!0},L.$$arity=1),n.def(a,"$eval_game_system_specific_command",I=function(t){var $,e=this;return/\d+CL.*/i["$==="]($=t)?e.$clutch_roll(t):/\d+D6.*\$[+\-]?\d.*/["$==="]($)?e.$damage_roll(t):/\d+R6/["$==="]($)?e.$r_roll(t):r},I.$$arity=1),n.def(a,"$clutch_roll",K=function(t){var e,$,u,i=this,d=r,s=r,p=r,x=r;return i.$debug("clutch_roll begin",t),d=y(l(_,"Command"),"Parser").$new(/\d+CL[67]?/,v(["round_type"],{round_type:i.$round_type()})).$restrict_cmp_op_to(r,">="),i.cmd=d.$parse(t),!m(i.cmd)||($=k(i.cmd.$command().$split("CL"),"map",[],"to_i".$to_proc()),e=n.to_ary($),i.times=null==e[0]?r:e[0],i.max_shift=null==e[1]?r:e[1],i.max_shift=m(s=i.max_shift)?s:6,m(i.cmd.$cmp_op())&&(p=[i.$clamp(i.cmd.$target_number(),1,i.max_shift)],k(i.cmd,"target_number=",n.to_a(p)),D(p.length,1)),i.times["$=="](0))?r:(x=k(i.randomizer.$roll_barabara(i.times,6),"map",[],(u=function(M){var z=null==u.$$s?this:u.$$s;return null==z.cmd&&(z.cmd=r),null==z.max_shift&&(z.max_shift=r),null==M&&(M=r),z.$clamp(h(M,z.cmd.$modify_number()),1,z.max_shift)},u.$$s=i,u.$$arity=1,u)).$sort(),[i.$expr_clutch(),"["+x.$join(", ")+"]",i.$result_clutch(x.$last())].$join(" \uff1e "))},K.$$arity=1),n.def(a,"$expr_clutch",N=function(){var e,$,u,t=this;return e=t.max_shift["$=="](7)?7:r,$=l(_,"Format").$comparison_operator(t.cmd.$cmp_op()),u=l(_,"Format").$modifier(t.cmd.$modify_number()),"("+t.times+"CL"+e+u+$+t.cmd.$target_number()+")"},N.$$arity=0),n.def(a,"$result_clutch",T=function(t){var e=this;return m(e.cmd.$cmp_op()["$!="](">="))?"\u30b7\u30d5\u30c8"+t:m(E(t,e.cmd.$target_number()))?"\u6210\u529f \u30b7\u30d5\u30c8"+e.cmd.$target_number():(t=D(t,1),m(g(t,1))&&(t=1),"\u5931\u6557 \u30b7\u30d5\u30c8"+t)},T.$$arity=1),n.def(a,"$clamp",Y=function(t,e,$){return m(g(t,e))?e:m(function(o,c){return"number"==typeof o&&"number"==typeof c?o>c:o["$>"](c)}(t,$))?$:t},Y.$$arity=3),n.def(a,"$r_roll",J=function(t){var e=this,$=r,u=r,i=r,d=r,s=r,p=r,x=r,w=r;return $=y(l(_,"Command"),"Parser").$new(/\d+R6/,v(["round_type"],{round_type:e.$round_type()})).$restrict_cmp_op_to(r,">=").$enable_critical().$enable_fumble().$enable_dollar(),e.cmd=$.$parse(t),!m(e.cmd)||(e.times=e.cmd.$command().$to_i(),e.times["$=="](0))?r:(e.critical=e.$normalize_critical(m(u=e.cmd.$critical())?u:12,t),e.fumble=e.$normalize_fumble(m(i=e.cmd.$fumble())?i:2,t),e.break=(m(d=e.cmd.$dollar())?d:0).$abs(),p=(s=e.randomizer.$roll_barabara(e.times,6).$sort()).$pop(e.break),w=h(x=s.$dup().$pop(2).$inject(0,"+"),e.cmd.$modify_number()),[e.$expr_r(),e.$dice_result_r(x,s,p),e.$result_r(x,w)].$join(" \uff1e "))},J.$$arity=1),n.def(a,"$expr_r",Q=function(){var e,$,u,i,d,t=this;return e=l(_,"Format").$modifier(t.cmd.$modify_number()),$=t.critical["$=="](12)?"":"c["+t.critical+"]",u=t.fumble["$=="](2)?"":"f["+t.fumble+"]",i=t.break["$=="](0)?"":"b["+t.break+"]",d=l(_,"Format").$comparison_operator(t.cmd.$cmp_op()),"("+t.times+"R6"+e+$+u+i+d+t.cmd.$target_number()+")"},Q.$$arity=0),n.def(a,"$dice_result_r",U=function(t,e,$){var i;return i=l(_,"Format").$modifier(this.cmd.$modify_number()),m($["$empty?"]())?t+"["+e.$join(", ")+"]"+i:t+"["+e.$join(", ")+"]\xd7["+$.$join(", ")+"]"+i},U.$$arity=3),n.def(a,"$result_r",V=function(t,e){var $=this;return m(function(o,c){return"number"==typeof o&&"number"==typeof c?o<=c:o["$<="](c)}(t,$.fumble))?"\u30d5\u30a1\u30f3\u30d6\u30eb!":m(E(t,$.critical))?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb!":$.cmd.$cmp_op()["$=="](">=")?m(E(e,$.cmd.$target_number()))?e+" \u6210\u529f":e+" \u5931\u6557":e.$to_s()},V.$$arity=2),n.def(a,"$normalize_critical",W=function(t,e){return m(/@[+-]/.$match(e))&&(t=h(12,t)),m(g(t,2))&&(t=2),t},W.$$arity=2),n.def(a,"$normalize_fumble",X=function(t,e){return m(/#[+-]/.$match(e))&&(t=h(2,t)),this.$clamp(t,0,12)},X.$$arity=2),n.def(a,"$damage_roll",Z=function(t){var e=this,$=r,u=r,i=r,d=r,s=r;return $=y(l(_,"Command"),"Parser").$new(/\d+D6/,v(["round_type"],{round_type:e.$round_type()})).$restrict_cmp_op_to(r).$enable_dollar(),e.cmd=$.$parse(t),!m(e.cmd)||(e.times=e.cmd.$command().$to_i(),e.break=(m(u=e.cmd.$dollar())?u:0).$abs(),e.times["$=="](0))?r:(d=(i=e.randomizer.$roll_barabara(e.times,6).$sort()).$pop(e.break),s=h(i.$inject(0,"+"),e.cmd.$modify_number()),m(g(s,0))&&(s=0),[e.$expr_damage(),e.$result_damage(i,d),s].$join(" \uff1e "))},Z.$$arity=1),n.def(a,"$expr_damage",O=function(){var e,$,t=this;return e=l(_,"Format").$modifier(t.cmd.$modify_number()),$=t.break["$=="](0)?"":"b["+t.break+"]","("+t.times+"D6"+e+$+")"},O.$$arity=0),n.def(a,"$result_damage",ee=function(t,e){var u,i;return u=t.$inject(0,"+"),i=l(_,"Format").$modifier(this.cmd.$modify_number()),m(e["$empty?"]())?u+"["+t.$join(", ")+"]"+i:u+"["+t.$join(", ")+"]\xd7["+e.$join(", ")+"]"+i},ee.$$arity=2)}(Opal)}}]);