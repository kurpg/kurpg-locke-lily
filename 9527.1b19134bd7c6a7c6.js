(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9527],{9527:(pe,ye,ge)=>{ge(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(r){var F,M,Z,K,U,N,W,k,Y=[],$=r.nil,t=r.$$$,e=r.module,x=r.hash2,P=r.truthy,H=r.def;return F=Y,M=k=[e(Y[0],"BCDice")].concat(F),W=[N=e(k[0],"ArithmeticEvaluator")].concat(M),K=[Z=r.get_singleton_class(N)].concat(W),U=r.$r(K),H(Z,"$eval",function(f,C){var I,j=$;if(null==C)C=x([],{});else if(!C.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(I=C.$$smap.round_type)&&(I=t(U("RoundType"),"FLOOR")),P(f)&&P(j=U("Arithmetic").$eval(f,I))?j:0},-2)},Opal.modules["i18n/backend/fallbacks"]=function(r){var K,f,I,j,U,o,Y=[],$=r.nil,t=r.$$$,e=r.module,x=r.class_variable_set,P=r.truthy,H=r.class_variable_get,a=r.def,F=r.send,S=r.to_a,k=r.rb_minus,R=r.send2,M=r.find_super,N=r.hash2,W=r.find_block_super,Z=r.neqeq;return K=Y,o=[U=e(Y[0],"I18n")].concat(K),x(o[0],"@@fallbacks",$),f=r.get_singleton_class(U),I=[f].concat(o),j=r.$r(I),a(f,"$fallbacks",function(){var T=$;return x(I[1],"@@fallbacks",P(null!=I[1].$$cvars["@@fallbacks"]?"class variable":$)&&P(T=H(I[1],"@@fallbacks",!1))?T:t(t(j("I18n"),"Locale"),"Fallbacks").$new()),P(T=j("Thread").$current()["$[]"]("i18n_fallbacks"))?T:H(I[1],"@@fallbacks",!1)},0),a(f,"$fallbacks=",function(b){var T;return x(I[1],"@@fallbacks",P(b["$is_a?"](j("Array")))?t(t(j("I18n"),"Locale"),"Fallbacks").$new(b):b),T=["i18n_fallbacks",H(I[1],"@@fallbacks",!1)],F(j("Thread").$current(),"[]=",S(T)),T[k(T.length,1)]},1),function(f,C){var b,T,y,v,j=[e(f,"Backend")].concat(C);return b=j,y=[T=e(j[0],"Fallbacks")].concat(b),v=r.$r(y),a(T,"$translate",function m(_,c,i){try{var n=m.$$p||$,s=this,d=$,g=$;return delete m.$$p,null==i&&(i=v("EMPTY_HASH")),P(i.$fetch("fallback",!0))?P(i["$[]"]("fallback_in_progress"))?R(s,M(s,"translate",m,!1,!0),"translate",[_,c,i],n):(P(i["$[]"]("default"))&&(d=s["$extract_non_symbol_default!"](i)),g=i.$merge(N(["fallback_in_progress"],{fallback_in_progress:!0})),F(v("I18n").$fallbacks()["$[]"](_),"each",[],function u(p){var h=null==u.$$s?this:u.$$s;null==p&&(p=$);try{return F(h,"catch",["exception"],function Q(){var l=null==Q.$$s?this:Q.$$s,X=$;if(X=R(l,W(l,"translate",Q.$$def||u.$$def||m,!1,!1),"translate",[p,c,g],null),P(X["$nil?"]()))return $;Z(_.$to_s(),p.$to_s())&&l.$on_fallback(_,p,c,i),r.ret(X)},{$$arity:0,$$s:h})}catch(Q){if(!r.rescue(Q,[t(v("I18n"),"InvalidLocale")]))throw Q;try{return $}finally{r.pop_exception()}}},{$$arity:1,$$s:s}),P(i["$key?"]("default"))&&P(i["$[]"]("default")["$nil?"]())?$:P(d)?R(s,M(s,"translate",m,!1,!0),"translate",[_,$,i.$merge(N(["default"],{default:d}))],null):s.$throw("exception",t(v("I18n"),"MissingTranslation").$new(_,c,i))):R(s,M(s,"translate",m,!1,!0),"translate",[_,c,i],n)}catch(u){if(u===r.returner)return u.$v;throw u}},-3),a(T,"$extract_non_symbol_default!",function(_){var i,c=$,n=$;return c=[_["$[]"]("default")].$flatten(),i=F(c,"detect",[],function(d){return null==d&&(d=$),d["$is_a?"](v("Symbol"))["$!"]()},1),P(i)&&(n=["default",c["$[]"](0,c.$index(i))],F(_,"[]=",S(n)),k(n.length,1)),i},1),a(T,"$exists?",function m(_,c,i){try{var n=m.$$p||$,s=this;return delete m.$$p,null==i&&(i=v("EMPTY_HASH")),P(i.$fetch("fallback",!0))?(F(v("I18n").$fallbacks()["$[]"](_),"each",[],function d(g){var u=null==d.$$s?this:d.$$s;null==g&&(g=$);try{if(!P(R(u,W(u,"exists?",d.$$def||m,!1,!1),"exists?",[g,c],null)))return $;r.ret(!0)}catch(p){if(!r.rescue(p,[t(v("I18n"),"InvalidLocale")]))throw p;try{return $}finally{r.pop_exception()}}},{$$arity:1,$$s:s}),!1):R(s,M(s,"exists?",m,!1,!0),"exists?",[_,c,i],n)}catch(d){if(d===r.returner)return d.$v;throw d}},-3),T.$private(),a(T,"$on_fallback",function(_,c,i,n){return $},4)}(o[0],o)},Opal.modules["bcdice/randomizer"]=function(r){var U,w,b,T,y,v,f,C,Y=[],$=r.nil,t=r.$$$,x=r.klass,P=r.const_set,H=r.def,a=r.truthy,F=r.rb_gt,S=r.rb_plus,k=r.rb_le,R=r.send,M=r.rb_minus,N=r.eqeq,W=r.rb_times,Z=r.eqeqeq,ne=r.rb_ge;return U=Y,f=[(0,r.module)(Y[0],"BCDice")].concat(U),C=r.$r(f),w=f,T=[b=x(f[0],null,"Randomizer")].concat(w),y=r.$r(T),(v=b.$$prototype).rand_results=v.detailed_rand_results=$,P(T[0],"UPPER_LIMIT_DICE_TIMES",200),P(T[0],"UPPER_LIMIT_DICE_SIDES",1e4),P(T[0],"UPPER_LIMIT_RANDS",1e4),H(b,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]},0),b.$attr_reader("rand_results"),b.$attr_reader("detailed_rand_results"),P(T[0],"DetailedRandResult",y("Struct").$new("kind","sides","value")),H(b,"$roll_barabara",function(_,c){var i=this;return a(F(S(i.rand_results.$size(),_),y("UPPER_LIMIT_RANDS")))&&i.$raise(y("TooManyRandsError")),a(k(_,0))||a(F(_,y("UPPER_LIMIT_DICE_TIMES")))?[]:R(y("Array"),"new",[_],function n(){return(null==n.$$s?this:n.$$s).$roll_once(c)},{$$arity:0,$$s:i})},2),H(b,"$roll_sum",function(_,c){return this.$roll_barabara(_,c).$sum()},2),H(b,"$roll_once",function(_){var i=$;return a(k(_,0))||a(F(_,y("UPPER_LIMIT_DICE_SIDES")))?0:(i=this.$rand_inner(_),this.$push_to_detail("normal",_,i),i)},1),H(b,"$roll_index",function(_){return M(this.$roll_once(_),1)},1),H(b,"$roll_tens_d10",function(){var i,c=$;return c=this.$rand_inner(10),N(c,10)&&(c=0),i=W(c,10),this.$push_to_detail("tens_d10",10,i),i},0),H(b,"$roll_d9",function(){var c;return c=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,c),c},0),H(b,"$roll_d66",function(_){var n,i=$;return i=R(y("Array"),"new",[2],function s(){return(null==s.$$s?this:s.$$s).$roll_once(6)},{$$arity:0,$$s:this}),Z(t(y("D66SortType"),"ASC"),n=_)?i["$sort!"]():Z(t(y("D66SortType"),"DESC"),n)&&i["$sort!"]()["$reverse!"](),S(W(i["$[]"](0),10),i["$[]"](1))},1),b.$private(),H(b,"$rand_inner",function(_){var i,c=this;return a(ne(c.rand_results.$size(),y("UPPER_LIMIT_RANDS")))&&c.$raise(y("TooManyRandsError")),i=c.$random(_),c.rand_results["$<<"]([i,_]),i},1),H(b,"$random",function(_){return S(y("Kernel").$rand(_),1)},1),H(b,"$push_to_detail",function(_,c,i){var s;return s=y("DetailedRandResult").$new(_,c,i),this.detailed_rand_results.$push(s)},3),x(f[0],C("StandardError"),"TooManyRandsError"),$},Opal.modules["bcdice/dice_table/roll_result"]=function(r){var a,R,ne,K,U,o,f,N,S,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.def,P=r.truthy;return a=Y,R=S=[t(Y[0],"BCDice")].concat(a),ne=N=[t(S[0],"DiceTable")].concat(R),U=[K=e(N[0],null,"RollResult")].concat(ne),o=r.$r(U),(f=K.$$prototype).table_name=f.value=f.body=$,x(K,"$initialize",function(I,j,w){var b=this;return b.table_name=I,b.value=j,b.body=w},3),K.$attr_reader("table_name"),K.$attr_reader("value"),K.$attr_reader("body"),x(K,"$to_s",function(){var I=this;return I.table_name+"("+I.value+") \uff1e "+I.body},0),x(K,"$last_body",function(){var I=this;return P(I.body["$is_a?"](o("RollResult")))?I.body.$last_body():I.body},0),x(K,"$empty?",function(){return!1},0)},Opal.modules["bcdice/dice_table/chain_table"]=function(r){var F,M,K,U,o,f,C,W,k,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.truthy,P=r.def,H=r.rb_minus;return F=Y,M=k=[t(Y[0],"BCDice")].concat(F),K=W=[t(k[0],"DiceTable")].concat(M),o=[U=e(W[0],null,"ChainTable")].concat(K),f=r.$r(o),(C=U.$$prototype).times=C.sides=C.items=C.name=$,P(U,"$initialize",function(j,w,b){var T=this,y=$;return T.name=j,T.items=b.$freeze(),y=/(\d+)D(\d+)/i.$match(w),x(y)||T.$raise(f("ArgumentError"),"Unexpected table type: "+w),T.times=y["$[]"](1).$to_i(),T.sides=y["$[]"](2).$to_i()},3),P(U,"$roll",function(j){var b,T,w=this,y=$;return b=j.$roll_sum(w.times,w.sides),T=H(b,w.times),y=w.items["$[]"](T),x(y["$respond_to?"]("roll"))&&(y=y.$roll(j)),f("RollResult").$new(w.name,b,y)},1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(r){var R,Z,f,C,I,j,w,K,N,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.hash2,P=r.defs,H=r.def,a=r.rb_plus,F=r.rb_times,S=r.rb_minus;return R=Y,Z=N=[t(Y[0],"BCDice")].concat(R),f=K=[t(N[0],"DiceTable")].concat(Z),I=[C=e(K[0],null,"D66GridTable")].concat(f),j=r.$r(I),(w=C.$$prototype).name=w.items=$,P(C,"$from_i18n",function(T,y){var m=$;return m=j("I18n").$t(T,x(["locale","raise"],{locale:y,raise:!0})),this.$new(m["$[]"]("name"),m["$[]"]("items"))},2),H(C,"$initialize",function(T,y){return this.name=T,this.items=y.$freeze()},2),H(C,"$roll",function(T){var v,m,_,c,i;return v=T.$roll_once(6),m=T.$roll_once(6),_=a(F(v,10),m),c=S(v,1),i=S(m,1),j("RollResult").$new(this.name,_,this.items["$[]"](c)["$[]"](i))},1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(r){var S,N,o,f,C,I,Z,ne,R,$=[],t=r.nil,e=r.module,x=r.klass,P=r.hash2,H=r.defs,a=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),S=$,N=R=[e($[0],"BCDice")].concat(S),Z=[e(R[0],"DiceTable")].concat(N),ne=r.$r(Z),o=Z,C=[f=x(Z[0],ne("D66GridTable"),"D66HalfGridTable")].concat(o),I=r.$r(C),H(f,"$from_i18n",function(w,b){var y=t;return y=I("I18n").$t(w,P(["locale","raise"],{locale:b,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2_3"),y["$[]"]("items_4_5_6"))},2),a(f,"$initialize",function(w,b,T){return this.name=w,this.items=[b,b,b,T,T,T].$freeze()},3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(r){var S,N,o,f,C,I,Z,ne,R,$=[],t=r.nil,e=r.module,x=r.klass,P=r.hash2,H=r.defs,a=r.def;return r.top.$require("bcdice/dice_table/d66_grid_table"),S=$,N=R=[e($[0],"BCDice")].concat(S),Z=[e(R[0],"DiceTable")].concat(N),ne=r.$r(Z),o=Z,C=[f=x(Z[0],ne("D66GridTable"),"D66OneThirdTable")].concat(o),I=r.$r(C),H(f,"$from_i18n",function(w,b){var y=t;return y=I("I18n").$t(w,P(["locale","raise"],{locale:b,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2"),y["$[]"]("items_3_4"),y["$[]"]("items_5_6"))},2),a(f,"$initialize",function(w,b,T,y){return this.name=w,this.items=[b,b,T,T,y,y].$freeze()},4)},Opal.modules["bcdice/dice_table/d66_table"]=function(r){var N,K,I,j,w,b,T,o,Z,Y=[],$=r.nil,t=r.$$$,e=r.module,x=r.klass,P=r.hash2,H=r.defs,a=r.def,F=r.eqeqeq,S=r.rb_plus,k=r.rb_times,R=r.truthy;return N=Y,K=Z=[e(Y[0],"BCDice")].concat(N),I=o=[e(Z[0],"DiceTable")].concat(K),w=[j=x(o[0],null,"D66Table")].concat(I),b=r.$r(w),(T=j.$$prototype).sort_type=T.items=T.name=$,H(j,"$from_i18n",function(v,m){var i,c=$;return c=b("I18n").$t(v,P(["locale"],{locale:m})),i=b("D66SortType").$const_get(c["$[]"]("d66_sort_type")),this.$new(c["$[]"]("name"),i,c["$[]"]("items"))},2),a(j,"$initialize",function(v,m,_){var c=this;return c.name=v,c.sort_type=m,c.items=_.$freeze()},3),a(j,"$roll",function(v){var m=this,_=$,c=$,i=$,n=$;return _=v.$roll_barabara(2,6),F(t(b("D66SortType"),"ASC"),c=m.sort_type)?_["$sort!"]():F(t(b("D66SortType"),"DESC"),c)&&_["$sort!"]()["$reverse!"](),i=S(k(_["$[]"](0),10),_["$[]"](1)),n=R(c=m.items["$[]"](i))?c:m.items["$[]"](i.$to_s()),R(n["$respond_to?"]("roll"))&&(n=n.$roll(v)),b("RollResult").$new(m.name,i,n)},1),a(j,"$choice",function(v){return b("RollResult").$new(this.name,v,this.items["$[]"](v))},1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(r){var ne,f,I,j,U,$=[],t=r.nil,e=r.module,x=r.klass,P=r.hash2,H=r.send,a=r.to_ary,F=r.rb_plus,S=r.rb_times,k=r.to_a,R=r.rb_minus,M=r.send2,N=r.find_super,W=r.def;return r.top.$require("bcdice/dice_table/d66_table"),ne=$,f=U=[e($[0],"BCDice")].concat(ne),I=[e(U[0],"DiceTable")].concat(f),j=r.$r(I),W(x(I[0],j("D66Table"),"D66LeftRangeTable"),"$initialize",function y(v,m,_){var n;return delete y.$$p,n=P([],{}),H(_,"each",[],function(d){var g,h;return null==d&&(d=t),g=a(d),h=null==g[1]?t:g[1],H(null==g[0]?t:g[0],"each",[],function(l){return null==l&&(l=t),H(h,"each_with_index",[],function(z,$e){var ue,_e;return null==z&&(z=t),null==$e&&($e=t),ue=F(S(l,10),F($e,1)),H(n,"[]=",k(_e=[ue,z])),_e[R(_e.length,1)]},2)},1)},1),M(this,N(this,"initialize",y,!1,!0),"initialize",[v,m,n],null)},3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(r){var M,ne,C,I,j,w,b,U,W,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.hash2,P=r.defs,H=r.def,a=r.truthy,F=r.rb_minus,S=r.rb_plus,k=r.rb_times;return M=Y,ne=W=[t(Y[0],"BCDice")].concat(M),C=U=[t(W[0],"DiceTable")].concat(ne),j=[I=e(U[0],null,"D66ParityTable")].concat(C),w=r.$r(j),(b=I.$$prototype).odd=b.even=b.name=$,P(I,"$from_i18n",function(y,v){var _=$;return _=w("I18n").$t(y,x(["locale","raise"],{locale:v,raise:!0})),this.$new(_["$[]"]("name"),_["$[]"]("odd"),_["$[]"]("even"))},2),H(I,"$initialize",function(y,v,m){var _=this;return _.name=y,_.odd=v.$freeze(),_.even=m.$freeze()},3),H(I,"$roll",function(y){var _,i,n,v=this,m=$;return m=y.$roll_once(6),_=y.$roll_once(6),i=(a(m["$odd?"]())?v.odd:v.even)["$[]"](F(_,1)),n=S(k(m,10),_),w("RollResult").$new(v.name,n,i)},1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(r){var S,N,U,o,f,C,I,Z,R,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.def,P=r.rb_plus,H=r.rb_times,a=r.send;return S=Y,N=R=[t(Y[0],"BCDice")].concat(S),U=Z=[t(R[0],"DiceTable")].concat(N),f=[o=e(Z[0],null,"D66RangeTable")].concat(U),C=r.$r(f),(I=o.$$prototype).items=I.name=$,x(o,"$initialize",function(w,b){return this.name=w,this.items=b.$freeze()},2),x(o,"$roll",function(w){var T,y,v,m=$;return T=w.$roll_once(6),y=w.$roll_once(6),v=P(H(T,10),y),m=a(this.items,"find",[],function(c){return null==c&&(c=$),c["$[]"](0)["$include?"](v)},1),C("RollResult").$new(this.name,v,m["$[]"](1))},1)},Opal.modules["bcdice/dice_table/range_table"]=function(r){var W,U,j,w,b,T,y,f,ne,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.const_set,P=r.send,H=r.truthy,a=r.def,F=r.to_a,S=r.rb_minus,k=r.eqeqeq,R=r.rb_times,M=r.rb_plus;return W=Y,U=ne=[t(Y[0],"BCDice")].concat(W),j=f=[t(ne[0],"DiceTable")].concat(U),b=[w=e(f[0],null,"RangeTable")].concat(j),T=r.$r(b),(y=w.$$prototype).name=y.items=y.num_of_dice=y.num_of_sides=y.formatter=$,x(b[0],"RollResult",P(T("Struct"),"new",["sum","values","content","formatted"],function v(){return(null==v.$$s?this:v.$$s).$alias_method("to_s","formatted")},{$$arity:0,$$s:w})),x(b[0],"Item",T("Struct").$new("range","content")),x(b[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),x(b[0],"DEFAULT_FORMATTER",P(w,"lambda",[],function(m,_){return null==m&&(m=$),null==_&&(_=$),m.$name()+"("+_.$sum()+") \uff1e "+_.$content()},2)),w.$attr_reader("name"),w.$attr_reader("num_of_dice"),w.$attr_reader("num_of_sides"),a(w,"$initialize",function v(m,_,c){var s,i=v.$$p||$,n=this,d=$;return delete v.$$p,n.name=m.$freeze(),n.formatter=H(s=i)?s:T("DEFAULT_FORMATTER"),d=T("DICE_ROLL_METHOD_RE").$match(_),H(d)||n.$raise(T("ArgumentError"),n.name+": invalid dice roll method: "+_),n.num_of_dice=d["$[]"](1).$to_i(),n.num_of_sides=d["$[]"](2).$to_i(),n.$store(c)},3),a(w,"$fetch",function(m){var c,_=this;return c=P(_.items,"find",[],function(n){return null==n&&(n=$),n.$range()["$include?"](m)},1),H(c)||_.$raise(T("RangeError"),_.name+": value is out of range: "+m),c},1),a(w,"$roll",function(m){var i,n,s,_=this,c=$;return i=(c=m.$roll_barabara(_.num_of_dice,_.num_of_sides)).$sum(),n=T("RollResult").$new(i,c,_.$fetch(i).$content()),s=[_.formatter["$[]"](_,n)],P(n,"formatted=",F(s)),S(s.length,1),n},1),w.$private(),a(w,"$store",function(m){var c,i,_=this;return c=P(m,"map",[],function n(s,d){return null==s&&(s=$),null==d&&(d=$),[(null==n.$$s?this:n.$$s).$coerce_to_int_range(s),d]},{$$arity:2,$$s:_}),i=P(c,"sort_by",[],function(s,d){return null==s&&(s=$),null==d&&(d=$),s.$min()},2),_.$assert_min_sum_is_covered(i),_.$assert_max_sum_is_covered(i),_.$assert_no_gap_or_overlap_in_ranges(i),_.items=P(i,"map",[],function(s,d){return null==s&&(s=$),null==d&&(d=$),T("Item").$new(s,d.$freeze()).$freeze()},2).$freeze(),_},1),a(w,"$coerce_to_int_range",function(m){var c;return k(T("Integer"),c=m)?T("Range").$new(m,m):k(T("Range"),c)&&H(m.$begin()["$is_a?"](T("Integer")))&&H(m.$end()["$is_a?"](T("Integer")))?m:this.$raise(T("TypeError"),this.name+": "+m+" ("+m.$class()+") must be an Integer or a Range with Integers ")},1),a(w,"$assert_min_sum_is_covered",function(m){var c,_=this,i=$;return c=_.num_of_dice,i=m.$first()["$[]"](0),H(i["$include?"](c))||_.$raise(T("RangeError"),_.name+": min value ("+c+") is not covered: "+i),_},1),a(w,"$assert_max_sum_is_covered",function(m){var c,_=this,i=$;return c=R(_.num_of_dice,_.num_of_sides),i=m.$last()["$[]"](0),H(i["$include?"](c))||_.$raise(T("RangeError"),_.name+": max value ("+c+") is not covered: "+i),_},1),a(w,"$assert_no_gap_or_overlap_in_ranges",function(m){return P(m,"each_cons",[2],function c(i,n){var u,p,s=null==c.$$s?this:c.$$s,d=$,g=$;return null==s.name&&(s.name=$),null==i&&(i=$),null==n&&(n=$),d=i["$[]"](0),g=n["$[]"](0),u=d.$max(),p=M(u,1),H(g["$include?"](u))&&s.$raise(T("RangeError"),s.name+": Range overlap: "+d+" and "+g),H(g["$include?"](p))?$:s.$raise(T("RangeError"),s.name+": Range gap: "+d+" and "+g)},{$$arity:2,$$s:this}),this},1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(r){var S,N,U,j,w,b,T,f,Z,R,Y=[],$=r.nil,t=r.$$$,e=r.module,x=r.klass,P=r.send,H=r.def,a=r.rb_minus;return S=Y,N=R=[e(Y[0],"BCDice")].concat(S),U=Z=[e(R[0],"DiceTable")].concat(N),j=f=[x(Z[0],null,"SaiFicSkillTable")].concat(U),b=[w=x(f[0],null,"Category")].concat(j),T=r.$r(b),w.$$prototype.name=$,H(w,"$initialize",function(m,_,c,i){var n=this;return n.name=m,n.skills=P(_.$map(),"with_index",[2],function(d,g){return null==d&&(d=$),null==g&&(g=$),t(T("SaiFicSkillTable"),"Skill").$new(m,d,c,g,i)},2),n.dice=c},4),H(w,"$roll",function(m){return this.$skills()["$[]"](a(m.$roll_sum(2,6),2))},1),H(w,"$to_s",function(){return this.name},0),w.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(r){var a,R,ne,C,I,U,N,S,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.def,P=r.hash2;return a=Y,R=S=[t(Y[0],"BCDice")].concat(a),ne=N=[t(S[0],"DiceTable")].concat(R),U=[e(N[0],null,"SaiFicSkillTable")].concat(ne),(I=(C=e(U[0],null,"Skill")).$$prototype).s_format=I.category_dice=I.row_dice=I.category_name=I.name=$,x(C,"$initialize",function(w,b,T,y,v){var m=this;return m.category_name=w,m.name=b,m.category_dice=T,m.row_dice=y,m.s_format=v},5),x(C,"$to_s",function(){var w=this;return w.$format(w.s_format,P(["category_dice","row_dice","category_name","skill_name"],{category_dice:w.category_dice,row_dice:w.row_dice,category_name:w.category_name,skill_name:w.name}))},0),C.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(r){var K,C,T,y,v,m,_,j,o,Y=r.top,$=[],t=r.nil,e=r.$$$,x=r.module,P=r.klass,H=r.hash2,a=r.send,S=r.defs,k=r.const_set,R=r.to_ary,M=r.def,N=r.truthy,W=r.rb_minus,Z=r.rb_plus;return Y.$require("bcdice/dice_table/sai_fic_skill_table/category"),Y.$require("bcdice/dice_table/sai_fic_skill_table/skill"),K=$,C=o=[x($[0],"BCDice")].concat(K),T=j=[x(o[0],"DiceTable")].concat(C),v=[y=P(j[0],null,"SaiFicSkillTable")].concat(T),m=r.$r(v),(_=y.$$prototype).rtt=_.rtt_format=_.rct=_.rct_format=_.rttn=_.rttn_format=_.categories=t,S(y,"$from_i18n",function(i,n,s){var d,g,u,l,Q=t;if(null==s)s=H([],{});else if(!s.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(d=s.$$smap.rtt)&&(d=t),null==(g=s.$$smap.rct)&&(g=t),null==(u=s.$$smap.rttn)&&(u=t),l=(Q=m("I18n").$t("RTT",H(["locale","raise","default"],{locale:n,raise:!1,default:H([],{})})).$merge(m("I18n").$t(i,H(["locale","raise"],{locale:n,raise:!0}))))["$[]"]("items"),Q=a(Q,"select",[],function(z,$e){return null==z&&(z=t),null==$e&&($e=t),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](z)},2),this.$new(l,r.to_hash(Q).$merge(H(["rtt","rct","rttn"],{rtt:d,rct:g,rttn:u})))},-3),k(v[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),k(v[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),k(v[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),k(v[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(y,"$initialize",function(i,n){var s,d,g,u,p,h,Q,l=this;if(null==n)n=H([],{});else if(!n.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(s=n.$$smap.rtt)&&(s=t),null==(d=n.$$smap.rct)&&(d=t),null==(g=n.$$smap.rttn)&&(g=t),null==(u=n.$$smap.rtt_format)&&(u=m("DEFAULT_RTT")),null==(p=n.$$smap.rct_format)&&(p=m("DEFAULT_RCT")),null==(h=n.$$smap.rttn_format)&&(h=m("DEFAULT_RTTN")),null==(Q=n.$$smap.s_format)&&(Q=m("DEFAULT_S")),l.categories=a(i.$map(),"with_index",[1],function(z,$e){var ue,fe,le;return null==z&&(z=t),null==$e&&($e=t),fe=null==(ue=R(z))[0]?t:ue[0],le=null==ue[1]?t:ue[1],e(m("SaiFicSkillTable"),"Category").$new(fe,le,$e,Q)},{$$arity:2,$$has_top_level_mlhs_arg:!0}),l.rtt=s,l.rct=d,l.rttn=g.$to_a(),l.rtt_format=u,l.rct_format=p,l.rttn_format=h},-2),k(v[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),M(y,"$roll_command",function(i,n){var d,s=this,g=t,u=t;return N(["RTT",s.rtt]["$include?"](d=n))?s.$format_skill(s.rtt_format,s.$roll_skill(i)):N(["RCT",s.rct]["$include?"](d))?(g=s.$roll_category(i),s.$format(s.rct_format,H(["category_dice","category_name"],{category_dice:g.$dice(),category_name:g.$name()}))):N(u=m("RTTN").$index(d))||N(u=s.rttn.$index(d))?s.$format_skill(s.rttn_format,s.categories["$[]"](u).$roll(i)):t},2),M(y,"$roll_category",function(i){return this.categories["$[]"](W(i.$roll_once(6),1))},1),M(y,"$roll_skill",function(i){return this.$roll_category(i).$roll(i)},1),M(y,"$prefixes",function(){var i=this;return Z(["RTT[1-6]?","RCT",i.rtt,i.rct],i.rttn).$compact()},0),y.$private(),M(y,"$format_skill",function(i,n){return this.$format(i,H(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:n.$category_dice(),row_dice:n.$row_dice(),category_name:n.$category_name(),skill_name:n.$name(),text:n.$to_s()}))},2)},Opal.modules["bcdice/dice_table/table"]=function(r){var k,W,o,f,C,I,j,ne,M,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.hash2,P=r.defs,H=r.truthy,a=r.def,F=r.rb_minus;return k=Y,W=M=[t(Y[0],"BCDice")].concat(k),o=ne=[t(M[0],"DiceTable")].concat(W),C=[f=e(ne[0],null,"Table")].concat(o),I=r.$r(C),(j=f.$$prototype).times=j.sides=j.name=j.items=$,P(f,"$from_i18n",function(b,T){var v=$;return v=I("I18n").$t(b,x(["locale"],{locale:T})),this.$new(v["$[]"]("name"),v["$[]"]("type"),v["$[]"]("items"))},2),a(f,"$initialize",function(b,T,y){var v=this,m=$;return v.name=b,v.items=y.$freeze(),m=/(\d+)D(\d+)/i.$match(T),H(m)||v.$raise(I("ArgumentError"),"Unexpected table type: "+T),v.times=m["$[]"](1).$to_i(),v.sides=m["$[]"](2).$to_i()},3),a(f,"$roll",function(b){var y,T=this;return y=b.$roll_sum(T.times,T.sides),T.$choice(y)},1),a(f,"$choice",function(b){var y,T=this;return y=F(b,T.times),I("RollResult").$new(T.name,b,T.items["$[]"](y))},1)},Opal.modules["bcdice/dice_table"]=function(r){var Y=r.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(r){var P,S,R,a,Y=[],t=r.module,e=r.const_set;return P=Y,S=a=[t(Y[0],"BCDice")].concat(P),R=[t(a[0],"D66SortType")].concat(S),e(R[0],"NO_SORT","no_sort"),e(R[0],"ASC","asc"),e(R[0],"DESC","desc"),function(F,S){var R=[t(F,"RoundType")].concat(S);return e(R[0],"CEIL","ceil"),e(R[0],"FLOOR","floor"),e(R[0],"ROUND","round")}(a[0],a)},Opal.modules["bcdice/translate"]=function(r){var a,R,M,N,W,S,Y=[],$=r.nil,t=r.module,e=r.hash2,P=r.def;return a=Y,R=S=[t(Y[0],"BCDice")].concat(a),N=[M=t(S[0],"Translate")].concat(R),W=r.$r(N),P(M,"$translate",function(ne,K){var U,o=this;if(null==o.locale&&(o.locale=$),null==K)K=e([],{});else if(!K.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return U=r.kwrestargs(K,{}),W("I18n").$translate(ne,e(["locale","raise"],{locale:o.locale,raise:!0}).$merge(r.to_hash(U)))},-2)},Opal.modules["bcdice/result"]=function(r){var S,W,U,Z,K,R,Y=[],$=r.nil,e=r.klass,x=r.send,P=r.to_a,H=r.rb_minus,a=r.def;return S=Y,W=R=[(0,r.module)(Y[0],"BCDice")].concat(S),[Z=e(R[0],null,"Result")].concat(W),(K=Z.$$prototype).secret=K.success=K.failure=K.critical=K.fumble=$,a(U=r.get_singleton_class(Z),"$success",function(C){return x(this.$new(),"tap",[],function(w){var b=$;return null==w&&(w=$),x(w,"text=",P(b=[C])),H(b.length,1),x(w,"success=",P(b=[!0])),b[H(b.length,1)]},1)},1),a(U,"$failure",function(C){return x(this.$new(),"tap",[],function(w){var b=$;return null==w&&(w=$),x(w,"text=",P(b=[C])),H(b.length,1),x(w,"failure=",P(b=[!0])),b[H(b.length,1)]},1)},1),a(U,"$critical",function(C){return x(this.$new(),"tap",[],function(w){var b=$;return null==w&&(w=$),x(w,"text=",P(b=[C])),H(b.length,1),x(w,"critical=",P(b=[!0])),H(b.length,1),x(w,"success=",P(b=[!0])),b[H(b.length,1)]},1)},1),a(U,"$fumble",function(C){return x(this.$new(),"tap",[],function(w){var b=$;return null==w&&(w=$),x(w,"text=",P(b=[C])),H(b.length,1),x(w,"fumble=",P(b=[!0])),H(b.length,1),x(w,"failure=",P(b=[!0])),b[H(b.length,1)]},1)},1),a(U,"$nothing",function(){return"nothing"},0),a(Z,"$initialize",function(o){var f=this;return null==o&&(o=$),f.text=o,f.rands=$,f.detailed_rands=$,f.secret=!1,f.success=!1,f.failure=!1,f.critical=!1,f.fumble=!1},-1),Z.$attr_accessor("text","rands","detailed_rands"),Z.$attr_writer("secret","success","failure","critical","fumble"),a(Z,"$secret?",function(){return this.secret},0),a(Z,"$success?",function(){return this.success},0),a(Z,"$failure?",function(){return this.failure},0),a(Z,"$critical?",function(){return this.critical},0),a(Z,"$fumble?",function(){return this.fumble},0),a(Z,"$condition=",function(o){return this.success=o,this.failure=o["$!"]()},1)},Opal.modules["racc/parser"]=function(r){var T,v,m,$=[],t=r.$r($),e=r.nil,x=r.$$$,P=r.module,H=r.klass,a=r.truthy,F=r.const_set,S=r.defs,k=r.gvars,R=r.rb_lt,M=r.send,N=r.to_a,W=r.rb_minus,Z=r.def,ne=r.to_ary,K=r.neqeq,U=r.rb_plus,o=r.eqeq,f=r.rb_ge,C=r.rb_gt,I=r.eqeqeq,j=r.rb_le,w=r.rb_times;return T=$,v=[P($[0],"Racc")].concat(T),m=r.$r(v),H(v[0],m("StandardError"),"ParseError"),a(x("::","ParseError","skip_raise")?"constant":e)||F($[0],"ParseError",x(t("Racc"),"ParseError")),function(b,T){var n,s,d,g,u,m=[P(b,"Racc")].concat(T),_=r.$r(m);return a(_("Racc_No_Extensions","skip_raise")?"constant":e)||F(m[0],"Racc_No_Extensions",!1),n=m,d=[s=H(m[0],null,"Parser")].concat(n),g=r.$r(d),(u=s.$$prototype).yydebug=u.racc_debug_out=u.racc_error_status=u.racc_t=u.racc_vstack=u.racc_val=u.racc_state=u.racc_tstack=e,F(d[0],"Racc_Runtime_Version","1.4.6"),F(d[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),F(d[0],"Racc_Runtime_Core_Version_R","1.4.6"),F(d[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),F(d[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),F(d[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),F(d[0],"Racc_Runtime_Core_Version",g("Racc_Runtime_Core_Version_R")),F(d[0],"Racc_Runtime_Core_Revision",g("Racc_Runtime_Core_Revision_R")),F(d[0],"Racc_Runtime_Type","ruby"),S(g("Parser"),"$racc_runtime_type",function(){return g("Racc_Runtime_Type")},0),Z(s,"$_racc_setup",function(){var h,Q,l=this,X=e,z=e,$e=e;return null==k.stderr&&(k.stderr=e),a(x(l.$class(),"Racc_debug_parser"))||(l.yydebug=!1),a(null!=(h=l.yydebug)&&h!==e?"instance-variable":e)||(l.yydebug=!1),a(l.yydebug)&&(a(null!=(Q=l.racc_debug_out)&&Q!==e?"instance-variable":e)||(l.racc_debug_out=k.stderr),l.racc_debug_out=a(X=l.racc_debug_out)?X:k.stderr),z=x(l.$class(),"Racc_arg"),a(R(z.$size(),14))&&(M(z,"[]=",N($e=[13,!0])),W($e.length,1)),z},0),Z(s,"$_racc_init_sysvars",function(){var h=this;return h.racc_state=[0],h.racc_tstack=[],h.racc_vstack=[],h.racc_t=e,h.racc_val=e,h.racc_read_next=!0,h.racc_user_yyerror=!1,h.racc_error_status=0},0),Z(s,"$do_parse",function(){return this.$__send__(g("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},0),Z(s,"$next_token",function(){return this.$raise(g("NotImplementedError"),this.$class()+"#next_token is not defined")},0),Z(s,"$_racc_do_parse_rb",function(h,Q){var l,z=this,$e=e,ue=e,_e=e,fe=e,te=e,A=e,J=e,B=e;return l=ne(h),$e=null==l[0]?e:l[0],ue=null==l[1]?e:l[1],_e=null==l[2]?e:l[2],fe=null==l[3]?e:l[3],te=null==l[10]?e:l[10],z.$_racc_init_sysvars(),A=J=B=e,M(z,"catch",["racc_end_parse"],function D(){var re,L,V=null==D.$$s?this:D.$$s,E=e;for(null==V.racc_state&&(V.racc_state=e),null==V.racc_read_next&&(V.racc_read_next=e),null==V.racc_t&&(V.racc_t=e),null==V.yydebug&&(V.yydebug=e),null==V.racc_val&&(V.racc_val=e);a(!0);)for(a(B=fe["$[]"](V.racc_state["$[]"](-1)))?(a(V.racc_read_next)&&K(V.racc_t,0)&&(L=V.$next_token(),re=ne(L),A=null==re[0]?e:re[0],V.racc_val=null==re[1]?e:re[1],V.racc_t=a(A)?a(E=te["$[]"](A))?E:1:0,a(V.yydebug)&&V.$racc_read_token(V.racc_t,A,V.racc_val),V.racc_read_next=!1),B=U(B,V.racc_t),a(f(B,0))&&a(J=$e["$[]"](B))&&o(ue["$[]"](B),V.racc_state["$[]"](-1))||(J=_e["$[]"](V.racc_state["$[]"](-1)))):J=_e["$[]"](V.racc_state["$[]"](-1));a(J=V.$_racc_evalact(J,h)););},{$$arity:0,$$s:z})},2),Z(s,"$yyparse",function(h,Q){return this.$__send__(g("Racc_YY_Parse_Method"),h,Q,this.$_racc_setup(),!0)},2),Z(s,"$_racc_yyparse_rb",function(h,Q,l,X){var z,_e=e,fe=e,le=e,te=e,J=e,B=e,D=e;return z=ne(l),_e=null==z[0]?e:z[0],fe=null==z[1]?e:z[1],le=null==z[2]?e:z[2],te=null==z[3]?e:z[3],J=null==z[10]?e:z[10],this.$_racc_init_sysvars(),B=e,D=e,M(this,"catch",["racc_end_parse"],function se(){var V=null==se.$$s?this:se.$$s;for(null==V.racc_state&&(V.racc_state=e);!a(D=te["$[]"](V.racc_state["$[]"](-1)));)for(;a(B=V.$_racc_evalact(le["$[]"](V.racc_state["$[]"](-1)),l)););return M(h,"__send__",[Q],function E(q,ie){var ee=null==E.$$s?this:E.$$s,G=e,ae=e;for(null==ee.racc_t&&(ee.racc_t=e),null==ee.racc_state&&(ee.racc_state=e),null==ee.racc_read_next&&(ee.racc_read_next=e),null==q&&(q=e),null==ie&&(ie=e),ee.racc_t=a(q)?a(G=J["$[]"](q))?G:1:0,ee.racc_val=ie,ee.racc_read_next=!1,D=U(D,ee.racc_t),a(f(D,0))&&a(B=_e["$[]"](D))&&o(fe["$[]"](D),ee.racc_state["$[]"](-1))||(B=le["$[]"](ee.racc_state["$[]"](-1)));a(B=ee.$_racc_evalact(B,l)););for(;a(a(G=a(ae=(D=te["$[]"](ee.racc_state["$[]"](-1)))["$!"]())?ae:ee.racc_read_next["$!"]())?G:ee.racc_t["$=="](0));)for(a(D)&&a(D=U(D,ee.racc_t))&&a(f(D,0))&&a(B=_e["$[]"](D))&&o(fe["$[]"](D),ee.racc_state["$[]"](-1))||(B=le["$[]"](ee.racc_state["$[]"](-1)));a(B=ee.$_racc_evalact(B,l)););},{$$arity:2,$$s:V})},{$$arity:0,$$s:this})},4),Z(s,"$_racc_evalact",function(h,Q){var l,le,z=this,$e=e,ue=e,fe=e,te=e,A=e,J=e,B=e;if($e=null==(l=ne(Q))[0]?e:l[0],ue=null==l[1]?e:l[1],fe=null==l[3]?e:l[3],le=null==l[11]?e:l[11],te=null==l[12]?e:l[12],a(C(h,0))&&a(R(h,le)))a(C(z.racc_error_status,0))&&(o(z.racc_t,1)||(z.racc_error_status=W(z.racc_error_status,1))),z.racc_vstack.$push(z.racc_val),z.racc_state.$push(h),z.racc_read_next=!0,a(z.yydebug)&&(z.racc_tstack.$push(z.racc_t),z.$racc_shift(z.racc_t,z.racc_tstack,z.racc_vstack));else if(a(R(h,0))&&a(C(h,te["$-@"]()))){if(A=M(z,"catch",["racc_jump"],function D(){var se=null==D.$$s?this:D.$$s;return null==se.racc_state&&(se.racc_state=e),se.racc_state.$push(se.$_racc_do_reduce(Q,h)),!1},{$$arity:0,$$s:z}),a(A)){if(I(1,J=A))return z.racc_user_yyerror=!0,te["$-@"]();if(I(2,J))return le;z.$raise("[Racc Bug] unknown jump code")}}else if(o(h,le))a(z.yydebug)&&z.$racc_accept(),z.$throw("racc_end_parse",z.racc_vstack["$[]"](0));else{if(o(h,te["$-@"]())){for(I(0,J=z.racc_error_status)?a(Q["$[]"](21))||z.$on_error(z.racc_t,z.racc_val,z.racc_vstack):I(3,J)&&(o(z.racc_t,0)&&z.$throw("racc_end_parse",e),z.racc_read_next=!0),z.racc_user_yyerror=!1,z.racc_error_status=3;a(!0)&&!(a(B=fe["$[]"](z.racc_state["$[]"](-1)))&&(B=U(B,1),a(f(B,0))&&a(h=$e["$[]"](B))&&o(ue["$[]"](B),z.racc_state["$[]"](-1))));)a(j(z.racc_state.$size(),1))&&z.$throw("racc_end_parse",e),z.racc_state.$pop(),z.racc_vstack.$pop(),a(z.yydebug)&&(z.racc_tstack.$pop(),z.$racc_e_pop(z.racc_state,z.racc_tstack,z.racc_vstack));return h}z.$raise("[Racc Bug] unknown action "+h.$inspect())}return a(z.yydebug)&&z.$racc_next_state(z.racc_state["$[]"](-1),z.racc_state),e},2),Z(s,"$_racc_do_reduce",function(h,Q){var l,te,J,V,E,q,ee,z=this,ue=e,_e=e,fe=e,le=e,A=e,B=e,D=e,se=e,re=e,L=e,ie=e,ce=e,O=e,G=e;return ue=null==(l=ne(h))[4]?e:l[4],_e=null==l[5]?e:l[5],fe=null==l[6]?e:l[6],le=null==l[7]?e:l[7],te=null==l[8]?e:l[8],A=null==l[9]?e:l[9],J=null==l[13]?e:l[13],B=z.racc_state,D=z.racc_vstack,se=z.racc_tstack,re=w(Q,-3),L=A["$[]"](re),V=A["$[]"](U(re,1)),E=A["$[]"](U(re,2)),q=[],a(z.yydebug)&&(ie=se["$[]"](L["$-@"](),L)),ce=D["$[]"](L["$-@"](),L),a(z.yydebug)&&(O=[L["$-@"](),L,q],M(se,"[]=",N(O)),W(O.length,1)),O=[L["$-@"](),L,q],M(D,"[]=",N(O)),W(O.length,1),O=[L["$-@"](),L,q],M(B,"[]=",N(O)),W(O.length,1),a(J)?D.$push(z.$__send__(E,ce,D,ce["$[]"](0))):D.$push(z.$__send__(E,ce,D)),se.$push(V),a(z.yydebug)&&z.$racc_reduce(ie,V,se,D),ee=W(V,te),a(re=le["$[]"](ee))&&(re=U(re,B["$[]"](-1)),a(f(re,0))&&a(G=ue["$[]"](re))&&o(_e["$[]"](re),ee))?G:fe["$[]"](ee)},2),Z(s,"$on_error",function(h,Q,l){var z,X=this;return X.$raise(g("ParseError"),X.$sprintf("\nparse error on value %s (%s)",Q.$inspect(),a(z=X.$token_to_str(h))?z:"?"))},3),Z(s,"$yyerror",function(){return this.$throw("racc_jump",1)},0),Z(s,"$yyaccept",function(){return this.$throw("racc_jump",2)},0),Z(s,"$yyerrok",function(){return this.racc_error_status=0},0),Z(s,"$racc_read_token",function(h,Q,l){var X=this;return X.racc_debug_out.$print("read    "),X.racc_debug_out.$print(Q.$inspect(),"(",X.$racc_token2str(h),") "),X.racc_debug_out.$puts(l.$inspect()),X.racc_debug_out.$puts()},3),Z(s,"$racc_shift",function(h,Q,l){var X=this;return X.racc_debug_out.$puts("shift   "+X.$racc_token2str(h)),X.$racc_print_stacks(Q,l),X.racc_debug_out.$puts()},3),Z(s,"$racc_reduce",function(h,Q,l,X){var z=this,$e=e;return($e=z.racc_debug_out).$print("reduce "),a(h["$empty?"]())?$e.$print(" <none>"):M(h,"each",[],function ue(_e){return null==_e&&(_e=e),$e.$print(" ",(null==ue.$$s?this:ue.$$s).$racc_token2str(_e))},{$$arity:1,$$s:z}),$e.$puts(" --\x3e "+z.$racc_token2str(Q)),z.$racc_print_stacks(l,X),z.racc_debug_out.$puts()},4),Z(s,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},0),Z(s,"$racc_e_pop",function(h,Q,l){var X=this;return X.racc_debug_out.$puts("error recovering mode: pop token"),X.$racc_print_states(h),X.$racc_print_stacks(Q,l),X.racc_debug_out.$puts()},3),Z(s,"$racc_next_state",function(h,Q){var l=this;return l.racc_debug_out.$puts("goto    "+h),l.$racc_print_states(Q),l.racc_debug_out.$puts()},2),Z(s,"$racc_print_stacks",function(h,Q){var X=e;return(X=this.racc_debug_out).$print("        ["),M(h,"each_index",[],function z($e){return null==$e&&($e=e),X.$print(" (",(null==z.$$s?this:z.$$s).$racc_token2str(h["$[]"]($e))," ",Q["$[]"]($e).$inspect(),")")},{$$arity:1,$$s:this}),X.$puts(" ]")},2),Z(s,"$racc_print_states",function(h){var l=e;return(l=this.racc_debug_out).$print("        ["),M(h,"each",[],function(z){return null==z&&(z=e),l.$print(" ",z)},1),l.$puts(" ]")},1),Z(s,"$racc_token2str",function(h){var l;return a(l=x(this.$class(),"Racc_token_to_s_table")["$[]"](h))?l:this.$raise("[Racc Bug] can't convert token "+h+" to string")},1),Z(s,"$token_to_str",function(h){return x(this.$class(),"Racc_token_to_s_table")["$[]"](h)},1)}($[0],$)},Opal.modules["bcdice/arithmetic/node"]=function(r){var Z,o,j,m,_,b,T,C,K,Y=[],$=r.nil,t=r.$$$,e=r.module,x=r.klass,P=r.def,H=r.send2,a=r.find_super,F=r.eqeq,S=r.const_set,k=r.eqeqeq,R=r.rb_divide,M=r.truthy,N=r.alias;return Z=Y,o=K=[e(Y[0],"BCDice")].concat(Z),j=C=[e(K[0],"Arithmetic")].concat(o),b=[e(C[0],"Node")].concat(j),T=r.$r(b),(_=(m=x(b[0],null,"BinaryOp")).$$prototype).lhs=_.rhs=_.op=$,P(m,"$initialize",function(i,n,s){var d=this;return d.lhs=i,d.op=n,d.rhs=s},3),P(m,"$eval",function(i){var d,n=this,s=$;return s=n.lhs.$eval(i),d=n.rhs.$eval(i),s.$send(n.op,d)},1),P(m,"$output",function(){var i=this;return""+i.lhs.$output()+i.op+i.rhs.$output()},0),P(m,"$s_exp",function(){var i=this;return"("+i.$op_for_s_exp()+" "+i.lhs.$s_exp()+" "+i.rhs.$s_exp()+")"},0),P(m,"$op_for_s_exp",function(){return this.op},0),function(y,v,m){var _=x(y,v,"DivideBase"),c=[_].concat(m),i=r.$r(c),n=_.$$prototype;n.lhs=n.rhs=n.op=$,P(_,"$initialize",function s(d,g){return delete s.$$p,H(this,a(this,"initialize",s,!1,!0),"initialize",[d,"/",g],null)},2),P(_,"$eval",function(d){var u,p,g=this;return u=g.lhs.$eval(d),p=g.rhs.$eval(d),F(p,0)&&g.$raise(i("ZeroDivisionError")),g.$divide_and_round(u,p,d)},1),P(_,"$output",function s(){var d=s.$$p||$,g=this;return delete s.$$p,""+H(g,a(g,"output",s,!1,!0),"output",[],d)+g.$rounding_method()},0),_.$private(),P(_,"$rounding_method",function(){return t(this.$class(),"ROUNDING_METHOD")},0),P(_,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()},0),P(_,"$divide_and_round",function(d,g,u){return this.$raise(i("NotImplementedError"))},3)}(b[0],T("BinaryOp"),b),function(y,v,m){var _=x(y,v,"DivideWithGameSystemDefault"),c=[_].concat(m),i=r.$r(c);S(c[0],"ROUNDING_METHOD",""),_.$private(),P(_,"$divide_and_round",function(s,d,g){var u,p=$;return k(t(i("RoundType"),"CEIL"),u=g)?R(s.$to_f(),d).$ceil():k(t(i("RoundType"),"ROUND"),u)?(p=R(s.$to_f(),d),M(p["$negative?"]())?p.$abs().$round()["$-@"]():p.$round()):R(s,d).$floor()},3)}(b[0],T("DivideBase"),b),function(y,v,m){var _=x(y,v,"DivideWithCeil"),c=[_].concat(m);S(c[0],"ROUNDING_METHOD","C"),_.$private(),P(_,"$divide_and_round",function(n,s,d){return R(n.$to_f(),s).$ceil()},3)}(b[0],T("DivideBase"),b),function(y,v,m){var _=x(y,v,"DivideWithRound"),c=[_].concat(m);S(c[0],"ROUNDING_METHOD","R"),_.$private(),P(_,"$divide_and_round",function(n,s,d){var g=$;return g=R(n.$to_f(),s),M(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()},3)}(b[0],T("DivideBase"),b),function(y,v,m){var _=x(y,v,"DivideWithFloor"),c=[_].concat(m);S(c[0],"ROUNDING_METHOD","F"),_.$private(),P(_,"$divide_and_round",function(n,s,d){return R(n,s).$floor()},3)}(b[0],T("DivideBase"),b),function(y,v){var m=x(y,null,"Negative");m.$$prototype.body=$,P(m,"$initialize",function(i){return this.body=i},1),P(m,"$eval",function(i){return this.body.$eval(i)["$-@"]()},1),P(m,"$output",function(){return"-"+this.body.$output()},0),P(m,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"},0)}(b[0]),function(y,v){var m=x(y,null,"Parenthesis");m.$$prototype.expr=$,P(m,"$initialize",function(i){return this.expr=i},1),P(m,"$eval",function(i){return this.expr.$eval(i)},1),P(m,"$output",function(){return"("+this.expr.$output()+")"},0),P(m,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"},0)}(b[0]),function(y,v){var m=x(y,null,"Number");return m.$$prototype.value=$,P(m,"$initialize",function(i){return this.value=i},1),P(m,"$eval",function(i){return this.value},1),P(m,"$output",function(){return this.value.$to_s()},0),N(m,"s_exp","output")}(b[0])},Opal.modules.strscan=function(r){var N,W,Z,ne,K,Y=[],$=r.nil,e=r.def,x=r.truthy,P=r.eqeqeq,H=r.Opal,a=r.send,F=r.to_a,S=r.rb_minus,k=r.alias;return N=Y,Z=[W=(0,r.klass)(Y[0],null,"StringScanner")].concat(N),ne=r.$r(Z),(K=W.$$prototype).pos=K.string=K.working=K.matched=K.prev_pos=K.match=$,W.$attr_reader("pos","matched"),e(W,"$initialize",function(o){var f=this;return f.string=o,f.pos=0,f.matched=$,f.working=o,f.match=[]},1),W.$attr_reader("string"),e(W,"$beginning_of_line?",function(){var o=this;return 0===o.pos||"\n"===o.string.charAt(o.pos-1)},0),e(W,"$scan",function(o){var f=this,C=(o=f.$anchor(o)).exec(f.working);return null==C?f.matched=$:"object"==typeof C?(f.prev_pos=f.pos,f.pos+=C[0].length,f.working=f.working.substring(C[0].length),f.matched=C[0],f.match=C,C[0]):"string"==typeof C?(f.pos+=C.length,f.working=f.working.substring(C.length),C):$},1),e(W,"$scan_until",function(o){var f=this;o=f.$anchor(o);for(var j,C=f.pos,I=f.working;;){if(j=o.exec(I),C+=1,I=I.substr(1),null!=j)return f.matched=f.string.substr(f.pos,C-f.pos-1+j[0].length),f.match=j,f.prev_pos=C-1,f.pos=C,f.working=I.substr(j[0].length),f.matched;if(0===I.length)return f.match=[],f.matched=$}},1),e(W,"$[]",function(o){var C;if(x(this.match["$empty?"]()))return $;P(ne("Symbol"),C=o)?o=o.$to_s():P(ne("String"),C)||(o=H["$coerce_to!"](o,ne("Integer"),"to_int"));var I=this.match;return o<0&&(o+=I.length),o<0||o>=I.length||null==I[o]?$:I[o]},1),e(W,"$check",function(o){var f=this,C=(o=f.$anchor(o)).exec(f.working);return f.matched=null==C?$:C[0]},1),e(W,"$check_until",function(o){var f=this,C=f.prev_pos,I=f.pos,j=f.$scan_until(o);return j!==$&&(f.matched=j.substr(-1),f.working=f.string.substr(I)),f.prev_pos=C,f.pos=I,j},1),e(W,"$peek",function(o){return this.working.substring(0,o)},1),e(W,"$eos?",function(){return 0===this.working.length},0),e(W,"$exist?",function(o){var C=o.exec(this.working);return null==C?$:0==C.index?0:C.index+1},1),e(W,"$skip",function(o){var f=this,C=(o=f.$anchor(o)).exec(f.working);if(null==C)return f.match=[],f.matched=$;var I=C[0],j=I.length;return f.matched=I,f.match=C,f.prev_pos=f.pos,f.pos+=j,f.working=f.working.substring(j),j},1),e(W,"$skip_until",function(o){var C=this.$scan_until(o);return C===$?$:(this.matched=C.substr(-1),C.length)},1),e(W,"$get_byte",function(){var o=this,f=$;return o.pos<o.string.length?(o.prev_pos=o.pos,o.pos+=1,f=o.matched=o.working.substring(0,1),o.working=o.working.substring(1)):o.matched=$,f},0),e(W,"$match?",function(o){var f=this,C=(o=f.$anchor(o)).exec(f.working);return null==C?$:(f.prev_pos=f.pos,C[0].length)},1),e(W,"$pos=",function(o){var f=this;return o<0&&(o+=f.string.$length()),f.pos=o,f.working=f.string.slice(o)},1),e(W,"$matched_size",function(){return this.matched===$?$:this.matched.length},0),e(W,"$post_match",function(){var o=this;return o.matched===$?$:o.string.substr(o.pos)},0),e(W,"$pre_match",function(){var o=this;return o.matched===$?$:o.string.substr(0,o.prev_pos)},0),e(W,"$reset",function(){var o=this;return o.working=o.string,o.matched=$,o.pos=0},0),e(W,"$rest",function(){return this.working},0),e(W,"$rest?",function(){return 0!==this.working.length},0),e(W,"$rest_size",function(){return this.$rest().$size()},0),e(W,"$terminate",function(){var f,o=this;return o.match=$,f=[o.string.$length()],a(o,"pos=",F(f)),f[S(f.length,1)]},0),e(W,"$unscan",function(){var o=this;return o.pos=o.prev_pos,o.prev_pos=$,o.match=$,o},0),k(W,"bol?","beginning_of_line?"),k(W,"getch","get_byte"),W.$private(),e(W,"$anchor",function(o){var f=o.toString().match(/\/([^\/]+)$/);return f=f?f[1]:void 0,new RegExp("^(?:"+o.source+")",f)},1)},Opal.modules["bcdice/normalize"]=function(r){var a,R,S,Y=[],$=r.nil,t=r.module,e=r.eqeqeq,x=r.def,P=r.eqeq;return a=Y,S=[t(Y[0],"BCDice")].concat(a),(R=t(S[0],"Normalize")).$module_function(),x(R,"$comparison_operator",function(N){var W;return e(/<=|=</,W=N)?"<=":e(/>=|=>/,W)?">=":e(/<>|!=|=!/,W)?"!=":e(/</,W)?"<":e(/>/,W)?">":e(/=/,W)?"==":$},1),x(R,"$target_number",function(N){return P(N,"?")?N:N.$to_i()},1)},Opal.modules["bcdice/command/lexer"]=function(r){var R,Z,f,C,I,j,w,K,N,Y=r.top,$=[],t=r.nil,e=r.module,x=r.klass,P=r.const_set,H=r.hash2,a=r.truthy,F=r.send,S=r.def;return Y.$require("strscan"),Y.$require("bcdice/normalize"),R=$,Z=N=[e($[0],"BCDice")].concat(R),f=K=[e(N[0],"Command")].concat(Z),I=[C=x(K[0],null,"Lexer")].concat(f),j=r.$r(I),(w=C.$$prototype).scanner=w.notations=t,P(I[0],"SYMBOLS",H(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),S(C,"$initialize",function(T,y){var v,m,c;return T=a(c=(m=(v=T)===t||null==v?t:F(v,"split",[" ",2]))===t||null==m?t:F(m,"first",[]))?c:"",this.scanner=j("StringScanner").$new(T),this.notations=F(y,"map",[],function(n){return null==n&&(n=t),a(n["$is_a?"](j("String")))?j("Regexp").$new(n):n},1)},2),S(C,"$next_token",function(){try{var T=this,y=t,v=t,_=t,c=t;return a(T.scanner["$eos?"]())?[!1,"$"]:(F(T.notations,"each",[],function i(n){var d,s=null==i.$$s?this:i.$$s;if(null==s.scanner&&(s.scanner=t),null==n&&(n=t),d=s.scanner.$scan(n),!a(d))return t;r.ret(["NOTATION",d])},{$$arity:1,$$s:T}),a(y=T.scanner.$scan(/\d+/))?["NUMBER",y.$to_i()]:a(v=T.scanner.$scan(/[<>!=]+/))?(v=j("Normalize").$comparison_operator(v),[a(v)?"CMP_OP":"ILLEGAL",v]):(_=T.scanner.$getch().$upcase(),[a(c=j("SYMBOLS")["$[]"](_))?c:_.$to_sym(),_]))}catch(i){if(i===r.returner)return i.$v;throw i}},0),S(C,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/command/parsed"]=function(r){var F,M,K,U,o,f,C,W,k,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.def,P=r.truthy,H=r.eqeqeq;return F=Y,M=k=[t(Y[0],"BCDice")].concat(F),K=W=[t(k[0],"Command")].concat(M),o=[U=e(W[0],null,"Parsed")].concat(K),f=r.$r(o),(C=U.$$prototype).question_target=C.critical=C.fumble=C.dollar=C.modify_number=C.target_number=C.prefix_number=C.command=C.suffix_number=C.cmp_op=$,U.$attr_accessor("command"),U.$attr_accessor("prefix_number"),U.$attr_accessor("suffix_number"),U.$attr_accessor("critical"),U.$attr_accessor("fumble"),U.$attr_accessor("dollar"),U.$attr_accessor("modify_number"),U.$attr_accessor("cmp_op"),U.$attr_accessor("target_number"),U.$attr_writer("question_target"),x(U,"$initialize",function(){var j=this;return j.prefix_number=$,j.suffix_number=$,j.critical=$,j.fumble=$,j.dollar=$,j.cmp_op=$,j.target_number=$,j.question_target=!1},0),x(U,"$question_target?",function(){return this.question_target},0),x(U,"$to_s",function(j){var _,w=this,b=$,T=$,y=$,v=$,m=$;return null==j&&(j="after_command"),b=P(w.critical)?"@"+w.critical:$,T=P(w.fumble)?"#"+w.fumble:$,y=P(w.dollar)?"$"+w.dollar:$,v=f("Format").$modifier(w.modify_number),m=P(w.question_target)?"?":w.target_number,H("after_command",_=j)?[w.prefix_number,w.command,w.suffix_number,b,T,y,v,w.cmp_op,m].$join():H("after_modify_number",_)?[w.prefix_number,w.command,w.suffix_number,v,b,T,y,w.cmp_op,m].$join():H("after_target_number",_)?[w.prefix_number,w.command,w.suffix_number,v,w.cmp_op,m,b,T,y].$join():$},-1)},Opal.modules["bcdice/command/parser"]=function(r){var f,w,_,s,d,g,u,p,h,Q,l,X,ue,c,i,n,le,T,y,I,Y=r.top,$=[],t=r.$r($),e=r.nil,x=r.$$$,P=r.klass,H=r.module,a=r.hash2,F=r.send2,S=r.find_super,k=r.def,R=r.send,M=r.to_a,N=r.rb_minus,W=r.eqeq,Z=r.hash,ne=r.const_set,K=r.truthy,U=r.to_ary;return Y.$require("racc/parser.rb"),Y.$require("bcdice/arithmetic/node"),Y.$require("bcdice/command/lexer"),Y.$require("bcdice/command/parsed"),P(x(t("BCDice"),"Command"),x(t("Racc"),"Parser"),"Parser"),f=$,w=I=[H($[0],"BCDice")].concat(f),T=[H(I[0],"Command")].concat(w),y=r.$r(T),_=T,i=[c=P(T[0],x(y("Racc"),"Parser"),"Parser")].concat(_),n=r.$r(i),(le=c.$$prototype).notations=le.lexer=le.modifier=le.suffix_number=le.prefix_number=le.need_suffix_number=le.need_prefix_number=le.critical=le.fumble=le.dollar=le.allowed_cmp_op=le.question_target=e,k(c,"$initialize",function te(A,J){var B,D,se,re,V=this;if(delete te.$$p,B=r.slice.call(arguments),null==(D=r.extract_kwargs(B)))D=a([],{});else if(!D.$$is_hash)throw r.ArgumentError.$new("expected kwargs");if(se=B,!r.hasOwnProperty.call(D.$$smap,"round_type"))throw r.ArgumentError.$new("missing keyword: round_type");return re=D.$$smap.round_type,F(V,S(V,"initialize",te,!1,!0),"initialize",[],null),V.notations=se,V.round_type=re,V.prefix_number=!1,V.suffix_number=!1,V.need_prefix_number=!1,V.need_suffix_number=!1,V.modifier=!0,V.critical=!1,V.fumble=!1,V.dollar=!1,V.allowed_cmp_op=[e,">=",">","<=","<","==","!="],V.question_target=!1},-2),k(c,"$disable_modifier",function(){return this.modifier=!1,this},0),k(c,"$enable_prefix_number",function(){return this.prefix_number=!0,this},0),k(c,"$enable_suffix_number",function(){return this.suffix_number=!0,this},0),k(c,"$has_prefix_number",function(){var A=this;return A.prefix_number=!0,A.need_prefix_number=!0,A},0),k(c,"$has_suffix_number",function(){var A=this;return A.suffix_number=!0,A.need_suffix_number=!0,A},0),k(c,"$enable_critical",function(){return this.critical=!0,this},0),k(c,"$enable_fumble",function(){return this.fumble=!0,this},0),k(c,"$enable_dollar",function(){return this.dollar=!0,this},0),k(c,"$restrict_cmp_op_to",function(A){var J,D=this;return J=r.slice.call(arguments),D.allowed_cmp_op=J,D},-1),k(c,"$enable_question_target",function(){return this.question_target=!0,this},0),k(c,"$parse",function(A){var J=this;try{return J.lexer=n("Lexer").$new(A,J.notations),J.$do_parse()}catch(B){if(!r.rescue(B,[n("ParseError"),n("ZeroDivisionError")]))throw B;try{return e}finally{r.pop_exception()}}},1),c.$private(),k(c,"$parsed",function(A,J,B,D){return R(n("Parsed").$new(),"tap",[],function re(L){var V,E,q,ie,ce,O,ee=null==re.$$s?this:re.$$s,G=e;return null==ee.round_type&&(ee.round_type=e),null==L&&(L=e),G=[A["$[]"]("command")],R(L,"command=",M(G)),N(G.length,1),G=[(V=A["$[]"]("prefix"),V===e||null==V?e:R(V,"eval",[ee.round_type]))],R(L,"prefix_number=",M(G)),N(G.length,1),G=[(E=A["$[]"]("suffix"),E===e||null==E?e:R(E,"eval",[ee.round_type]))],R(L,"suffix_number=",M(G)),N(G.length,1),G=[(q=J["$[]"]("critical"),q===e||null==q?e:R(q,"eval",[ee.round_type]))],R(L,"critical=",M(G)),N(G.length,1),G=[(ie=J["$[]"]("fumble"),ie===e||null==ie?e:R(ie,"eval",[ee.round_type]))],R(L,"fumble=",M(G)),N(G.length,1),G=[(ce=J["$[]"]("dollar"),ce===e||null==ce?e:R(ce,"eval",[ee.round_type]))],R(L,"dollar=",M(G)),N(G.length,1),G=[B.$eval(ee.round_type)],R(L,"modify_number=",M(G)),N(G.length,1),G=[D["$[]"]("cmp_op")],R(L,"cmp_op=",M(G)),N(G.length,1),W(D["$[]"]("target"),"?")?(R(L,"question_target=",M(G=[!0])),N(G.length,1),R(L,"target_number=",M(G=[0])),G[N(G.length,1)]):(R(L,"question_target=",M(G=[!1])),N(G.length,1),G=[(O=D["$[]"]("target"),O===e||null==O?e:R(O,"eval",[ee.round_type]))],R(L,"target_number=",M(G)),G[N(G.length,1)])},{$$arity:1,$$s:this})},4),k(c,"$next_token",function(){return this.lexer.$next_token()},0),s=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,33,34,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,36,37,17,18,6,e,5,e,e,17,18,6,e,5,e,e,17,18,e,e,5,23,24,25,26,56,54,55,57],d=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,e,17,15,15,18,18,23,e,18,30,30,23,23,24,e,23,31,31,24,24,25,e,24,44,44,25,25,28,e,25,47,47,28,28,29,e,28,48,48,29,29,33,e,29,49,49,33,33,34,e,33,50,50,34,34,36,e,34,e,e,36,36,37,e,36,e,e,37,37,e,e,37,27,27,27,27,52,52,52,52],g=[-2,4,16,-3,-1,11,e,33,13,35,23,30,1,e,28,40,e,37,44,e,e,-2,e,51,58,65,0,106,72,79,47,54,e,86,93,e,100,107,e,e,e,e,e,e,63,e,e,68,75,82,89,e,120,e,e,e,e,e],u=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],p=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,e,e,21,47,48,40,51,52,49,50,44,46,3,e,e,e,13,e,e,e,e,e,e,e,32],h=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,e,e,4,8,8,5,7,7,8,8,9,5,6,e,e,e,6,e,e,e,e,e,e,e,6],Q=[e,6,13,3,9,-1,27,-15,-10,-1,-38],l=[e,e,e,e,e,e,19,16,15,e,e],X=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],ue=Z(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),ne(i[0],"Racc_arg",[s,d,u,g,p,h,l,Q,19,X,ue,58,35,!0]),ne(i[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),ne(i[0],"Racc_debug_parser",!1),k(c,"$_reduce_1",function(A,J,B){var D;return K(this.modifier)||this.$raise(n("ParseError")),D=U(A),this.$parsed(null==D[0]?e:D[0],null==D[1]?e:D[1],null==D[2]?e:D[2],null==D[3]?e:D[3])},3),k(c,"$_reduce_2",function(A,J,B){var D;return K(this.modifier)||this.$raise(n("ParseError")),D=U(A),this.$parsed(null==D[0]?e:D[0],null==D[2]?e:D[2],null==D[1]?e:D[1],null==D[3]?e:D[3])},3),k(c,"$_reduce_3",function(A,J,B){var D,E;return E=null==(D=U(A))[2]?e:D[2],this.$parsed(null==D[0]?e:D[0],null==D[1]?e:D[1],x(x(n("Arithmetic"),"Node"),"Number").$new(0),E)},3),k(c,"$_reduce_4",function(A,J,B){var D=this;return K(D.prefix_number)&&K(D.suffix_number)||D.$raise(n("ParseError")),a(["command","prefix","suffix"],{command:A["$[]"](1),prefix:A["$[]"](0),suffix:A["$[]"](2)})},3),k(c,"$_reduce_5",function(A,J,B){var D=this;return K(D.prefix_number)||D.$raise(n("ParseError")),K(D.need_suffix_number)&&D.$raise(n("ParseError")),a(["command","prefix"],{command:A["$[]"](1),prefix:A["$[]"](0)})},3),k(c,"$_reduce_6",function(A,J,B){var D=this;return K(D.suffix_number)||D.$raise(n("ParseError")),K(D.need_prefix_number)&&D.$raise(n("ParseError")),a(["command","suffix"],{command:A["$[]"](0),suffix:A["$[]"](1)})},3),k(c,"$_reduce_7",function(A,J,B){var D=this;return(K(D.need_prefix_number)||K(D.need_suffix_number))&&D.$raise(n("ParseError")),a(["command"],{command:A["$[]"](0)})},3),k(c,"$_reduce_8",function(A,J,B){return a([],{})},3),k(c,"$_reduce_9",function(A,J,B){var D,E,q,L=e;return L=null==(D=U(A))[0]?e:D[0],E=null==D[2]?e:D[2],K(this.critical)&&K(L["$[]"]("critical")["$nil?"]())||this.$raise(n("ParseError")),R(L,"[]=",M(q=["critical",E])),N(q.length,1),L},3),k(c,"$_reduce_10",function(A,J,B){var D,E,q,L=e;return L=null==(D=U(A))[0]?e:D[0],E=null==D[2]?e:D[2],K(this.fumble)&&K(L["$[]"]("fumble")["$nil?"]())||this.$raise(n("ParseError")),R(L,"[]=",M(q=["fumble",E])),N(q.length,1),L},3),k(c,"$_reduce_11",function(A,J,B){var D,E,q,L=e;return L=null==(D=U(A))[0]?e:D[0],E=null==D[2]?e:D[2],K(this.dollar)&&K(L["$[]"]("dollar")["$nil?"]())||this.$raise(n("ParseError")),R(L,"[]=",M(q=["dollar",E])),N(q.length,1),L},3),k(c,"$_reduce_12",function(A,J,B){return A["$[]"](1)},3),k(c,"$_reduce_13",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"Negative").$new(A["$[]"](1))},3),k(c,"$_reduce_14",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"BinaryOp").$new(A["$[]"](0),"+",A["$[]"](2))},3),k(c,"$_reduce_15",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"BinaryOp").$new(A["$[]"](0),"-",A["$[]"](2))},3),k(c,"$_reduce_16",function(A,J,B){return K(this.allowed_cmp_op["$include?"](e))||this.$raise(n("ParseError")),a([],{})},3),k(c,"$_reduce_17",function(A,J,B){var D,L,V;return V=null==(D=U(A))[1]?e:D[1],K(this.allowed_cmp_op["$include?"](L=null==D[0]?e:D[0]))||this.$raise(n("ParseError")),a(["cmp_op","target"],{cmp_op:L,target:V})},3),k(c,"$_reduce_18",function(A,J,B){var se,D=this;return se=A["$[]"](0),K(D.question_target)||D.$raise(n("ParseError")),K(D.allowed_cmp_op["$include?"](se))||D.$raise(n("ParseError")),a(["cmp_op","target"],{cmp_op:se,target:"?"})},3),k(c,"$_reduce_19",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"BinaryOp").$new(A["$[]"](0),"+",A["$[]"](2))},3),k(c,"$_reduce_20",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"BinaryOp").$new(A["$[]"](0),"-",A["$[]"](2))},3),k(c,"$_reduce_22",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"BinaryOp").$new(A["$[]"](0),"*",A["$[]"](2))},3),k(c,"$_reduce_23",function(A,J,B){return A["$[]"](3).$new(A["$[]"](0),A["$[]"](2))},3),k(c,"$_reduce_25",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault")},3),k(c,"$_reduce_26",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"DivideWithCeil")},3),k(c,"$_reduce_27",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"DivideWithCeil")},3),k(c,"$_reduce_28",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"DivideWithRound")},3),k(c,"$_reduce_29",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"DivideWithFloor")},3),k(c,"$_reduce_30",function(A,J,B){return A["$[]"](1)},3),k(c,"$_reduce_31",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"Negative").$new(A["$[]"](1))},3),k(c,"$_reduce_33",function(A,J,B){return A["$[]"](1)},3),k(c,"$_reduce_34",function(A,J,B){return x(x(n("Arithmetic"),"Node"),"Number").$new(A["$[]"](0))},3),k(c,"$_reduce_none",function(A,J,B){return A["$[]"](0)},3)},Opal.modules["bcdice/deprecated/checker"]=function(r){var F,M,ne,K,U,o,W,k,Y=[],$=r.nil,t=r.module,e=r.send,x=r.eqeqeq,P=r.truthy,H=r.def;return F=Y,M=k=[t(Y[0],"BCDice")].concat(F),ne=W=[t(k[0],"Deprecated")].concat(M),U=[K=t(W[0],"Checker")].concat(ne),o=r.$r(U),K.$private(),H(K,"$check_result_legacy",function(C,I,j,w){var v,b=this,T=$,y=$,m=$,_=$;return T=e(I,"map",[],"sides".$to_proc()),v=(y=e(I,"map",[],"value".$to_proc())).$sum(),m=x([100],_=T)?b.$check_1D100(C,v,j,w):x([20],_)?b.$check_1D20(C,v,j,w):x([6,6],_)?b.$check_2D6(C,v,y,j,w):$,(P(m["$nil?"]())||P(m["$empty?"]()))&&(m=x([10],_=T.$uniq())?b.$check_nD10(C,v,y,j,w):x([6],_)?b.$check_nD6(C,v,y,j,w):$,P(m["$nil?"]())||P(m["$empty?"]()))?$:o("Result").$new(m.$delete_prefix(" \uff1e "))},4),H(K,"$check_1D100",function(C,I,j,w){return $},4),H(K,"$check_1D20",function(C,I,j,w){return $},4),H(K,"$check_nD10",function(C,I,j,w,b){return $},5),H(K,"$check_2D6",function(C,I,j,w,b){return $},5),H(K,"$check_nD6",function(C,I,j,w,b){return $},5)},Opal.modules["bcdice/base"]=function(r){var I,y,i,s,d,v,m,_,c,w,Y=r.top,$=[],t=r.$r($),e=r.nil,x=r.$$$,P=r.module,H=r.klass,a=r.truthy,F=r.def,S=r.regexp,k=r.rb_plus,R=r.send,M=r.to_a,N=r.rb_minus,W=r.eqeqeq,Z=r.eqeq,ne=r.range,K=r.rb_divide,U=r.rb_times,o=r.rb_ge,f=e;return Y.$require("i18n"),Y.$require("i18n/backend/fallbacks"),Y.$require("bcdice/randomizer"),Y.$require("bcdice/dice_table"),Y.$require("bcdice/enum"),Y.$require("bcdice/translate"),Y.$require("bcdice/result"),Y.$require("bcdice/command/parser"),Y.$require("bcdice/deprecated/checker"),I=$,y=w=[P($[0],"BCDice")].concat(I),m=[v=H(w[0],null,"Base")].concat(y),_=r.$r(m),(c=v.$$prototype).sort_add_dice=c.sort_barabara_dice=c.enabled_d9=c.raw_input=c.randomizer=c.enabled_upcase_input=c.debug=e,s=[i=r.get_singleton_class(v)].concat(m),d=r.$r(s),i.$attr_reader("prefixes"),F(i,"$register_prefix",function(u){var h,Q=this,l=e;return null==Q.prefixes&&(Q.prefixes=e),h=r.slice.call(arguments),Q.prefixes=a(l=Q.prefixes)?l:[],Q.prefixes.$concat(h.$flatten())},-1),F(i,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())},0),F(i,"$prefixes_pattern",function(){var u=this,p=e;return null==u.prefixes_pattern&&(u.prefixes_pattern=e),null==u.prefixes&&(u.prefixes=e),u.prefixes_pattern=a(p=u.prefixes_pattern)?p:e,a(u.prefixes_pattern)?u.prefixes_pattern:(u.prefixes=a(p=u.prefixes)?p:[],u.prefixes.$freeze(),u.prefixes_pattern=(a(u.prefixes["$empty?"]())?/(?!)/:S(["^(S)?(",u.prefixes.$join("|"),")"],"i")).$freeze())},0),F(i,"$command_pattern",function(){var u=this,p=e,h=e;return null==u.command_pattern&&(u.command_pattern=e),null==u.prefixes&&(u.prefixes=e),u.command_pattern=a(p=u.command_pattern)?p:e,a(u.command_pattern)?u.command_pattern:(u.prefixes=a(p=u.prefixes)?p:[],u.prefixes.$freeze(),h=k(R(x(d("CommonCommand"),"COMMANDS"),"map",[],function(l){return null==l&&(l=e),x(l,"PREFIX_PATTERN").$source()},1),u.prefixes),u.command_pattern=S(["^S?(",h.$join("|"),")"],"i").$freeze())},0),F(i,"$eval",function(u){return this.$new(u).$eval()},1),v.$include(_("Translate")),v.$include(x(_("Deprecated"),"Checker")),F(v,"$initialize",function(n){var s=this;return s.raw_input=n,s.sort_add_dice=!1,s.sort_barabara_dice=!1,s.d66_sort_type=x(_("D66SortType"),"NO_SORT"),s.enabled_d9=!1,s.round_type=x(_("RoundType"),"FLOOR"),s.sides_implicit_d=6,s.upper_dice_reroll_threshold=e,s.reroll_dice_reroll_threshold=e,s.default_cmp_op=e,s.default_target_number=e,s.enabled_upcase_input=!0,s.locale="ja_jp",s.randomizer=x(_("BCDice"),"Randomizer").$new(),s.debug=!1},1),v.$attr_accessor("randomizer"),v.$attr_reader("d66_sort_type"),v.$attr_reader("round_type"),v.$attr_reader("sides_implicit_d"),v.$attr_reader("upper_dice_reroll_threshold"),v.$attr_reader("reroll_dice_reroll_threshold"),v.$attr_reader("default_cmp_op"),v.$attr_reader("default_target_number"),F(v,"$sort_add_dice?",function(){return this.sort_add_dice},0),F(v,"$sort_barabara_dice?",function(){return this.sort_barabara_dice},0),F(v,"$enabled_d9?",function(){return this.enabled_d9},0),F(v,"$enable_debug",function(){return this.debug=!0},0),F(v,"$eval",function(){var s,d,g,n=this,u=e;return s=x(_("BCDice"),"Preprocessor").$process(n.raw_input,n),d=a(g=n.$dice_command(s))?g:n.$eval_common_command(n.raw_input),a(d)?(u=[n.randomizer.$rand_results()],R(d,"rands=",M(u)),N(u.length,1),u=[n.randomizer.$detailed_rand_results()],R(d,"detailed_rands=",M(u)),N(u.length,1),d):e},0),F(v,"$change_text",function(n){return n},1),F(v,"$check_result",function(n,s,d,g){var u=this,p=e,h=e,Q=e,l=e,X=e;return p=u.$check_result_legacy(n,s,d,g),a(p)?p:(h=R(s,"map",[],"sides".$to_proc()),l=(Q=R(s,"map",[],"value".$to_proc())).$sum(),p=W([100],X=h)?u.$result_1d100(n,l,d,g):W([20],X)?u.$result_1d20(n,l,d,g):W([6,6],X)?u.$result_2d6(n,l,Q,d,g):e,Z(p,_("Result").$nothing())?e:a(p)?p:(p=W([10],X=h.$uniq())?u.$result_nd10(n,l,Q,d,g):W([6],X)?u.$result_nd6(n,l,Q,d,g):e,Z(p,_("Result").$nothing())?e:a(p)?p:u.$result_ndx(n,d,g)))},4),F(v,"$grich_text",function(n,s,d){return e},3),v.$private(),F(v,"$eval_common_command",function(n){try{return n=this.$change_text(n),R(x(_("CommonCommand"),"COMMANDS"),"each",[],function d(g){var p,u=null==d.$$s?this:d.$$s;if(null==u.randomizer&&(u.randomizer=e),null==g&&(g=e),p=g.$eval(n,u,u.randomizer),!a(p))return e;r.ret(p)},{$$arity:1,$$s:this}),e}catch(d){if(d===r.returner)return d.$v;throw d}},1),F(v,"$dice_command",function(n){var s=this,d=e,g=e,u=e,p=e,h=e;return a(s.enabled_upcase_input)&&(n=n.$upcase()),d=s.$class().$prefixes_pattern().$match(n),a(d)?(g=d["$[]"](1)["$nil?"]()["$!"](),a(g)&&(n=n["$[]"](ne(1,-1,!1))),u=s.$eval_game_system_specific_command(n),a(u["$is_a?"](_("Result")))?(p=[a(h=u["$secret?"]())?h:g],R(u,"secret=",M(p)),N(p.length,1),u):a(u["$nil?"]())||a(u["$empty?"]())||Z(u,"1")?e:R(_("Result").$new(),"tap",[],function(l){return null==l&&(l=e),p=[u.$to_s()],R(l,"text=",M(p)),N(p.length,1),R(l,"secret=",M(p=[g])),p[N(p.length,1)]},1)):e},1),F(v,"$eval_game_system_specific_command",function(n){return e},1),F(v,"$result_ndx",function(n,s,d){return a(d["$is_a?"](_("String")))?e:a(n.$send(s,d))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))},3),F(v,"$result_1d100",function(n,s,d,g){return e},4),F(v,"$result_1d20",function(n,s,d,g){return e},4),F(v,"$result_nd10",function(n,s,d,g,u){return e},5),F(v,"$result_2d6",function(n,s,d,g,u){return e},5),F(v,"$result_nd6",function(n,s,d,g,u){return e},5),F(v,"$get_table_by_2d6",function(n){return this.$get_table_by_nD6(n,2)},1),F(v,"$get_table_by_1d6",function(n){return this.$get_table_by_nD6(n,1)},1),F(v,"$get_table_by_nD6",function(n,s){return this.$get_table_by_nDx(n,s,6)},2),F(v,"$get_table_by_nDx",function(n,s,d){var u,p=e;return u=this.randomizer.$roll_sum(s,d),p=this.$get_table_value(n["$[]"](N(u,s))),a(p["$nil?"]())?["1",0]:[p,u]},3),F(v,"$get_table_by_1d3",function(n){var g,u,s=this,p=e;return s.$debug("get_table_by_1d3"),g=s.randomizer.$roll_sum(1,6),s.$debug("num",g),u=K(N(g,1),2).$to_i(),s.$debug("index",u),p=n["$[]"](u),a(p["$nil?"]())?["1",0]:[p,g]},1),F(v,"$get_table_by_d66_swap",function(n){var d;return d=this.randomizer.$roll_d66(x(_("D66SortType"),"ASC")),[this.$get_table_by_number(d,n),d]},1),F(v,"$get_table_by_d66",function(n){var d,g,u,h,p=e;return d=this.randomizer.$roll_once(6),g=this.randomizer.$roll_once(6),u=k(U(N(d,1),6),N(g,1)),p=n["$[]"](u),h=""+d+g,a(p["$nil?"]())?["1",h]:[p,h]},1),F(v,"$get_table_by_number",function(n,s,d){try{return null==d&&(d="1"),R(s,"each",[],function u(p){var Q,h=null==u.$$s?this:u.$$s;if(null==p&&(p=e),Q=p["$[]"](0),!a(o(Q,n)))return e;r.ret(h.$get_table_value(p["$[]"](1)))},{$$arity:1,$$s:this}),this.$get_table_value(d)}catch(u){if(u===r.returner)return u.$v;throw u}},-3),F(v,"$get_table_value",function(n){return a(n["$is_a?"](_("Proc")))?n.$call():n},1),F(v,"$roll_tables",function(n,s){var g=e;return g=s["$[]"](n),a(g)?g.$roll(this.randomizer).$to_s():e},2),F(v,"$debug",function(n,s){var g,u=this,p=e,h=e;return g=r.slice.call(arguments,1),a(u.debug)?(p=a(n["$is_a?"](_("String")))?n:n.$inspect(),a(g["$empty?"]())?u.$warn(p):(h=R(g,"map",[],function(l){return null==l&&(l=e),a(l["$is_a?"](_("String")))?'"'+l+'"':l.$inspect()},1),u.$warn(p+": "+h.$join(", ")))):e},-2),x(x(t("I18n"),"Backend"),"Simple").$include(x(x(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),f=["ja_jp"],R(t("I18n"),"default_locale=",M(f)),N(f.length,1),f=[["ja_jp"]],R(t("I18n").$fallbacks(),"defaults=",M(f)),f[N(f.length,1)]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(r){var R,Z,C,T,y,v,m,j,K,U,N,$=[],t=r.nil,e=r.module,x=r.klass,P=r.const_set,H=r.hash2,a=r.truthy,F=r.send,S=r.def;return r.top.$require("strscan"),R=$,Z=N=[e($[0],"BCDice")].concat(R),K=[e(N[0],"GameSystem")].concat(Z),U=r.$r(K),C=K,T=j=[x(K[0],U("Base"),"SwordWorld")].concat(C),v=[y=x(j[0],null,"RatingLexer")].concat(T),m=r.$r(v),y.$$prototype.scanner=t,P(v[0],"SYMBOLS",H(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),S(y,"$initialize",function(i){var n,s,g;return i=a(g=(s=(n=i)===t||null==n?t:F(n,"split",[" ",2]))===t||null==s?t:F(s,"first",[]))?g:"",this.scanner=m("StringScanner").$new(i)},1),S(y,"$next_token",function(){var i=this,n=t,s=t,g=t;return a(i.scanner["$eos?"]())?[!1,"$"]:a(n=i.scanner.$scan(/\d+/))?["NUMBER",n.$to_i()]:(s=i.scanner.$getch().$upcase(),[a(g=m("SYMBOLS")["$[]"](s))?g:s.$to_sym(),s])},0),S(y,"$source",function(){return this.scanner.$string()},0)},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(r){var R,Z,C,T,y,v,m,_,j,K,U,N,Y=[],$=r.nil,t=r.module,e=r.klass,x=r.def,P=r.truthy,H=r.rb_le,a=r.rb_plus,F=r.rb_lt,S=r.neqeq;return R=Y,Z=N=[t(Y[0],"BCDice")].concat(R),K=[t(N[0],"GameSystem")].concat(Z),U=r.$r(K),C=K,T=j=[e(K[0],U("Base"),"SwordWorld")].concat(C),v=[y=e(j[0],null,"RatingParsed")].concat(T),m=r.$r(v),(_=y.$$prototype).modifier_after_half=_.semi_fixed_val=_.kept_modify=_.rate=_.greatest_fortune=_.modifier=$,y.$attr_accessor("rate"),y.$attr_accessor("critical"),y.$attr_accessor("kept_modify"),y.$attr_accessor("first_to"),y.$attr_accessor("first_modify"),y.$attr_accessor("rateup"),y.$attr_accessor("greatest_fortune"),y.$attr_accessor("semi_fixed_val"),y.$attr_accessor("tmp_fixed_val"),y.$attr_accessor("modifier"),y.$attr_accessor("modifier_after_half"),x(y,"$initialize",function(i,n){var s=this;return s.rate=i,s.modifier=n,s.critical=13,s.kept_modify=0,s.first_to=0,s.first_modify=0,s.greatest_fortune=!1,s.rateup=0,s.semi_fixed_val=0,s.tmp_fixed_val=0,s.modifier_after_half=$},2),x(y,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()},0),x(y,"$min_critical",function(){var i=this;return P(H(i.semi_fixed_val,1))?3:a(a(i.semi_fixed_val,i.kept_modify),2).$clamp(3,13)},0),x(y,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())},0),x(y,"$to_s",function(){var i=this,n=$;return n="KeyNo."+i.rate,P(F(i.$critical(),13))&&(n=a(n,"c["+i.$critical()+"]")),S(i.$first_modify(),0)&&(n=a(n,"m["+m("Format").$modifier(i.$first_modify())+"]")),S(i.$first_to(),0)&&(n=a(n,"m["+i.$first_to()+"]")),S(i.$rateup(),0)&&(n=a(n,"r["+i.$rateup()+"]")),P(i.greatest_fortune)&&(n=a(n,"gf")),S(i.$semi_fixed_val(),0)&&(n=a(n,"sf["+i.$semi_fixed_val()+"]")),S(i.$tmp_fixed_val(),0)&&(n=a(n,"tf["+i.$tmp_fixed_val()+"]")),S(i.$kept_modify(),0)&&(n=a(n,"a["+m("Format").$modifier(i.$kept_modify())+"]")),S(i.modifier,0)&&(n=a(n,m("Format").$modifier(i.modifier))),n},0)},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(r){var a,R,K,I,o,N,W,S,Y=[],t=r.module,e=r.klass,x=r.truthy,P=r.def;return a=Y,R=S=[t(Y[0],"BCDice")].concat(a),N=[t(S[0],"GameSystem")].concat(R),W=r.$r(N),K=N,o=[e(N[0],W("Base"),"SwordWorld")].concat(K),(I=e(o[0],null,"RatingOptions")).$attr_accessor("critical"),I.$attr_accessor("kept_modify"),I.$attr_accessor("first_to"),I.$attr_accessor("first_modify"),I.$attr_accessor("rateup"),I.$attr_accessor("greatest_fortune"),I.$attr_accessor("semi_fixed_val"),I.$attr_accessor("tmp_fixed_val"),I.$attr_accessor("modifier"),I.$attr_accessor("modifier_after_half"),P(I,"$settable_first_roll_adjust_option?",function(){var b;return x(b=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():b},0),P(I,"$settable_non_2d_roll_option?",function(){var b,T,w=this;return x(b=x(T=w.$greatest_fortune()["$nil?"]())?w.$semi_fixed_val()["$nil?"]():T)?w.$tmp_fixed_val()["$nil?"]():b},0)},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(r){var f,w,_,g,Q,l,X,z,$e,ue,_e,fe,le,J,u,p,h,se,i,n,T,y,I,Y=r.top,$=[],t=r.nil,e=r.$$$,x=r.module,P=r.klass,H=r.hash2,a=r.send2,F=r.find_super,S=r.def,k=r.send,R=r.truthy,M=r.to_a,N=r.rb_minus,W=r.not,Z=r.hash,ne=r.const_set,K=r.to_ary,U=r.eqeq;return Y.$require("racc/parser.rb"),Y.$require("bcdice/arithmetic/node"),Y.$require("bcdice/enum"),Y.$require("bcdice/game_system/sword_world/rating_lexer"),Y.$require("bcdice/game_system/sword_world/rating_parsed"),Y.$require("bcdice/game_system/sword_world/rating_options"),f=$,w=I=[x($[0],"BCDice")].concat(f),T=[x(I[0],"GameSystem")].concat(w),y=r.$r(T),_=T,i=[P(T[0],y("Base"),"SwordWorld")].concat(_),n=r.$r(i),g=i,p=[u=P(i[0],e(n("Racc"),"Parser"),"RatingParser")].concat(g),h=r.$r(p),(se=u.$$prototype).lexer=se.round_type=se.version=t,S(u,"$initialize",function re(L){var V,E;if(delete re.$$p,null==L)L=H([],{});else if(!L.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(V=L.$$smap.version)&&(V="v1_0"),null==(E=L.$$smap.round_type)&&(E=e(h("RoundType"),"CEIL")),a(this,F(this,"initialize",re,!1,!0),"initialize",[],null),this.version=V,this.round_type=E},-1),S(u,"$set_debug",function(){return this.yydebug=!0,this},0),S(u,"$parse",function(L){try{return this.lexer=h("RatingLexer").$new(L),this.$do_parse()}catch(E){if(!r.rescue(E,[h("ParseError"),h("ZeroDivisionError")]))throw E;try{return t}finally{r.pop_exception()}}},1),u.$private(),S(u,"$parsed",function(L,V,E){return k(h("RatingParsed").$new(L,V),"tap",[],function ie(ce){var O,ee,G,ae,me,ve,be,he=null==ie.$$s?this:ie.$$s,oe=t,de=t;return null==he.round_type&&(he.round_type=t),null==ce&&(ce=t),oe=[R((O=E.$kept_modify(),de=O===t||null==O?t:k(O,"eval",[he.round_type])))?de:0],k(ce,"kept_modify=",M(oe)),N(oe.length,1),oe=[R(de=E.$first_to())?de:0],k(ce,"first_to=",M(oe)),N(oe.length,1),oe=[R(de=E.$first_modify())?de:0],k(ce,"first_modify=",M(oe)),N(oe.length,1),oe=[R((ee=E.$rateup(),de=ee===t||null==ee?t:k(ee,"eval",[he.round_type])))?de:0],k(ce,"rateup=",M(oe)),N(oe.length,1),W(E.$greatest_fortune()["$nil?"]())&&(oe=[E.$greatest_fortune()],k(ce,"greatest_fortune=",M(oe)),N(oe.length,1)),oe=[R((G=E.$semi_fixed_val(),de=G===t||null==G?t:k(G,"clamp",[1,6])))?de:0],k(ce,"semi_fixed_val=",M(oe)),N(oe.length,1),oe=[R((ae=E.$tmp_fixed_val(),de=ae===t||null==ae?t:k(ae,"clamp",[1,6])))?de:0],k(ce,"tmp_fixed_val=",M(oe)),N(oe.length,1),oe=[(me=E.$modifier_after_half(),me===t||null==me?t:k(me,"eval",[he.round_type]))],k(ce,"modifier_after_half=",M(oe)),N(oe.length,1),oe=[R((ve=E.$critical(),be=ve===t||null==ve?t:k(ve,"eval",[he.round_type]),de=be===t||null==be?t:k(be,"clamp",[0,13])))?de:R(ce.$half())?13:10],k(ce,"critical=",M(oe)),oe[N(oe.length,1)]},{$$arity:1,$$s:this})},3),S(u,"$next_token",function(){return this.lexer.$next_token()},0),Q=[15,14,16,5,17,18,20,21,57,58,23,24,11,59,12,19,13,15,14,16,4,17,18,20,21,4,30,3,30,11,8,12,19,13,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,9,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,55,56,30,26,27,26,27,29,30,29,26,27,37,30,29,30,26,27,55,56,29,26,27,26,27,29,30,29,30,55,56,38,39,32,26,27,26,27,29,46,29,33,34,51,52,53,54],l=[6,6,6,1,6,6,6,6,49,49,10,10,6,49,6,6,6,22,22,22,3,22,22,22,22,0,11,0,12,22,4,22,22,22,11,11,12,12,11,14,12,15,41,41,43,43,19,14,14,15,15,14,20,15,19,19,5,21,19,23,20,20,44,44,20,21,21,23,23,21,24,23,26,45,45,50,50,27,24,24,26,26,24,29,26,27,27,16,55,27,56,29,29,62,62,29,55,55,56,56,55,57,56,58,63,63,17,18,13,57,57,58,58,57,25,58,13,13,33,34,38,39],X=[22,3,t,17,28,56,-4,t,t,t,0,24,26,106,37,39,80,99,100,44,50,55,13,57,68,97,70,75,t,81,t,t,t,116,117,t,t,t,118,119,t,30,t,32,50,61,t,t,t,-2,63,t,t,t,t,86,88,99,101,t,t,t,81,92],z=[-33,-33,-4,-33,-33,-33,-1,-4,-3,64,-5,-33,-33,-33,-11,-33,-33,-33,-33,-33,-33,-33,-2,-33,-33,-33,-33,-33,-30,-33,-32,-7,-8,-33,-33,-12,-13,-14,-33,-33,-17,-18,-27,-19,-20,-21,-6,-28,-29,-33,-24,-9,-10,-15,-16,-33,-33,-33,-33,-31,-25,-26,-22,-23],$e=[25,31,6,35,36,1,49,22,40,41,43,2,44,45,7,47,48,t,50,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,60,61,62,63],ue=[5,5,3,5,5,1,7,3,5,6,6,2,6,6,2,5,5,t,6,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,5,5,6,6],_e=[t,5,11,0,t,-11,-11,-23,t],fe=[t,t,t,t,10,42,t,t,28],le=[0,0,"racc_error",2,22,"_reduce_1",3,22,"_reduce_2",2,23,"_reduce_3",0,24,"_reduce_4",2,24,"_reduce_5",4,24,"_reduce_6",3,24,"_reduce_7",3,24,"_reduce_8",4,24,"_reduce_9",4,24,"_reduce_10",2,24,"_reduce_11",3,24,"_reduce_12",3,24,"_reduce_13",3,24,"_reduce_14",4,24,"_reduce_15",4,24,"_reduce_16",3,24,"_reduce_17",2,25,"_reduce_18",2,25,"_reduce_19",3,25,"_reduce_20",3,25,"_reduce_21",3,28,"_reduce_22",3,28,"_reduce_23",1,28,"_reduce_none",3,27,"_reduce_25",3,27,"_reduce_26",1,27,"_reduce_none",2,26,"_reduce_28",2,26,"_reduce_29",1,26,"_reduce_none",3,29,"_reduce_31",1,29,"_reduce_32"],J=Z(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"S",8,"T",9,"PLUS",10,"MINUS",11,"ASTERISK",12,"SLASH",13,"PARENL",14,"PARENR",15,"BRACKETL",16,"BRACKETR",17,"AT",18,"SHARP",19,"DOLLAR",20),ne(p[0],"Racc_arg",[Q,l,z,X,$e,ue,fe,_e,21,le,J,64,33,!0]),ne(p[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),ne(p[0],"Racc_debug_parser",!1),S(u,"$_reduce_1",function(L,V,E){var q,O,ae,ee=t,G=t;return O=null==(q=K(L))[0]?t:q[0],G=R(ae=(ee=null==q[1]?t:q[1]).$modifier())?ae:e(e(h("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(O,G.$eval(this.round_type),ee)},3),S(u,"$_reduce_2",function(L,V,E){var q,ee,ae,G=t,me=t,ve=t;return ee=null==(q=K(L))[1]?t:q[1],R((G=null==q[2]?t:q[2]).$modifier_after_half())||(me=[e(e(h("Arithmetic"),"Node"),"Number").$new(0)],k(G,"modifier_after_half=",M(me)),N(me.length,1)),ve=R(ae=G.$modifier())?ae:e(e(h("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ee,ve.$eval(this.round_type),G)},3),S(u,"$_reduce_3",function(L,V,E){return L["$[]"](1).$to_i()},3),S(u,"$_reduce_4",function(L,V,E){return h("RatingOptions").$new()},3),S(u,"$_reduce_5",function(L,V,E){var q,ee,G,O=t;return ee=null==(q=K(L))[1]?t:q[1],R((O=null==q[0]?t:q[0]).$modifier()["$nil?"]())||this.$raise(h("ParseError")),k(O,"modifier=",M(G=[ee])),N(G.length,1),O},3),S(u,"$_reduce_6",function(L,V,E){var q,G,ae,O=t;return G=null==(q=K(L))[2]?t:q[2],R((O=null==q[0]?t:q[0]).$critical()["$nil?"]())||this.$raise(h("ParseError")),k(O,"critical=",M(ae=[G])),N(ae.length,1),O},3),S(u,"$_reduce_7",function(L,V,E){var q,G,ae,O=t;return G=null==(q=K(L))[2]?t:q[2],R((O=null==q[0]?t:q[0]).$critical()["$nil?"]())||this.$raise(h("ParseError")),k(O,"critical=",M(ae=[G])),N(ae.length,1),O},3),S(u,"$_reduce_8",function(L,V,E){var q,ae,O=t,G=t;return G=null==(q=K(L))[2]?t:q[2],R((O=null==q[0]?t:q[0])["$settable_first_roll_adjust_option?"]())||this.$raise(h("ParseError")),ae=[G.$to_i()],k(O,"first_to=",M(ae)),N(ae.length,1),O},3),S(u,"$_reduce_9",function(L,V,E){var q,ae,O=t,G=t;return G=null==(q=K(L))[3]?t:q[3],R((O=null==q[0]?t:q[0])["$settable_first_roll_adjust_option?"]())||this.$raise(h("ParseError")),ae=[G.$to_i()],k(O,"first_modify=",M(ae)),N(ae.length,1),O},3),S(u,"$_reduce_10",function(L,V,E){var q,ae,O=t,G=t;return G=null==(q=K(L))[3]?t:q[3],R((O=null==q[0]?t:q[0])["$settable_first_roll_adjust_option?"]())||this.$raise(h("ParseError")),ae=[G.$to_i()["$-@"]()],k(O,"first_modify=",M(ae)),N(ae.length,1),O},3),S(u,"$_reduce_11",function(L,V,E){var q,G,O=t;return q=K(L),R((O=null==q[0]?t:q[0]).$modifier_after_half()["$nil?"]())||this.$raise(h("ParseError")),G=[e(e(h("Arithmetic"),"Node"),"Number").$new(0)],k(O,"modifier_after_half=",M(G)),N(G.length,1),O},3),S(u,"$_reduce_12",function(L,V,E){var q,G,ae,O=t;return G=null==(q=K(L))[2]?t:q[2],R((O=null==q[0]?t:q[0]).$modifier_after_half()["$nil?"]())||this.$raise(h("ParseError")),k(O,"modifier_after_half=",M(ae=[G])),N(ae.length,1),O},3),S(u,"$_reduce_13",function(L,V,E){var q,G,ae,O=t;return O=null==(q=K(L))[0]?t:q[0],G=null==q[2]?t:q[2],R(["v2_5","v2_0"]["$include?"](this.version))&&R(O.$rateup()["$nil?"]())||this.$raise(h("ParseError")),k(O,"rateup=",M(ae=[G])),N(ae.length,1),O},3),S(u,"$_reduce_14",function(L,V,E){var q,G,O=t;return O=null==(q=K(L))[0]?t:q[0],R(["v2_5","v2_0"]["$include?"](this.version))&&R(O["$settable_non_2d_roll_option?"]())||this.$raise(h("ParseError")),k(O,"greatest_fortune=",M(G=[!0])),N(G.length,1),O},3),S(u,"$_reduce_15",function(L,V,E){var q,ae,O=t,G=t;return O=null==(q=K(L))[0]?t:q[0],G=null==q[3]?t:q[3],R(["v2_5","v2_0"]["$include?"](this.version))&&R(O["$settable_non_2d_roll_option?"]())||this.$raise(h("ParseError")),ae=[G.$to_i()],k(O,"semi_fixed_val=",M(ae)),N(ae.length,1),O},3),S(u,"$_reduce_16",function(L,V,E){var q,ae,O=t,G=t;return O=null==(q=K(L))[0]?t:q[0],G=null==q[3]?t:q[3],R(["v2_5","v2_0"]["$include?"](this.version))&&R(O["$settable_non_2d_roll_option?"]())||this.$raise(h("ParseError")),ae=[G.$to_i()],k(O,"tmp_fixed_val=",M(ae)),N(ae.length,1),O},3),S(u,"$_reduce_17",function(L,V,E){var q,G,ae,O=t;return O=null==(q=K(L))[0]?t:q[0],G=null==q[2]?t:q[2],U(this.version,"v2_5")&&R(O.$kept_modify()["$nil?"]())||this.$raise(h("ParseError")),k(O,"kept_modify=",M(ae=[G])),N(ae.length,1),O},3),S(u,"$_reduce_18",function(L,V,E){return L["$[]"](1)},3),S(u,"$_reduce_19",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"Negative").$new(L["$[]"](1))},3),S(u,"$_reduce_20",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"BinaryOp").$new(L["$[]"](0),"+",L["$[]"](2))},3),S(u,"$_reduce_21",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"BinaryOp").$new(L["$[]"](0),"-",L["$[]"](2))},3),S(u,"$_reduce_22",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"BinaryOp").$new(L["$[]"](0),"+",L["$[]"](2))},3),S(u,"$_reduce_23",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"BinaryOp").$new(L["$[]"](0),"-",L["$[]"](2))},3),S(u,"$_reduce_25",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"BinaryOp").$new(L["$[]"](0),"*",L["$[]"](2))},3),S(u,"$_reduce_26",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(L["$[]"](0),L["$[]"](2))},3),S(u,"$_reduce_28",function(L,V,E){return L["$[]"](1)},3),S(u,"$_reduce_29",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"Negative").$new(L["$[]"](1))},3),S(u,"$_reduce_31",function(L,V,E){return L["$[]"](1)},3),S(u,"$_reduce_32",function(L,V,E){return e(e(h("Arithmetic"),"Node"),"Number").$new(L["$[]"](0))},3),S(u,"$_reduce_none",function(L,V,E){return L["$[]"](0)},3)},Opal.modules["bcdice/game_system/SwordWorld"]=function(r){var b,m,d,g,u,p,h,c,i,y,Y=r.top,$=[],t=r.nil,e=r.module,x=r.klass,P=r.const_set,H=r.send2,a=r.find_super,F=r.def,S=r.truthy,k=r.rb_ge,R=r.rb_le,M=r.eqeq,N=r.neqeq,W=r.rb_minus,Z=r.rb_gt,ne=r.hash2,K=r.send,U=r.to_ary,o=r.rb_plus,f=r.rb_lt,C=r.rb_times,I=r.to_a,j=r.rb_divide;return Y.$require("bcdice/base"),Y.$require("bcdice/game_system/sword_world/rating_parser"),b=$,m=y=[e($[0],"BCDice")].concat(b),c=[e(y[0],"GameSystem")].concat(m),i=r.$r(c),d=c,u=[g=x(c[0],i("Base"),"SwordWorld")].concat(d),p=r.$r(u),(h=g.$$prototype).rating_table=h.randomizer=t,P(u[0],"ID","SwordWorld"),P(u[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),P(u[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),P(u[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),g.$register_prefix("H?K"),F(g,"$initialize",function Q(l){var z=this;return delete Q.$$p,H(z,a(z,"initialize",Q,!1,!0),"initialize",[l],null),z.rating_table=0},1),F(g,"$result_2d6",function(l,X,z,$e,ue){return S(k(X,12))?p("Result").$critical(this.$translate("SwordWorld.critical")):S(R(X,2))?p("Result").$fumble(this.$translate("SwordWorld.fumble")):N($e,">=")||M(ue,"?")?t:S(k(l,ue))?p("Result").$success(this.$translate("success")):p("Result").$failure(this.$translate("failure"))},5),F(g,"$eval_game_system_specific_command",function(l){return this.$rating(l)},1),g.$private(),F(g,"$rating_parser",function(){return p("RatingParser").$new()},0),F(g,"$rating",function(l){var X,z,$e=this,ue=t,_e=t,fe=t,le=t,te=t,A=t,J=t,B=t,D=t,se=t,re=t,L=t,V=t,E=t,ie=t,ce=t;return $e.$debug("rating string",l),ue=$e.$rating_parser().$parse(l),S(ue)?(_e=$e.$getSW2_0_RatingTable(),fe=W(_e.$length(),1),$e.$debug("keyMax",fe),S(Z(ue.$rate(),fe))?p("Result").$new($e.$translate("SwordWorld.keynumber_exceeds",ne(["keyMax"],{keyMax:fe}))):S(ue["$infinite_roll?"]())?p("Result").$new($e.$translate("SwordWorld.infinite_critical",ne(["min_critical"],{min_critical:ue.$min_critical()}))):(le=$e.$getNewRates(_e),te=ue+" \uff1e ",A=[],J=[],B=[],D=0,se=0,re=0,L=0,V=ue.$first_to(),E=ue.$first_modify(),function(){var O=r.new_brk();try{K($e,"loop",[],function ee(){var G,ae,he,oe,me=null==ee.$$s?this:ee.$$s,ve=t,be=t;if(ae=me.$rollDice(ue,L),be=null==(G=U(ae))[1]?t:G[1],D=ve=null==G[0]?t:G[0],N(V,0)?(D=ve=V,V=0):N(E,0)&&(D=o(D,E),E=0),S(R(ve,2))&&(A["$<<"](ve.$to_s()),J["$<<"](be.$to_s()),B["$<<"]("**"),L=o(L,1),r.brk(t,O)),N(ue.$kept_modify(),0)&&N(D,2)&&(D=o(D,ue.$kept_modify())),S(f(D,2))&&(D=2),S(Z(D,12))&&(D=12),he=[o(ue.$rate(),C(L,ue.$rateup())),fe].$min(),me.$debug("currentKey",he),oe=le["$[]"](D)["$[]"](he),me.$debug("rateValue",oe),re=o(re,oe),se=o(se,D),A["$<<"](D.$to_s()),J["$<<"](be.$to_s()),B["$<<"](S(Z(D,2))?oe:"**"),L=o(L,1),S(k(D,ue.$critical())))return t;r.brk(t,O)},{$$arity:0,$$s:$e,$$brk:O})}catch(ee){if(ee===O)return ee.$v;throw ee}}(),z=$e.$getResultText(re,ue,J,A,B,se,L),X=U(z),ie=null==X[1]?t:X[1],ce=null==X[2]?t:X[2],te=o(te,null==X[0]?t:X[0]),K(p("Result").$new(),"tap",[],function(ee){var G=t;return null==ee&&(ee=t),K(ee,"text=",I(G=[te])),W(G.length,1),K(ee,"critical=",I(G=[ie])),W(G.length,1),K(ee,"fumble=",I(G=[ce])),G[W(G.length,1)]},1))):($e.$debug("not matched"),"1")},1),F(g,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]},0),F(g,"$getNewRates",function(l){var z=t,$e=t,ue=t,_e=t,fe=t,le=t,te=t,A=t,J=t,B=t,D=t,se=t;return z=[],$e=[],ue=[],_e=[],fe=[],le=[],te=[],A=[],J=[],B=[],D=[],K(l,"each",[],function(V){var E=t;return null==V&&(V=t),E=V.$split(/,/),D.$push(0),z.$push(E["$[]"](1).$to_i()),$e.$push(E["$[]"](2).$to_i()),ue.$push(E["$[]"](3).$to_i()),_e.$push(E["$[]"](4).$to_i()),fe.$push(E["$[]"](5).$to_i()),le.$push(E["$[]"](6).$to_i()),te.$push(E["$[]"](7).$to_i()),A.$push(E["$[]"](8).$to_i()),J.$push(E["$[]"](9).$to_i()),B.$push(E["$[]"](10).$to_i())},1),M(this.rating_table,1)&&(se=[31,(se=[32,(se=[33,10],K(B,"[]=",I(se)),se[W(se.length,1)])],K(B,"[]=",I(se)),se[W(se.length,1)])],K(B,"[]=",I(se)),W(se.length,1)),[D,D,D,z,$e,ue,_e,fe,le,te,A,J,B]},1),F(g,"$rollDice",function(l,X){var $e=t;return[($e=this.randomizer.$roll_barabara(2,6)).$sum(),$e.$join(",")]},2),F(g,"$getResultText",function(l,X,z,$e,ue,_e,fe){var le=t,te=t,A=t,J=t,B=t;return(le=[]).$push("2D:["+z.$join(" ")+"]="+$e.$join(",")),S(R(_e,2))?(le.$push(ue.$join(",")),le.$push("\u81ea\u52d5\u7684\u5931\u6557"),[le.$join(" \uff1e "),!1,!0]):(S(Z(ue.$size(),1))||N(X.$modifier(),0)?(te=o(ue.$join(","),p("Format").$modifier(X.$modifier())),S(X.$half())&&(te="("+te+")/2",N(X.$modifier_after_half(),0)&&(te=o(te,p("Format").$modifier(X.$modifier_after_half())))),le.$push(te)):S(X.$half())&&(te=ue.$first()+"/2",N(X.$modifier_after_half(),0)&&(te=o(te,p("Format").$modifier(X.$modifier_after_half()))),le.$push(te)),S(Z(fe,1))&&(A=W(fe,1)+"\u56de\u8ee2",le.$push(A)),J=o(l,X.$modifier()),S(X.$half())&&(J=j(J,2).$ceil(),N(X.$modifier_after_half(),0)&&(J=o(J,X.$modifier_after_half()))),B=J.$to_s(),le.$push(B),[le.$join(" \uff1e "),Z(fe,1),!1])},7)},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(r){var ne,f,T,c,i,n,s,d,v,I,j,U,Y=r.top,$=[],t=r.nil,e=r.module,x=r.klass,P=r.def,H=r.truthy,a=r.rb_lt,F=r.hash2,S=r.not,k=r.rb_ge,R=r.rb_plus,M=r.send,N=r.to_a,W=r.rb_minus;return Y.$require("bcdice/result"),Y.$require("bcdice/translate"),ne=$,f=U=[e($[0],"BCDice")].concat(ne),I=[e(U[0],"GameSystem")].concat(f),j=r.$r(I),T=I,c=v=[x(I[0],j("SwordWorld"),"SwordWorld2_0")].concat(T),n=[i=x(v[0],null,"TranscendentTest")].concat(c),s=r.$r(n),(d=i.$$prototype).modifier=d.critical_value=d.expression=d.modifier_str=d.target=d.cmp_op=t,i.$include(s("Translate")),P(i,"$initialize",function(u,p,h,Q,l){var X=this;return X.critical_value=u,X.modifier=p,X.cmp_op=h,X.target=Q,X.locale=l,X.modifier_str=s("Format").$modifier(X.modifier),X.expression=X.$node_expression()},5),P(i,"$execute",function(u){var X,z,$e,h=this,Q=t,l=t,ue=t,_e=t,fe=t,le=t;if(H(a(h.critical_value,3)))return h.$translate("SwordWorld2_0.transcendent_critical_too_small",F(["expression"],{expression:h.expression}));if(l=[Q=u.$roll_barabara(2,6)],X=Q["$=="]([1,1]),z=Q["$=="]([6,6]),S(X)&&S(z))for(;H(k(h.$sum_of_dice(l.$last()),h.critical_value));)l.$push(u.$roll_barabara(2,6));return $e=h.$sum_of_dice(l),ue=R($e,h.modifier),_e=h.$result_status(ue,l.$length(),X,z),fe=F(["success","failure","super_success","critical","fumble"],{success:h.$translate("success"),failure:h.$translate("failure"),super_success:h.$translate("SwordWorld2_0.super_success"),critical:h.$translate("SwordWorld.critical"),fumble:h.$translate("SwordWorld.fumble")}).$freeze()["$[]"](_e),le=["("+h.expression+")",""+h.$dice_str(l,$e)+h.modifier_str,ue,fe].$compact(),M(s("Result").$new(),"tap",[],function(A){var J=t;return null==A&&(A=t),J=[le.$join(" \uff1e ")],M(A,"text=",N(J)),W(J.length,1),J=[_e["$=="]("fumble")],M(A,"fumble=",N(J)),W(J.length,1),J=[_e["$=="]("critical")],M(A,"critical=",N(J)),W(J.length,1),J=[["success","super_success","critical"]["$include?"](_e)],M(A,"success=",N(J)),W(J.length,1),J=[["failure","fumble"]["$include?"](_e)],M(A,"failure=",N(J)),J[W(J.length,1)]},1)},1),i.$private(),P(i,"$node_expression",function(){var p,u=this;return p="2D6@"+u.critical_value+u.modifier_str,H(u.target)?""+p+u.cmp_op+u.target:p},0),P(i,"$sum_of_dice",function(u){return u.$flatten().$sum()},1),P(i,"$dice_str",function(u,p){return""+p+M(u,"map",[],function(l){return null==l&&(l=t),"["+l.$join(",")+"]"},1).$join()},2),P(i,"$result_status",function(u,p,h,Q){var l=this;return H(l.target)?H(h)?"fumble":H(Q)?"critical":H(u.$send(l.cmp_op,l.target))?H(k(p,2))&&H(k(u,41))?"super_success":"success":"failure":"no_target"},4)},Opal.modules["bcdice/game_system/SwordWorld2_0"]=function(r){var f,w,_,c,i,n,s,T,y,I,Y=r.top,$=[],t=r.nil,e=r.$$$,x=r.module,P=r.klass,H=r.const_set,a=r.send2,F=r.find_super,S=r.def,k=r.eqeqeq,R=r.truthy,M=r.hash2,N=r.rb_gt,W=r.rb_plus,Z=r.eqeq,ne=r.rb_times,K=r.send,U=r.neqeq;return Y.$require("bcdice/arithmetic_evaluator"),Y.$require("bcdice/game_system/SwordWorld"),Y.$require("bcdice/game_system/sword_world/transcendent_test"),f=$,w=I=[x($[0],"BCDice")].concat(f),T=[x(I[0],"GameSystem")].concat(w),y=r.$r(T),_=T,i=[c=P(T[0],y("SwordWorld"),"SwordWorld2_0")].concat(_),n=r.$r(i),(s=c.$$prototype).locale=s.randomizer=t,H(i[0],"ID","SwordWorld2.0"),H(i[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),H(i[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),H(i[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),c.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),S(c,"$initialize",function d(g){var p=this;return delete d.$$p,a(p,F(p,"initialize",d,!1,!0),"initialize",[g],null),p.rating_table=2},1),S(c,"$eval_game_system_specific_command",function d(g){var h,p=this,l=t;return delete d.$$p,k(/^Gr(\d+)?/i,h=g)?R(g["$=~"](/^Gr(\d+)/i))?p.$growth(n("Regexp").$last_match(1).$to_i()):p.$growth():k(/^2D6?@\d+/i,h)?(l=e(n("Command"),"Parser").$new(/2D6?/i,M(["round_type"],{round_type:e(e(n("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(t,">=",">").$parse(g),R(l)?n("TranscendentTest").$new(l.$critical(),l.$modify_number(),l.$cmp_op(),l.$target_number(),p.locale).$execute(p.randomizer):t):k("FT",h)?p.$get_fumble_table():k("TT",h)?p.$get_tangle_table():a(p,F(p,"eval_game_system_specific_command",d,!1,!0),"eval_game_system_specific_command",[g],null)},1),S(c,"$rating_parser",function(){return n("RatingParser").$new(M(["version"],{version:"v2_0"}))},0),S(c,"$rollDice",function d(g,u){var h=this,Q=t;return delete d.$$p,R(N(g.$semi_fixed_val(),0))?(Q=h.randomizer.$roll_once(6),[W(Q,g.$semi_fixed_val()),Q+","+g.$semi_fixed_val()]):Z(u,0)&&R(N(g.$tmp_fixed_val(),0))?(Q=h.randomizer.$roll_once(6),[W(Q,g.$tmp_fixed_val()),Q+","+g.$tmp_fixed_val()]):R(g.$greatest_fortune())?(Q=h.randomizer.$roll_once(6),[ne(Q,2),Q+","+Q]):a(h,F(h,"rollDice",d,!1,!0),"rollDice",[g,u],null)},2),S(c,"$growth",function(g){return null==g&&(g=1),K(r.Range.$new(1,g,!1),"map",[],function p(){return(null==p.$$s?this:p.$$s).$growth_step()},{$$arity:0,$$s:this}).$join(" | ")},-1),S(c,"$growth_step",function(){var g=this,u=t,p=t,h=t;return p=(u=e(n("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",g.locale)).$roll(g.randomizer),h=u.$roll(g.randomizer),U(p.$value(),h.$value())?"["+p.$value()+","+h.$value()+"]->("+p.$body()+" or "+h.$body()+")":"["+p.$value()+","+h.$value()+"]->("+p.$body()+")"},0),S(c,"$get_fumble_table",function(){return e(n("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)},0),S(c,"$get_tangle_table",function(){return e(n("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)},0)},Opal.queue(function(r){var K,C,y,v,m,_,c,j,w,o,$=[],t=r.nil,e=r.$$$,x=r.module,P=r.klass,H=r.const_set,a=r.eqeqeq,F=r.send,S=r.hash2,k=r.truthy,R=r.send2,M=r.find_super,N=r.def,W=r.range,Z=r.rb_plus;return r.top.$require("bcdice/game_system/SwordWorld2_0"),K=$,C=o=[x($[0],"BCDice")].concat(K),j=[x(o[0],"GameSystem")].concat(C),w=r.$r(j),y=j,m=[v=P(j[0],w("SwordWorld2_0"),"SwordWorld2_5")].concat(y),_=r.$r(m),(c=v.$$prototype).randomizer=c.locale=t,H(m[0],"ID","SwordWorld2.5"),H(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.5"),H(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.5"),H(m[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u5fc5\u6bba\u653b\u6483\u7528\uff09\n\u3000\u300c\uff03\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r5\n\u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u30c9\u30eb\u30a4\u30c9\u306e\u7269\u7406\u9b54\u6cd5\u7528\u8868\u3000(Dru[2-6\u306e\u5024,7-9\u306e\u5024,10-12\u306e\u5024])\n\u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n\u30fb\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3000(ABT)\n\u3000\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),v.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT","Dru","ABT"),N(v,"$eval_game_system_specific_command",function i(n){var g,d=this,u=t,h=t;return delete i.$$p,a(/^dru\[(\d+),(\d+),(\d+)\]/i,g=n)?(u=F(_("Regexp").$last_match().$captures(),"map",[],"to_i".$to_proc()),h=e(_("Command"),"Parser").$new(/dru\[\d+,\d+,\d+\]/i,S(["round_type"],{round_type:e(e(_("BCDice"),"RoundType"),"CEIL")})).$parse(n),k(h)?d.$druid_dice(h,u):t):a("ABT",g)?d.$get_abyss_curse_table():R(d,M(d,"eval_game_system_specific_command",i,!1,!0),"eval_game_system_specific_command",[n],null)},1),N(v,"$rating_parser",function(){return _("RatingParser").$new(S(["version"],{version:"v2_5"}))},0),N(v,"$druid_dice",function(n,s){var u,p,h,Q,l,g=t;return u=(g=this.randomizer.$roll_barabara(2,6)).$sum(),p=a(W(2,6,!1),h=u)?0:a(W(7,9,!1),h)?1:a(W(10,12,!1),h)?2:t,Q=s["$[]"](p),l=Z(Q,n.$modify_number()),["("+n.$command().$capitalize()+_("Format").$modifier(n.$modify_number())+")","2D["+g.$join(",")+"]="+u,""+Q+_("Format").$modifier(n.$modify_number()),l].$join(" \uff1e ")},2),N(v,"$get_abyss_curse_table",function(){var g,n=this,s=t,d=t;return s=e(_("DiceTable"),"D66GridTable").$from_i18n("SwordWorld2_5.AbyssCurseTable",n.locale).$roll(n.randomizer),d=a(14,g=s.$value())?e(_("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseCategoryTable",n.locale).$roll(n.randomizer).$to_s():a(25,g)?e(_("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseAttrTable",n.locale).$roll(n.randomizer).$to_s():t,[s.$to_s(),d].$compact().$join("\n")},0)})}}]);