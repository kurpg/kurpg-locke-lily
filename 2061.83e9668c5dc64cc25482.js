(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[2061],{2061:function(le,ge,ue){ue(4656),Opal.modules["bcdice/game_system/EarthDawn"]=function(i){function B(u,p){return"number"==typeof u&&"number"==typeof p?u>p:u["$>"](p)}function V(u,p){return"number"==typeof u&&"number"==typeof p?u<p:u["$<"](p)}function d(u,p){return"number"==typeof u&&"number"==typeof p?u-p:u["$-"](p)}function o(u,p){return"number"==typeof u&&"number"==typeof p?u+p:u["$+"](p)}function L(u,p){return"number"==typeof u&&"number"==typeof p?u>=p:u["$>="](p)}var p,X,ie,h,z,K,C,j,J,k,T,Y,_,A=[],a=i.nil,e=i.$$,ee=i.module,F=i.klass,W=i.send2,E=i.truthy,te=i.send;return p=A,X=_=[ee(A[0],"BCDice")].concat(p),ie=Y=[ee(_[0],"GameSystem")].concat(X),k=F(Y[0],e(Y,"Base"),"EarthDawn"),T=[k].concat(ie),k.$$prototype.string=k.$$prototype.isFailed=a,i.const_set(T[0],"ID","EarthDawn"),i.const_set(T[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f3"),i.const_set(T[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u3093"),i.const_set(T[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2-D20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff099E\u300010E8\u300010E+D12\n"),k.$register_prefix("\\d+e"),i.def(k,"$initialize",h=function(w){var l=this;return h.$$p&&(h.$$p=null),W(l,i.find_super_dispatcher(l,"initialize",h,!1,!0),"initialize",[w],null),l.sort_add_dice=!0},h.$$arity=1),i.def(k,"$eval_game_system_specific_command",z=function(w){return this.$ed_step(w)},z.$$arity=1),i.def(k,"$ed_step",K=function(w){return this.$getStepResult(w)},K.$$arity=1),i.def(k,"$getStepResult",C=function(w){var r=this,f=a,l=a,v=a,N=a,b=a,s=a,t=a,n=a,$=a,g=a,y=a,S=a,c=a,R=a,D=a,x=a,I=a,M=a,G=a,Q=a;return!E(/(\d+)E(\d+)?(\+)?(\d+)?(d\d+)?/i["$=~"](w))||(f=0,r.isFailed=!0,l=e(T,"Regexp").$last_match(1).$to_i(),v=0,N=!1,b=0,s=0,E(B(l,40))&&(l=40),E(e(T,"Regexp").$last_match(2))&&(v=e(T,"Regexp").$last_match(2).$to_i(),E(B(v,43))&&(v=42)),E(e(T,"Regexp").$last_match(3))&&(N=e(T,"Regexp").$last_match(3).$to_i()),E(e(T,"Regexp").$last_match(4))&&(b=e(T,"Regexp").$last_match(4).$to_i()),E(e(T,"Regexp").$last_match(5))&&(s=e(T,"Regexp").$last_match(5)),E(V(v,0)))?a:(n=(t=r.$getStepTable())["$[]"](0)["$[]"](d(l,1)),$=t["$[]"](1)["$[]"](d(l,1)),g=t["$[]"](2)["$[]"](d(l,1)),y=t["$[]"](3)["$[]"](d(l,1)),S=t["$[]"](4)["$[]"](d(l,1)),c=t["$[]"](5)["$[]"](d(l,1)),R=t["$[]"](6)["$[]"](d(l,1)),E(N)&&(/d20/i["$==="](D=s)?$=o($,b):/d12/i["$==="](D)?g=o(g,b):/d10/i["$==="](D)?y=o(y,b):/d8/i["$==="](D)?S=o(S,b):/d6/i["$==="](D)?c=o(c,b):/d4/i["$==="](D)?R=o(R,b):n=o(n,b)),r.string="",r.$debug("d20step, d12step, d10step, d8step, d6step, d4step",$,g,y,S,c,R),f=o(f,r.$rollStep(20,$)),f=o(f,r.$rollStep(12,g)),f=o(f,r.$rollStep(10,y)),f=o(f,r.$rollStep(8,S)),f=o(f,r.$rollStep(6,c)),f=o(f,r.$rollStep(4,R)),E(B(n,0))&&(r.string=o(r.string,"+")),E(n["$!="](0))&&(r.string=o(r.string,n.$to_s()),f=o(f,n)),r.string=o(r.string," \uff1e "+f),x="\u30b9\u30c6\u30c3\u30d7"+l+" \uff1e "+r.string,v["$=="](0)||(r.string=o(r.string," \uff1e "),I=t["$[]"](7)["$[]"](d(v,1)),M=t["$[]"](8)["$[]"](d(v,1)),G=t["$[]"](9)["$[]"](d(v,1)),Q=t["$[]"](11)["$[]"](d(v,1)),r.string=E(r.isFailed)?o(r.string,"\u81ea\u52d5\u5931\u6557"):E(L(f,I))?o(r.string,"\u6700\u826f\u6210\u529f"):E(L(f,M))?o(r.string,"\u512a\u6210\u529f"):E(L(f,G))?o(r.string,"\u826f\u6210\u529f"):E(L(f,v))?o(r.string,"\u6210\u529f"):E(V(f,Q))?o(r.string,"\u5927\u5931\u6557"):o(r.string,"\u5931\u6557"),x="\u30b9\u30c6\u30c3\u30d7"+l+">="+v+" \uff1e "+r.string),x)},C.$$arity=1),i.def(k,"$getStepTable",j=function(){return[[-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[0,0,0,0,0,1,0,0,0,1,1,2,1,0,0,0,1,0,0,0,1,1,2,1,1,1,1,2,1,1,1,2,3,2,1,1,1,2,1,1,0,0,1,0,0,0,1,0,0,0,1,1,2,1],[0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,1,1,2,1,1,1,2,2,1,1,1,1,2,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0],[0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,0,0,0,0,1,0,0,0,2,0,0,0,0,1,0,0,0,2,1,1,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[6,8,10,12,14,17,19,20,22,24,25,27,29,32,33,35,37,38,39,41,42,44,45,47,48,49,51,52,54,55,56,58,59,60,62,64,65,67,68,70,71,72],[4,6,8,10,11,13,15,16,18,19,21,22,24,26,27,29,30,32,33,34,35,37,38,40,41,42,43,45,46,47,48,49,51,52,53,55,56,58,59,60,61,62],[2,4,6,7,9,10,12,13,14,15,17,18,20,21,22,24,25,26,27,28,29,31,32,33,34,35,36,38,39,40,41,42,43,45,46,47,48,50,51,52,53,54],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],[0,1,1,1,1,2,2,3,4,5,5,6,6,7,8,8,9,10,11,12,13,13,14,15,16,17,18,18,18,20,21,22,23,23,24,25,26,26,27,28,29,30]]},j.$$arity=0),void i.def(k,"$rollStep",J=function(w,r){var f,l=this,v=a;return l.$debug("rollStep diceType, diceCount, @string",w,r,l.string),v=0,E(B(r,0))&&(E(l.string["$empty?"]())||(l.string=o(l.string,"+")),l.string=o(l.string,r+"d"+w+"["),l.$debug("rollStep @string",l.string),te(r,"times",[],((f=function(b){var s=null==f.$$s?this:f.$$s,n=a,$=a;for(null==s.randomizer&&(s.randomizer=a),null==s.string&&(s.string=a),null==b&&(b=a),n=s.randomizer.$roll_once(w),E(n["$!="](1))&&(s.isFailed=!1),$=n;n["$=="](w);)$=o($,n=s.randomizer.$roll_once(w));return v=o(v,$),E(b["$!="](0))&&(s.string=o(s.string,",")),s.string=o(s.string,$.$to_s())}).$$s=l,f.$$arity=1,f)),l.string=o(l.string,"]")),v},J.$$arity=2)},function(i){function B(m,_){return"number"==typeof m&&"number"==typeof _?m-_:m["$-"](_)}function d(m,_){return"number"==typeof m&&"number"==typeof _?m+_:m["$+"](_)}function o(m,_){return"number"==typeof m&&"number"==typeof _?m>_:m["$>"](_)}function A(m,_){return"number"==typeof m&&"number"==typeof _?m>=_:m["$>="](_)}var _,Y,T,K,C,j,J,P,w,r,f,l,v,N,h,z,q,X,O=[],e=i.nil,F=i.$$,W=i.module,E=i.klass,te=i.send2,u=i.truthy,p=i.send;i.top.$require("bcdice/game_system/EarthDawn"),_=O,Y=X=[W(O[0],"BCDice")].concat(_),T=q=[W(X[0],"GameSystem")].concat(Y),h=E(q[0],F(q,"EarthDawn"),"EarthDawn3"),z=[h].concat(T),h.$$prototype.string=h.$$prototype.isFailed=e,i.const_set(z[0],"ID","EarthDawn3"),i.const_set(z[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f33\u7248"),i.const_set(z[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u30933"),i.const_set(z[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2\uff5eD20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff09\u30b9\u30c6\u30c3\u30d710\uff1a10E\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\uff1a10E8\n\u3000\u3000\u30b9\u30c6\u30c3\u30d712\u3001\u76ee\u6a19\u50248\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9D12\uff1a10E8+1D6\n"),h.$register_prefix("\\d+e"),i.def(h,"$initialize",K=function(s){var $=this;return K.$$p&&(K.$$p=null),te($,i.find_super_dispatcher($,"initialize",K,!1,!0),"initialize",[s],null),$.sort_add_dice=!0},K.$$arity=1),i.def(h,"$eval_game_system_specific_command",C=function(s){return this.$ed_step(s)},C.$$arity=1),i.def(h,"$ed_step",j=function(s){return this.$getStepResult(s)},j.$$arity=1),i.def(h,"$getStepResult",J=function(s){var t,n,m,$=this,g=e,y=e,S=e,c=e,R=e,D=e,x=e,I=e,M=e,G=e,se=e,Z=e;return!u(/^(\d+)E(\d+)?(\+(\d*)D(\d+))?(\+\d)?/i["$=~"](s))||(g=0,$.isFailed=!0,y=F(z,"Regexp").$last_match(1).$to_i(),S=[F(z,"Regexp").$last_match(2).$to_i(),20].$min(),c=F(z,"Regexp").$last_match(3)["$nil?"]()["$!"](),R=[1,F(z,"Regexp").$last_match(4).$to_i()].$max(),D=F(z,"Regexp").$last_match(5).$to_i(),x=F(z,"Regexp").$last_match(6).$to_i(),I=F(z,"Hash").$new(0),u(c)&&(p(I,"[]=",i.to_a(M=[D,R])),B(M.length,1)),u("number"==typeof(m=S)?m<0:m["$<"](0)))?e:(G=$.$getStepInfo(y),$.$debug("stepInfo",G),$.string="",p([20,12,10,8,6,4],"each",[],((t=function(H){return null==H&&(H=e),g=d(g,(null==t.$$s?this:t.$$s).$rollStep(H,G.$shift()))}).$$s=$,t.$$arity=1,t)),se=G.$shift(),p(I,"each",[],((n=function(H,U){return null==H&&(H=e),null==U&&(U=e),g=d(g,(null==n.$$s?this:n.$$s).$rollStep(H,U))}).$$s=$,n.$$arity=2,n)),$.string=d($.string,d($.$getModifyText(se),$.$getModifyText(x))),g=d(g,d(se,x)),$.string=d($.string," \uff1e "+g),Z="\u30b9\u30c6\u30c3\u30d7"+y+" \uff1e "+$.string,S["$=="](0)||($.string=d($.string,d(" \uff1e ",$.$getSuccess(S,g))),Z="\u30b9\u30c6\u30c3\u30d7"+y+">="+S+" \uff1e "+$.string),Z)},J.$$arity=1),i.def(h,"$getModifyText",P=function(s){var t=this;return t.string="",s["$=="](0)||(u(o(s,0))&&(t.string=d(t.string,"+")),t.string=d(t.string,s.$to_s())),t.string},P.$$arity=1),i.def(h,"$getBaseStepTable",w=function(){return[[1,[0,0,0,0,1,0,-3]],[2,[0,0,0,0,1,0,-2]],[3,[0,0,0,0,1,0,-1]],[4,[0,0,0,0,1,0,0]],[5,[0,0,0,1,0,0,0]],[6,[0,0,1,0,0,0,0]],[7,[0,1,0,0,0,0,0]]]},w.$$arity=0),i.def(h,"$getStepInfo",r=function(s){var t,g,n=this,$=e,y=e,S=e,c=e,R=e,D=e,x=e,I=e;return g=($=n.$getBaseStepTable()).$last().$first(),u(function(m,_){return"number"==typeof m&&"number"==typeof _?m<=_:m["$<="](_)}(s,g))?n.$get_table_by_number(s,$):(y=[0,1,0,0,0,0,0],S=B(B(s,g),1),R=[0,0,0,0,0,0,0],D=function(m,_){return"number"==typeof m&&"number"==typeof _?m/_:m["$/"](_)}(S,(c=[[0,0,0,0,2,0,0],[0,0,0,1,1,0,0],[0,0,0,2,0,0,0],[0,0,1,1,0,0,0],[0,0,2,0,0,0,0],[0,1,1,0,0,0,0],[0,2,0,0,0,0,0]]).$size()).$to_i(),p(D,"times",[],((t=function(){return(null==t.$$s?this:t.$$s).$addStepToResult(R,y)}).$$s=n,t.$$arity=0,t)),x=S["$%"](c.$size()),I=c["$[]"](x),n.$addStepToResult(R,I),R)},r.$$arity=1),i.def(h,"$addStepToResult",f=function(s,t){var n;return p(s.$size(),"times",[],((n=function(y){var c;return null==y&&(y=e),c=[y,d(s["$[]"](y),t["$[]"](y))],p(s,"[]=",i.to_a(c)),c[B(c.length,1)]}).$$s=this,n.$$arity=1,n)),s},f.$$arity=2),i.def(h,"$getSuccess",l=function(s,t){var n,g=this,y=e,S=e,c=e,R=e,D=e,x=e,I=e;return u(g.isFailed)?"\u81ea\u52d5\u5931\u6557":(y=g.$getSuccessTable(),S=g.$get_table_by_number(s,y),c=null==(n=i.to_ary(S))[0]?e:n[0],R=null==n[1]?e:n[1],D=null==n[2]?e:n[2],x=null==n[3]?e:n[3],I=null==n[4]?e:n[4],u(A(t,null==n[5]?e:n[5]))?"Extraordinary(\u6975\u4e0a)":u(A(t,I))?"Excelent(\u6700\u9ad8)":u(A(t,x))?"Good(\u4e0a\u51fa\u6765)":u(A(t,D))?"Average(\u305d\u3053\u305d\u3053)":u(A(t,R))?"Poor(\u304a\u7c97\u672b)":u(A(t,c))?"Pathetic(\u60e8\u3081)":e)},l.$$arity=2),i.def(h,"$getSuccessTable",v=function(){return[[2,[0,1,2,5,7,9]],[3,[0,1,3,6,8,10]],[4,[0,1,4,7,10,12]],[5,[1,2,5,8,11,14]],[6,[1,2,6,9,13,17]],[7,[1,3,7,11,15,19]],[8,[1,4,8,13,16,20]],[9,[1,5,9,15,18,22]],[10,[1,6,10,16,20,24]],[11,[1,6,11,17,21,25]],[12,[1,7,12,18,23,27]],[13,[1,7,13,20,25,29]],[14,[1,8,14,21,26,31]],[15,[1,9,15,23,27,31]],[16,[1,10,16,24,28,33]],[17,[1,11,17,25,30,34]],[18,[1,12,18,26,31,36]],[19,[1,12,19,28,33,37]],[20,[1,13,20,29,34,39]],[21,[1,14,21,30,36,41]],[22,[1,15,22,31,37,42]],[23,[1,16,23,33,38,43]],[24,[1,16,24,34,39,44]],[25,[1,17,25,35,41,46]],[26,[1,18,26,36,42,47]],[27,[1,19,27,37,43,49]],[28,[1,19,28,39,45,50]],[29,[1,21,29,40,46,51]],[30,[1,21,30,41,47,53]],[31,[1,22,31,42,48,54]],[32,[1,23,32,43,49,55]],[33,[1,24,33,45,51,57]],[34,[1,24,34,46,52,58]],[35,[1,25,35,47,53,60]],[36,[1,26,36,48,54,60]],[37,[1,27,37,49,56,62]],[38,[1,28,38,51,57,63]],[39,[1,29,39,52,58,64]],[40,[1,30,40,53,59,66]]]},v.$$arity=0),i.def(h,"$rollStep",N=function(s,t){var n,$=this,g=e;return $.$debug("rollStep diceType, diceCount, @string",s,t,$.string),g=0,u(o(t,0))&&(u($.string["$empty?"]())||($.string=d($.string,"+")),$.string=d($.string,t+"d"+s+"["),$.$debug("rollStep @string",$.string),p(t,"times",[],((n=function(S){var c=null==n.$$s?this:n.$$s,D=e,x=e;for(null==c.randomizer&&(c.randomizer=e),null==c.string&&(c.string=e),null==S&&(S=e),D=c.randomizer.$roll_once(s),u(D["$!="](1))&&(c.isFailed=!1),x=D;D["$=="](s);)x=d(x,D=c.randomizer.$roll_once(s));return g=d(g,x),u(S["$!="](0))&&(c.string=d(c.string,",")),c.string=d(c.string,x.$to_s())}).$$s=$,n.$$arity=1,n)),$.string=d($.string,"]")),g},N.$$arity=2)}(Opal)}}]);