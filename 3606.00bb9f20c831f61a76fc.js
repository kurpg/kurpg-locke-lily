(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[3606],{3606:function(Be,Re,ye){ye(4656),function(l){function K(i,u){return"number"==typeof i&&"number"==typeof u?i>=u:i["$>="](u)}function A(i,u){return"number"==typeof i&&"number"==typeof u?i-u:i["$-"](u)}function c(i,u){return"number"==typeof i&&"number"==typeof u?i+u:i["$+"](u)}function q(i,u){return"number"==typeof i&&"number"==typeof u?i>u:i["$>"](u)}function X(i,u){return"number"==typeof i&&"number"==typeof u?i<u:i["$<"](u)}function N(i,u){return"number"==typeof i&&"number"==typeof u?i*u:i["$*"](u)}function Z(i,u){return"number"==typeof i&&"number"==typeof u?i/u:i["$/"](u)}function O(i,u){return"number"==typeof i&&"number"==typeof u?i<=u:i["$<="](u)}var u,Ae,ze,E,te,re,ie,ue,se,le,oe,_e,ae,fe,ce,a,d,Y,ne,ee=[],e=l.nil,pe=l.$$$,x=l.$$,$e=l.module,ve=l.klass,Te=l.send2,s=l.truthy,y=l.send,xe=l.hash2;u=ee,Ae=ne=[$e(ee[0],"BCDice")].concat(u),ze=Y=[$e(ne[0],"GameSystem")].concat(Ae),a=ve(Y[0],x(Y,"Base"),"TunnelsAndTrolls"),d=[a].concat(ze),a.$$prototype.dice_total=a.$$prototype.count_6=a.$$prototype.randomizer=a.$$prototype.dice_list=e,l.const_set(d[0],"ID","TunnelsAndTrolls"),l.const_set(d[0],"NAME","\u30c8\u30f3\u30cd\u30eb\u30ba\uff06\u30c8\u30ed\u30fc\u30eb\u30ba"),l.const_set(d[0],"SORT_KEY","\u3068\u3093\u306d\u308b\u3059\u3042\u3093\u3068\u3068\u308d\u304a\u308b\u3059"),l.const_set(d[0],"HELP_MESSAGE",'\u30fb\u884c\u70ba\u5224\u5b9a\u3000(nD6+x>=nLV)\n\u5931\u6557\u3001\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3068\u30be\u30ed\u76ee\u306e\u632f\u308a\u8db3\u3057\u7d4c\u9a13\u5024\u306e\u81ea\u52d5\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\nSAVE\u306e\u96e3\u6613\u5ea6\u3092\u300c\u30ec\u30d9\u30eb\u300d\u3067\u8868\u8a18\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300c2Lv\u300d\u3068\u66f8\u304f\u3068\u300c25\u300d\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\u5224\u5b9a\u6642\u4ee5\u5916\u306f\u60aa\u610f\u30c0\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u7528\u306b\u5c02\u7528\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\n\u4f8b\uff092D6+1>=1Lv\n\u3000 (2D6+1>=20) \uff1e 7[2,5]+1 \uff1e 8 \uff1e \u5931\u6557\n\u3000\u5224\u5b9a\u6642\u306b\u306f\u30be\u30ed\u76ee\u3092\u81ea\u52d5\u3067\u632f\u308a\u8db3\u3057\u307e\u3059\u3002\n\n\u30fb\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3000(nBS+x or nHBS+x)\n\u3000"(\u30c0\u30a4\u30b9\u6570)BS(\u4fee\u6b63\u5024)"\u3067\u30d0\u30fc\u30b5\u30fc\u30af\u3001"(\u30c0\u30a4\u30b9\u6570)HBS(\u4fee\u6b63\u5024)"\u3067\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3067\u30ed\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\u3000\u6700\u521d\u306e\u30c0\u30a4\u30b9\u306e\u8aad\u66ff\u306f\u3001\u500b\u5225\u306e\u51fa\u76ee\u306f\u305d\u306e\u307e\u307e\u3067\u8868\u793a\u3002\n\u3000\u4e0b\u304b\u3089\uff12\u756a\u76ee\u306e\u51fa\u76ee\u3092\u305a\u3089\u3057\u305f\u5206\u3060\u3051\u5408\u8a08\u306b\u30de\u30a4\u30ca\u30b9\u4fee\u6b63\u3092\u8ffd\u52a0\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n'),a.$register_prefix("\\d+H?BS","\\d+R6","\\d+D\\d+"),l.def(a,"$initialize",E=function(t){var n=this;return E.$$p&&(E.$$p=null),Te(n,l.find_super_dispatcher(n,"initialize",E,!1,!0),"initialize",[t],null),n.sort_add_dice=!0},E.$$arity=1),a.$private(),l.def(a,"$replace_text",te=function(t){var r,$,n,o,m=this;return s(/BS/i["$=~"](t))&&(t=y(t,"gsub",[/(\d+)HBS([^\d\s][+\-\d]+)/i],((r=function(){return x(d,"Regexp").$last_match(1)+"R6"+x(d,"Regexp").$last_match(2)+"[H]"}).$$s=m,r.$$arity=0,r)),t=y(t,"gsub",[/(\d+)HBS/i],(($=function(){return x(d,"Regexp").$last_match(1)+"R6[H]"}).$$s=m,$.$$arity=0,$)),t=y(t,"gsub",[/(\d+)BS([^\d\s][+\-\d]+)/i],((n=function(){return x(d,"Regexp").$last_match(1)+"R6"+x(d,"Regexp").$last_match(2)}).$$s=m,n.$$arity=0,n)),t=y(t,"gsub",[/(\d+)BS/i],((o=function(){return x(d,"Regexp").$last_match(1)+"R6"}).$$s=m,o.$$arity=0,o))),t},te.$$arity=1),l.def(a,"$eval_game_system_specific_command",re=function(t){var r,$=this,n=e,o=e,m=e,_=e,b=e,g=e,p=e,h=e,k=e,J=e,L=e,w=e,Q=e;return s(/^\d+D\d+/i["$match?"](t))?$.$roll_action(t):(t=$.$replace_text(t),$.$debug("tandt_berserk string",t),n="1",s(o=/(^|\s)S?((\d+)[rR]6([+\-\d]*)(\[(\w+)\])?)(\s|$)/i.$match(t))&&($.$debug("tandt_berserk matched"),t=o["$[]"](2),m=o["$[]"](3).$to_i(),_=0,s(o["$[]"](4))&&(_=x(d,"ArithmeticEvaluator").$eval(o["$[]"](4))),b=!1,s(s(g=o["$[]"](5))?o["$[]"](6)["$=~"](/[Hh]/):g)&&(b=!0),p=[],h=0,k="",J=!0,L=0,w=0,$.$debug("isHyperBerserk",b),p.$push(m),function(){var U=l.new_brk();try{y($,"loop",[],((r=function(){var z,B,R,H,F,de,T=null==r.$$s?this:r.$$s,j=e,G=e,me=e,P=e,D=e,be=e,C=e,M=e;if(null==T.randomizer&&(T.randomizer=e),T.$debug("loop dice_arr",p),F=p.$shift(),T.$debug("roll dice_wk d6",F),de=(j=T.randomizer.$roll_barabara(F,6).$sort()).$sum(),G=j.$count(6),s(K(F,2))&&(me=j,D=[],y(P=6,"times",[],((z=function(f){return null==f&&(f=e),D.$push(0)}).$$s=T,z.$$arity=1,z)),y(me,"each",[],((B=function(f){var S;return null==f&&(f=e),S=[A(f,1),c(D["$[]"](A(f,1)),1)],y(D,"[]=",l.to_a(S)),S[A(S.length,1)]}).$$s=T,B.$$arity=1,B)),y(D,"each",[],((R=function(f){return null==f&&(f=e),s(K(f,2))?(s(b)&&(f=c(f,1)),p.$push(f)):e}).$$s=T,R.$$arity=1,R)),s(s(be=J)?p["$empty?"]():be)&&(C=0,M=0,y(P,"times",[],((H=function(f){var S,I=null==H.$$s?this:H.$$s;return null==f&&(f=e),S=A(A(P,f),1),I.$debug("diceType index",S),s(q(D["$[]"](S),0))?(M=C,C=S):e}).$$s=T,H.$$arity=1,H)),T.$debug("min1, min2",C,M),w=A(M,C)["$-@"](),M["$=="](5)&&(G=A(G,1)),s(b)?p.$push(3):p.$push(2))),h=c(h,de),s(k["$!="](""))&&(k=c(k,"][")),k=c(k,j.$join(",")),L=c(L,G),J=!1,T.$debug("loop last chek dice_arr",p),!s(p["$empty?"]()))return e;l.brk(e,U)}).$$s=$,r.$$brk=U,r.$$arity=0,r))}catch(V){if(V===U)return V.$v;throw V}}(),$.$debug("loop breaked"),$.$debug("dice_now, bonus, bonus2",h,_,w),Q=c(c(h,_),w),n=h+(k="["+k+"]"),s(X(w,0))&&($.$debug("bonus2",w),n=c(n,w.$to_s())),$.$debug("bonus",_),s(q(_,0))?n=c(n,"+"+_):s(X(_,0))&&(n=c(n,_.$to_s())),n=s(n["$=~"](/[^\d\[\]]+/))?"("+t+") \uff1e "+n+" \uff1e "+Q:"("+t+") \uff1e "+Q,s(q(L,0))&&(n=c(n," \uff1e \u60aa\u610f"+L))),n)},re.$$arity=1),l.def(a,"$roll_action",ie=function(t){var r,$=this,o=e,m=e,_=e,b=e;return t=y(t,"sub",[/\d+LV$/i],((r=function(h){return null==h&&(h=e),c(N(h.$to_i(),5),15)}).$$s=$,r.$$arity=1,r)),o=pe(x(d,"Command"),"Parser").$new(/\d+D6/,xe(["round_type"],{round_type:$.$round_type()})).$restrict_cmp_op_to(e,">=").$enable_question_target().$parse(t),s(o)?(m=o.$command().$to_i(),$.$roll_action_dice(m),_=c($.dice_total,o.$modify_number()),b=s(o["$question_target?"]())?"?":o.$target_number(),["("+o+")",$.$interim_expr(o,$.dice_total),_.$to_s(),$.$action_result(_,$.dice_total,b),$.$additional_result($.count_6)].$compact().$join(" \uff1e ")):e},ie.$$arity=1),l.def(a,"$roll_action_dice",ue=function(t){var $=this,n=e,o=e;for(n=$.randomizer.$roll_barabara(t,6).$sort(),$.dice_list=[n];s($["$same_all_dice?"](n));)n=$.randomizer.$roll_barabara(t,6).$sort(),$.dice_list.$push(n);return o=$.dice_list.$flatten(),$.dice_total=o.$sum(),$.count_6=o.$count(6)},ue.$$arity=1),l.def(a,"$same_all_dice?",se=function(t){var $;return s($=q(t.$size(),1))?t.$uniq().$size()["$=="](1):$},se.$$arity=1),l.def(a,"$interim_expr",le=function(t,r){var $,o,n=this,m=e,_=e;return s(s(o=n.dice_list.$flatten().$size()["$=="](1))?t.$modify_number()["$=="](0):o)?e:(m=y(n.dice_list,"map",[],($=function(g){return null==g&&(g=e),"["+g.$join(",")+"]"},$.$$s=n,$.$$arity=1,$)).$join(""),_=x(d,"Format").$modifier(t.$modify_number()),[r.$to_s(),m,_].$join(""))},le.$$arity=2),l.def(a,"$action_result",oe=function(t,r,$){return r["$=="](3)?"\u81ea\u52d5\u5931\u6557":s($["$nil?"]())?e:$["$=="]("?")?this.$success_level(t,r):s(K(t,$))?"\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+this.$experience_point($,r):"\u5931\u6557"},oe.$$arity=3),l.def(a,"$success_level",_e=function(t,r){var n;return n=Z(A(t,15),5).$to_i(),s(O(n,0))?"\u5931\u6557 \uff1e \u7d4c\u9a13\u5024"+r:n+"Lv\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+r},_e.$$arity=2),l.def(a,"$experience_point",ae=function(t,r){var n=e;return n=N(Z(N(1,A(t,15)),5),r),s(O(n,0))?"0":s(this["$int?"](n))?n.$to_i().$to_s():this.$format("%.1f",n)},ae.$$arity=2),l.def(a,"$int?",fe=function(t){return t["$=="](t.$to_i())},fe.$$arity=1),l.def(a,"$additional_result",ce=function(t){return s(q(t,0))?"\u60aa\u610f"+t:e},ce.$$arity=1)}(Opal)}}]);