(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[8957],{8957:function(Xe,Je,Ve){Ve(4656),Opal.modules["i18n/backend/fallbacks"]=function(e){function W(C,i){return"number"==typeof C&&"number"==typeof i?C-i:C["$-"](i)}var i,l,G,D,H,I,F,S=[],r=e.nil,x=e.$$$,_=e.$$,V=e.module,$=e.truthy,L=e.send,P=e.send2,t=e.hash2;return i=S,F=[I=V(S[0],"I18n")].concat(i),e.class_variable_set(F[0],"@@fallbacks",r),l=e.get_singleton_class(I),H=[l].concat(F),e.def(l,"$fallbacks",G=function(){var A,n,d;return e.class_variable_set(H[1],"@@fallbacks",$(d=null==(A=H[1].$$cvars["@@fallbacks"])?r:A)?d:x(x(_(H,"I18n"),"Locale"),"Fallbacks").$new()),$(n=_(H,"Thread").$current()["$[]"]("i18n_fallbacks"))?n:null==(A=H[1].$$cvars["@@fallbacks"])?r:A},G.$$arity=0),e.def(l,"$fallbacks=",D=function(A){var B,n;return e.class_variable_set(H[1],"@@fallbacks",$(A["$is_a?"](_(H,"Array")))?x(x(_(H,"I18n"),"Locale"),"Fallbacks").$new(A):A),n=["i18n_fallbacks",null==(B=H[1].$$cvars["@@fallbacks"])?r:B],L(_(H,"Thread").$current(),"[]=",e.to_a(n)),n[W(n.length,1)]},D.$$arity=1),void function(l,q){var G=[V(l,"Backend")].concat(q);!function(D,Z){var d,n,f,u,A=V(D,"Fallbacks"),B=[A].concat(Z);e.def(A,"$translate",d=function(R,g,h){try{var v,E=d.$$p,T=this,c=r,o=r,m=r,y=r,z=r,a=r;for(E&&(d.$$p=null),z=0,a=arguments.length,y=new Array(a);z<a;z++)y[z]=arguments[z];return null==h&&(h=_(B,"EMPTY_HASH")),!$(h.$fetch("fallback",!0))||$(h["$[]"]("fallback_in_progress"))?P(T,e.find_super_dispatcher(T,"translate",d,!1,!0),"translate",y,E):($(h["$[]"]("default"))&&(c=T["$extract_non_symbol_default!"](h)),o=h.$merge(t(["fallback_in_progress"],{fallback_in_progress:!0})),L(_(B,"I18n").$fallbacks()["$[]"](R),"each",[],((v=function(Y){var re,te=null==v.$$s?this:v.$$s;null==Y&&(Y=r);try{return L(te,"catch",["exception"],((re=function(){var ye=null==re.$$s?this:re.$$s,De=r;if(De=P(ye,e.find_iter_super_dispatcher(ye,"translate",re.$$def||v.$$def||d,!1,!1),"translate",[Y,g,o],null),$(De["$nil?"]()))return r;$(R.$to_s()["$!="](Y.$to_s()))&&ye.$on_fallback(R,Y,g,h),e.ret(De)}).$$s=te,re.$$arity=0,re))}catch(me){if(!e.rescue(me,[x(_(B,"I18n"),"InvalidLocale")]))throw me;try{return r}finally{e.pop_exception()}}}).$$s=T,v.$$arity=1,v)),$($(m=h["$key?"]("default"))?h["$[]"]("default")["$nil?"]():m)?r:$(c)?P(T,e.find_super_dispatcher(T,"translate",d,!1,!0),"translate",[R,r,h.$merge(t(["default"],{default:c}))],null):T.$throw("exception",x(_(B,"I18n"),"MissingTranslation").$new(R,g,h)))}catch(p){if(p===e.returner)return p.$v;throw p}},d.$$arity=-3),e.def(A,"$extract_non_symbol_default!",n=function(R){var g,E,v=r,K=r;return v=[R["$[]"]("default")].$flatten(),E=L(v,"detect",[],((g=function(c){return null==c&&(c=r),c["$is_a?"](_(B,"Symbol"))["$!"]()}).$$s=this,g.$$arity=1,g)),$(E)&&(K=["default",v["$[]"](0,v.$index(E))],L(R,"[]=",e.to_a(K)),W(K.length,1)),E},n.$$arity=1),e.def(A,"$exists?",f=function(R,g,h){try{var v,E=f.$$p,T=this,c=r,o=r,m=r;for(E&&(f.$$p=null),o=0,m=arguments.length,c=new Array(m);o<m;o++)c[o]=arguments[o];return null==h&&(h=_(B,"EMPTY_HASH")),$(h.$fetch("fallback",!0))?(L(_(B,"I18n").$fallbacks()["$[]"](R),"each",[],((v=function(z){var a=null==v.$$s?this:v.$$s;null==z&&(z=r);try{if(!$(P(a,e.find_iter_super_dispatcher(a,"exists?",v.$$def||f,!1,!1),"exists?",[z,g],null)))return r;e.ret(!0)}catch(p){if(!e.rescue(p,[x(_(B,"I18n"),"InvalidLocale")]))throw p;try{return r}finally{e.pop_exception()}}}).$$s=T,v.$$arity=1,v)),!1):P(T,e.find_super_dispatcher(T,"exists?",f,!1,!0),"exists?",c,E)}catch(y){if(y===e.returner)return y.$v;throw y}},f.$$arity=-3),A.$private(),e.def(A,"$on_fallback",u=function(R,g,h,v){return r},u.$$arity=4)}(G[0],G)}(F[0],F)},Opal.modules["bcdice/randomizer"]=function(e){function W(l,q){return"number"==typeof l&&"number"==typeof q?l>q:l["$>"](q)}function X(l,q){return"number"==typeof l&&"number"==typeof q?l+q:l["$+"](q)}function S(l,q){return"number"==typeof l&&"number"==typeof q?l<=q:l["$<="](q)}function r(l,q){return"number"==typeof l&&"number"==typeof q?l-q:l["$-"](q)}function x(l,q){return"number"==typeof l&&"number"==typeof q?l*q:l["$*"](q)}var q,A,n,f,u,b,R,g,h,v,E,K,T,B,d,G,$=[],L=e.nil,P=e.$$$,t=e.$$,i=e.klass,I=e.truthy,F=e.send;return q=$,A=G=[(0,e.module)($[0],"BCDice")].concat(q),B=i(G[0],null,"Randomizer"),d=[B].concat(A),B.$$prototype.rand_results=B.$$prototype.detailed_rand_results=L,e.const_set(d[0],"UPPER_LIMIT_DICE_TIMES",200),e.const_set(d[0],"UPPER_LIMIT_DICE_SIDES",1e3),e.const_set(d[0],"UPPER_LIMIT_RANDS",1e4),e.def(B,"$initialize",n=function(){return this.rand_results=[],this.detailed_rand_results=[]},n.$$arity=0),B.$attr_reader("rand_results"),B.$attr_reader("detailed_rand_results"),e.const_set(d[0],"DetailedRandResult",t(d,"Struct").$new("kind","sides","value")),e.def(B,"$roll_barabara",f=function(o,m){var y,a,z=this;return I(W(X(z.rand_results.$size(),o),t(d,"UPPER_LIMIT_RANDS")))&&z.$raise(t(d,"TooManyRandsError")),I(I(a=S(o,0))?a:W(o,t(d,"UPPER_LIMIT_DICE_TIMES")))?[]:F(t(d,"Array"),"new",[o],((y=function(){return(null==y.$$s?this:y.$$s).$roll_once(m)}).$$s=z,y.$$arity=0,y))},f.$$arity=2),e.def(B,"$roll_sum",u=function(o,m){return this.$roll_barabara(o,m).$sum()},u.$$arity=2),e.def(B,"$roll_once",b=function(o){var y,z=L;return I(I(y=S(o,0))?y:W(o,t(d,"UPPER_LIMIT_DICE_SIDES")))?0:(z=this.$rand_inner(o),this.$push_to_detail("normal",o,z),z)},b.$$arity=1),e.def(B,"$roll_index",R=function(o){return r(this.$roll_once(o),1)},R.$$arity=1),e.def(B,"$roll_tens_d10",g=function(){var y,m=L;return(m=this.$rand_inner(10))["$=="](10)&&(m=0),y=x(m,10),this.$push_to_detail("tens_d10",10,y),y},g.$$arity=0),e.def(B,"$roll_d9",h=function(){var m;return m=r(this.$rand_inner(10),1),this.$push_to_detail("d9",10,m),m},h.$$arity=0),e.def(B,"$roll_d66",v=function(o){var m,a,z=L;return z=F(t(d,"Array"),"new",[2],((m=function(){return(null==m.$$s?this:m.$$s).$roll_once(6)}).$$s=this,m.$$arity=0,m)),a=o,P(t(d,"D66SortType"),"ASC")["$==="](a)?z["$sort!"]():P(t(d,"D66SortType"),"DESC")["$==="](a)&&z["$sort!"]()["$reverse!"](),X(x(z["$[]"](0),10),z["$[]"](1))},v.$$arity=1),B.$private(),e.def(B,"$rand_inner",E=function(o){var y,m=this;return I(function(l,q){return"number"==typeof l&&"number"==typeof q?l>=q:l["$>="](q)}(m.rand_results.$size(),t(d,"UPPER_LIMIT_RANDS")))&&m.$raise(t(d,"TooManyRandsError")),y=m.$random(o),m.rand_results["$<<"]([y,o]),y},E.$$arity=1),e.def(B,"$random",K=function(o){return X(t(d,"Kernel").$rand(o),1)},K.$$arity=1),e.def(B,"$push_to_detail",T=function(o,m,y){var a;return a=t(d,"DetailedRandResult").$new(o,m,y),this.detailed_rand_results.$push(a)},T.$$arity=3),void function(D,Z,A){[i(D,Z,"TooManyRandsError")].concat(A)}(G[0],t(G,"StandardError"),G)},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var P,I,G,A,B,d,n,D,Z,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.klass,$=e.truthy;return P=X,I=C=[_(X[0],"BCDice")].concat(P),G=l=[_(C[0],"DiceTable")].concat(I),D=V(l[0],null,"RollResult"),Z=[D].concat(G),D.$$prototype.table_name=D.$$prototype.value=D.$$prototype.body=S,e.def(D,"$initialize",A=function(u,b,R){var g=this;return g.table_name=u,g.value=b,g.body=R},A.$$arity=3),D.$attr_reader("table_name"),D.$attr_reader("value"),D.$attr_reader("body"),e.def(D,"$to_s",B=function(){var u=this;return u.table_name+"("+u.value+") \uff1e "+u.body},B.$$arity=0),e.def(D,"$last_body",d=function(){var u=this;return $(u.body["$is_a?"](x(Z,"RollResult")))?u.body.$last_body():u.body},d.$$arity=0),void e.def(D,"$empty?",n=function(){return!1},n.$$arity=0)},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var t,F,D,B,d,Z,A,q,i,S=[],r=e.nil,_=e.$$,V=e.module,$=e.klass,L=e.truthy;return t=S,F=i=[V(S[0],"BCDice")].concat(t),D=q=[V(i[0],"DiceTable")].concat(F),Z=$(q[0],null,"ChainTable"),A=[Z].concat(D),Z.$$prototype.times=Z.$$prototype.sides=Z.$$prototype.items=Z.$$prototype.name=r,e.def(Z,"$initialize",B=function(f,u,b){var R=this,g=r;return R.name=f,R.items=b.$freeze(),g=/(\d+)D(\d+)/i.$match(u),L(g)||R.$raise(_(A,"ArgumentError"),"Unexpected table type: "+u),R.times=g["$[]"](1).$to_i(),R.sides=g["$[]"](2).$to_i()},B.$$arity=3),void e.def(Z,"$roll",d=function(f){var b,R,u=this,g=r;return R=function(P,t){return"number"==typeof P&&"number"==typeof t?P-t:P["$-"](t)}(b=f.$roll_sum(u.times,u.sides),u.times),g=u.items["$[]"](R),L(g["$respond_to?"]("roll"))&&(g=g.$roll(f)),_(A,"RollResult").$new(u.name,b,g)},d.$$arity=1)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){function S(C,i){return"number"==typeof C&&"number"==typeof i?C-i:C["$-"](i)}var i,q,A,n,f,u,B,d,G,F,x=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.hash2;return i=x,q=F=[L(x[0],"BCDice")].concat(i),A=G=[L(F[0],"DiceTable")].concat(q),B=P(G[0],null,"D66GridTable"),d=[B].concat(A),B.$$prototype.name=B.$$prototype.items=_,e.defs(B,"$from_i18n",n=function(R,g){var v=_;return v=$(d,"I18n").$t(R,t(["locale","raise"],{locale:g,raise:!0})),this.$new(v["$[]"]("name"),v["$[]"]("items"))},n.$$arity=2),e.def(B,"$initialize",f=function(R,g){return this.name=R,this.items=g.$freeze()},f.$$arity=2),void e.def(B,"$roll",u=function(R){var h,v,E,K,T,C;return h=R.$roll_once(6),v=R.$roll_once(6),E=function(C,i){return"number"==typeof C&&"number"==typeof i?C+i:C["$+"](i)}("number"==typeof(C=h)?10*C:C["$*"](10),v),K=S(h,1),T=S(v,1),$(d,"RollResult").$new(this.name,E,this.items["$[]"](K)["$[]"](T))},u.$$arity=1)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var P,I,G,A,B,D,Z,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=X,I=C=[_(X[0],"BCDice")].concat(P),G=l=[_(C[0],"DiceTable")].concat(I),D=V(l[0],x(l,"D66GridTable"),"D66HalfGridTable"),Z=[D].concat(G),e.defs(D,"$from_i18n",A=function(n,f){var b=S;return b=x(Z,"I18n").$t(n,$(["locale","raise"],{locale:f,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items_1_2_3"),b["$[]"]("items_4_5_6"))},A.$$arity=2),void e.def(D,"$initialize",B=function(n,f,u){return this.name=n,this.items=[f,f,f,u,u,u].$freeze()},B.$$arity=3)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var P,I,G,A,B,D,Z,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.klass,$=e.hash2;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=X,I=C=[_(X[0],"BCDice")].concat(P),G=l=[_(C[0],"DiceTable")].concat(I),D=V(l[0],x(l,"D66GridTable"),"D66OneThirdTable"),Z=[D].concat(G),e.defs(D,"$from_i18n",A=function(n,f){var b=S;return b=x(Z,"I18n").$t(n,$(["locale","raise"],{locale:f,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("items_1_2"),b["$[]"]("items_3_4"),b["$[]"]("items_5_6"))},A.$$arity=2),void e.def(D,"$initialize",B=function(n,f,u,b){return this.name=n,this.items=[f,f,u,u,b,b].$freeze()},B.$$arity=4)},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var i,q,A,n,f,u,b,B,d,G,F,r=[],x=e.nil,_=e.$$$,V=e.$$,$=e.module,L=e.klass,P=e.hash2,t=e.truthy;return i=r,q=F=[$(r[0],"BCDice")].concat(i),A=G=[$(F[0],"DiceTable")].concat(q),B=L(G[0],null,"D66Table"),d=[B].concat(A),B.$$prototype.sort_type=B.$$prototype.items=B.$$prototype.name=x,e.defs(B,"$from_i18n",n=function(g,h){var K,E=x;return E=V(d,"I18n").$t(g,P(["locale"],{locale:h})),K=V(d,"D66SortType").$const_get(E["$[]"]("d66_sort_type")),this.$new(E["$[]"]("name"),K,E["$[]"]("items"))},n.$$arity=2),e.def(B,"$initialize",f=function(g,h,v){var E=this;return E.name=g,E.sort_type=h,E.items=v.$freeze()},f.$$arity=3),e.def(B,"$roll",u=function(g){var E,c,C,h=this,v=x,K=x,T=x;return v=g.$roll_barabara(2,6),E=h.sort_type,_(V(d,"D66SortType"),"ASC")["$==="](E)?v["$sort!"]():_(V(d,"D66SortType"),"DESC")["$==="](E)&&v["$sort!"]()["$reverse!"](),K=function(C,i){return"number"==typeof C&&"number"==typeof i?C+i:C["$+"](i)}("number"==typeof(C=v["$[]"](0))?10*C:C["$*"](10),v["$[]"](1)),T=t(c=h.items["$[]"](K))?c:h.items["$[]"](K.$to_s()),t(T["$respond_to?"]("roll"))&&(T=T.$roll(g)),V(d,"RollResult").$new(h.name,K,T)},u.$$arity=1),void e.def(B,"$choice",b=function(g){return V(d,"RollResult").$new(this.name,g,this.items["$[]"](g))},b.$$arity=1)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){function W(I,F){return"number"==typeof I&&"number"==typeof F?I+F:I["$+"](F)}var F,d,u,n,G,Z,q,x=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.hash2,C=e.send,i=e.send2;return e.top.$require("bcdice/dice_table/d66_table"),F=x,G=q=[L(x[0],"BCDice")].concat(F),d=Z=[L(q[0],"DiceTable")].concat(G),[n=P(Z[0],$(Z,"D66Table"),"D66LeftRangeTable")].concat(d),void e.def(n,"$initialize",u=function(R,g,h){var v,c,T=this;return u.$$p&&(u.$$p=null),c=t([],{}),C(h,"each",[],((v=function(o){function m(y){return o.apply(this,arguments)}return m.toString=function(){return o.toString()},m}(function(o){var y,a,Y,m=null==v.$$s?this:v.$$s;return null==o&&(o=_),y=e.to_ary(o),Y=null==y[1]?_:y[1],C(null==y[0]?_:y[0],"each",[],((a=function(re){var ye;return null==re&&(re=_),C(Y,"each_with_index",[],((ye=function(Be,Te){var Ce,oe,I;return null==Be&&(Be=_),null==Te&&(Te=_),Ce=W("number"==typeof(I=re)?10*I:I["$*"](10),W(Te,1)),C(c,"[]=",e.to_a(oe=[Ce,Be])),oe[function(I,F){return"number"==typeof I?I-1:I["$-"](1)}(oe.length)]}).$$s=null==a.$$s?this:a.$$s,ye.$$arity=2,ye))}).$$s=m,a.$$arity=1,a))})).$$s=T,v.$$arity=1,v)),i(T,e.find_super_dispatcher(T,"initialize",u,!1,!0),"initialize",[R,g,c],null)},u.$$arity=3)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var i,q,A,n,f,B,d,G,F,x=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.truthy;return i=x,q=F=[L(x[0],"BCDice")].concat(i),A=G=[L(F[0],"DiceTable")].concat(q),B=P(G[0],null,"D66ParityTable"),d=[B].concat(A),B.$$prototype.odd=B.$$prototype.even=B.$$prototype.name=_,e.def(B,"$initialize",n=function(b,R,g){var h=this;return h.name=b,h.odd=R.$freeze(),h.even=g.$freeze()},n.$$arity=3),void e.def(B,"$roll",f=function(b){var h,E,K,C,R=this,g=_;return g=b.$roll_once(6),h=b.$roll_once(6),E=(t(g["$odd?"]())?R.odd:R.even)["$[]"]("number"==typeof(C=h)?C-1:C["$-"](1)),K=function(C,i){return"number"==typeof C&&"number"==typeof i?C+i:C["$+"](i)}(function(C,i){return"number"==typeof C?10*C:C["$*"](10)}(g),h),$(d,"RollResult").$new(R.name,K,E)},f.$$arity=1)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var C,l,Z,d,n,A,B,H,I,r=[],x=e.nil,V=e.$$,$=e.module,L=e.klass,P=e.send;return C=r,l=I=[$(r[0],"BCDice")].concat(C),Z=H=[$(I[0],"DiceTable")].concat(l),A=L(H[0],null,"D66RangeTable"),B=[A].concat(Z),A.$$prototype.items=A.$$prototype.name=x,e.def(A,"$initialize",d=function(u,b){return this.name=u,this.items=b.$freeze()},d.$$arity=2),void e.def(A,"$roll",n=function(u){var b,g,h,v,t,R=this,E=x;return g=u.$roll_once(6),h=u.$roll_once(6),v=function(t,C){return"number"==typeof t&&"number"==typeof C?t+C:t["$+"](C)}("number"==typeof(t=g)?10*t:t["$*"](10),h),E=P(R.items,"find",[],((b=function(T){return null==T&&(T=x),T["$[]"](0)["$include?"](v)}).$$s=R,b.$$arity=1,b)),V(B,"RollResult").$new(R.name,v,E["$[]"](1))},n.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var I,H,B,f,u,b,R,g,h,v,E,K,d,n,D,l,x=[],_=e.nil,$=e.$$,L=e.module,P=e.klass,t=e.send,C=e.truthy;return I=x,H=l=[L(x[0],"BCDice")].concat(I),B=D=[L(l[0],"DiceTable")].concat(H),d=P(D[0],null,"RangeTable"),n=[d].concat(B),d.$$prototype.name=d.$$prototype.items=d.$$prototype.num_of_dice=d.$$prototype.num_of_sides=d.$$prototype.formatter=_,e.const_set(n[0],"RollResult",t($(n,"Struct"),"new",["sum","values","content","formatted"],((f=function(){return(null==f.$$s?this:f.$$s).$alias_method("to_s","formatted")}).$$s=d,f.$$arity=0,f))),e.const_set(n[0],"Item",$(n,"Struct").$new("range","content")),e.const_set(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(n[0],"DEFAULT_FORMATTER",t(d,"lambda",[],($$2=function(T){function c(o,m){return T.apply(this,arguments)}return c.toString=function(){return T.toString()},c}(function(T,c){return null==$$2.$$s||$$2,null==T&&(T=_),null==c&&(c=_),T.$name()+"("+c.$sum()+") \uff1e "+c.$content()}),$$2.$$s=d,$$2.$$arity=2,$$2))),d.$attr_reader("name"),d.$attr_reader("num_of_dice"),d.$attr_reader("num_of_sides"),e.def(d,"$initialize",u=function(c,o,m){var p,y=u.$$p,z=y||_,a=this,Y=_;return y&&(u.$$p=null),y&&(u.$$p=null),a.name=c.$freeze(),a.formatter=C(p=z)?p:$(n,"DEFAULT_FORMATTER"),Y=$(n,"DICE_ROLL_METHOD_RE").$match(o),C(Y)||a.$raise($(n,"ArgumentError"),a.name+": invalid dice roll method: "+o),a.num_of_dice=Y["$[]"](1).$to_i(),a.num_of_sides=Y["$[]"](2).$to_i(),a.$store(m)},u.$$arity=3),e.def(d,"$fetch",b=function(c){var o,y,m=this;return y=t(m.items,"find",[],((o=function(a){return null==a&&(a=_),a.$range()["$include?"](c)}).$$s=m,o.$$arity=1,o)),C(y)||m.$raise($(n,"RangeError"),m.name+": value is out of range: "+c),y},b.$$arity=1),e.def(d,"$roll",R=function(c){var y,z,a,i,o=this,m=_;return y=(m=c.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),z=$(n,"RollResult").$new(y,m,o.$fetch(y).$content()),a=[o.formatter["$[]"](o,z)],t(z,"formatted=",e.to_a(a)),"number"==typeof(i=a.length)||i["$-"](1),z},R.$$arity=1),d.$private(),e.def(d,"$store",g=function(c){var o,m,y,a,p,z=this;return a=t(c,"map",[],((o=function(te,re){return null==te&&(te=_),null==re&&(re=_),[(null==o.$$s?this:o.$$s).$coerce_to_int_range(te),re]}).$$s=z,o.$$arity=2,o)),p=t(a,"sort_by",[],((m=function(te,re){return null==te&&(te=_),null==re&&(re=_),te.$min()}).$$s=z,m.$$arity=2,m)),z.$assert_min_sum_is_covered(p),z.$assert_max_sum_is_covered(p),z.$assert_no_gap_or_overlap_in_ranges(p),z.items=t(p,"map",[],(y=function(te,re){return null==te&&(te=_),null==re&&(re=_),$(n,"Item").$new(te,re.$freeze()).$freeze()},y.$$s=z,y.$$arity=2,y)).$freeze(),z},g.$$arity=1),e.def(d,"$coerce_to_int_range",h=function(c){var m,y=_;return m=c,$(n,"Integer")["$==="](m)?$(n,"Range").$new(c,c):$(n,"Range")["$==="](m)&&C(C(y=c.$begin()["$is_a?"]($(n,"Integer")))?c.$end()["$is_a?"]($(n,"Integer")):y)?c:this.$raise($(n,"TypeError"),this.name+": "+c+" ("+c.$class()+") must be an Integer or a Range with Integers ")},h.$$arity=1),e.def(d,"$assert_min_sum_is_covered",v=function(c){var m,o=this,y=_;return m=o.num_of_dice,y=c.$first()["$[]"](0),C(y["$include?"](m))||o.$raise($(n,"RangeError"),o.name+": min value ("+m+") is not covered: "+y),o},v.$$arity=1),e.def(d,"$assert_max_sum_is_covered",E=function(c){var m,o=this,y=_;return m=function(i,I){return"number"==typeof i&&"number"==typeof I?i*I:i["$*"](I)}(o.num_of_dice,o.num_of_sides),y=c.$last()["$[]"](0),C(y["$include?"](m))||o.$raise($(n,"RangeError"),o.name+": max value ("+m+") is not covered: "+y),o},E.$$arity=1),void e.def(d,"$assert_no_gap_or_overlap_in_ranges",K=function(c){var o;return t(c,"each_cons",[2],((o=function(z,a){var re,me,i,p=null==o.$$s?this:o.$$s,Y=_,te=_;return null==p.name&&(p.name=_),null==z&&(z=_),null==a&&(a=_),Y=z["$[]"](0),te=a["$[]"](0),me="number"==typeof(i=re=Y.$max())?i+1:i["$+"](1),C(te["$include?"](re))&&p.$raise($(n,"RangeError"),p.name+": Range overlap: "+Y+" and "+te),C(te["$include?"](me))?_:p.$raise($(n,"RangeError"),p.name+": Range gap: "+Y+" and "+te)}).$$s=this,o.$$arity=2,o)),this},K.$$arity=1)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var t,F,D,n,b,R,g,f,u,A,q,i,S=[],r=e.nil,x=e.$$$,_=e.$$,V=e.module,$=e.klass,L=e.send;return t=S,F=i=[V(S[0],"BCDice")].concat(t),D=q=[V(i[0],"DiceTable")].concat(F),n=A=[$(q[0],null,"SaiFicSkillTable")].concat(D),f=$(A[0],null,"Category"),u=[f].concat(n),f.$$prototype.name=r,e.def(f,"$initialize",b=function(v,E,K,T){var c,o=this;return o.name=v,o.skills=L(E.$map(),"with_index",[2],((c=function(m){function y(z,a){return m.apply(this,arguments)}return y.toString=function(){return m.toString()},y}(function(m,y){return null==m&&(m=r),null==y&&(y=r),x(_(u,"SaiFicSkillTable"),"Skill").$new(v,m,K,y,T)})).$$s=o,c.$$arity=2,c)),o.dice=K},b.$$arity=4),e.def(f,"$roll",R=function(v){return this.$skills()["$[]"]("number"==typeof(P=v.$roll_sum(2,6))?P-2:P["$-"](2));var P},R.$$arity=1),e.def(f,"$to_s",g=function(){return this.name},g.$$arity=0),void f.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var P,I,d,u,b,n,G,Z,l,C,X=[],S=e.nil,_=e.module,V=e.klass,$=e.hash2;return P=X,I=C=[_(X[0],"BCDice")].concat(P),G=l=[_(C[0],"DiceTable")].concat(I),d=Z=[V(l[0],null,"SaiFicSkillTable")].concat(G),[n=V(Z[0],null,"Skill")].concat(d),n.$$prototype.s_format=n.$$prototype.category_dice=n.$$prototype.row_dice=n.$$prototype.category_name=n.$$prototype.name=S,e.def(n,"$initialize",u=function(g,h,v,E,K){var T=this;return T.category_name=g,T.name=h,T.category_dice=v,T.row_dice=E,T.s_format=K},u.$$arity=5),e.def(n,"$to_s",b=function(){var g=this;return g.$format(g.s_format,$(["category_dice","row_dice","category_name","skill_name"],{category_dice:g.category_dice,row_dice:g.row_dice,category_name:g.category_name,skill_name:g.name}))},b.$$arity=0),void n.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var F,G,d,u,b,R,g,h,v,E,n,f,Z,q,S=e.top,r=[],x=e.nil,_=e.$$$,V=e.$$,$=e.module,L=e.klass,P=e.hash2,t=e.send,i=e.truthy;return S.$require("bcdice/dice_table/sai_fic_skill_table/category"),S.$require("bcdice/dice_table/sai_fic_skill_table/skill"),F=r,G=q=[$(r[0],"BCDice")].concat(F),d=Z=[$(q[0],"DiceTable")].concat(G),n=L(Z[0],null,"SaiFicSkillTable"),f=[n].concat(d),n.$$prototype.rtt=n.$$prototype.rtt_format=n.$$prototype.rct=n.$$prototype.rct_format=n.$$prototype.rttn=n.$$prototype.rttn_format=n.$$prototype.categories=x,e.defs(n,"$from_i18n",u=function(T,c,o){var m,y,z,a,re,te=x;if(null==o)o=P([],{});else if(!o.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(m=o.$$smap.rtt)&&(m=x),null==(y=o.$$smap.rct)&&(y=x),null==(z=o.$$smap.rttn)&&(z=x),re=(te=V(f,"I18n").$t("RTT",P(["locale","raise","default"],{locale:c,raise:!1,default:P([],{})})).$merge(V(f,"I18n").$t(T,P(["locale","raise"],{locale:c,raise:!0}))))["$[]"]("items"),te=t(te,"select",[],((a=function(me){function ye(De,Be){return me.apply(this,arguments)}return ye.toString=function(){return me.toString()},ye}(function(me,ye){return null==me&&(me=x),null==ye&&(ye=x),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](me)})).$$s=this,a.$$arity=2,a)),this.$new(re,e.to_hash(te).$merge(P(["rtt","rct","rttn"],{rtt:m,rct:y,rttn:z})))},u.$$arity=-3),e.const_set(f[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),e.const_set(f[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),e.const_set(f[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),e.const_set(f[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),e.def(n,"$initialize",b=function(T,c){var o,m,y,z,a,p,Y,te,re=this;if(null==c)c=P([],{});else if(!c.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return null==(o=c.$$smap.rtt)&&(o=x),null==(m=c.$$smap.rct)&&(m=x),null==(y=c.$$smap.rttn)&&(y=x),null==(z=c.$$smap.rtt_format)&&(z=V(f,"DEFAULT_RTT")),null==(a=c.$$smap.rct_format)&&(a=V(f,"DEFAULT_RCT")),null==(p=c.$$smap.rttn_format)&&(p=V(f,"DEFAULT_RTTN")),null==(Y=c.$$smap.s_format)&&(Y=V(f,"DEFAULT_S")),re.categories=t(T.$map(),"with_index",[1],((te=function(ye,De){var Te,Ce,oe;return null==ye&&(ye=x),null==De&&(De=x),Ce=null==(Te=e.to_ary(ye))[0]?x:Te[0],oe=null==Te[1]?x:Te[1],_(V(f,"SaiFicSkillTable"),"Category").$new(Ce,oe,De,Y)}).$$s=re,te.$$arity=2,te.$$has_top_level_mlhs_arg=!0,te)),re.rtt=o,re.rct=m,re.rttn=y.$to_a(),re.rtt_format=z,re.rct_format=a,re.rttn_format=p},b.$$arity=-2),e.const_set(f[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),n.$attr_reader("categories"),e.def(n,"$roll_command",R=function(T,c){var m,o=this,y=x,z=x,a=x;return i(["RTT",o.rtt]["$include?"](m=c))?o.$format_skill(o.rtt_format,o.$roll_skill(T)):i(["RCT",o.rct]["$include?"](m))?(y=o.$roll_category(T),o.$format(o.rct_format,P(["category_dice","category_name"],{category_dice:y.$dice(),category_name:y.$name()}))):i(i(z=a=V(f,"RTTN").$index(m))?z:a=o.rttn.$index(m))?o.$format_skill(o.rttn_format,o.categories["$[]"](a).$roll(T)):x},R.$$arity=2),e.def(n,"$roll_category",g=function(T){return this.categories["$[]"]("number"==typeof(I=T.$roll_once(6))?I-1:I["$-"](1));var I},g.$$arity=1),e.def(n,"$roll_skill",h=function(T){return this.$roll_category(T).$roll(T)},h.$$arity=1),e.def(n,"$prefixes",v=function(){var T=this;return function(I,F){return"number"==typeof I&&"number"==typeof F?I+F:I["$+"](F)}(["RTT[1-6]?","RCT",T.rtt,T.rct],T.rttn).$compact()},v.$$arity=0),n.$private(),void e.def(n,"$format_skill",E=function(T,c){return this.$format(T,P(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:c.$category_dice(),row_dice:c.$row_dice(),category_name:c.$category_name(),skill_name:c.$name(),text:c.$to_s()}))},E.$$arity=2)},Opal.modules["bcdice/dice_table/table"]=function(e){var C,l,Z,d,n,f,u,A,B,H,I,S=[],r=e.nil,_=e.$$,V=e.module,$=e.klass,L=e.hash2,P=e.truthy;return C=S,l=I=[V(S[0],"BCDice")].concat(C),Z=H=[V(I[0],"DiceTable")].concat(l),A=$(H[0],null,"Table"),B=[A].concat(Z),A.$$prototype.times=A.$$prototype.sides=A.$$prototype.name=A.$$prototype.items=r,e.defs(A,"$from_i18n",d=function(R,g){var v=r;return v=_(B,"I18n").$t(R,L(["locale"],{locale:g})),this.$new(v["$[]"]("name"),v["$[]"]("type"),v["$[]"]("items"))},d.$$arity=2),e.def(A,"$initialize",n=function(R,g,h){var v=this,E=r;return v.name=R,v.items=h.$freeze(),E=/(\d+)D(\d+)/i.$match(g),P(E)||v.$raise(_(B,"ArgumentError"),"Unexpected table type: "+g),v.times=E["$[]"](1).$to_i(),v.sides=E["$[]"](2).$to_i()},n.$$arity=3),e.def(A,"$roll",f=function(R){var h,g=this;return h=R.$roll_sum(g.times,g.sides),g.$choice(h)},f.$$arity=1),void e.def(A,"$choice",u=function(R){var h,g=this;return h=function(t,C){return"number"==typeof t&&"number"==typeof C?t-C:t["$-"](C)}(R,g.times),_(B,"RollResult").$new(g.name,R,g.items["$[]"](h))},u.$$arity=1)},Opal.modules["bcdice/dice_table"]=function(e){var W=e.top;return W.$require("bcdice/dice_table/roll_result"),W.$require("bcdice/dice_table/chain_table"),W.$require("bcdice/dice_table/d66_grid_table"),W.$require("bcdice/dice_table/d66_half_grid_table"),W.$require("bcdice/dice_table/d66_one_third_table"),W.$require("bcdice/dice_table/d66_left_range_table"),W.$require("bcdice/dice_table/d66_parity_table"),W.$require("bcdice/dice_table/d66_range_table"),W.$require("bcdice/dice_table/d66_table"),W.$require("bcdice/dice_table/range_table"),W.$require("bcdice/dice_table/sai_fic_skill_table"),W.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var $,C,I,P,X=[],_=e.module;return $=X,C=P=[_(X[0],"BCDice")].concat($),I=[_(P[0],"D66SortType")].concat(C),e.const_set(I[0],"NO_SORT","no_sort"),e.const_set(I[0],"ASC","asc"),e.const_set(I[0],"DESC","desc"),void function(t,C){var I=[_(t,"RoundType")].concat(C);e.const_set(I[0],"CEIL","ceil"),e.const_set(I[0],"FLOOR","floor"),e.const_set(I[0],"ROUND","round")}(P[0],P)},Opal.modules["bcdice/translate"]=function(e){var P,I,q,F,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.hash2;return P=X,I=C=[_(X[0],"BCDice")].concat(P),F=_(C[0],"Translate"),l=[F].concat(I),void e.def(F,"$translate",q=function(G,D){var Z,A=this;if(null==A.locale&&(A.locale=S),null==D)D=V([],{});else if(!D.$$is_hash)throw e.ArgumentError.$new("expected kwargs");return Z=e.kwrestargs(D,{}),x(l,"I18n").$translate(G,V(["locale","raise"],{locale:A.locale,raise:!0}).$merge(e.to_hash(Z)))},q.$$arity=-2)},Opal.modules["bcdice/result"]=function(e){function W(P,t){return"number"==typeof P&&"number"==typeof t?P-t:P["$-"](t)}var t,f,R,g,h,v,E,l,G,D,Z,A,B,d,n,q,H,i,S=[],r=e.nil,$=e.klass,L=e.send;return t=S,l=i=[(0,e.module)(S[0],"BCDice")].concat(t),H=[q=$(i[0],null,"Result")].concat(l),q.$$prototype.secret=q.$$prototype.success=q.$$prototype.failure=q.$$prototype.critical=q.$$prototype.fumble=r,[f=e.get_singleton_class(q)].concat(H),e.def(f,"$success",R=function(T){var c;return L(this.$new(),"tap",[],((c=function(m){function y(z){return m.apply(this,arguments)}return y.toString=function(){return m.toString()},y}(function(m){var z=r;return null==m&&(m=r),L(m,"text=",e.to_a(z=[T])),W(z.length,1),L(m,"success=",e.to_a(z=[!0])),z[W(z.length,1)]})).$$s=this,c.$$arity=1,c))},R.$$arity=1),e.def(f,"$failure",g=function(T){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[T])),W(a.length,1),L(y,"failure=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},g.$$arity=1),e.def(f,"$critical",h=function(T){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[T])),W(a.length,1),L(y,"critical=",e.to_a(a=[!0])),W(a.length,1),L(y,"success=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},h.$$arity=1),e.def(f,"$fumble",v=function(T){var c;return L(this.$new(),"tap",[],((c=function(y){var a=r;return null==y&&(y=r),L(y,"text=",e.to_a(a=[T])),W(a.length,1),L(y,"fumble=",e.to_a(a=[!0])),W(a.length,1),L(y,"failure=",e.to_a(a=[!0])),a[W(a.length,1)]}).$$s=this,c.$$arity=1,c))},v.$$arity=1),e.def(f,"$nothing",E=function(){return"nothing"},E.$$arity=0),e.def(q,"$initialize",G=function(u){var b=this;return null==u&&(u=r),b.text=u,b.rands=r,b.detailed_rands=r,b.secret=!1,b.success=!1,b.failure=!1,b.critical=!1,b.fumble=!1},G.$$arity=-1),q.$attr_accessor("text","rands","detailed_rands"),q.$attr_writer("secret","success","failure","critical","fumble"),e.def(q,"$secret?",D=function(){return this.secret},D.$$arity=0),e.def(q,"$success?",Z=function(){return this.success},Z.$$arity=0),e.def(q,"$failure?",A=function(){return this.failure},A.$$arity=0),e.def(q,"$critical?",B=function(){return this.critical},B.$$arity=0),e.def(q,"$fumble?",d=function(){return this.fumble},d.$$arity=0),void e.def(q,"$condition=",n=function(u){return this.success=u,this.failure=u["$!"]()},n.$$arity=1)},Opal.modules["racc/parser"]=function(e){function W(G,D){return"number"==typeof G&&"number"==typeof D?G<D:G["$<"](D)}function X(G,D){return"number"==typeof G&&"number"==typeof D?G-D:G["$-"](D)}function S(G,D){return"number"==typeof G&&"number"==typeof D?G+D:G["$+"](D)}function r(G,D){return"number"==typeof G&&"number"==typeof D?G>=D:G["$>="](D)}function x(G,D){return"number"==typeof G&&"number"==typeof D?G>D:G["$>"](D)}function _(G,D){return"number"==typeof G&&"number"==typeof D?G<=D:G["$<="](D)}var B,d,n,D,A,P=[],t=e.nil,C=e.$$$,i=e.$$,I=e.module,F=e.klass,l=e.truthy,q=e.gvars,H=e.send;return D=P,B=(A=[I(P[0],"Racc")].concat(D))[0],d=i(A,"StandardError"),n=A,[F(B,d,"ParseError")].concat(n),l(C("::","ParseError","skip_raise")?"constant":t)||e.const_set(P[0],"ParseError",C(i(P,"Racc"),"ParseError")),function(G,D){var f,R,g,h,v,E,K,T,c,o,m,y,z,a,p,Y,te,re,me,ye,De,Be,Te,Ee,Ce,u,b,A=[I(G,"Racc")].concat(D);l(i(A,"Racc_No_Extensions","skip_raise")?"constant":t)||e.const_set(A[0],"Racc_No_Extensions",!1),f=A,u=F(A[0],null,"Parser"),b=[u].concat(f),u.$$prototype.yydebug=u.$$prototype.racc_debug_out=u.$$prototype.racc_error_status=u.$$prototype.racc_t=u.$$prototype.racc_vstack=u.$$prototype.racc_val=u.$$prototype.racc_state=u.$$prototype.racc_tstack=t,e.const_set(b[0],"Racc_Runtime_Version","1.4.6"),e.const_set(b[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(b[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(b[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(b[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(b[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(b[0],"Racc_Runtime_Core_Version",i(b,"Racc_Runtime_Core_Version_R")),e.const_set(b[0],"Racc_Runtime_Core_Revision",i(b,"Racc_Runtime_Core_Revision_R")),e.const_set(b[0],"Racc_Runtime_Type","ruby"),e.defs(i(b,"Parser"),"$racc_runtime_type",R=function(){return i(b,"Racc_Runtime_Type")},R.$$arity=0),e.def(u,"$_racc_setup",g=function(){var O,J,s=this,N=t,w=t,k=t;return null==q.stderr&&(q.stderr=t),l(C(s.$class(),"Racc_debug_parser"))||(s.yydebug=!1),l(null!=(O=s.yydebug)&&O!==t?"instance-variable":t)||(s.yydebug=!1),l(s.yydebug)&&(l(null!=(J=s.racc_debug_out)&&J!==t?"instance-variable":t)||(s.racc_debug_out=q.stderr),s.racc_debug_out=l(N=s.racc_debug_out)?N:q.stderr),w=C(s.$class(),"Racc_arg"),l(W(w.$size(),14))&&(H(w,"[]=",e.to_a(k=[13,!0])),X(k.length,1)),w},g.$$arity=0),e.def(u,"$_racc_init_sysvars",h=function(){var O=this;return O.racc_state=[0],O.racc_tstack=[],O.racc_vstack=[],O.racc_t=t,O.racc_val=t,O.racc_read_next=!0,O.racc_user_yyerror=!1,O.racc_error_status=0},h.$$arity=0),e.def(u,"$do_parse",v=function(){return this.$__send__(i(b,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},v.$$arity=0),e.def(u,"$next_token",E=function(){return this.$raise(i(b,"NotImplementedError"),this.$class()+"#next_token is not defined")},E.$$arity=0),e.def(u,"$_racc_do_parse_rb",K=function(O,J){var s,w,k=this,Q=t,ee=t,$e=t,de=t,ie=t,ve=t,be=t,fe=t;return s=e.to_ary(O),Q=null==s[0]?t:s[0],ee=null==s[1]?t:s[1],$e=null==s[2]?t:s[2],de=null==s[3]?t:s[3],ie=null==s[10]?t:s[10],k.$_racc_init_sysvars(),ve=be=fe=t,H(k,"catch",["racc_end_parse"],((w=function(){var qe,Ne,ae=null==w.$$s?this:w.$$s,Se=t,Ae=t,Ie=t;for(null==ae.racc_state&&(ae.racc_state=t),null==ae.racc_read_next&&(ae.racc_read_next=t),null==ae.racc_t&&(ae.racc_t=t),null==ae.yydebug&&(ae.yydebug=t),null==ae.racc_val&&(ae.racc_val=t);l(!0);)for(l(fe=de["$[]"](ae.racc_state["$[]"](-1)))?(l(ae.racc_read_next)&&l(ae.racc_t["$!="](0))&&(Ne=ae.$next_token(),qe=e.to_ary(Ne),ve=null==qe[0]?t:qe[0],ae.racc_val=null==qe[1]?t:qe[1],ae.racc_t=l(ve)?l(Se=ie["$[]"](ve))?Se:1:0,l(ae.yydebug)&&ae.$racc_read_token(ae.racc_t,ve,ae.racc_val),ae.racc_read_next=!1),fe=S(fe,ae.racc_t),l(l(Ae=l(Ie=r(fe,0))?be=Q["$[]"](fe):Ie)?ee["$[]"](fe)["$=="](ae.racc_state["$[]"](-1)):Ae)||(be=$e["$[]"](ae.racc_state["$[]"](-1)))):be=$e["$[]"](ae.racc_state["$[]"](-1));l(be=ae.$_racc_evalact(be,O)););}).$$s=k,w.$$arity=0,w))},K.$$arity=2),e.def(u,"$yyparse",T=function(O,J){return this.$__send__(i(b,"Racc_YY_Parse_Method"),O,J,this.$_racc_setup(),!0)},T.$$arity=2),e.def(u,"$_racc_yyparse_rb",c=function(O,J,s,N){var w,Q,$e=t,de=t,ne=t,ie=t,be=t,fe=t,he=t;return w=e.to_ary(s),$e=null==w[0]?t:w[0],de=null==w[1]?t:w[1],ne=null==w[2]?t:w[2],ie=null==w[3]?t:w[3],be=null==w[10]?t:w[10],this.$_racc_init_sysvars(),fe=t,he=t,H(this,"catch",["racc_end_parse"],((Q=function(){var Se,xe=null==Q.$$s?this:Q.$$s;for(null==xe.racc_state&&(xe.racc_state=t);!l(he=ie["$[]"](xe.racc_state["$[]"](-1)));)for(;l(fe=xe.$_racc_evalact(ne["$[]"](xe.racc_state["$[]"](-1)),s)););return H(O,"__send__",[J],((Se=function(Ie,Pe){var Ue,He,ke=null==Se.$$s?this:Se.$$s,Le=t,Ge=t,je=t,We=t,ue=t,U=t,_e=t;for(null==ke.racc_t&&(ke.racc_t=t),null==ke.racc_state&&(ke.racc_state=t),null==ke.racc_read_next&&(ke.racc_read_next=t),null==Ie&&(Ie=t),null==Pe&&(Pe=t),ke.racc_t=l(Ie)?l(Le=be["$[]"](Ie))?Le:1:0,ke.racc_val=Pe,ke.racc_read_next=!1,he=S(he,ke.racc_t),l(l(Ue=l(He=r(he,0))?fe=$e["$[]"](he):He)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):Ue)||(fe=ne["$[]"](ke.racc_state["$[]"](-1)));l(fe=ke.$_racc_evalact(fe,s)););for(;l(l(Ge=l(je=(he=ie["$[]"](ke.racc_state["$[]"](-1)))["$!"]())?je:ke.racc_read_next["$!"]())?Ge:ke.racc_t["$=="](0));)for(l(l(We=l(ue=l(U=l(_e=he)?he=S(he,ke.racc_t):_e)?r(he,0):U)?fe=$e["$[]"](he):ue)?de["$[]"](he)["$=="](ke.racc_state["$[]"](-1)):We)||(fe=ne["$[]"](ke.racc_state["$[]"](-1)));l(fe=ke.$_racc_evalact(fe,s)););}).$$s=xe,Se.$$arity=2,Se))}).$$s=this,Q.$$arity=0,Q))},c.$$arity=4),e.def(u,"$_racc_evalact",o=function(O,J){var s,w,ne,ve,k=this,Q=t,ee=t,de=t,ie=t,be=t,fe=t,he=t,ae=t,xe=t,qe=t;if(Q=null==(s=e.to_ary(J))[0]?t:s[0],ee=null==s[1]?t:s[1],de=null==s[3]?t:s[3],ne=null==s[11]?t:s[11],ie=null==s[12]?t:s[12],l(l(ve=x(O,0))?W(O,ne):ve))l(x(k.racc_error_status,0))&&(k.racc_t["$=="](1)||(k.racc_error_status=X(k.racc_error_status,1))),k.racc_vstack.$push(k.racc_val),k.racc_state.$push(O),k.racc_read_next=!0,l(k.yydebug)&&(k.racc_tstack.$push(k.racc_t),k.$racc_shift(k.racc_t,k.racc_tstack,k.racc_vstack));else if(l(l(be=W(O,0))?x(O,ie["$-@"]()):be)){if(fe=H(k,"catch",["racc_jump"],((w=function(){var Se=null==w.$$s?this:w.$$s;return null==Se.racc_state&&(Se.racc_state=t),Se.racc_state.$push(Se.$_racc_do_reduce(J,O)),!1}).$$s=k,w.$$arity=0,w)),l(fe)){if(1["$==="](he=fe))return k.racc_user_yyerror=!0,ie["$-@"]();if(2["$==="](he))return ne;k.$raise("[Racc Bug] unknown jump code")}}else if(O["$=="](ne))l(k.yydebug)&&k.$racc_accept(),k.$throw("racc_end_parse",k.racc_vstack["$[]"](0));else{if(O["$=="](ie["$-@"]())){for((0)["$==="](he=k.racc_error_status)?l(J["$[]"](21))||k.$on_error(k.racc_t,k.racc_val,k.racc_vstack):3["$==="](he)&&(k.racc_t["$=="](0)&&k.$throw("racc_end_parse",t),k.racc_read_next=!0),k.racc_user_yyerror=!1,k.racc_error_status=3;l(!0)&&(!l(ae=de["$[]"](k.racc_state["$[]"](-1)))||(ae=S(ae,1),!l(l(xe=l(qe=r(ae,0))?O=Q["$[]"](ae):qe)?ee["$[]"](ae)["$=="](k.racc_state["$[]"](-1)):xe)));)l(_(k.racc_state.$size(),1))&&k.$throw("racc_end_parse",t),k.racc_state.$pop(),k.racc_vstack.$pop(),l(k.yydebug)&&(k.racc_tstack.$pop(),k.$racc_e_pop(k.racc_state,k.racc_tstack,k.racc_vstack));return O}k.$raise("[Racc Bug] unknown action "+O.$inspect())}return l(k.yydebug)&&k.$racc_next_state(k.racc_state["$[]"](-1),k.racc_state),t},o.$$arity=2),e.def(u,"$_racc_do_reduce",m=function(O,J){var s,ne,ve,qe,Ne,Se,ke,w=this,Q=t,ee=t,$e=t,de=t,ie=t,be=t,fe=t,he=t,ae=t,xe=t,Ae=t,Ie=t,Pe=t,Me=t,Fe=t,Le=t;return Q=null==(s=e.to_ary(O))[4]?t:s[4],ee=null==s[5]?t:s[5],$e=null==s[6]?t:s[6],de=null==s[7]?t:s[7],ne=null==s[8]?t:s[8],ie=null==s[9]?t:s[9],ve=null==s[13]?t:s[13],be=w.racc_state,fe=w.racc_vstack,he=w.racc_tstack,ae=function(G,D){return"number"==typeof G?-3*G:G["$*"](-3)}(J),xe=ie["$[]"](ae),qe=ie["$[]"](S(ae,1)),Ne=ie["$[]"](S(ae,2)),Se=[],l(w.yydebug)&&(Ae=he["$[]"](xe["$-@"](),xe)),Ie=fe["$[]"](xe["$-@"](),xe),l(w.yydebug)&&(Pe=[xe["$-@"](),xe,Se],H(he,"[]=",e.to_a(Pe)),X(Pe.length,1)),Pe=[xe["$-@"](),xe,Se],H(fe,"[]=",e.to_a(Pe)),X(Pe.length,1),Pe=[xe["$-@"](),xe,Se],H(be,"[]=",e.to_a(Pe)),X(Pe.length,1),l(ve)?fe.$push(w.$__send__(Ne,Ie,fe,Ie["$[]"](0))):fe.$push(w.$__send__(Ne,Ie,fe)),he.$push(qe),l(w.yydebug)&&w.$racc_reduce(Ae,qe,he,fe),ke=X(qe,ne),l(ae=de["$[]"](ke))&&(ae=S(ae,be["$[]"](-1)),l(l(Me=l(Fe=r(ae,0))?Le=Q["$[]"](ae):Fe)?ee["$[]"](ae)["$=="](ke):Me))?Le:$e["$[]"](ke)},m.$$arity=2),e.def(u,"$on_error",y=function(O,J,s){var w,N=this;return N.$raise(i(b,"ParseError"),N.$sprintf("\nparse error on value %s (%s)",J.$inspect(),l(w=N.$token_to_str(O))?w:"?"))},y.$$arity=3),e.def(u,"$yyerror",z=function(){return this.$throw("racc_jump",1)},z.$$arity=0),e.def(u,"$yyaccept",a=function(){return this.$throw("racc_jump",2)},a.$$arity=0),e.def(u,"$yyerrok",p=function(){return this.racc_error_status=0},p.$$arity=0),e.def(u,"$racc_read_token",Y=function(O,J,s){var N=this;return N.racc_debug_out.$print("read    "),N.racc_debug_out.$print(J.$inspect(),"(",N.$racc_token2str(O),") "),N.racc_debug_out.$puts(s.$inspect()),N.racc_debug_out.$puts()},Y.$$arity=3),e.def(u,"$racc_shift",te=function(O,J,s){var N=this;return N.racc_debug_out.$puts("shift   "+N.$racc_token2str(O)),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},te.$$arity=3),e.def(u,"$racc_reduce",re=function(O,J,s,N){var w,k=this,Q=t;return(Q=k.racc_debug_out).$print("reduce "),l(O["$empty?"]())?Q.$print(" <none>"):H(O,"each",[],((w=function($e){return null==$e&&($e=t),Q.$print(" ",(null==w.$$s?this:w.$$s).$racc_token2str($e))}).$$s=k,w.$$arity=1,w)),Q.$puts(" --\x3e "+k.$racc_token2str(J)),k.$racc_print_stacks(s,N),k.racc_debug_out.$puts()},re.$$arity=4),e.def(u,"$racc_accept",me=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},me.$$arity=0),e.def(u,"$racc_e_pop",ye=function(O,J,s){var N=this;return N.racc_debug_out.$puts("error recovering mode: pop token"),N.$racc_print_states(O),N.$racc_print_stacks(J,s),N.racc_debug_out.$puts()},ye.$$arity=3),e.def(u,"$racc_next_state",De=function(O,J){var s=this;return s.racc_debug_out.$puts("goto    "+O),s.$racc_print_states(J),s.racc_debug_out.$puts()},De.$$arity=2),e.def(u,"$racc_print_stacks",Be=function(O,J){var s,w=t;return(w=this.racc_debug_out).$print("        ["),H(O,"each_index",[],((s=function(Q){return null==Q&&(Q=t),w.$print(" (",(null==s.$$s?this:s.$$s).$racc_token2str(O["$[]"](Q))," ",J["$[]"](Q).$inspect(),")")}).$$s=this,s.$$arity=1,s)),w.$puts(" ]")},Be.$$arity=2),e.def(u,"$racc_print_states",Te=function(O){var J,N=t;return(N=this.racc_debug_out).$print("        ["),H(O,"each",[],((J=function(k){return null==k&&(k=t),N.$print(" ",k)}).$$s=this,J.$$arity=1,J)),N.$puts(" ]")},Te.$$arity=1),e.def(u,"$racc_token2str",Ee=function(O){var s;return l(s=C(this.$class(),"Racc_token_to_s_table")["$[]"](O))?s:this.$raise("[Racc Bug] can't convert token "+O+" to string")},Ee.$$arity=1),e.def(u,"$token_to_str",Ce=function(O){return C(this.$class(),"Racc_token_to_s_table")["$[]"](O)},Ce.$$arity=1)}(P[0],P)},Opal.modules["bcdice/arithmetic/node"]=function(e){function W(P,t){return"number"==typeof P&&"number"==typeof t?P/t:P["$/"](t)}var t,F,G,A,B,d,u,b,R,g,h,v,n,f,Z,q,i,S=[],r=e.nil,x=e.$$$,_=e.$$,V=e.module,$=e.klass,L=e.send2;return t=S,F=i=[V(S[0],"BCDice")].concat(t),G=q=[V(i[0],"Arithmetic")].concat(F),function(A,B,d){var u,b,R,g,h,n=$(A,null,"BinaryOp");[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(E,K,T){var c=this;return c.lhs=E,c.op=K,c.rhs=T},u.$$arity=3),e.def(n,"$eval",b=function(E){var c,K=this,T=r;return T=K.lhs.$eval(E),c=K.rhs.$eval(E),T.$send(K.op,c)},b.$$arity=1),e.def(n,"$output",R=function(){var E=this;return""+E.lhs.$output()+E.op+E.rhs.$output()},R.$$arity=0),e.def(n,"$s_exp",g=function(){var E=this;return"("+E.$op_for_s_exp()+" "+E.lhs.$s_exp()+" "+E.rhs.$s_exp()+")"},g.$$arity=0),e.def(n,"$op_for_s_exp",h=function(){return this.op},h.$$arity=0)}((Z=[V(q[0],"Node")].concat(G))[0],0,Z),A=Z[0],B=_(Z,"BinaryOp"),d=Z,n=$(A,B,"DivideBase"),f=[n].concat(d),n.$$prototype.lhs=n.$$prototype.rhs=n.$$prototype.op=r,e.def(n,"$initialize",u=function(K,T){return u.$$p&&(u.$$p=null),L(this,e.find_super_dispatcher(this,"initialize",u,!1,!0),"initialize",[K,"/",T],null)},u.$$arity=2),e.def(n,"$eval",b=function(K){var c,T=this,o=r;return c=T.lhs.$eval(K),(o=T.rhs.$eval(K))["$=="](0)&&T.$raise(_(f,"ZeroDivisionError")),T.$divide_and_round(c,o,K)},b.$$arity=1),e.def(n,"$output",R=function(){var K=R.$$p,c=this,o=r,m=r,y=r;for(K&&(R.$$p=null),m=0,y=arguments.length,o=new Array(y);m<y;m++)o[m]=arguments[m];return""+L(c,e.find_super_dispatcher(c,"output",R,!1,!0),"output",o,K)+c.$rounding_method()},R.$$arity=0),n.$private(),e.def(n,"$rounding_method",g=function(){return x(this.$class(),"ROUNDING_METHOD")},g.$$arity=0),e.def(n,"$op_for_s_exp",h=function(){return""+this.op+this.$rounding_method()},h.$$arity=0),e.def(n,"$divide_and_round",v=function(K,T,c){return this.$raise(_(f,"NotImplementedError"))},v.$$arity=3),function(A,B,d){var u,n=$(A,B,"DivideWithGameSystemDefault"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD",""),n.$private(),e.def(n,"$divide_and_round",u=function(R,g,h){var E;return E=h,x(_(f,"RoundType"),"CEIL")["$==="](E)?W(R.$to_f(),g).$ceil():x(_(f,"RoundType"),"ROUND")["$==="](E)?W(R.$to_f(),g).$round():W(R,g).$to_i()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,B,d){var u,n=$(A,B,"DivideWithCeil"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","C"),n.$private(),e.def(n,"$divide_and_round",u=function(R,g,h){return W(R.$to_f(),g).$ceil()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,B,d){var u,n=$(A,B,"DivideWithRound"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","R"),n.$private(),e.def(n,"$divide_and_round",u=function(R,g,h){return W(R.$to_f(),g).$round()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,B,d){var u,n=$(A,B,"DivideWithFloor"),f=[n].concat(d);e.const_set(f[0],"ROUNDING_METHOD","F"),n.$private(),e.def(n,"$divide_and_round",u=function(R,g,h){return W(R,g).$to_i()},u.$$arity=3)}(Z[0],_(Z,"DivideBase"),Z),function(A,B,d){var u,b,R,g,n=$(A,null,"Negative");[n].concat(d),n.$$prototype.body=r,e.def(n,"$initialize",u=function(v){return this.body=v},u.$$arity=1),e.def(n,"$eval",b=function(v){return this.body.$eval(v)["$-@"]()},b.$$arity=1),e.def(n,"$output",R=function(){return"-"+this.body.$output()},R.$$arity=0),e.def(n,"$s_exp",g=function(){return"(- "+this.body.$s_exp()+")"},g.$$arity=0)}(Z[0],0,Z),function(A,B,d){var u,b,R,g,n=$(A,null,"Parenthesis");[n].concat(d),n.$$prototype.expr=r,e.def(n,"$initialize",u=function(v){return this.expr=v},u.$$arity=1),e.def(n,"$eval",b=function(v){return this.expr.$eval(v)},b.$$arity=1),e.def(n,"$output",R=function(){return"("+this.expr.$output()+")"},R.$$arity=0),e.def(n,"$s_exp",g=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},g.$$arity=0)}(Z[0],0,Z),void function(A,B,d){var u,b,R,n=$(A,null,"Number");[n].concat(d),n.$$prototype.value=r,e.def(n,"$initialize",u=function(h){return this.value=h},u.$$arity=1),e.def(n,"$eval",b=function(h){return this.value},b.$$arity=1),e.def(n,"$output",R=function(){return this.value.$to_s()},R.$$arity=0),e.alias(n,"s_exp","output")}(Z[0],0,Z)},Opal.modules.strscan=function(e){var C,F,l,q,H,G,D,Z,A,B,d,n,f,u,b,R,g,h,v,E,K,T,c,o,m,y,i,I,S=[],r=e.nil,_=e.$$,$=e.truthy,L=e.send;return C=S,i=(0,e.klass)(S[0],null,"StringScanner"),I=[i].concat(C),i.$$prototype.pos=i.$$prototype.string=i.$$prototype.working=i.$$prototype.matched=i.$$prototype.prev_pos=i.$$prototype.match=r,i.$attr_reader("pos"),i.$attr_reader("matched"),e.def(i,"$initialize",F=function(a){var p=this;return p.string=a,p.pos=0,p.matched=r,p.working=a,p.match=[]},F.$$arity=1),i.$attr_reader("string"),e.def(i,"$beginning_of_line?",l=function(){var a=this;return 0===a.pos||"\n"===a.string.charAt(a.pos-1)},l.$$arity=0),e.alias(i,"bol?","beginning_of_line?"),e.def(i,"$scan",q=function(a){var p=this,Y=(a=p.$anchor(a)).exec(p.working);return null==Y?p.matched=r:"object"==typeof Y?(p.prev_pos=p.pos,p.pos+=Y[0].length,p.working=p.working.substring(Y[0].length),p.matched=Y[0],p.match=Y,Y[0]):"string"==typeof Y?(p.pos+=Y.length,p.working=p.working.substring(Y.length),Y):r},q.$$arity=1),e.def(i,"$scan_until",H=function(a){var p=this;a=p.$anchor(a);for(var re,Y=p.pos,te=p.working;;){if(re=a.exec(te),Y+=1,te=te.substr(1),null!=re)return p.matched=p.string.substr(p.pos,Y-p.pos-1+re[0].length),p.match=re,p.prev_pos=Y-1,p.pos=Y,p.working=te.substr(re[0].length),p.matched;if(0===te.length)return p.match=[],p.matched=r}},H.$$arity=1),e.def(i,"$[]",G=function(a){var Y;if($(this.match["$empty?"]()))return r;Y=a,_(I,"Symbol")["$==="](Y)?a=a.$to_s():_(I,"String")["$==="](Y)||(a=_(I,"Opal")["$coerce_to!"](a,_(I,"Integer"),"to_int"));var te=this.match;return a<0&&(a+=te.length),a<0||a>=te.length||null==te[a]?r:te[a]},G.$$arity=1),e.def(i,"$check",D=function(a){var p=this,Y=(a=p.$anchor(a)).exec(p.working);return p.matched=null==Y?r:Y[0]},D.$$arity=1),e.def(i,"$check_until",Z=function(a){var p=this,Y=p.prev_pos,te=p.pos,re=p.$scan_until(a);return re!==r&&(p.matched=re.substr(-1),p.working=p.string.substr(te)),p.prev_pos=Y,p.pos=te,re},Z.$$arity=1),e.def(i,"$peek",A=function(a){return this.working.substring(0,a)},A.$$arity=1),e.def(i,"$eos?",B=function(){return 0===this.working.length},B.$$arity=0),e.def(i,"$exist?",d=function(a){var Y=a.exec(this.working);return null==Y?r:0==Y.index?0:Y.index+1},d.$$arity=1),e.def(i,"$skip",n=function(a){var p=this,Y=(a=p.$anchor(a)).exec(p.working);if(null==Y)return p.match=[],p.matched=r;var te=Y[0],re=te.length;return p.matched=te,p.match=Y,p.prev_pos=p.pos,p.pos+=re,p.working=p.working.substring(re),re},n.$$arity=1),e.def(i,"$skip_until",f=function(a){var Y=this.$scan_until(a);return Y===r?r:(this.matched=Y.substr(-1),Y.length)},f.$$arity=1),e.def(i,"$get_byte",u=function(){var a=this,p=r;return a.pos<a.string.length?(a.prev_pos=a.pos,a.pos+=1,p=a.matched=a.working.substring(0,1),a.working=a.working.substring(1)):a.matched=r,p},u.$$arity=0),e.alias(i,"getch","get_byte"),e.def(i,"$match?",b=function(a){var p=this,Y=(a=p.$anchor(a)).exec(p.working);return null==Y?r:(p.prev_pos=p.pos,Y[0].length)},b.$$arity=1),e.def(i,"$pos=",R=function(a){var p=this;return a<0&&(a+=p.string.$length()),p.pos=a,p.working=p.string.slice(a)},R.$$arity=1),e.def(i,"$matched_size",g=function(){return this.matched===r?r:this.matched.length},g.$$arity=0),e.def(i,"$post_match",h=function(){var a=this;return a.matched===r?r:a.string.substr(a.pos)},h.$$arity=0),e.def(i,"$pre_match",v=function(){var a=this;return a.matched===r?r:a.string.substr(0,a.prev_pos)},v.$$arity=0),e.def(i,"$reset",E=function(){var a=this;return a.working=a.string,a.matched=r,a.pos=0},E.$$arity=0),e.def(i,"$rest",K=function(){return this.working},K.$$arity=0),e.def(i,"$rest?",T=function(){return 0!==this.working.length},T.$$arity=0),e.def(i,"$rest_size",c=function(){return this.$rest().$size()},c.$$arity=0),e.def(i,"$terminate",o=function(){var p,P,a=this;return a.match=r,p=[a.string.$length()],L(a,"pos=",e.to_a(p)),p[(P=p.length,"number"==typeof P?P-1:P["$-"](1))]},o.$$arity=0),e.def(i,"$unscan",m=function(){var a=this;return a.pos=a.prev_pos,a.prev_pos=r,a.match=r,a},m.$$arity=0),i.$private(),e.def(i,"$anchor",y=function(a){var Y=a.toString().match(/\/([^\/]+)$/);return Y=Y?Y[1]:void 0,new RegExp("^(?:"+a.source+")",Y)},y.$$arity=1),r&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var C,F,l,i,$,P,X=[],S=e.nil,_=e.module;return $=X,C=P=[_(X[0],"BCDice")].concat($),[i=_(P[0],"Normalize")].concat(C),i.$module_function(),e.def(i,"$comparison_operator",F=function(H){var D;return/<=|=</["$==="](D=H)?"<=":/>=|=>/["$==="](D)?">=":/<>|!=|=!/["$==="](D)?"!=":/</["$==="](D)?"<":/>/["$==="](D)?">":/=/["$==="](D)?"==":S},F.$$arity=1),void e.def(i,"$target_number",l=function(H){return H["$=="]("?")?H:H.$to_i()},l.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var C,l,Z,d,n,f,A,B,H,I,W=e.top,X=[],S=e.nil,x=e.$$,_=e.module,V=e.klass,$=e.hash2,L=e.truthy,P=e.send;return W.$require("strscan"),W.$require("bcdice/normalize"),C=X,l=I=[_(X[0],"BCDice")].concat(C),Z=H=[_(I[0],"Command")].concat(l),A=V(H[0],null,"Lexer"),B=[A].concat(Z),A.$$prototype.scanner=A.$$prototype.notations=S,e.const_set(B[0],"SYMBOLS",$(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(A,"$initialize",d=function(b,R){var g,h,v,K,E=this;return b=L(K=(h=(g=b)===S||null==g?S:P(g,"split",[" ",2]))===S||null==h?S:P(h,"first",[]))?K:"",E.scanner=x(B,"StringScanner").$new(b),E.notations=P(R,"map",[],((v=function(T){function c(o){return T.apply(this,arguments)}return c.toString=function(){return T.toString()},c}(function(T){return null==T&&(T=S),L(T["$is_a?"](x(B,"String")))?x(B,"Regexp").$new(T):T})).$$s=E,v.$$arity=1,v))},d.$$arity=2),e.def(A,"$next_token",n=function(){try{var b,R=this,g=S,h=S,E=S,K=S;return L(R.scanner["$eos?"]())?[!1,"$"]:(P(R.notations,"each",[],((b=function(c){var m,o=null==b.$$s?this:b.$$s;if(null==o.scanner&&(o.scanner=S),null==c&&(c=S),m=o.scanner.$scan(c),!L(m))return S;e.ret(["NOTATION",m])}).$$s=R,b.$$arity=1,b)),L(g=R.scanner.$scan(/\d+/))?["NUMBER",g.$to_i()]:L(h=R.scanner.$scan(/[<>!=]+/))?(h=x(B,"Normalize").$comparison_operator(h),[L(h)?"CMP_OP":"ILLEGAL",h]):(E=R.scanner.$getch().$upcase(),[L(K=x(B,"SYMBOLS")["$[]"](E))?K:E.$to_sym(),E]))}catch(T){if(T===e.returner)return T.$v;throw T}},n.$$arity=0),void e.def(A,"$source",f=function(){return this.scanner.$string()},f.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var P,I,G,A,B,d,D,Z,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.klass,$=e.truthy;return P=X,I=C=[_(X[0],"BCDice")].concat(P),G=l=[_(C[0],"Command")].concat(I),D=V(l[0],null,"Parsed"),Z=[D].concat(G),D.$$prototype.question_target=D.$$prototype.critical=D.$$prototype.fumble=D.$$prototype.dollar=D.$$prototype.modify_number=D.$$prototype.target_number=D.$$prototype.prefix_number=D.$$prototype.command=D.$$prototype.suffix_number=D.$$prototype.cmp_op=S,D.$attr_accessor("command"),D.$attr_accessor("prefix_number"),D.$attr_accessor("suffix_number"),D.$attr_accessor("critical"),D.$attr_accessor("fumble"),D.$attr_accessor("dollar"),D.$attr_accessor("modify_number"),D.$attr_accessor("cmp_op"),D.$attr_accessor("target_number"),D.$attr_writer("question_target"),e.def(D,"$initialize",A=function(){var f=this;return f.prefix_number=S,f.suffix_number=S,f.critical=S,f.fumble=S,f.dollar=S,f.cmp_op=S,f.target_number=S,f.question_target=!1},A.$$arity=0),e.def(D,"$question_target?",B=function(){return this.question_target},B.$$arity=0),void e.def(D,"$to_s",d=function(f){var E,u=this,b=S,R=S,g=S,h=S,v=S;return null==f&&(f="after_command"),b=$(u.critical)?"@"+u.critical:S,R=$(u.fumble)?"#"+u.fumble:S,g=$(u.dollar)?"$"+u.dollar:S,h=x(Z,"Format").$modifier(u.modify_number),v=$(u.question_target)?"?":u.target_number,"after_command"["$==="](E=f)?[u.prefix_number,u.command,u.suffix_number,b,R,g,h,u.cmp_op,v].$join():"after_modify_number"["$==="](E)?[u.prefix_number,u.command,u.suffix_number,h,b,R,g,u.cmp_op,v].$join():"after_target_number"["$==="](E)?[u.prefix_number,u.command,u.suffix_number,h,u.cmp_op,v,b,R,g].$join():S},d.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function W(I,F){return"number"==typeof I&&"number"==typeof F?I-F:I["$-"](F)}var F,G,A,B,d,u,b,R,g,h,v,E,K,T,c,o,m,y,z,a,p,Y,te,re,me,ye,De,Be,Te,Ee,Ce,oe,O,J,s,N,w,k,Q,ee,$e,de,ne,ie,ve,be,fe,he,ae,xe,qe,Ne,Se,Ae,Ie,Pe,ke,Me,Fe,Le,Ge,n,f,Z,q,X=e.top,S=[],r=e.nil,x=e.$$$,_=e.$$,V=e.klass,$=e.module,L=e.hash2,P=e.send2,t=e.send,C=e.hash,i=e.truthy;return X.$require("racc/parser.rb"),X.$require("bcdice/arithmetic/node"),X.$require("bcdice/command/lexer"),X.$require("bcdice/command/parsed"),function(I,F,l){[V(I,F,"Parser")].concat(l)}(x(_(S,"BCDice"),"Command"),x(_(S,"Racc"),"Parser"),S),F=S,G=q=[$(S[0],"BCDice")].concat(F),A=(Z=[$(q[0],"Command")].concat(G))[0],B=x(_(Z,"Racc"),"Parser"),d=Z,n=V(A,B,"Parser"),f=[n].concat(d),n.$$prototype.notations=n.$$prototype.lexer=n.$$prototype.modifier=n.$$prototype.prefix_number=n.$$prototype.suffix_number=n.$$prototype.need_suffix_number=n.$$prototype.need_prefix_number=n.$$prototype.critical=n.$$prototype.fumble=n.$$prototype.dollar=n.$$prototype.allowed_cmp_op=n.$$prototype.question_target=r,e.def(n,"$initialize",u=function(U,_e){var j,M,se,Re,pe=u.$$p,le=this;if(pe&&(u.$$p=null),j=e.slice.call(arguments,0,arguments.length),null==(M=e.extract_kwargs(j)))M=L([],{});else if(!M.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(se=j,!e.hasOwnProperty.call(M.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return Re=M.$$smap.round_type,P(le,e.find_super_dispatcher(le,"initialize",u,!1,!0),"initialize",[],null),le.notations=se,le.round_type=Re,le.prefix_number=!1,le.suffix_number=!1,le.need_prefix_number=!1,le.need_suffix_number=!1,le.modifier=!0,le.critical=!1,le.fumble=!1,le.dollar=!1,le.allowed_cmp_op=[r,">=",">","<=","<","==","!="],le.question_target=!1},u.$$arity=-2),e.def(n,"$disable_modifier",b=function(){return this.modifier=!1,this},b.$$arity=0),e.def(n,"$enable_prefix_number",R=function(){return this.prefix_number=!0,this},R.$$arity=0),e.def(n,"$enable_suffix_number",g=function(){return this.suffix_number=!0,this},g.$$arity=0),e.def(n,"$has_prefix_number",h=function(){var U=this;return U.prefix_number=!0,U.need_prefix_number=!0,U},h.$$arity=0),e.def(n,"$has_suffix_number",v=function(){var U=this;return U.suffix_number=!0,U.need_suffix_number=!0,U},v.$$arity=0),e.def(n,"$enable_critical",E=function(){return this.critical=!0,this},E.$$arity=0),e.def(n,"$enable_fumble",K=function(){return this.fumble=!0,this},K.$$arity=0),e.def(n,"$enable_dollar",T=function(){return this.dollar=!0,this},T.$$arity=0),e.def(n,"$restrict_cmp_op_to",c=function(U){var _e,M=this;return _e=e.slice.call(arguments,0,arguments.length),M.allowed_cmp_op=_e,M},c.$$arity=-1),e.def(n,"$enable_question_target",o=function(){return this.question_target=!0,this},o.$$arity=0),e.def(n,"$parse",m=function(U){try{return this.lexer=_(f,"Lexer").$new(U,this.notations),this.$do_parse()}catch(j){if(!e.rescue(j,[_(f,"ParseError"),_(f,"ZeroDivisionError")]))throw j;try{return r}finally{e.pop_exception()}}},m.$$arity=1),n.$private(),e.def(n,"$parsed",y=function(U,_e,j,M){var se;return t(_(f,"Parsed").$new(),"tap",[],((se=function(ge){var we,ze,Ze,Ye,Ke,Qe,le=null==se.$$s?this:se.$$s,ce=r;return null==le.round_type&&(le.round_type=r),null==ge&&(ge=r),ce=[U["$[]"]("command")],t(ge,"command=",e.to_a(ce)),W(ce.length,1),ce=[(we=U["$[]"]("prefix"),we===r||null==we?r:t(we,"eval",[le.round_type]))],t(ge,"prefix_number=",e.to_a(ce)),W(ce.length,1),ce=[(ze=U["$[]"]("suffix"),ze===r||null==ze?r:t(ze,"eval",[le.round_type]))],t(ge,"suffix_number=",e.to_a(ce)),W(ce.length,1),ce=[(Ze=_e["$[]"]("critical"),Ze===r||null==Ze?r:t(Ze,"eval",[le.round_type]))],t(ge,"critical=",e.to_a(ce)),W(ce.length,1),ce=[(Ye=_e["$[]"]("fumble"),Ye===r||null==Ye?r:t(Ye,"eval",[le.round_type]))],t(ge,"fumble=",e.to_a(ce)),W(ce.length,1),ce=[(Ke=_e["$[]"]("dollar"),Ke===r||null==Ke?r:t(Ke,"eval",[le.round_type]))],t(ge,"dollar=",e.to_a(ce)),W(ce.length,1),ce=[j.$eval(le.round_type)],t(ge,"modify_number=",e.to_a(ce)),W(ce.length,1),ce=[M["$[]"]("cmp_op")],t(ge,"cmp_op=",e.to_a(ce)),W(ce.length,1),M["$[]"]("target")["$=="]("?")?(t(ge,"question_target=",e.to_a(ce=[!0])),W(ce.length,1),t(ge,"target_number=",e.to_a(ce=[0])),ce[W(ce.length,1)]):(t(ge,"question_target=",e.to_a(ce=[!1])),W(ce.length,1),ce=[(Qe=M["$[]"]("target"),Qe===r||null==Qe?r:t(Qe,"eval",[le.round_type]))],t(ge,"target_number=",e.to_a(ce)),ce[W(ce.length,1)])}).$$s=this,se.$$arity=1,se))},y.$$arity=4),e.def(n,"$next_token",z=function(){return this.lexer.$next_token()},z.$$arity=0),Ne=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,33,34,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,36,37,17,18,6,r,5,r,r,17,18,6,r,5,r,r,17,18,r,r,5,23,24,25,26,56,54,55,57],Se=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,r,17,15,15,18,18,23,r,18,30,30,23,23,24,r,23,31,31,24,24,25,r,24,44,44,25,25,28,r,25,47,47,28,28,29,r,28,48,48,29,29,33,r,29,49,49,33,33,34,r,33,50,50,34,34,36,r,34,r,r,36,36,37,r,36,r,r,37,37,r,r,37,27,27,27,27,52,52,52,52],Ae=[-2,4,16,-3,-1,11,r,33,13,35,23,30,1,r,28,40,r,37,44,r,r,-2,r,51,58,65,0,106,72,79,47,54,r,86,93,r,100,107,r,r,r,r,r,r,63,r,r,68,75,82,89,r,120,r,r,r,r,r],Ie=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],Pe=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,r,r,21,47,48,40,51,52,49,50,44,46,3,r,r,r,13,r,r,r,r,r,r,r,32],ke=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,r,r,4,8,8,5,7,7,8,8,9,5,6,r,r,r,6,r,r,r,r,r,r,r,6],Me=[r,6,13,3,9,-1,27,-15,-10,-1,-38],Fe=[r,r,r,r,r,r,19,16,15,r,r],Le=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],Ge=C(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(f[0],"Racc_arg",[Ne,Se,Ie,Ae,Pe,ke,Fe,Me,19,Le,Ge,58,35,!0]),e.const_set(f[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(f[0],"Racc_debug_parser",!1),e.def(n,"$_reduce_1",a=function(U,_e,j){var M;return i(this.modifier)||this.$raise(_(f,"ParseError")),M=e.to_ary(U),this.$parsed(null==M[0]?r:M[0],null==M[1]?r:M[1],null==M[2]?r:M[2],null==M[3]?r:M[3])},a.$$arity=3),e.def(n,"$_reduce_2",p=function(U,_e,j){var M;return i(this.modifier)||this.$raise(_(f,"ParseError")),M=e.to_ary(U),this.$parsed(null==M[0]?r:M[0],null==M[2]?r:M[2],null==M[1]?r:M[1],null==M[3]?r:M[3])},p.$$arity=3),e.def(n,"$_reduce_3",Y=function(U,_e,j){var M,le;return le=null==(M=e.to_ary(U))[2]?r:M[2],this.$parsed(null==M[0]?r:M[0],null==M[1]?r:M[1],x(x(_(f,"Arithmetic"),"Node"),"Number").$new(0),le)},Y.$$arity=3),e.def(n,"$_reduce_4",te=function(U,_e,j){var se,M=this;return i(i(se=M.prefix_number)?M.suffix_number:se)||M.$raise(_(f,"ParseError")),L(["command","prefix","suffix"],{command:U["$[]"](1),prefix:U["$[]"](0),suffix:U["$[]"](2)})},te.$$arity=3),e.def(n,"$_reduce_5",re=function(U,_e,j){var M=this;return i(M.prefix_number)||M.$raise(_(f,"ParseError")),i(M.need_suffix_number)&&M.$raise(_(f,"ParseError")),L(["command","prefix"],{command:U["$[]"](1),prefix:U["$[]"](0)})},re.$$arity=3),e.def(n,"$_reduce_6",me=function(U,_e,j){var M=this;return i(M.suffix_number)||M.$raise(_(f,"ParseError")),i(M.need_prefix_number)&&M.$raise(_(f,"ParseError")),L(["command","suffix"],{command:U["$[]"](0),suffix:U["$[]"](1)})},me.$$arity=3),e.def(n,"$_reduce_7",ye=function(U,_e,j){var se,M=this;return i(i(se=M.need_prefix_number)?se:M.need_suffix_number)&&M.$raise(_(f,"ParseError")),L(["command"],{command:U["$[]"](0)})},ye.$$arity=3),e.def(n,"$_reduce_8",De=function(U,_e,j){return L([],{})},De.$$arity=3),e.def(n,"$_reduce_9",Be=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.critical)?pe["$[]"]("critical")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["critical",le])),W(ze.length,1),pe},Be.$$arity=3),e.def(n,"$_reduce_10",Te=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.fumble)?pe["$[]"]("fumble")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["fumble",le])),W(ze.length,1),pe},Te.$$arity=3),e.def(n,"$_reduce_11",Ee=function(U,_e,j){var M,le,ze,we,pe=r;return pe=null==(M=e.to_ary(U))[0]?r:M[0],le=null==M[2]?r:M[2],i(i(we=this.dollar)?pe["$[]"]("dollar")["$nil?"]():we)||this.$raise(_(f,"ParseError")),t(pe,"[]=",e.to_a(ze=["dollar",le])),W(ze.length,1),pe},Ee.$$arity=3),e.def(n,"$_reduce_12",Ce=function(U,_e,j){return U["$[]"](1)},Ce.$$arity=3),e.def(n,"$_reduce_13",oe=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},oe.$$arity=3),e.def(n,"$_reduce_14",O=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},O.$$arity=3),e.def(n,"$_reduce_15",J=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},J.$$arity=3),e.def(n,"$_reduce_16",s=function(U,_e,j){return i(this.allowed_cmp_op["$include?"](r))||this.$raise(_(f,"ParseError")),L([],{})},s.$$arity=3),e.def(n,"$_reduce_17",N=function(U,_e,j){var M,pe,ge;return ge=null==(M=e.to_ary(U))[1]?r:M[1],i(this.allowed_cmp_op["$include?"](pe=null==M[0]?r:M[0]))||this.$raise(_(f,"ParseError")),L(["cmp_op","target"],{cmp_op:pe,target:ge})},N.$$arity=3),e.def(n,"$_reduce_18",w=function(U,_e,j){var se,M=this;return se=U["$[]"](0),i(M.question_target)||M.$raise(_(f,"ParseError")),i(M.allowed_cmp_op["$include?"](se))||M.$raise(_(f,"ParseError")),L(["cmp_op","target"],{cmp_op:se,target:"?"})},w.$$arity=3),e.def(n,"$_reduce_19",k=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"+",U["$[]"](2))},k.$$arity=3),e.def(n,"$_reduce_20",Q=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"-",U["$[]"](2))},Q.$$arity=3),e.def(n,"$_reduce_22",ee=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"BinaryOp").$new(U["$[]"](0),"*",U["$[]"](2))},ee.$$arity=3),e.def(n,"$_reduce_23",$e=function(U,_e,j){return U["$[]"](3).$new(U["$[]"](0),U["$[]"](2))},$e.$$arity=3),e.def(n,"$_reduce_25",de=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},de.$$arity=3),e.def(n,"$_reduce_26",ne=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"DivideWithCeil")},ne.$$arity=3),e.def(n,"$_reduce_27",ie=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"DivideWithCeil")},ie.$$arity=3),e.def(n,"$_reduce_28",ve=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"DivideWithRound")},ve.$$arity=3),e.def(n,"$_reduce_29",be=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"DivideWithFloor")},be.$$arity=3),e.def(n,"$_reduce_30",fe=function(U,_e,j){return U["$[]"](1)},fe.$$arity=3),e.def(n,"$_reduce_31",he=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"Negative").$new(U["$[]"](1))},he.$$arity=3),e.def(n,"$_reduce_33",ae=function(U,_e,j){return U["$[]"](1)},ae.$$arity=3),e.def(n,"$_reduce_34",xe=function(U,_e,j){return x(x(_(f,"Arithmetic"),"Node"),"Number").$new(U["$[]"](0))},xe.$$arity=3),void e.def(n,"$_reduce_none",qe=function(U,_e,j){return U["$[]"](0)},qe.$$arity=3)},Opal.modules["bcdice/deprecated/checker"]=function(e){var P,I,H,Z,A,B,d,n,f,G,D,l,C,X=[],S=e.nil,x=e.$$,_=e.module,V=e.send,$=e.truthy;return P=X,I=C=[_(X[0],"BCDice")].concat(P),H=l=[_(C[0],"Deprecated")].concat(I),G=_(l[0],"Checker"),D=[G].concat(H),G.$private(),e.def(G,"$check_result_legacy",Z=function(b,R,g,h){var T,m,v=this,E=S,K=S,c=S,o=S,y=S;return E=V(R,"map",[],"sides".$to_proc()),T=(K=V(R,"map",[],"value".$to_proc())).$sum(),c=[100]["$==="](o=E)?v.$check_1D100(b,T,g,h):[20]["$==="](o)?v.$check_1D20(b,T,g,h):[6,6]["$==="](o)?v.$check_2D6(b,T,K,g,h):S,$($(m=c["$nil?"]())?m:c["$empty?"]())&&(o=E.$uniq(),c=[10]["$==="](o)?v.$check_nD10(b,T,K,g,h):[6]["$==="](o)?v.$check_nD6(b,T,K,g,h):S,$($(y=c["$nil?"]())?y:c["$empty?"]()))?S:x(D,"Result").$new(c.$delete_prefix(" \uff1e "))},Z.$$arity=4),e.def(G,"$check_1D100",A=function(b,R,g,h){return S},A.$$arity=4),e.def(G,"$check_1D20",B=function(b,R,g,h){return S},B.$$arity=4),e.def(G,"$check_nD10",d=function(b,R,g,h,v){return S},d.$$arity=5),e.def(G,"$check_2D6",n=function(b,R,g,h,v){return S},n.$$arity=5),void e.def(G,"$check_nD6",f=function(b,R,g,h,v){return S},f.$$arity=5)},Opal.modules["bcdice/base"]=function(e){function W(q,H){return"number"==typeof q&&"number"==typeof H?q+H:q["$+"](H)}function X(q,H){return"number"==typeof q&&"number"==typeof H?q-H:q["$-"](H)}var H,B,f,u,b,R,g,h,v,E,K,T,c,o,m,y,z,a,p,Y,te,re,me,ye,De,Be,Te,Ee,Ce,oe,O,J,w,k,Q,ee,$e,N,d,n,D,_=e.top,V=[],$=e.nil,L=e.$$$,P=e.$$,t=e.module,C=e.klass,i=e.truthy,I=e.send,F=e.range,l=$;return _.$require("i18n"),_.$require("i18n/backend/fallbacks"),_.$require("bcdice/randomizer"),_.$require("bcdice/dice_table"),_.$require("bcdice/enum"),_.$require("bcdice/translate"),_.$require("bcdice/result"),_.$require("bcdice/command/parser"),_.$require("bcdice/deprecated/checker"),H=V,B=D=[t(V[0],"BCDice")].concat(H),d=C(D[0],null,"Base"),n=[d].concat(B),d.$$prototype.sort_add_dice=d.$$prototype.sort_barabara_dice=d.$$prototype.enabled_d9=d.$$prototype.raw_input=d.$$prototype.randomizer=d.$$prototype.enabled_upcase_input=d.$$prototype.debug=$,J=e.get_singleton_class(d),N=[J].concat(n),J.$attr_reader("prefixes"),e.def(J,"$register_prefix",w=function(ne){var ve,be=this,fe=$;return null==be.prefixes&&(be.prefixes=$),ve=e.slice.call(arguments,0,arguments.length),be.prefixes=i(fe=be.prefixes)?fe:[],be.prefixes.$concat(ve.$flatten())},w.$$arity=-1),e.def(J,"$register_prefix_from_super_class",k=function(){return this.$register_prefix(this.$superclass().$prefixes())},k.$$arity=0),e.def(J,"$prefixes_pattern",Q=function(){var ie,ne=this,ve=$;return null==ne.prefixes_pattern&&(ne.prefixes_pattern=$),null==ne.prefixes&&(ne.prefixes=$),ne.prefixes_pattern=i(ie=ne.prefixes_pattern)?ie:$,i(ne.prefixes_pattern)?ne.prefixes_pattern:(ne.prefixes=i(ve=ne.prefixes)?ve:[],ne.prefixes.$freeze(),ne.prefixes_pattern=(i(ne.prefixes["$empty?"]())?/(?!)/:e.regexp(["^(S)?(",ne.prefixes.$join("|"),")"],"i")).$freeze())},Q.$$arity=0),e.def(J,"$command_pattern",ee=function(){var ne,ve,ie=this,be=$,fe=$;return null==ie.command_pattern&&(ie.command_pattern=$),null==ie.prefixes&&(ie.prefixes=$),ie.command_pattern=i(ve=ie.command_pattern)?ve:$,i(ie.command_pattern)?ie.command_pattern:(ie.prefixes=i(be=ie.prefixes)?be:[],ie.prefixes.$freeze(),fe=W(I(L(P(N,"CommonCommand"),"COMMANDS"),"map",[],((ne=function(ae){return null==ae&&(ae=$),L(ae,"PREFIX_PATTERN").$source()}).$$s=ie,ne.$$arity=1,ne)),ie.prefixes),ie.command_pattern=e.regexp(["^S?(",fe.$join("|"),")"],"i").$freeze())},ee.$$arity=0),e.def(J,"$eval",$e=function(ne){return this.$new(ne).$eval()},$e.$$arity=1),d.$include(P(n,"Translate")),d.$include(L(P(n,"Deprecated"),"Checker")),e.def(d,"$initialize",f=function(s){var N=this;return N.raw_input=s,N.sort_add_dice=!1,N.sort_barabara_dice=!1,N.d66_sort_type=L(P(n,"D66SortType"),"NO_SORT"),N.enabled_d9=!1,N.round_type=L(P(n,"RoundType"),"FLOOR"),N.sides_implicit_d=6,N.upper_dice_reroll_threshold=$,N.reroll_dice_reroll_threshold=$,N.default_cmp_op=$,N.default_target_number=$,N.enabled_upcase_input=!0,N.locale="ja_jp",N.randomizer=L(P(n,"BCDice"),"Randomizer").$new(),N.debug=!1},f.$$arity=1),d.$attr_accessor("randomizer"),d.$attr_reader("d66_sort_type"),d.$attr_reader("round_type"),d.$attr_reader("sides_implicit_d"),d.$attr_reader("upper_dice_reroll_threshold"),d.$attr_reader("reroll_dice_reroll_threshold"),d.$attr_reader("default_cmp_op"),d.$attr_reader("default_target_number"),e.def(d,"$sort_add_dice?",u=function(){return this.sort_add_dice},u.$$arity=0),e.def(d,"$sort_barabara_dice?",b=function(){return this.sort_barabara_dice},b.$$arity=0),e.def(d,"$enabled_d9?",R=function(){return this.enabled_d9},R.$$arity=0),e.def(d,"$enable_debug",g=function(){return this.debug=!0},g.$$arity=0),e.def(d,"$eval",h=function(){var N,w,k,s=this,Q=$;return N=L(P(n,"BCDice"),"Preprocessor").$process(s.raw_input,s),w=i(k=s.$dice_command(N))?k:s.$eval_common_command(s.raw_input),i(w)?(Q=[s.randomizer.$rand_results()],I(w,"rands=",e.to_a(Q)),X(Q.length,1),Q=[s.randomizer.$detailed_rand_results()],I(w,"detailed_rands=",e.to_a(Q)),X(Q.length,1),w):$},h.$$arity=0),e.def(d,"$change_text",v=function(s){return s},v.$$arity=1),e.def(d,"$check_result",E=function(s,N,w,k){var Q=this,ee=$,$e=$,de=$,ne=$,ie=$;return ee=Q.$check_result_legacy(s,N,w,k),i(ee)?ee:($e=I(N,"map",[],"sides".$to_proc()),ne=(de=I(N,"map",[],"value".$to_proc())).$sum(),(ee=[100]["$==="](ie=$e)?Q.$result_1d100(s,ne,w,k):[20]["$==="](ie)?Q.$result_1d20(s,ne,w,k):[6,6]["$==="](ie)?Q.$result_2d6(s,ne,de,w,k):$)["$=="](P(n,"Result").$nothing())?$:i(ee)?ee:(ie=$e.$uniq(),(ee=[10]["$==="](ie)?Q.$result_nd10(s,ne,de,w,k):[6]["$==="](ie)?Q.$result_nd6(s,ne,de,w,k):$)["$=="](P(n,"Result").$nothing())?$:i(ee)?ee:Q.$result_ndx(s,w,k)))},E.$$arity=4),e.def(d,"$grich_text",K=function(s,N,w){return $},K.$$arity=3),d.$private(),e.def(d,"$eval_common_command",T=function(s){try{var N;return s=this.$change_text(s),I(L(P(n,"CommonCommand"),"COMMANDS"),"each",[],((N=function(Q){var $e,ee=null==N.$$s?this:N.$$s;if(null==ee.randomizer&&(ee.randomizer=$),null==Q&&(Q=$),$e=Q.$eval(s,ee,ee.randomizer),!i($e))return $;e.ret($e)}).$$s=this,N.$$arity=1,N)),$}catch(k){if(k===e.returner)return k.$v;throw k}},T.$$arity=1),e.def(d,"$dice_command",c=function(s){var N,w=this,k=$,Q=$,ee=$,$e=$,de=$,ne=$,ie=$;return i(w.enabled_upcase_input)&&(s=s.$upcase()),k=w.$class().$prefixes_pattern().$match(s),i(k)?(Q=k["$[]"](1)["$nil?"]()["$!"](),i(Q)&&(s=s["$[]"](F(1,-1,!1))),ee=w.$eval_game_system_specific_command(s),i(ee["$is_a?"](P(n,"Result")))?($e=[i(de=ee["$secret?"]())?de:Q],I(ee,"secret=",e.to_a($e)),X($e.length,1),ee):i(i(ne=i(ie=ee["$nil?"]())?ie:ee["$empty?"]())?ne:ee["$=="]("1"))?$:I(P(n,"Result").$new(),"tap",[],((N=function(be){return null==be&&(be=$),$e=[ee.$to_s()],I(be,"text=",e.to_a($e)),X($e.length,1),I(be,"secret=",e.to_a($e=[Q])),$e[X($e.length,1)]}).$$s=w,N.$$arity=1,N))):$},c.$$arity=1),e.def(d,"$eval_game_system_specific_command",o=function(s){return $},o.$$arity=1),e.def(d,"$result_ndx",m=function(s,N,w){return i(w["$is_a?"](P(n,"String")))?$:i(s.$send(N,w))?P(n,"Result").$success(this.$translate("success")):P(n,"Result").$failure(this.$translate("failure"))},m.$$arity=3),e.def(d,"$result_1d100",y=function(s,N,w,k){return $},y.$$arity=4),e.def(d,"$result_1d20",z=function(s,N,w,k){return $},z.$$arity=4),e.def(d,"$result_nd10",a=function(s,N,w,k,Q){return $},a.$$arity=5),e.def(d,"$result_2d6",p=function(s,N,w,k,Q){return $},p.$$arity=5),e.def(d,"$result_nd6",Y=function(s,N,w,k,Q){return $},Y.$$arity=5),e.def(d,"$get_table_by_2d6",te=function(s){return this.$get_table_by_nD6(s,2)},te.$$arity=1),e.def(d,"$get_table_by_1d6",re=function(s){return this.$get_table_by_nD6(s,1)},re.$$arity=1),e.def(d,"$get_table_by_nD6",me=function(s,N){return this.$get_table_by_nDx(s,N,6)},me.$$arity=2),e.def(d,"$get_table_by_nDx",ye=function(s,N,w){var Q,ee=$;return Q=this.randomizer.$roll_sum(N,w),ee=this.$get_table_value(s["$[]"](X(Q,N))),i(ee["$nil?"]())?["1",0]:[ee,Q]},ye.$$arity=3),e.def(d,"$get_table_by_1d3",De=function(s){var k,Q,q,N=this,ee=$;return N.$debug("get_table_by_1d3"),k=N.randomizer.$roll_sum(1,6),N.$debug("num",k),Q=(q=X(k,1),"number"==typeof q?q/2:q["$/"](2)).$to_i(),N.$debug("index",Q),ee=s["$[]"](Q),i(ee["$nil?"]())?["1",0]:[ee,k]},De.$$arity=1),e.def(d,"$get_table_by_d66_swap",Be=function(s){var w;return w=this.randomizer.$roll_d66(L(P(n,"D66SortType"),"ASC")),[this.$get_table_by_number(w,s),w]},Be.$$arity=1),e.def(d,"$get_table_by_d66",Te=function(s){var w,k,Q,$e,q,ee=$;return w=this.randomizer.$roll_once(6),k=this.randomizer.$roll_once(6),Q=W("number"==typeof(q=X(w,1))?6*q:q["$*"](6),X(k,1)),ee=s["$[]"](Q),$e=""+w+k,i(ee["$nil?"]())?["1",$e]:[ee,$e]},Te.$$arity=1),e.def(d,"$get_table_by_number",Ee=function(s,N,w){try{var k;return null==w&&(w="1"),I(N,"each",[],((k=function($e){var ne,de=null==k.$$s?this:k.$$s;if(null==$e&&($e=$),ne=$e["$[]"](0),!i(function(q,H){return"number"==typeof q&&"number"==typeof H?q>=H:q["$>="](H)}(ne,s)))return $;e.ret(de.$get_table_value($e["$[]"](1)))}).$$s=this,k.$$arity=1,k)),this.$get_table_value(w)}catch(ee){if(ee===e.returner)return ee.$v;throw ee}},Ee.$$arity=-3),e.def(d,"$get_table_value",Ce=function(s){return i(s["$is_a?"](P(n,"Proc")))?s.$call():s},Ce.$$arity=1),e.def(d,"$roll_tables",oe=function(s,N){var k=$;return k=N["$[]"](s),i(k)?k.$roll(this.randomizer).$to_s():$},oe.$$arity=2),e.def(d,"$debug",O=function(s,N){var k,Q,ee=this,$e=$,de=$;return k=e.slice.call(arguments,1,arguments.length),i(ee.debug)?($e=i(s["$is_a?"](P(n,"String")))?s:s.$inspect(),i(k["$empty?"]())?ee.$warn($e):(de=I(k,"map",[],((Q=function(ie){return null==ie&&(ie=$),i(ie["$is_a?"](P(n,"String")))?'"'+ie+'"':ie.$inspect()}).$$s=ee,Q.$$arity=1,Q)),ee.$warn($e+": "+de.$join(", ")))):$},O.$$arity=-2),L(L(P(V,"I18n"),"Backend"),"Simple").$include(L(L(P(V,"I18n"),"Backend"),"Fallbacks")),P(V,"I18n").$load_path()["$<<"](P(V,"Dir")["$[]"](P(V,"File").$join(_.$__dir__(),"../../i18n/**/*.yml"))),l=["ja_jp"],I(P(V,"I18n"),"default_locale=",e.to_a(l)),X(l.length,1),l=[["ja_jp"]],I(P(V,"I18n").$fallbacks(),"defaults=",e.to_a(l)),l[X(l.length,1)]},function(e){function W(F,l){return"number"==typeof F&&"number"==typeof l?F+l:F["$+"](l)}function X(F,l){return"number"==typeof F&&"number"==typeof l?F-l:F["$-"](l)}function S(F,l){return"number"==typeof F&&"number"==typeof l?F>l:F["$>"](l)}var l,D,n,b,R,g,h,v,E,K,f,u,A,H,V=[],$=e.nil,P=e.$$,t=e.module,C=e.klass,i=e.truthy,I=e.send;e.top.$require("bcdice/base"),l=V,D=H=[t(V[0],"BCDice")].concat(l),n=A=[t(H[0],"GameSystem")].concat(D),f=C(A[0],P(A,"Base"),"ZettaiReido"),u=[f].concat(n),f.$$prototype.randomizer=$,e.const_set(u[0],"ID","ZettaiReido"),e.const_set(u[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),e.const_set(u[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),e.const_set(u[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),f.$register_prefix("\\d+\\-2DR"),e.def(f,"$eval_game_system_specific_command",b=function(c){var m=$,y=$,z=$;return i(c["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(m=P(u,"Regexp").$last_match(1).$to_i(),y=P(u,"Regexp").$last_match(2),z=P(u,"Regexp").$last_match(4),this.$roll2DR(m,y,z)):$},b.$$arity=1),e.def(f,"$roll2DR",R=function(c,o,m){var y,z,p,Y,te,re,me,oe,a=this,De=$,Be=$,Te=$,Ee=$,Ce=$;return z=a.$roll2DarkDice(),p=null==(y=e.to_ary(z))[0]?$:y[0],Y=null==y[1]?$:y[1],te=null==y[2]?$:y[2],z=a.$getModInfo(o),re=null==(y=e.to_ary(z))[0]?$:y[0],o=null==y[1]?$:y[1],z=a.$getDiffInfo(m),me=null==(y=e.to_ary(z))[0]?$:y[0],De="("+c+"-2DR"+o+(null==y[1]?$:y[1])+")",Be=c+"-"+p+"["+Y+"]"+o,Te=W(X(c,p),re),Ee=a.$getResult(p,Te,me),i(S(te,0))&&(Ce=te+"DP"),oe=[[De,Be,Te.$to_i(),Ee.$text(),Ce].$compact().$join(" \uff1e ")],I(Ee,"text=",e.to_a(oe)),X(oe.length,1),Ee},R.$$arity=3),e.def(f,"$roll2DarkDice",g=function(){var c,o,y,z,a,p,Y,m=this,re=$;return y=m.randomizer.$roll_once(6),z=m.randomizer.$roll_once(6),o=m.$changeDiceToDarkDice(y),a=null==(c=e.to_ary(o))[0]?$:c[0],p=null==c[1]?$:c[1],o=m.$changeDiceToDarkDice(z),Y=null==(c=e.to_ary(o))[0]?$:c[0],(re=W(p,null==c[1]?$:c[1]))["$=="](2)&&(re=4),[W(a,Y),a+","+Y,re]},g.$$arity=0),e.def(f,"$changeDiceToDarkDice",h=function(c){var m=$,y=$;return m=0,y=c,c["$=="](6)&&(y=0,m=1),[y,m]},h.$$arity=1),e.def(f,"$getModInfo",v=function(c){var F,m=$,y=$;return m=P(u,"ArithmeticEvaluator").$eval(c),y="",i("number"==typeof(F=m)?F<0:F["$<"](0))?y=m.$to_s():i(S(m,0))&&(y=W("+",m.$to_s())),[m,y]},v.$$arity=1),e.def(f,"$getDiffInfo",E=function(c){var m=$;return m="",i(c["$nil?"]())||(m=">="+(c=c.$to_i()).$to_i()),[c,m]},E.$$arity=1),e.def(f,"$getResult",K=function(c,o,m){var F,z=$;return c["$=="](0)?P(u,"Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):c["$=="](10)?P(u,"Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(i(m["$nil?"]())&&(m=0),z=X(o,m),i("number"==typeof(F=z)?F>=0:F["$>="](0))?P(u,"Result").$success(z+" \u6210\u529f"):P(u,"Result").$failure("\u5931\u6557"))},K.$$arity=3)}(Opal)}}]);