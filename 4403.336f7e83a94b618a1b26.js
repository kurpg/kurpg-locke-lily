(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[4403],{4403:function($e,ie,se){se(4656),Opal.modules["bcdice/arithmetic_evaluator"]=function(r){var i,d,u,P,T,L,l,w,N=[],F=r.nil,M=r.$$$,S=r.$$,_=r.module,J=r.hash2,t=r.truthy;return i=N,d=w=[_(N[0],"BCDice")].concat(i),l=[L=_(w[0],"ArithmeticEvaluator")].concat(d),u=r.get_singleton_class(L),T=[u].concat(l),void r.def(u,"$eval",P=function(K,k){var y,j=F;if(null==k)k=J([],{});else if(!k.$$is_hash)throw r.ArgumentError.$new("expected kwargs");return null==(y=k.$$smap.round_type)&&(y=M(S(T,"RoundType"),"FLOOR")),t(K)&&t(j=S(T,"Arithmetic").$eval(K,y))?j:0},P.$$arity=-2)},Opal.modules["bcdice/dice_table/range_table"]=function(r){var d,E,k,j,q,te,X,z,B,W,Z,O,y,D,P,l,S=[],_=r.nil,t=r.$$,A=r.module,i=r.klass,G=r.send,w=r.truthy;return d=S,E=l=[A(S[0],"BCDice")].concat(d),k=P=[A(l[0],"DiceTable")].concat(E),y=i(P[0],null,"RangeTable"),D=[y].concat(k),y.$$prototype.name=y.$$prototype.items=y.$$prototype.num_of_dice=y.$$prototype.num_of_sides=y.$$prototype.formatter=_,r.const_set(D[0],"RollResult",G(t(D,"Struct"),"new",["sum","values","content","formatted"],((j=function(){return(null==j.$$s?this:j.$$s).$alias_method("to_s","formatted")}).$$s=y,j.$$arity=0,j))),r.const_set(D[0],"Item",t(D,"Struct").$new("range","content")),r.const_set(D[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),r.const_set(D[0],"DEFAULT_FORMATTER",G(y,"lambda",[],($$2=function(h){function m($,a){return h.apply(this,arguments)}return m.toString=function(){return h.toString()},m}(function(h,m){return null==$$2.$$s||$$2,null==h&&(h=_),null==m&&(m=_),h.$name()+"("+m.$sum()+") \uff1e "+m.$content()}),$$2.$$s=y,$$2.$$arity=2,$$2))),y.$attr_reader("name"),y.$attr_reader("num_of_dice"),y.$attr_reader("num_of_sides"),r.def(y,"$initialize",q=function(m,$,a){var b,e=q.$$p,s=e||_,o=this,n=_;return e&&(q.$$p=null),e&&(q.$$p=null),o.name=m.$freeze(),o.formatter=w(b=s)?b:t(D,"DEFAULT_FORMATTER"),n=t(D,"DICE_ROLL_METHOD_RE").$match($),w(n)||o.$raise(t(D,"ArgumentError"),o.name+": invalid dice roll method: "+$),o.num_of_dice=n["$[]"](1).$to_i(),o.num_of_sides=n["$[]"](2).$to_i(),o.$store(a)},q.$$arity=3),r.def(y,"$fetch",te=function(m){var $,e,a=this;return e=G(a.items,"find",[],(($=function(o){return null==o&&(o=_),o.$range()["$include?"](m)}).$$s=a,$.$$arity=1,$)),w(e)||a.$raise(t(D,"RangeError"),a.name+": value is out of range: "+m),e},te.$$arity=1),r.def(y,"$roll",X=function(m){var e,s,o,x,$=this,a=_;return e=(a=m.$roll_barabara($.num_of_dice,$.num_of_sides)).$sum(),s=t(D,"RollResult").$new(e,a,$.$fetch(e).$content()),o=[$.formatter["$[]"]($,s)],G(s,"formatted=",r.to_a(o)),"number"==typeof(x=o.length)||x["$-"](1),s},X.$$arity=1),y.$private(),r.def(y,"$store",z=function(m){var $,a,e,o,b,s=this;return o=G(m,"map",[],(($=function(c,C){return null==c&&(c=_),null==C&&(C=_),[(null==$.$$s?this:$.$$s).$coerce_to_int_range(c),C]}).$$s=s,$.$$arity=2,$)),b=G(o,"sort_by",[],((a=function(c,C){return null==c&&(c=_),null==C&&(C=_),c.$min()}).$$s=s,a.$$arity=2,a)),s.$assert_min_sum_is_covered(b),s.$assert_max_sum_is_covered(b),s.$assert_no_gap_or_overlap_in_ranges(b),s.items=G(b,"map",[],(e=function(c,C){return null==c&&(c=_),null==C&&(C=_),t(D,"Item").$new(c,C.$freeze()).$freeze()},e.$$s=s,e.$$arity=2,e)).$freeze(),s},z.$$arity=1),r.def(y,"$coerce_to_int_range",B=function(m){var a,e=_;return a=m,t(D,"Integer")["$==="](a)?t(D,"Range").$new(m,m):t(D,"Range")["$==="](a)&&w(w(e=m.$begin()["$is_a?"](t(D,"Integer")))?m.$end()["$is_a?"](t(D,"Integer")):e)?m:this.$raise(t(D,"TypeError"),this.name+": "+m+" ("+m.$class()+") must be an Integer or a Range with Integers ")},B.$$arity=1),r.def(y,"$assert_min_sum_is_covered",W=function(m){var a,$=this,e=_;return a=$.num_of_dice,e=m.$first()["$[]"](0),w(e["$include?"](a))||$.$raise(t(D,"RangeError"),$.name+": min value ("+a+") is not covered: "+e),$},W.$$arity=1),r.def(y,"$assert_max_sum_is_covered",Z=function(m){var a,$=this,e=_;return a=function(x,d){return"number"==typeof x&&"number"==typeof d?x*d:x["$*"](d)}($.num_of_dice,$.num_of_sides),e=m.$last()["$[]"](0),w(e["$include?"](a))||$.$raise(t(D,"RangeError"),$.name+": max value ("+a+") is not covered: "+e),$},Z.$$arity=1),void r.def(y,"$assert_no_gap_or_overlap_in_ranges",O=function(m){var $;return G(m,"each_cons",[2],(($=function(s,o){var C,R,x,b=null==$.$$s?this:$.$$s,n=_,c=_;return null==b.name&&(b.name=_),null==s&&(s=_),null==o&&(o=_),n=s["$[]"](0),c=o["$[]"](0),R="number"==typeof(x=C=n.$max())?x+1:x["$+"](1),w(c["$include?"](C))&&b.$raise(t(D,"RangeError"),b.name+": Range overlap: "+n+" and "+c),w(c["$include?"](R))?_:b.$raise(t(D,"RangeError"),b.name+": Range gap: "+n+" and "+c)}).$$s=this,$.$$arity=2,$)),this},O.$$arity=1)},function(r){function U(E,T){return"number"==typeof E&&"number"==typeof T?E<T:E["$<"](T)}function N(E,T){return"number"==typeof E&&"number"==typeof T?E>T:E["$>"](T)}function F(E,T){return"number"==typeof E&&"number"==typeof T?E+T:E["$+"](T)}function M(E,T){return"number"==typeof E&&"number"==typeof T?E-T:E["$-"](T)}function S(E,T){return"number"==typeof E&&"number"==typeof T?E>=T:E["$>="](T)}var T,k,j,q,te,B,W,Z,O,h,m,e,b,n,c,C,s,o,X,z,D,Q,_=r.top,J=[],t=r.nil,A=r.$$$,i=r.$$,G=r.module,w=r.klass,x=r.send2,d=r.truthy,L=r.send,l=r.hash2,u=r.range;_.$require("bcdice/arithmetic_evaluator"),_.$require("bcdice/dice_table/range_table"),T=J,k=Q=[G(J[0],"BCDice")].concat(T),j=(D=[G(Q[0],"GameSystem")].concat(k))[0],q=i(D,"Base"),te=D,X=w(j,q,"DoubleCross"),z=[X].concat(te),X.$$prototype.randomizer=t,r.const_set(z[0],"ID","DoubleCross"),r.const_set(z[0],"NAME","\u30c0\u30d6\u30eb\u30af\u30ed\u30b92nd,3rd"),r.const_set(z[0],"SORT_KEY","\u305f\u3075\u308b\u304f\u308d\u30592"),r.const_set(z[0],"HELP_MESSAGE",'\u30fb\u5224\u5b9a\u30b3\u30de\u30f3\u30c9\uff08xDX+y@c or xDXc+y\uff09\n\u3000"(\u500b\u6570)DX(\u4fee\u6b63)@(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)" \u3082\u3057\u304f\u306f "(\u500b\u6570)DX(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)(\u4fee\u6b63)" \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4fee\u6b63\u5024\u3082\u4ed8\u3051\u3089\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff0910dx\u3000\u300010dx+5@8\uff08OD tool\u5f0f)\u3000\u30005DX7+7-3\uff08\u75be\u98a8\u6012\u6fe4\u5f0f\uff09\n\n\u30fb\u5404\u7a2e\u8868\n\u3000\u30fb\u611f\u60c5\u8868\uff08ET\uff09\n\u3000\u3000\u30dd\u30b8\u30c6\u30a3\u30d6\u3068\u30cd\u30ac\u30c6\u30a3\u30d6\u306e\u4e21\u65b9\u3092\u632f\u3063\u3066\u3001\u8868\u306b\u306a\u3063\u3066\u3044\u308b\u5074\u306b\u25cb\u3092\u4ed8\u3051\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\u3000\u3000\u3082\u3061\u308d\u3093\u4efb\u610f\u3067\u9078\u3076\u90e8\u5206\u306f\u5909\u66f4\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n'),r.def(X,"$initialize",B=function(a){var o=this;return B.$$p&&(B.$$p=null),x(o,r.find_super_dispatcher(o,"initialize",B,!1,!0),"initialize",[a],null),o.sides_implicit_d=10},B.$$arity=1),X.$register_prefix("\\d+DX","ET"),e=z,s=w(z[0],null,"DX"),o=[s].concat(e),s.$$prototype.modifier=s.$$prototype.critical_value=s.$$prototype.expression=s.$$prototype.num=s.$$prototype.modifier_str=s.$$prototype.target_value=t,s.$include(i(o,"Translate")),r.def(s,"$initialize",b=function(I,v,f,g){var p=this;return p.num=I,p.critical_value=v,p.modifier=f,p.target_value=g,p.modifier_str=i(o,"Format").$modifier(p.modifier),p.expression=p.$node_expression(),p.locale="ja_jp"},b.$$arity=4),r.def(s,"$execute",n=function(I){var f=this,g=t,p=t,V=t,ee=t,Y=t,H=t;if(d(U(f.critical_value,2)))return i(o,"Result").$new("("+f.expression+") \uff1e "+f.$translate("DoubleCross.DX.invalid_critical"));if(d(U(f.num,1)))return i(o,"Result").$failure("("+f.expression+") \uff1e "+f.$translate("DoubleCross.DX.auto_failure"));for(g=[],p=f.num,V=0;d(d(ee=N(p,0))?U(V,A(A(i(o,"CommonCommand"),"RerollDice"),"REROLL_LIMIT")):ee);)Y=I.$roll_barabara(p,10),H=i(o,"ValueGroup").$new(Y,f.critical_value),g.$push(H),p=H.$num_of_critical_occurrences(),V=F(V,1);return f.$result(g)},n.$$arity=1),s.$private(),r.def(s,"$node_expression",c=function(){var v,I=this;return v=I.num+"DX"+I.critical_value+I.modifier_str,d(I.target_value)?v+">="+I.target_value:v},c.$$arity=0),r.def(s,"$result",C=function(I){var p,ee,v=this,f=t,g=t,V=t,Y=t,H=t,re=t,ne=t;return f=i(o,"Result").$new(),g=[I["$[]"](0).$values()["$all?"](1)],L(f,"fumble=",r.to_a(g)),M(g.length,1),p=L(I,"map",[],"max".$to_proc()).$sum(),V=d(f["$fumble?"]())?0:F(p,v.modifier),ee=d(f["$fumble?"]())?V+" ("+v.$translate("fumble")+")":V.$to_s(),g=[N(I.$length(),1)],L(f,"critical=",r.to_a(g)),M(g.length,1),Y=["("+v.expression+")",""+I.$join("+")+v.modifier_str,ee],d(v.target_value)&&(H=d(re=f["$fumble?"]()["$!"]())?S(V,v.target_value):re,d(H)?(L(f,"success=",r.to_a(g=[!0])),M(g.length,1)):(L(f,"failure=",r.to_a(g=[!0])),M(g.length,1)),ne=v.$translate(d(H)?"success":"failure"),Y.$push(ne)),g=[Y.$join(" \uff1e ")],L(f,"text=",r.to_a(g)),M(g.length,1),f},C.$$arity=1),function($,a,e){var b,n,c,C,R,s=w($,null,"ValueGroup");[s].concat(e),s.$$prototype.values=s.$$prototype.critical_value=t,s.$attr_reader("values"),s.$attr_reader("critical_value"),r.def(s,"$initialize",b=function(v,f){return this.values=v.$sort(),this.critical_value=f},b.$$arity=2),r.def(s,"$to_s",n=function(){return this.$max()+"["+this.values.$join(",")+"]"},n.$$arity=0),r.def(s,"$max",c=function(){var v,f=this;return d(L(f.values,"any?",[],((v=function(p){return null==p&&(p=t),(null==v.$$s?this:v.$$s)["$critical?"](p)}).$$s=f,v.$$arity=1,v)))?10:f.values.$max()},c.$$arity=0),r.def(s,"$num_of_critical_occurrences",C=function(){var v;return L(this.values,"count",[],((v=function(p){return null==p&&(p=t),(null==v.$$s?this:v.$$s)["$critical?"](p)}).$$s=this,v.$$arity=1,v))},C.$$arity=0),s.$private(),r.def(s,"$critical?",R=function(v){return S(v,this.critical_value)},R.$$arity=1)}(z[0],0,z),r.def(X,"$eval_game_system_specific_command",W=function(a){var e=this,s=t;return d(s=e.$parse_dx(a))?s.$execute(e.randomizer):a["$=="]("ET")?e.$roll_emotion_table():t},W.$$arity=1),X.$private(),r.def(X,"$parse_dx",Z=function(a){var s;return d(s=this.$parse_dx_od(a))?s:this.$parse_dx_shippu_doto(a)},Z.$$arity=1),r.def(X,"$parse_dx_od",O=function(a){var o=t,b=t,n=t,c=t;return o=A(i(z,"Command"),"Parser").$new(/\d+DX/,l(["round_type"],{round_type:this.$round_type()})).$enable_critical().$restrict_cmp_op_to(t,">=").$parse(a),d(o)?(b=o.$command().$to_i(),n=d(c=o.$critical())?c:10,A(this.$class(),"DX").$new(b,n,o.$modify_number(),o.$target_number())):t},O.$$arity=1),r.def(X,"$parse_dx_shippu_doto",h=function(a){var e,s,o,b=this,c=t,C=t,R=t,I=t;return c=A(i(z,"Command"),"Parser").$new(/\d+DX\d*/,l(["round_type"],{round_type:b.$round_type()})).$restrict_cmp_op_to(t,">=").$parse(a),d(c)?(s=L(c.$command().$split("DX",2),"map",[],((o=function(f){var p;return null==f&&(f=t),(p=f)===t||null==p?t:L(p,"to_i",[])}).$$s=b,o.$$arity=1,o)),C=null==(e=r.to_ary(s))[0]?t:e[0],R=d(I=R=null==e[1]?t:e[1])?I:10,A(b.$class(),"DX").$new(C,R,c.$modify_number(),c.$target_number())):t},h.$$arity=1),r.def(X,"$roll_emotion_table",m=function(){var o,a=this,e=t,s=t,b=t,c=t;return e=A(a.$class(),"POSITIVE_EMOTION_TABLE").$roll(a.randomizer),s=A(a.$class(),"NEGATIVE_EMOTION_TABLE").$roll(a.randomizer),o=a.randomizer.$roll_once(2)["$=="](1),b=d(o)?["\u25cb"+e.$content(),s.$content()]:[e.$content(),"\u25cb"+s.$content()],c=[a.$translate("DoubleCross.ET.name")+"("+e.$sum()+"-"+s.$sum()+")",b.$join(" - ")],i(z,"Result").$new(c.$join(" \uff1e "))},m.$$arity=0),function($,a){var s,o,e=[$].concat(a);$.$private(),r.def($,"$positive_emotion_table",s=function(n){return A(i(e,"DiceTable"),"RangeTable").$new(i(e,"I18n").$translate("DoubleCross.ET.positive.name",l(["locale"],{locale:n})),"1D100",[[u(1,5,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.1_5",l(["locale"],{locale:n}))],[u(6,10,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.6_10",l(["locale"],{locale:n}))],[u(11,15,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.11_15",l(["locale"],{locale:n}))],[u(16,20,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.16_20",l(["locale"],{locale:n}))],[u(21,25,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.21_25",l(["locale"],{locale:n}))],[u(26,30,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.26_30",l(["locale"],{locale:n}))],[u(31,35,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.31_35",l(["locale"],{locale:n}))],[u(36,40,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.36_40",l(["locale"],{locale:n}))],[u(41,45,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.41_45",l(["locale"],{locale:n}))],[u(46,50,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.46_50",l(["locale"],{locale:n}))],[u(51,55,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.51_55",l(["locale"],{locale:n}))],[u(56,60,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.56_60",l(["locale"],{locale:n}))],[u(61,65,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.61_65",l(["locale"],{locale:n}))],[u(66,70,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.66_70",l(["locale"],{locale:n}))],[u(71,75,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.71_75",l(["locale"],{locale:n}))],[u(76,80,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.76_80",l(["locale"],{locale:n}))],[u(81,85,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.81_85",l(["locale"],{locale:n}))],[u(86,90,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.86_90",l(["locale"],{locale:n}))],[u(91,95,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.91_95",l(["locale"],{locale:n}))],[u(96,100,!1),i(e,"I18n").$translate("DoubleCross.ET.positive.items.96_100",l(["locale"],{locale:n}))]])},s.$$arity=1),r.def($,"$negative_emotion_table",o=function(n){return A(i(e,"DiceTable"),"RangeTable").$new(i(e,"I18n").$translate("DoubleCross.ET.negative.name",l(["locale"],{locale:n})),"1D100",[[u(1,5,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.1_5",l(["locale"],{locale:n}))],[u(6,10,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.6_10",l(["locale"],{locale:n}))],[u(11,15,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.11_15",l(["locale"],{locale:n}))],[u(16,20,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.16_20",l(["locale"],{locale:n}))],[u(21,25,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.21_25",l(["locale"],{locale:n}))],[u(26,30,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.26_30",l(["locale"],{locale:n}))],[u(31,35,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.31_35",l(["locale"],{locale:n}))],[u(36,40,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.36_40",l(["locale"],{locale:n}))],[u(41,45,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.41_45",l(["locale"],{locale:n}))],[u(46,50,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.46_50",l(["locale"],{locale:n}))],[u(51,55,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.51_55",l(["locale"],{locale:n}))],[u(56,60,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.56_60",l(["locale"],{locale:n}))],[u(61,65,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.61_65",l(["locale"],{locale:n}))],[u(66,70,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.66_70",l(["locale"],{locale:n}))],[u(71,75,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.71_75",l(["locale"],{locale:n}))],[u(76,80,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.76_80",l(["locale"],{locale:n}))],[u(81,85,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.81_85",l(["locale"],{locale:n}))],[u(86,90,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.86_90",l(["locale"],{locale:n}))],[u(91,95,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.91_95",l(["locale"],{locale:n}))],[u(96,100,!1),i(e,"I18n").$translate("DoubleCross.ET.negative.items.96_100",l(["locale"],{locale:n}))]]).$freeze()},o.$$arity=1)}(r.get_singleton_class(X),z),r.const_set(z[0],"POSITIVE_EMOTION_TABLE",X.$positive_emotion_table("ja_jp").$freeze()),r.const_set(z[0],"NEGATIVE_EMOTION_TABLE",X.$negative_emotion_table("ja_jp").$freeze())}(Opal)}}]);