(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[2354],{2354:function(V,X,Q){Q(4656),Opal.modules["bcdice/normalize"]=function(t){var _,w,j,p,k,z,l=[],W=t.nil,S=t.module;return k=l,_=z=[S(l[0],"BCDice")].concat(k),[p=S(z[0],"Normalize")].concat(_),p.$module_function(),t.def(p,"$comparison_operator",w=function(N){var c;return/<=|=</["$==="](c=N)?"<=":/>=|=>/["$==="](c)?">=":/<>|!=|=!/["$==="](c)?"!=":/</["$==="](c)?"<":/>/["$==="](c)?">":/=/["$==="](c)?"==":W},w.$$arity=1),void t.def(p,"$target_number",j=function(N){return N["$=="]("?")?N:N.$to_i()},j.$$arity=1)},Opal.modules["bcdice/format"]=function(t){var z,h,R,N,w,j,_,W=[],E=t.nil,S=t.$$,d=t.module,k=t.truthy;return z=W,h=_=[d(W[0],"BCDice")].concat(z),w=d(_[0],"Format"),j=[w].concat(h),w.$module_function(),t.def(w,"$comparison_operator",R=function(c){var A;return"=="["$==="](A=c)?"=":"!="["$==="](A)?"<>":S(j,"Symbol")["$==="](A)?c.$to_s():E},R.$$arity=1),void t.def(w,"$modifier",N=function(c){return k(c["$nil?"]())?E:c["$=="](0)?"":k("number"==typeof(g=c)?g>0:g["$>"](0))?"+"+c:c.$to_s();var g},N.$$arity=1)},function(t){function y(p,h){return"number"==typeof p&&"number"==typeof h?p+h:p["$+"](h)}function l(p,h){return"number"==typeof p&&"number"==typeof h?p-h:p["$-"](h)}var h,N,q,A,U,D,M,G,T,H,I,K,L,v,a,$,o,i,n,e,u,b,f,c,j,W=t.top,E=[],r=t.nil,d=t.$$,k=t.module,g=t.klass,z=t.send2,m=t.truthy,_=t.send;W.$require("bcdice/normalize"),W.$require("bcdice/format"),h=E,N=j=[k(E[0],"BCDice")].concat(h),q=(c=[k(j[0],"GameSystem")].concat(N))[0],A=d(c,"Base"),U=c,b=g(q,A,"NightWizard"),f=[b].concat(U),b.$$prototype.nw_command=b.$$prototype.randomizer=b.$$prototype.total=b.$$prototype.interim_expr=b.$$prototype.status=b.$$prototype.fumble_numbers=b.$$prototype.critical_numbers=r,t.const_set(f[0],"ID","NightWizard"),t.const_set(f[0],"NAME","\u30ca\u30a4\u30c8\u30a6\u30a3\u30b6\u30fc\u30c9 The 2nd Edition"),t.const_set(f[0],"SORT_KEY","\u306a\u3044\u3068\u3046\u3044\u3055\u3042\u30682"),t.const_set(f[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u7528\u30b3\u30de\u30f3\u30c9\u3000(aNW+b@x#y$z+c)\n\u3000\u3000a : \u57fa\u672c\u5024\n\u3000\u3000b : \u5e38\u6642\u306b\u6e96\u3058\u308b\u7279\u6280\u306b\u3088\u308b\u88dc\u6b63\n\u3000\u3000c : \u5e38\u6642\u4ee5\u5916\u306e\u7279\u6280\u3001\u304a\u3088\u3073\u652f\u63f4\u52b9\u679c\u306b\u3088\u308b\u88dc\u6b63\uff08\u30d5\u30a1\u30f3\u30d6\u30eb\u6642\u306b\u306f\u9069\u7528\u3055\u308c\u306a\u3044\uff09\n\u3000\u3000x : \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u30ab\u30f3\u30de\u533a\u5207\u308a\uff08\u7701\u7565\u6642 10\uff09\n\u3000\u3000y : \u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u30ab\u30f3\u30de\u533a\u5207\u308a\uff08\u7701\u7565\u6642 5\uff09\n\u3000\u3000z : \u30d7\u30e9\u30fc\u30ca\u306b\u3088\u308b\u9054\u6210\u5024\u88dc\u6b63\u306e\u30d7\u30e9\u30fc\u30ca\u6d88\u8cbb\u6570\uff08\u30d5\u30a1\u30f3\u30d6\u30eb\u6642\u306b\u306f\u9069\u7528\u3055\u308c\u306a\u3044\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u304c\u7121\u3044\u5834\u5408\u306f1\u308413\u306a\u3069\u306e\u3042\u308a\u5f97\u306a\u3044\u6570\u5024\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\u3000\u4f8b\uff0912NW-5@7#2$3 1NW 50nw+5@7,10#2,5 50nw-5+10@7,10#2,5+15+25\n"),b.$register_prefix("([-+]?\\d+)?NW","2R6"),t.def(b,"$initialize",D=function(a){var u=this;return D.$$p&&(D.$$p=null),z(u,t.find_super_dispatcher(u,"initialize",D,!1,!0),"initialize",[a],null),u.nw_command="NW"},D.$$arity=1),t.def(b,"$eval_game_system_specific_command",M=function(a){var $,e,i,u=this,o=r,n=r,x=r,s=r,P=r;return o=m(i=u.$parse_nw(a))?i:u.$parse_2r6(a),m(o)?(e=u.$roll_nw(o),n=null==($=t.to_ary(e))[0]?r:$[0],x=null==$[1]?r:$[1],s=null==$[2]?r:$[2],P=m(o.$cmp_op())?m(n.$send(o.$cmp_op(),o.$target_number()))?"\u6210\u529f":"\u5931\u6557":r,["("+o+")",x,s,n.$to_s(),P].$compact().$join(" \uff1e ")):r},M.$$arity=1),b.$private(),function(v,a,$){var e=g(v,null,"Parsed");[e].concat($),e.$attr_accessor("critical_numbers"),e.$attr_accessor("fumble_numbers"),e.$attr_accessor("prana"),e.$attr_accessor("active_modify_number"),e.$attr_accessor("cmp_op"),e.$attr_accessor("target_number")}(f[0],0,f),v=f[0],a=d(f,"Parsed"),$=f,e=g(v,a,"ParsedNW"),u=[e].concat($),e.$$prototype.base=e.$$prototype.modify_number=e.$$prototype.active_modify_number=e.$$prototype.prana=e.$$prototype.command=e.$$prototype.critical_numbers=e.$$prototype.fumble_numbers=e.$$prototype.cmp_op=e.$$prototype.target_number=r,e.$attr_accessor("base"),e.$attr_accessor("modify_number"),t.def(e,"$initialize",o=function(s){var F=this;return o.$$p&&(o.$$p=null),z(F,t.find_super_dispatcher(F,"initialize",o,!1,!0),"initialize",[],null),F.command=s},o.$$arity=1),t.def(e,"$passive_modify_number",i=function(){return y(this.base,this.modify_number)},i.$$arity=0),t.def(e,"$to_s",n=function(){var P,C,F,Y,J,s=this;return P=m(s.base["$zero?"]())?r:s.base,C=d(u,"Format").$modifier(s.modify_number),F=d(u,"Format").$modifier(s.active_modify_number),Y=m(J=s.prana)?"$"+s.prana:J,""+P+s.command+C+"@"+s.critical_numbers.$join(",")+"#"+s.fumble_numbers.$join(",")+Y+F+s.cmp_op+s.target_number},n.$$arity=0),function(v,a,$){var o,e=g(v,a,"Parsed2R6");[e].concat($),e.$$prototype.passive_modify_number=e.$$prototype.active_modify_number=e.$$prototype.critical_numbers=e.$$prototype.fumble_numbers=e.$$prototype.cmp_op=e.$$prototype.target_number=r,e.$attr_accessor("passive_modify_number"),t.def(e,"$to_s",o=function(){var n=this;return"2R6M["+n.passive_modify_number+","+n.active_modify_number+"]C["+n.critical_numbers.$join(",")+"]F["+n.fumble_numbers.$join(",")+"]"+n.cmp_op+n.target_number},o.$$arity=0)}(f[0],d(f,"Parsed"),f),t.def(b,"$parse_nw",G=function(a){var $,e,o=r,i=r,n=r;return o=t.regexp(["^([-+]?\\d+)?",this.nw_command,"((?:[-+]\\d+)+)?(?:@(\\d+(?:,\\d+)*))?(?:#(\\d+(?:,\\d+)*))?(?:\\$(\\d+(?:,\\d+)*))?((?:[-+]\\d+)+)?(?:([>=]+)(\\d+))?$"]).$match(a),m(o)?(i=d(f,"ParsedNW").$new(this.nw_command),n=[o["$[]"](1).$to_i()],_(i,"base=",t.to_a(n)),l(n.length,1),n=[d(f,"ArithmeticEvaluator").$eval(o["$[]"](2))],_(i,"modify_number=",t.to_a(n)),l(n.length,1),n=[m(o["$[]"](3))?_(o["$[]"](3).$split(","),"map",[],"to_i".$to_proc()):[10]],_(i,"critical_numbers=",t.to_a(n)),l(n.length,1),n=[m(o["$[]"](4))?_(o["$[]"](4).$split(","),"map",[],"to_i".$to_proc()):[5]],_(i,"fumble_numbers=",t.to_a(n)),l(n.length,1),n=[($=o["$[]"](5),$===r||null==$?r:_($,"to_i",[]))],_(i,"prana=",t.to_a(n)),l(n.length,1),n=[d(f,"ArithmeticEvaluator").$eval(o["$[]"](6))],_(i,"active_modify_number=",t.to_a(n)),l(n.length,1),n=[d(f,"Normalize").$comparison_operator(o["$[]"](7))],_(i,"cmp_op=",t.to_a(n)),l(n.length,1),n=[(e=o["$[]"](8),e===r||null==e?r:_(e,"to_i",[]))],_(i,"target_number=",t.to_a(n)),l(n.length,1),i):r},G.$$arity=1),t.def(b,"$parse_2r6",T=function(a){var $,u=r,o=r,i=r;return u=/^2R6m\[([-+]?\d+(?:[-+]\d+)*)(?:,([-+]?\d+(?:[-+]\d+)*))?\](?:c\[(\d+(?:,\d+)*)\])?(?:f\[(\d+(?:,\d+)*)\])?(?:([>=]+)(\d+))?/i.$match(a),m(u)?(o=d(f,"Parsed2R6").$new(),i=[d(f,"ArithmeticEvaluator").$eval(u["$[]"](1))],_(o,"passive_modify_number=",t.to_a(i)),l(i.length,1),i=[d(f,"ArithmeticEvaluator").$eval(u["$[]"](2))],_(o,"active_modify_number=",t.to_a(i)),l(i.length,1),i=[m(u["$[]"](3))?_(u["$[]"](3).$split(","),"map",[],"to_i".$to_proc()):[10]],_(o,"critical_numbers=",t.to_a(i)),l(i.length,1),i=[m(u["$[]"](4))?_(u["$[]"](4).$split(","),"map",[],"to_i".$to_proc()):[5]],_(o,"fumble_numbers=",t.to_a(i)),l(i.length,1),i=[d(f,"Normalize").$comparison_operator(u["$[]"](5))],_(o,"cmp_op=",t.to_a(i)),l(i.length,1),i=[($=u["$[]"](6),$===r||null==$?r:_($,"to_i",[]))],_(o,"target_number=",t.to_a(i)),l(i.length,1),o):r},T.$$arity=1),t.def(b,"$roll_nw",H=function(a){var o,e=this,u=r,i=r,n=r,x=r,s=r;for(e.critical_numbers=a.$critical_numbers(),e.fumble_numbers=a.$fumble_numbers(),e.total=0,e.interim_expr="",e.status=r,u=e.$roll_once_first();u["$=="]("critical");)u=e.$roll_once();return m(m(o=u["$!="]("fumble"))?a.$prana():o)&&(n=(i=e.randomizer.$roll_barabara(a.$prana(),6)).$sum(),x=i.$join(","),e.total=y(e.total,n),e.interim_expr=y(e.interim_expr,"+"+n+"["+x+"]")),s=u["$=="]("fumble")?e.$fumble_base_number(a):y(a.$passive_modify_number(),a.$active_modify_number()),e.total=y(e.total,s),e.interim_expr=y(s.$to_s(),e.interim_expr),[e.total,e.interim_expr,e.status]},H.$$arity=1),t.def(b,"$roll_once",I=function(a){var u,o,i,$=this,e=r;return null==a&&(a=!1),u=(e=$.randomizer.$roll_barabara(2,6)).$sum(),o=e.$join(","),m(m(i=a)?$.fumble_numbers["$include?"](u):i)?($.total=l($.total,10),$.interim_expr=y($.interim_expr,"-10["+o+"]"),$.status="\u30d5\u30a1\u30f3\u30d6\u30eb","fumble"):m($.critical_numbers["$include?"](u))?($.total=y($.total,10),$.interim_expr=y($.interim_expr,"+10["+o+"]"),$.status="\u30af\u30ea\u30c6\u30a3\u30ab\u30eb","critical"):($.total=y($.total,u),$.interim_expr=y($.interim_expr,"+"+u+"["+o+"]"),r)},I.$$arity=-1),t.def(b,"$roll_once_first",K=function(){return this.$roll_once(!0)},K.$$arity=0),t.def(b,"$fumble_base_number",L=function(a){return a.$passive_modify_number()},L.$$arity=1)}(Opal)}}]);