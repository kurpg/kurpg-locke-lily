(self.webpackChunkudonarium_lily=self.webpackChunkudonarium_lily||[]).push([[1999],{1999:function(oe,ce,fe){fe(4656),Opal.modules["bcdice/game_system/EarthDawn"]=function(s){function x(b,u){return"number"==typeof b&&"number"==typeof u?b>u:b["$>"](u)}function H(b,u){return"number"==typeof b&&"number"==typeof u?b<u:b["$<"](u)}function z(b,u){return"number"==typeof b&&"number"==typeof u?b-u:b["$-"](u)}function d(b,u){return"number"==typeof b&&"number"==typeof u?b+u:b["$+"](u)}function F(b,u){return"number"==typeof b&&"number"==typeof u?b>=u:b["$>="](u)}var u,$e,re,w,A,J,Q,U,V,k,g,Y,Z,W=[],a=s.nil,M=s.$$,K=s.module,X=s.klass,te=s.send2,E=s.truthy,h=s.send;return u=W,$e=Z=[K(W[0],"BCDice")].concat(u),re=Y=[K(Z[0],"GameSystem")].concat($e),k=X(Y[0],M(Y,"Base"),"EarthDawn"),g=[k].concat(re),k.$$prototype.string=k.$$prototype.isFailed=a,s.const_set(g[0],"ID","EarthDawn"),s.const_set(g[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f3"),s.const_set(g[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u3093"),s.const_set(g[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2-D20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff099E\u300010E8\u300010E+D12\n"),k.$register_prefix("\\d+e"),s.def(k,"$initialize",w=function(D){var c=this;return w.$$p&&(w.$$p=null),te(c,s.find_super_dispatcher(c,"initialize",w,!1,!0),"initialize",[D],null),c.sort_add_dice=!0},w.$$arity=1),s.def(k,"$eval_game_system_specific_command",A=function(D){return this.$ed_step(D)},A.$$arity=1),s.def(k,"$ed_step",J=function(D){return this.$getStepResult(D)},J.$$arity=1),s.def(k,"$getStepResult",Q=function(D){var r=this,f=a,c=a,v=a,N=a,y=a,i=a,$=a,e=a,n=a,o=a,_=a,p=a,l=a,T=a,m=a,R=a,I=a,j=a,C=a,B=a;return!E(/(\d+)E(\d+)?(\+)?(\d+)?(d\d+)?/i["$=~"](D))||(f=0,r.isFailed=!0,c=M(g,"Regexp").$last_match(1).$to_i(),v=0,N=!1,y=0,i=0,E(x(c,40))&&(c=40),E(M(g,"Regexp").$last_match(2))&&(v=M(g,"Regexp").$last_match(2).$to_i(),E(x(v,43))&&(v=42)),E(M(g,"Regexp").$last_match(3))&&(N=M(g,"Regexp").$last_match(3).$to_i()),E(M(g,"Regexp").$last_match(4))&&(y=M(g,"Regexp").$last_match(4).$to_i()),E(M(g,"Regexp").$last_match(5))&&(i=M(g,"Regexp").$last_match(5)),E(H(v,0)))?a:(e=($=r.$getStepTable())["$[]"](0)["$[]"](z(c,1)),n=$["$[]"](1)["$[]"](z(c,1)),o=$["$[]"](2)["$[]"](z(c,1)),_=$["$[]"](3)["$[]"](z(c,1)),p=$["$[]"](4)["$[]"](z(c,1)),l=$["$[]"](5)["$[]"](z(c,1)),T=$["$[]"](6)["$[]"](z(c,1)),E(N)&&(/d20/i["$==="](m=i)?n=d(n,y):/d12/i["$==="](m)?o=d(o,y):/d10/i["$==="](m)?_=d(_,y):/d8/i["$==="](m)?p=d(p,y):/d6/i["$==="](m)?l=d(l,y):/d4/i["$==="](m)?T=d(T,y):e=d(e,y)),r.string="",r.$debug("d20step, d12step, d10step, d8step, d6step, d4step",n,o,_,p,l,T),f=d(f,r.$rollStep(20,n)),f=d(f,r.$rollStep(12,o)),f=d(f,r.$rollStep(10,_)),f=d(f,r.$rollStep(8,p)),f=d(f,r.$rollStep(6,l)),f=d(f,r.$rollStep(4,T)),E(x(e,0))&&(r.string=d(r.string,"+")),E(e["$!="](0))&&(r.string=d(r.string,e.$to_s()),f=d(f,e)),r.string=d(r.string," \uff1e "+f),R="\u30b9\u30c6\u30c3\u30d7"+c+" \uff1e "+r.string,v["$=="](0)||(r.string=d(r.string," \uff1e "),I=$["$[]"](7)["$[]"](z(v,1)),j=$["$[]"](8)["$[]"](z(v,1)),C=$["$[]"](9)["$[]"](z(v,1)),B=$["$[]"](11)["$[]"](z(v,1)),r.string=E(r.isFailed)?d(r.string,"\u81ea\u52d5\u5931\u6557"):E(F(f,I))?d(r.string,"\u6700\u826f\u6210\u529f"):E(F(f,j))?d(r.string,"\u512a\u6210\u529f"):E(F(f,C))?d(r.string,"\u826f\u6210\u529f"):E(F(f,v))?d(r.string,"\u6210\u529f"):E(H(f,B))?d(r.string,"\u5927\u5931\u6557"):d(r.string,"\u5931\u6557"),R="\u30b9\u30c6\u30c3\u30d7"+c+">="+v+" \uff1e "+r.string),R)},Q.$$arity=1),s.def(k,"$getStepTable",U=function(){return[[-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[0,0,0,0,0,1,0,0,0,1,1,2,1,0,0,0,1,0,0,0,1,1,2,1,1,1,1,2,1,1,1,2,3,2,1,1,1,2,1,1,0,0,1,0,0,0,1,0,0,0,1,1,2,1],[0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,1,1,2,1,1,1,2,2,1,1,1,1,2,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0],[0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,0,0,0,0,1,0,0,0,2,0,0,0,0,1,0,0,0,2,1,1,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[6,8,10,12,14,17,19,20,22,24,25,27,29,32,33,35,37,38,39,41,42,44,45,47,48,49,51,52,54,55,56,58,59,60,62,64,65,67,68,70,71,72],[4,6,8,10,11,13,15,16,18,19,21,22,24,26,27,29,30,32,33,34,35,37,38,40,41,42,43,45,46,47,48,49,51,52,53,55,56,58,59,60,61,62],[2,4,6,7,9,10,12,13,14,15,17,18,20,21,22,24,25,26,27,28,29,31,32,33,34,35,36,38,39,40,41,42,43,45,46,47,48,50,51,52,53,54],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],[0,1,1,1,1,2,2,3,4,5,5,6,6,7,8,8,9,10,11,12,13,13,14,15,16,17,18,18,18,20,21,22,23,23,24,25,26,26,27,28,29,30]]},U.$$arity=0),void s.def(k,"$rollStep",V=function(D,r){var f,c=this,v=a;return c.$debug("rollStep diceType, diceCount, @string",D,r,c.string),v=0,E(x(r,0))&&(E(c.string["$empty?"]())||(c.string=d(c.string,"+")),c.string=d(c.string,r+"d"+D+"["),c.$debug("rollStep @string",c.string),h(r,"times",[],((f=function(y){var i=null==f.$$s?this:f.$$s,e=a,n=a;for(null==i.randomizer&&(i.randomizer=a),null==i.string&&(i.string=a),null==y&&(y=a),e=i.randomizer.$roll_once(D),E(e["$!="](1))&&(i.isFailed=!1),n=e;e["$=="](D);)n=d(n,e=i.randomizer.$roll_once(D));return v=d(v,n),E(y["$!="](0))&&(i.string=d(i.string,",")),i.string=d(i.string,n.$to_s())}).$$s=c,f.$$arity=1,f)),c.string=d(c.string,"]")),v},V.$$arity=2)},function(s){function x(u,S){return"number"==typeof u&&"number"==typeof S?u+S:u["$+"](S)}function H(u,S){return"number"==typeof u&&"number"==typeof S?u>S:u["$>"](S)}function z(u,S){return"number"==typeof u&&"number"==typeof S?u<S:u["$<"](S)}function F(u,S){return"number"==typeof u&&"number"==typeof S?u-S:u["$-"](S)}function ee(u,S){return"number"==typeof u&&"number"==typeof S?u/S:u["$/"](S)}var S,ne,k,A,J,Q,U,V,G,D,r,f,c,v,N,g,w,q,O,a=[],t=s.nil,K=s.$$,X=s.module,te=s.klass,E=s.send2,h=s.truthy,b=s.send;s.top.$require("bcdice/game_system/EarthDawn"),S=a,ne=O=[X(a[0],"BCDice")].concat(S),k=q=[X(O[0],"GameSystem")].concat(ne),g=te(q[0],K(q,"EarthDawn"),"EarthDawn4"),w=[g].concat(k),g.$$prototype.calcText=g.$$prototype.isFailed=t,s.const_set(w[0],"ID","EarthDawn4"),s.const_set(w[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f34\u7248"),s.const_set(w[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u30934"),s.const_set(w[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEnK)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3002\n\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\u4f7f\u7528\u6642\u306f\u672b\u5c3e\u306bK\u3092\u8ffd\u52a0\uff08\u7701\u7565\u53ef\u80fd\uff09\n\u4f8b\uff09\u30b9\u30c6\u30c3\u30d710\uff1a10E\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\uff1a10E8\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\uff1a10E8K\n"),g.$register_prefix("\\d+e"),s.def(g,"$initialize",A=function(i){var n=this;return A.$$p&&(A.$$p=null),E(n,s.find_super_dispatcher(n,"initialize",A,!1,!0),"initialize",[i],null),n.sort_add_dice=!0,n.calcText=""},A.$$arity=1),s.def(g,"$eval_game_system_specific_command",J=function(i){return this.$ed_step(i)},J.$$arity=1),s.def(g,"$ed_step",Q=function(i){return this.$getStepResult(i)},Q.$$arity=1),s.def(g,"$getStepResult",U=function(i){var $,e,_,p,o=t,l=t;return e=this.$getStepResultInfos(i),_=null==($=s.to_ary(e))[1]?t:$[1],p=null==$[2]?t:$[2],l=null==$[3]?t:$[3],h((o=null==$[0]?t:$[0])["$nil?"]())?t:l["$=="](0)?o+" \uff1e "+_+" \uff1e "+p:o+">="+l+" \uff1e "+_+" \uff1e "+p+" \uff1e "+this.$getSuccess(l,p)},U.$$arity=1),s.def(g,"$getStepResultInfos",V=function(i){var e,n,o,ue,le,_=this,p=t,l=t,T=t,m=t,R=t,I=t,j=t,C=t,B=t,L=t,P=t;for(p=[],l=[],T=[],m=0;h(h(R=i["$nil?"]()["$!"]())?i["$empty?"]()["$!"]():R);){if(_.$debug("=====>!! str",i),n=_.$getStepResultInfo(i),j=null==(e=s.to_ary(n))[1]?t:e[1],C=null==e[2]?t:e[2],B=null==e[3]?t:e[3],L=null==e[4]?t:e[4],_.$debug("=====> step",I=null==e[0]?t:e[0]),h(I["$nil?"]()))return t;if(p["$<<"](I),l["$<<"](j),T["$<<"](C),B["$=="](0)||(m=B),_.$debug("=====> nextText",L),L["$=="](i))break;i=L}return ue=p.$join("+"),P=l.$join(")+("),le=b(T,"inject",[],((o=function(se,ae){return null==se&&(se=t),null==ae&&(ae=t),x(se,ae)}).$$s=_,o.$$arity=2,o)),h(H(l.$size(),1))&&(P=x(x("(",P),")")),h(H(T.$size(),1))&&(P=x(P," \uff1e ("+T.$join("+")+")")),[ue,P,le,m]},V.$$arity=1),s.def(g,"$getStepResultInfo",G=function(i){var $,e=this,n=t,o=t,_=t,p=t,l=t,T=t,m=t,I=t;return!h(/^(\d+)E(\d+)?(K)?(\+\d+$)?(\+(.*))?/i["$=~"](i))||(n=0,e.isFailed=!0,o=K(w,"Regexp").$last_match(1).$to_i(),_=K(w,"Regexp").$last_match(2).$to_i(),h(z(_,0)))?t:(p=K(w,"Regexp").$last_match(3)["$nil?"]()["$!"](),l=K(w,"Regexp").$last_match(4).$to_i(),T=K(w,"Regexp").$last_match(6),m=e.$getStepInfo(o),e.$debug("stepInfo",m),e.calcText="",b([20,12,10,8,6,4],"each",[],(($=function(B){return null==B&&(B=t),n=x(n,(null==$.$$s?this:$.$$s).$rollStep(B,m.$shift()))}).$$s=e,$.$$arity=1,$)),I=m.$shift(),h(p)&&(n=x(n,e.$rollStep(6,1))),e.calcText=x(e.calcText,x(e.$getModifyText(I),e.$getModifyText(l))),n=x(n,x(I,l)),["\u30b9\u30c6\u30c3\u30d7"+o,e.calcText,n,_,T])},G.$$arity=1),s.def(g,"$getModifyText",D=function(i){var e=t;return e="",i["$=="](0)||(h(H(i,0))&&(e=x(e,"+")),e=x(e,i.$to_s())),e},D.$$arity=1),s.def(g,"$getBaseStepTable",r=function(){return[[1,[0,0,0,0,0,1,-2]],[2,[0,0,0,0,0,1,-1]],[3,[0,0,0,0,0,1,0]],[4,[0,0,0,0,1,0,0]],[5,[0,0,0,1,0,0,0]],[6,[0,0,1,0,0,0,0]],[7,[0,1,0,0,0,0,0]]]},r.$$arity=0),s.def(g,"$getStepInfo",f=function(i){var $,o,e=this,n=t,_=t,p=t,l=t,T=t,m=t,R=t,I=t;return o=(n=e.$getBaseStepTable()).$last().$first(),h(function(u,S){return"number"==typeof u&&"number"==typeof S?u<=S:u["$<="](S)}(i,o))?e.$get_table_by_number(i,n):(_=[1,0,0,0,0,0,0],p=F(F(i,o),1),T=[0,0,0,0,0,0,0],m=ee(p,(l=[[0,0,0,0,2,0,0],[0,0,0,1,1,0,0],[0,0,0,2,0,0,0],[0,0,1,1,0,0,0],[0,0,2,0,0,0,0],[0,1,1,0,0,0,0],[0,2,0,0,0,0,0],[0,1,0,0,2,0,0],[0,1,0,1,1,0,0],[0,1,0,2,0,0,0],[0,1,1,1,0,0,0]]).$size()).$to_i(),b(m,"times",[],(($=function(){return(null==$.$$s?this:$.$$s).$addStepToResult(T,_)}).$$s=e,$.$$arity=0,$)),R=p["$%"](l.$size()),I=l["$[]"](R),e.$addStepToResult(T,I),T)},f.$$arity=1),s.def(g,"$addStepToResult",c=function(i,$){var e;return b(i.$size(),"times",[],((e=function(_){var l;return null==_&&(_=t),l=[_,x(i["$[]"](_),$["$[]"](_))],b(i,"[]=",s.to_a(l)),l[F(l.length,1)]}).$$s=this,e.$$arity=1,e)),i},c.$$arity=2),s.def(g,"$getSuccess",v=function(i,$){var n=t;return h(this.isFailed)?"\u81ea\u52d5\u5931\u6557":(n=F($,i),this.$debug("diff",n),h(z(n,0))?"\u5931\u6557":"\u6210\u529f \u30ec\u30d9\u30eb\uff1a"+x(ee(n,5).$to_i(),1))},v.$$arity=2),s.def(g,"$rollStep",N=function(i,$){var e,n=this,o=t;return n.$debug("rollStep diceType, diceCount, @calcText",i,$,n.calcText),o=0,h(H($,0))&&(h(n.calcText["$empty?"]())||(n.calcText=x(n.calcText,"+")),n.calcText=x(n.calcText,$+"d"+i+"["),n.$debug("rollStep string",n.calcText),b($,"times",[],((e=function(p){var l=null==e.$$s?this:e.$$s,m=t,R=t;for(null==l.randomizer&&(l.randomizer=t),null==l.calcText&&(l.calcText=t),null==p&&(p=t),m=l.randomizer.$roll_once(i),h(m["$!="](1))&&(l.isFailed=!1),R=m;m["$=="](i);)R=x(R,m=l.randomizer.$roll_once(i));return o=x(o,R),h(p["$!="](0))&&(l.calcText=x(l.calcText,",")),l.calcText=x(l.calcText,R.$to_s())}).$$s=n,e.$$arity=1,e)),n.calcText=x(n.calcText,"]")),o},N.$$arity=2)}(Opal)}}]);